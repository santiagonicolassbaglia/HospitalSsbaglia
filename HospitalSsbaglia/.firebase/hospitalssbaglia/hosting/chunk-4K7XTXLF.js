import{a as V}from"./chunk-U4O4KU6Q.js";import{a as B,b as C}from"./chunk-P4PAYY2C.js";import{a as H,b as L,d as X,g as N,s as W}from"./chunk-WQDWLB3F.js";import{h as D,i as A,k as g}from"./chunk-TQDNXVMP.js";import{$a as w,Ga as a,Ha as _,Ua as u,Wa as h,Ya as r,Za as e,cb as x,fa as M,fb as t,hb as p,jb as b,kb as E,lb as v,mb as y,nb as O,pa as T,pb as k,qa as F,rb as I}from"./chunk-75HCPL27.js";import{a as f,b as P}from"./chunk-GLKGYJID.js";function z(l,d){l&1&&(r(0,"div")(1,"p"),t(2,"No hay historias cl\xEDnicas para mostrar."),e()())}function q(l,d){if(l&1&&(r(0,"div")(1,"p")(2,"strong"),t(3),e(),t(4),e()()),l&2){let s=d.$implicit;a(3),p("",s.clave,":"),a(),p(" ",s.valor,"")}}function G(l,d){if(l&1){let s=w();r(0,"div",7)(1,"input",8),v("ngModelChange",function(n){let o=T(s).$implicit;return E(o.seleccionado,n)||(o.seleccionado=n),F(n)}),e(),r(2,"p")(3,"strong"),t(4,"Fecha:"),e(),t(5),k(6,"date"),e(),r(7,"p")(8,"strong"),t(9,"Paciente:"),e(),t(10),e(),r(11,"p")(12,"strong"),t(13,"Especialista:"),e(),t(14),e(),r(15,"p")(16,"strong"),t(17,"Especialidad:"),e(),t(18),e(),r(19,"p")(20,"strong"),t(21,"Altura:"),e(),t(22),e(),r(23,"p")(24,"strong"),t(25,"Peso:"),e(),t(26),e(),r(27,"p")(28,"strong"),t(29,"Temperatura:"),e(),t(30),e(),r(31,"p")(32,"strong"),t(33,"Presi\xF3n:"),e(),t(34),e(),u(35,q,5,2,"div",9),e()}if(l&2){let s=d.$implicit;a(),b("ngModel",s.seleccionado),a(4),p(" ",I(6,10,s.fecha,"short"),""),a(5),p(" ",s.nombrePaciente,""),a(4),p(" ",s.nombreEspecialista,""),a(4),p(" ",s.especialidad,""),a(4),p(" ",s.altura," cm"),a(4),p(" ",s.peso," kg"),a(4),p(" ",s.temperatura," \xB0C"),a(4),p(" ",s.presion,""),a(),h("ngForOf",s.datosDinamicos)}}var $=(()=>{let d=class d{constructor(i,n){this.historiaClinicaService=i,this.datePipe=n,this.historiasClinicas=[],this.historiasClinicasFiltradas=[],this.filtro=""}ngOnInit(){this.historiaClinicaService.obtenerTodasHistorias().subscribe(i=>{this.historiasClinicas=i.map(n=>{let o=n.payload.doc.data();return o.id=n.payload.doc.id,o.fecha=this.convertTimestampToDate(o.fecha),o}).sort((n,o)=>o.fecha.getTime()-n.fecha.getTime()),this.historiasClinicasFiltradas=this.historiasClinicas})}convertTimestampToDate(i){return i instanceof Date?i:i.toDate()}aplicarFiltro(){let i=this.filtro.toLowerCase();this.historiasClinicasFiltradas=this.historiasClinicas.filter(n=>n.nombrePaciente.toLowerCase().includes(i)||n.nombreEspecialista.toLowerCase().includes(i)||this.dateToString(n.fecha).includes(i))}dateToString(i){return this.datePipe.transform(i,"shortDate")?.toLowerCase()||""}exportarSeleccionados(){let i=this.historiasClinicasFiltradas.filter(c=>c.seleccionado);if(i.length===0){alert("No hay historias cl\xEDnicas seleccionadas.");return}let n=i.map(c=>f({Fecha:this.dateToString(c.fecha),Paciente:c.nombrePaciente,Especialista:c.nombreEspecialista,Especialidad:c.especialidad,Altura:c.altura+" cm",Peso:c.peso+" kg",Temperatura:c.temperatura+" \xB0C",Presi\u00F3n:c.presion},c.datosDinamicos.reduce((j,S)=>P(f({},j),{[S.clave]:S.valor}),{}))),o=C.json_to_sheet(n),m=C.book_new();C.book_append_sheet(m,o,"Historias Cl\xEDnicas"),B(m,"historias_clinicas_seleccionadas.xlsx")}seleccionarTodos(){this.historiasClinicasFiltradas.forEach(i=>i.seleccionado=!0)}};d.\u0275fac=function(n){return new(n||d)(_(V),_(g))},d.\u0275cmp=M({type:d,selectors:[["app-hist-clinica-admin"]],standalone:!0,features:[y([g]),O],decls:11,vars:3,consts:[[1,"contenedor"],[4,"ngIf"],[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],[1,"botonseleccionarTodos",3,"click"],[1,"botonExportarSeleccionados",3,"click"],["class","historia-clinica",4,"ngFor","ngForOf"],[1,"historia-clinica"],["type","checkbox",1,"checkbox",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"]],template:function(n,o){n&1&&(r(0,"div",0)(1,"h2"),t(2,"Historias Cl\xEDnicas (Admin)"),e(),u(3,z,3,0,"div",1),r(4,"div",2)(5,"input",3),v("ngModelChange",function(c){return E(o.filtro,c)||(o.filtro=c),c}),x("input",function(){return o.aplicarFiltro()}),e(),r(6,"button",4),x("click",function(){return o.seleccionarTodos()}),t(7,"Seleccionar Todos"),e(),r(8,"button",5),x("click",function(){return o.exportarSeleccionados()}),t(9,"Exportar Seleccionados a Excel"),e(),u(10,G,36,13,"div",6),e()()),n&2&&(a(3),h("ngIf",o.historiasClinicas.length===0),a(2),b("ngModel",o.filtro),a(5),h("ngForOf",o.historiasClinicasFiltradas))},dependencies:[D,A,W,L,H,X,N,g],styles:[".contenedor[_ngcontent-%COMP%]{width:80%;margin:0 auto;padding:20px;border:1px solid #000000;border-radius:5px;box-shadow:0 2px 5px #000;background-color:#c9090958}h2[_ngcontent-%COMP%]{text-align:center;font-size:24px;margin-bottom:20px}.historia-clinica[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:5px;padding:15px;margin-bottom:15px}.historia-clinica[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:5px}.historia-clinica[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.datos-dinamicos[_ngcontent-%COMP%]{margin-top:10px}.datos-dinamicos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.botonseleccionarTodos[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#0b7a7a;border:1px solid #0b7a7a;border-radius:5px;padding:5px 10px;cursor:pointer}.botonExportarSeleccionados[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#0b7a7a;border:1px solid #0b7a0f;border-radius:5px;padding:5px 10px;cursor:pointer}"]});let l=d;return l})();export{$ as a};
