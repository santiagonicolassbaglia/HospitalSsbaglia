import{a as W}from"./chunk-MFCKY6MA.js";import{a as R}from"./chunk-CBWNEQSN.js";import{b as $,d as G,g as H,s as B}from"./chunk-WQDWLB3F.js";import{d as A}from"./chunk-Q3TEWXKA.js";import{h as z,i as D,k as N}from"./chunk-TQDNXVMP.js";import{$a as v,Ga as a,Ha as T,Ua as g,Wa as u,Xa as k,Ya as s,Za as r,cb as C,db as l,fa as F,fb as d,hb as m,jb as b,kb as S,lb as w,nb as I,ob as M,pa as _,pb as y,qa as f,rb as V,sb as L}from"./chunk-75HCPL27.js";import{a as P,b as O,j as h}from"./chunk-GLKGYJID.js";var U=()=>["especialidad","especialistaNombre","estado","comentario","calificacion"],q=()=>[1,2,3,4,5];function J(o,c){if(o&1&&(s(0,"p"),d(1),r()),o&2){let i=l().$implicit;a(),m("Comentario: ",i.comentario,"")}}function K(o,c){if(o&1&&(s(0,"p"),d(1),r()),o&2){let i=l().$implicit;a(),m("Calificaci\xF3n: ",i.calificacion,"")}}function Q(o,c){if(o&1){let i=v();s(0,"div")(1,"textarea",8),w("ngModelChange",function(t){_(i);let n=l(2).$implicit;return S(n.comentario,t)||(n.comentario=t),f(t)}),r(),s(2,"button",6),C("click",function(){_(i);let t=l(2).$implicit,n=l();return f(n.cancelarTurno(t))}),d(3,"Confirmar Cancelaci\xF3n"),r()()}if(o&2){let i=l(2).$implicit;a(),b("ngModel",i.comentario)}}function X(o,c){if(o&1){let i=v();s(0,"div")(1,"button",6),C("click",function(){_(i);let t=l().$implicit,n=l();return f(n.toggleCancelarTurno(t))}),d(2),r(),g(3,Q,4,1,"div",5),r()}if(o&2){let i=l().$implicit;a(2),m(" ",i.mostrarcomentario?"No Cancelar":"Cancelar Turno"," "),a(),u("ngIf",i.mostrarcomentario)}}function Z(o,c){if(o&1){let i=v();s(0,"span",11),C("click",function(){let t=_(i).$implicit,n=l(2).$implicit,p=l();return f(p.calificarAtencion(n,t))}),d(1,"\u2606"),r()}if(o&2){let i=c.$implicit,e=l(2).$implicit;k("seleccionada",e.calificacion>=i)}}function ee(o,c){o&1&&(s(0,"div",9)(1,"p"),d(2,"Calificar Atenci\xF3n:"),r(),g(3,Z,2,2,"span",10),r()),o&2&&(a(3),u("ngForOf",M(1,q)))}function te(o,c){if(o&1){let i=v();s(0,"div",4)(1,"p"),d(2),r(),s(3,"p"),d(4),r(),s(5,"p"),d(6),y(7,"date"),r(),s(8,"p"),d(9),r(),g(10,J,2,1,"p",5)(11,K,2,1,"p",5),s(12,"button",6),C("click",function(){let t=_(i).$implicit,n=l();return f(n.eliminarTurno(t.id))}),d(13,"\u2716"),r(),g(14,X,4,2,"div",5)(15,ee,4,2,"div",7),r()}if(o&2){let i=c.$implicit;a(2),m("Especialidad: ",i.especialidad,""),a(2),m("Especialista: ",i.especialistaNombre,""),a(2),m("Fecha y Hora: ",V(7,8,i.fechaHora,"short"),""),a(3),m("Estado: ",i.estado,""),a(),u("ngIf",i.comentario),a(),u("ngIf",i.calificacion),a(3),u("ngIf",i.estado!=="realizado"),a(),u("ngIf",i.estado==="realizado")}}var pe=(()=>{let c=class c{constructor(e,t){this.authService=e,this.turnoService=t,this.turnos=[],this.turnosFiltrados=[],this.especialidades=[],this.especialistas=[],this.filtroGeneral=""}ngOnInit(){return h(this,null,function*(){let e=yield this.authService.usuarioActual();this.turnoService.getTurnosByPaciente(e.uid).subscribe(t=>{this.turnos=t.map(n=>O(P({},n),{fechaHora:this.convertTimestampToDate(n.fechaHora)})),this.turnos.sort((n,p)=>n.fechaHora.getTime()-p.fechaHora.getTime()),this.turnosFiltrados=this.turnos,this.obtenerEspecialidadesYEspecialistas(t)})})}convertTimestampToDate(e){return e instanceof Date?e:e.toDate()}obtenerEspecialidadesYEspecialistas(e){let t=new Set,n=new Set;e.forEach(p=>{t.add(p.especialidad),n.add({id:p.especialistaId,nombre:p.especialistaNombre})}),this.especialidades=Array.from(t),this.especialistas=Array.from(n)}aplicarFiltro(){this.turnosFiltrados=this.turnos.filter(e=>this.buscarEnTurno(e,this.filtroGeneral))}buscarEnTurno(e,t){if(!t||(t=t.toLowerCase(),e.especialidad.toLowerCase().includes(t)||e.especialistaNombre.toLowerCase().includes(t)||e.estado.toLowerCase().includes(t)||e.fechaHora.toString().toLowerCase().includes(t)))return!0;if(e.historiaClinica){let{altura:n,peso:p,temperatura:x,presion:j,datosDinamicos:Y}=e.historiaClinica;if(n.toString().includes(t)||p.toString().includes(t)||x.toString().includes(t)||j.toLowerCase().includes(t)||Y.some(E=>E.clave.toLowerCase().includes(t)||E.valor.toLowerCase().includes(t)))return!0}return!1}cancelarTurno(e){return h(this,null,function*(){e.estado!=="realizado"&&(e.estado="cancelado",e.comentario=e.comentario?e.comentario:"Turno cancelado por el paciente",yield this.turnoService.actualizarTurno(e))})}completarEncuesta(e){e.estado==="realizado"&&this.turnoService.obtenerEncuesta(e.id).subscribe(t=>{console.log(t?"La encuesta ya fue completada":"Redirigir al formulario de encuesta")})}verResenia(e){e.estado==="realizado"&&(e.mostrarresenia=!e.mostrarresenia,e.mostrarresenia&&this.turnoService.obtenerRese\u00F1a(e.id).subscribe(t=>{e.comentario=t||"No hay rese\xF1a"}))}calificarAtencion(e,t){e.estado==="realizado"&&(e.calificacion=t,this.turnoService.actualizarTurno(e))}toggleCancelarTurno(e){e.mostrarcomentario&&(e.comentarioGuardado=e.comentario),e.mostrarcomentario=!e.mostrarcomentario}eliminarTurno(e){this.turnoService.eliminarTurno(e).then(()=>{this.turnos=this.turnos.filter(t=>t.id!==e),this.turnosFiltrados=this.turnosFiltrados.filter(t=>t.id!==e)})}};c.\u0275fac=function(t){return new(t||c)(T(A),T(W))},c.\u0275cmp=F({type:c,selectors:[["app-turnos"]],standalone:!0,features:[I],decls:5,vars:7,consts:[[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],[1,"turnos"],["class","turno",4,"ngFor","ngForOf"],[1,"turno"],[4,"ngIf"],[3,"click"],["class","calificacion",4,"ngIf"],["placeholder","Raz\xF3n de cancelaci\xF3n",3,"ngModelChange","ngModel"],[1,"calificacion"],["class","estrella",3,"seleccionada","click",4,"ngFor","ngForOf"],[1,"estrella",3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"input",1),w("ngModelChange",function(x){return S(n.filtroGeneral,x)||(n.filtroGeneral=x),x}),C("input",function(){return n.aplicarFiltro()}),r()(),s(2,"div",2),g(3,te,16,11,"div",3),y(4,"filtrarDatos"),r()),t&2&&(a(),b("ngModel",n.filtroGeneral),a(2),u("ngForOf",L(4,2,n.turnos,M(6,U),n.filtroGeneral)))},dependencies:[z,D,B,$,G,H,N,R],styles:[".filtros[_ngcontent-%COMP%]{margin-bottom:20px}.turnos[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.turno[_ngcontent-%COMP%]{border:1px solid #ccc;padding:20px;background-color:#f9f9f9;border-radius:5px}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px}.turno[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.turno[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px}.turno[_ngcontent-%COMP%]   .mostrarresenia[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-style:italic}.btn-eliminar[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:20px;cursor:pointer;color:red}.btn-eliminar[_ngcontent-%COMP%]:hover{color:#8b0000}textarea[_ngcontent-%COMP%]{width:100%;margin-top:5px}.calificacion[_ngcontent-%COMP%]{display:flex;align-items:center}.calificacion[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 10px 0 0}.estrella[_ngcontent-%COMP%]{font-size:24px;cursor:pointer;color:#ccc}.estrella.seleccionada[_ngcontent-%COMP%]{color:gold}"]});let o=c;return o})();export{pe as a};
