import{$ as J,A as Ii,Aa as Ps,B as F0,C as wp,Ca as re,D as As,Da as Rp,E as O0,Ea as Q0,F as yl,Fa as nr,G as Ds,Ga as Oe,H as Cn,Ha as xa,I as Ep,J as V0,Ja as Bt,K as vl,Ka as Pp,L as Zn,La as Y0,M as L0,Ma as X0,N as Tp,Na as wl,O as U0,P as bs,Pa as Np,Q as Ie,R as Ip,Ra as kp,S as B0,T as He,U as j0,V as Re,Va as J0,W as $0,Wa as Dn,X as An,Y as te,Z as yt,_ as q0,a as S0,aa as Cp,b as R0,ba as V,c as Lt,ca as Z,cb as bn,d as mp,da as Ci,db as Z0,e as _p,ea as ka,eb as Ns,f as Yt,fa as G0,fb as El,g as Xt,ga as vt,gb as Tl,h as Ts,ha as Fe,hb as Ma,i as P0,ia as Ai,ib as xp,j as Dr,jb as Il,k as br,ka as z0,kb as Mp,l as Is,la as Ss,m as Ee,ma as hn,mb as Fp,n as W,na as Sr,nb as Rr,o as Pa,oa as er,ob as eT,p as N0,pa as Ap,pb as tT,q as k0,qa as Rs,qb as Di,r as H,ra as Dp,s as yp,sa as tr,t as Jt,ta as xt,u as x0,ua as W0,v as vp,va as bp,w as M0,wa as H0,x as Na,xa as Ke,y as Ut,ya as Sp,z as Cs,za as K0}from"./chunk-7PBKTP3G.js";import{A as cT,B as ee,C as Mt,D as tt,E as Up,F as lT,G as Va,H as ne,I as lt,J as Rl,K as Bp,L as en,M as Nr,N as rr,O as bi,P as Fs,R as ir,S as Pl,T as it,U as jp,W as Ve,a as L,b as ks,c as Cl,d as nT,e as rT,f as xs,g as rt,h as Ms,i as Fa,j as Op,k as iT,l as Sn,m as Vp,n as Al,o as Dl,p as sT,q as bl,r as Qe,s as oT,t as aT,u as Zt,v as Pr,w as Sl,x as Oa,y as Lp,z as uT}from"./chunk-NGQSJ7MP.js";import{a as G,b as de,d as gp,e as R}from"./chunk-LYQJE5UA.js";var mT=null;function sr(){return mT}function _T(n){mT??=n}var Nl=class{};var Ft=new J(""),yT=(()=>{let e=class e{historyGo(r){throw new Error("")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>Z(jN),providedIn:"platform"});let n=e;return n})();var jN=(()=>{let e=class e extends yT{constructor(){super(),this._doc=Z(Ft),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return sr().getBaseHref(this._doc)}onPopState(r){let i=sr().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",r,!1),()=>i.removeEventListener("popstate",r)}onHashChange(r){let i=sr().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",r,!1),()=>i.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,i,s){this._history.pushState(r,i,s)}replaceState(r,i,s){this._history.replaceState(r,i,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>new e,providedIn:"platform"});let n=e;return n})();function vT(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function hT(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,r=t-(n[t-1]==="/"?1:0);return n.slice(0,r)+n.slice(t)}function Si(n){return n&&n[0]!=="?"?"?"+n:n}var Vs=(()=>{let e=class e{historyGo(r){throw new Error("")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>Z(wT),providedIn:"root"});let n=e;return n})(),$N=new J(""),wT=(()=>{let e=class e extends Vs{constructor(r,i){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Z(Ft).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return vT(this._baseHref,r)}path(r=!1){let i=this._platformLocation.pathname+Si(this._platformLocation.search),s=this._platformLocation.hash;return s&&r?`${i}${s}`:i}pushState(r,i,s,o){let a=this.prepareExternalUrl(s+Si(o));this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){let a=this.prepareExternalUrl(s+Si(o));this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}};e.\u0275fac=function(i){return new(i||e)(V(yT),V($N,8))},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var La=(()=>{let e=class e{constructor(r){this._subject=new xt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;let i=this._locationStrategy.getBaseHref();this._basePath=zN(hT(dT(i))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,i=""){return this.path()==this.normalize(r+Si(i))}normalize(r){return e.stripTrailingSlash(GN(this._basePath,dT(r)))}prepareExternalUrl(r){return r&&r[0]!=="/"&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,i="",s=null){this._locationStrategy.pushState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+Si(i)),s)}replaceState(r,i="",s=null){this._locationStrategy.replaceState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+Si(i)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",i){this._urlChangeListeners.forEach(s=>s(r,i))}subscribe(r,i,s){return this._subject.subscribe({next:r,error:i,complete:s})}};e.normalizeQueryParams=Si,e.joinWithSlash=vT,e.stripTrailingSlash=hT,e.\u0275fac=function(i){return new(i||e)(V(Vs))},e.\u0275prov=te({token:e,factory:()=>qN(),providedIn:"root"});let n=e;return n})();function qN(){return new La(V(Vs))}function GN(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function dT(n){return n.replace(/\/index.html$/,"")}function zN(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}function kl(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let r=t.indexOf("="),[i,s]=r==-1?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}var $p=class{constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},cj=(()=>{let e=class e{set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}constructor(r,i,s){this._viewContainer=r,this._template=i,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let r=this._ngForOf;if(!this._differ&&r)if(0)try{}catch{}else this._differ=this._differs.find(r).create(this.ngForTrackBy)}if(this._differ){let r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){let i=this._viewContainer;r.forEachOperation((s,o,a)=>{if(s.previousIndex==null)i.createEmbeddedView(this._template,new $p(s.item,this._ngForOf,-1,-1),a===null?void 0:a);else if(a==null)i.remove(o===null?void 0:o);else if(o!==null){let u=i.get(o);i.move(u,a),fT(u,s)}});for(let s=0,o=i.length;s<o;s++){let u=i.get(s).context;u.index=s,u.count=o,u.ngForOf=this._ngForOf}r.forEachIdentityChange(s=>{let o=i.get(s.currentIndex);fT(o,s)})}static ngTemplateContextGuard(r,i){return!0}};e.\u0275fac=function(i){return new(i||e)(re(xa),re(Rp),re(eT))},e.\u0275dir=Fe({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let n=e;return n})();function fT(n,e){n.context.$implicit=e.item}var lj=(()=>{let e=class e{constructor(r,i){this._viewContainer=r,this._context=new qp,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){pT("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){pT("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,i){return!0}};e.\u0275fac=function(i){return new(i||e)(re(xa),re(Rp))},e.\u0275dir=Fe({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let n=e;return n})(),qp=class{constructor(){this.$implicit=null,this.ngIf=null}};function pT(n,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${$0(e)}'.`)}var WN=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({});let n=e;return n})(),ET="browser",HN="server";function kr(n){return n===HN}var Os=class{};var Ba=class{},Ml=class{},or=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var zp=class{encodeKey(e){return IT(e)}encodeValue(e){return IT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function YN(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let s=i.indexOf("="),[o,a]=s==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],u=t.get(o)||[];u.push(a),t.set(o,u)}),t}var XN=/%(\d[a-f0-9])/gi,JN={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function IT(n){return encodeURIComponent(n).replace(XN,(e,t)=>JN[t]??e)}function xl(n){return`${n}`}var Mr=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new zp,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=YN(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(xl):[xl(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(xl(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(xl(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Wp=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function ZN(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function CT(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function AT(n){return typeof Blob<"u"&&n instanceof Blob}function DT(n){return typeof FormData<"u"&&n instanceof FormData}function ek(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var Ua=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(ZN(this.method)||i?(this.body=r!==void 0?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new or,this.context??=new Wp,!this.params)this.params=new Mr,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),u=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+u+o}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||CT(this.body)||AT(this.body)||DT(this.body)||ek(this.body)?this.body:this.body instanceof Mr?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||DT(this.body)?null:AT(this.body)?this.body.type||null:CT(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Mr?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.transferCache??this.transferCache,o=e.body!==void 0?e.body:this.body,a=e.withCredentials??this.withCredentials,u=e.reportProgress??this.reportProgress,l=e.headers||this.headers,h=e.params||this.params,f=e.context??this.context;return e.setHeaders!==void 0&&(l=Object.keys(e.setHeaders).reduce((g,_)=>g.set(_,e.setHeaders[_]),l)),e.setParams&&(h=Object.keys(e.setParams).reduce((g,_)=>g.set(_,e.setParams[_]),h)),new n(t,r,o,{params:h,headers:l,context:f,reportProgress:u,responseType:i,withCredentials:a,transferCache:s})}},Fr=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Fr||{}),ja=class{constructor(e,t=200,r="OK"){this.headers=e.headers||new or,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},Fl=class n extends ja{constructor(e={}){super(e),this.type=Fr.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},$a=class n extends ja{constructor(e={}){super(e),this.type=Fr.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},xr=class extends ja{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},PT=200,tk=204;function Gp(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var nk=(()=>{let e=class e{constructor(r){this.handler=r}request(r,i,s={}){let o;if(r instanceof Ua)o=r;else{let l;s.headers instanceof or?l=s.headers:l=new or(s.headers);let h;s.params&&(s.params instanceof Mr?h=s.params:h=new Mr({fromObject:s.params})),o=new Ua(r,i,s.body!==void 0?s.body:null,{headers:l,context:s.context,params:h,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let a=W(o).pipe(Ii(l=>this.handler.handle(l)));if(r instanceof Ua||s.observe==="events")return a;let u=a.pipe(Ut(l=>l instanceof $a));switch(s.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return u.pipe(H(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return u.pipe(H(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return u.pipe(H(l=>{if(l.body!==null&&typeof l.body!="string")throw new Error("Response is not a string.");return l.body}));case"json":default:return u.pipe(H(l=>l.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(r,i={}){return this.request("DELETE",r,i)}get(r,i={}){return this.request("GET",r,i)}head(r,i={}){return this.request("HEAD",r,i)}jsonp(r,i){return this.request("JSONP",r,{params:new Mr().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,i={}){return this.request("OPTIONS",r,i)}patch(r,i,s={}){return this.request("PATCH",r,Gp(s,i))}post(r,i,s={}){return this.request("POST",r,Gp(s,i))}put(r,i,s={}){return this.request("PUT",r,Gp(s,i))}};e.\u0275fac=function(i){return new(i||e)(V(Ba))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),rk=/^\)\]\}',?\n/,ik="X-Request-URL";function bT(n){if(n.url)return n.url;let e=ik.toLocaleLowerCase();return n.headers.get(e)}var sk=(()=>{let e=class e{constructor(){this.fetchImpl=Z(Hp,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Z(Oe)}handle(r){return new Lt(i=>{let s=new AbortController;return this.doRequest(r,s.signal,i).then(Kp,o=>i.error(new xr({error:o}))),()=>s.abort()})}doRequest(r,i,s){return R(this,null,function*(){let o=this.createRequestInit(r),a;try{let E=this.fetchImpl(r.urlWithParams,G({signal:i},o));ok(E),s.next({type:Fr.Sent}),a=yield E}catch(E){s.error(new xr({error:E,status:E.status??0,statusText:E.statusText,url:r.urlWithParams,headers:E.headers}));return}let u=new or(a.headers),l=a.statusText,h=bT(a)??r.urlWithParams,f=a.status,g=null;if(r.reportProgress&&s.next(new Fl({headers:u,status:f,statusText:l,url:h})),a.body){let E=a.headers.get("content-length"),b=[],I=a.body.getReader(),M=0,B,x,U=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>R(this,null,function*(){for(;;){let{done:Q,value:T}=yield I.read();if(Q)break;if(b.push(T),M+=T.length,r.reportProgress){x=r.responseType==="text"?(x??"")+(B??=new TextDecoder).decode(T,{stream:!0}):void 0;let y=()=>s.next({type:Fr.DownloadProgress,total:E?+E:void 0,loaded:M,partialText:x});U?U.run(y):y()}}}));let Y=this.concatChunks(b,M);try{let Q=a.headers.get("Content-Type")??"";g=this.parseBody(r,Y,Q)}catch(Q){s.error(new xr({error:Q,headers:new or(a.headers),status:a.status,statusText:a.statusText,url:bT(a)??r.urlWithParams}));return}}f===0&&(f=g?PT:0),f>=200&&f<300?(s.next(new $a({body:g,headers:u,status:f,statusText:l,url:h})),s.complete()):s.error(new xr({error:g,headers:u,status:f,statusText:l,url:h}))})}parseBody(r,i,s){switch(r.responseType){case"json":let o=new TextDecoder().decode(i).replace(rk,"");return o===""?null:JSON.parse(o);case"text":return new TextDecoder().decode(i);case"blob":return new Blob([i],{type:s});case"arraybuffer":return i.buffer}}createRequestInit(r){let i={},s=r.withCredentials?"include":void 0;if(r.headers.forEach((o,a)=>i[o]=a.join(",")),i.Accept??="application/json, text/plain, */*",!i["Content-Type"]){let o=r.detectContentTypeHeader();o!==null&&(i["Content-Type"]=o)}return{body:r.serializeBody(),method:r.method,headers:i,credentials:s}}concatChunks(r,i){let s=new Uint8Array(i),o=0;for(let a of r)s.set(a,o),o+=a.length;return s}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),Hp=class{};function Kp(){}function ok(n){n.then(Kp,Kp)}function ak(n,e){return e(n)}function uk(n,e,t){return(r,i)=>hn(t,()=>e(r,s=>n(s,i)))}var NT=new J(""),ck=new J(""),lk=new J("",{providedIn:"root",factory:()=>!0});var ST=(()=>{let e=class e extends Ba{constructor(r,i){super(),this.backend=r,this.injector=i,this.chain=null,this.pendingTasks=Z(wl),this.contributeToStability=Z(lk)}handle(r){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(NT),...this.injector.get(ck,[])]));this.chain=i.reduceRight((s,o)=>uk(s,o,this.injector),ak)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(r,s=>this.backend.handle(s)).pipe(Ds(()=>this.pendingTasks.remove(i)))}else return this.chain(r,i=>this.backend.handle(i))}};e.\u0275fac=function(i){return new(i||e)(V(Ml),V(Ss))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})();var hk=/^\)\]\}',?\n/;function dk(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var RT=(()=>{let e=class e{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new Re(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?Ee(i.\u0275loadImpl()):W(null)).pipe(Ie(()=>new Lt(o=>{let a=i.build();if(a.open(r.method,r.urlWithParams),r.withCredentials&&(a.withCredentials=!0),r.headers.forEach((I,M)=>a.setRequestHeader(I,M.join(","))),r.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let I=r.detectContentTypeHeader();I!==null&&a.setRequestHeader("Content-Type",I)}if(r.responseType){let I=r.responseType.toLowerCase();a.responseType=I!=="json"?I:"text"}let u=r.serializeBody(),l=null,h=()=>{if(l!==null)return l;let I=a.statusText||"OK",M=new or(a.getAllResponseHeaders()),B=dk(a)||r.url;return l=new Fl({headers:M,status:a.status,statusText:I,url:B}),l},f=()=>{let{headers:I,status:M,statusText:B,url:x}=h(),U=null;M!==tk&&(U=typeof a.response>"u"?a.responseText:a.response),M===0&&(M=U?PT:0);let Y=M>=200&&M<300;if(r.responseType==="json"&&typeof U=="string"){let Q=U;U=U.replace(hk,"");try{U=U!==""?JSON.parse(U):null}catch(T){U=Q,Y&&(Y=!1,U={error:T,text:U})}}Y?(o.next(new $a({body:U,headers:I,status:M,statusText:B,url:x||void 0})),o.complete()):o.error(new xr({error:U,headers:I,status:M,statusText:B,url:x||void 0}))},g=I=>{let{url:M}=h(),B=new xr({error:I,status:a.status||0,statusText:a.statusText||"Unknown Error",url:M||void 0});o.error(B)},_=!1,E=I=>{_||(o.next(h()),_=!0);let M={type:Fr.DownloadProgress,loaded:I.loaded};I.lengthComputable&&(M.total=I.total),r.responseType==="text"&&a.responseText&&(M.partialText=a.responseText),o.next(M)},b=I=>{let M={type:Fr.UploadProgress,loaded:I.loaded};I.lengthComputable&&(M.total=I.total),o.next(M)};return a.addEventListener("load",f),a.addEventListener("error",g),a.addEventListener("timeout",g),a.addEventListener("abort",g),r.reportProgress&&(a.addEventListener("progress",E),u!==null&&a.upload&&a.upload.addEventListener("progress",b)),a.send(u),o.next({type:Fr.Sent}),()=>{a.removeEventListener("error",g),a.removeEventListener("abort",g),a.removeEventListener("load",f),a.removeEventListener("timeout",g),r.reportProgress&&(a.removeEventListener("progress",E),u!==null&&a.upload&&a.upload.removeEventListener("progress",b)),a.readyState!==a.DONE&&a.abort()}})))}};e.\u0275fac=function(i){return new(i||e)(V(Os))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),kT=new J(""),fk="XSRF-TOKEN",pk=new J("",{providedIn:"root",factory:()=>fk}),gk="X-XSRF-TOKEN",mk=new J("",{providedIn:"root",factory:()=>gk}),Ol=class{},_k=(()=>{let e=class e{constructor(r,i,s){this.doc=r,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=kl(r,this.cookieName),this.lastCookieString=r),this.lastToken}};e.\u0275fac=function(i){return new(i||e)(V(Ft),V(Ke),V(pk))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})();function yk(n,e){let t=n.url.toLowerCase();if(!Z(kT)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=Z(Ol).getToken(),i=Z(mk);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}function Ij(...n){let e=[nk,RT,ST,{provide:Ba,useExisting:ST},{provide:Ml,useFactory:()=>Z(sk,{optional:!0})??Z(RT)},{provide:NT,useValue:yk,multi:!0},{provide:kT,useValue:!0},{provide:Ol,useClass:_k}];for(let t of n)e.push(...t.\u0275providers);return Ai(e)}var Xp=class extends Nl{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Jp=class n extends Xp{static makeCurrent(){_T(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=wk();return t==null?null:Ek(t)}resetBaseElement(){qa=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return kl(document.cookie,e)}},qa=null;function wk(){return qa=qa||document.querySelector("base"),qa?qa.getAttribute("href"):null}function Ek(n){return new URL(n,document.baseURI).pathname}var Tk=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),Zp=new J(""),OT=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new Re(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(V(Zp),V(Oe))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),Vl=class{constructor(e){this._doc=e}},Qp="ng-app-id",VT=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=kr(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${Qp}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(Qp),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(Qp,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(V(Ft),V(bp),V(Sp,8),V(Ke))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),Yp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},tg=/%COMP%/g,LT="%COMP%",Ik=`_nghost-${LT}`,Ck=`_ngcontent-${LT}`,Ak=!0,Dk=new J("",{providedIn:"root",factory:()=>Ak});function bk(n){return Ck.replace(tg,n)}function Sk(n){return Ik.replace(tg,n)}function UT(n,e){return e.map(t=>t.replace(tg,n))}var xT=(()=>{let e=class e{constructor(r,i,s,o,a,u,l,h=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=l,this.nonce=h,this.rendererByCompId=new Map,this.platformIsServer=kr(u),this.defaultRenderer=new Ga(r,a,l,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===ka.ShadowDom&&(i=de(G({},i),{encapsulation:ka.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Ll?s.applyToHost(r):s instanceof za&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,l=this.eventManager,h=this.sharedStylesHost,f=this.removeStylesOnCompDestroy,g=this.platformIsServer;switch(i.encapsulation){case ka.Emulated:o=new Ll(l,h,i,this.appId,f,a,u,g);break;case ka.ShadowDom:return new eg(l,h,r,i,a,u,this.nonce,g);default:o=new za(l,h,i,f,a,u,g);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(V(OT),V(VT),V(bp),V(Dk),V(Ft),V(Ke),V(Oe),V(Sp))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),Ga=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Yp[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(MT(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(MT(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new Re(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=Yp[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=Yp[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Ps.DashCase|Ps.Important)?e.style.setProperty(t,r,i&Ps.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Ps.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=sr().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function MT(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var eg=class extends Ga{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=UT(i.id,i.styles);for(let h of l){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=h,this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},za=class extends Ga{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?UT(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Ll=class extends za{constructor(e,t,r,i,s,o,a,u){let l=i+"-"+r.id;super(e,t,r,s,o,a,u,l),this.contentAttr=bk(l),this.hostAttr=Sk(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},Rk=(()=>{let e=class e extends Vl{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(V(Ft))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})(),FT=["alt","control","meta","shift"],Pk={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nk={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},kk=(()=>{let e=class e extends Vl{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>sr().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),FT.forEach(h=>{let f=i.indexOf(h);f>-1&&(i.splice(f,1),a+=h+".")}),a+=o,i.length!=0||o.length===0)return null;let l={};return l.domEventName=s,l.fullKey=a,l}static matchEventFullKeyCode(r,i){let s=Pk[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),FT.forEach(a=>{if(a!==s){let u=Nk[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(V(Ft))},e.\u0275prov=te({token:e,factory:e.\u0275fac});let n=e;return n})();function e$(n,e){return tT(G({rootComponent:n},xk(e)))}function xk(n){return{appProviders:[...Lk,...n?.providers??[]],platformProviders:Vk}}function Mk(){Jp.makeCurrent()}function Fk(){return new Dp}function Ok(){return W0(document),document}var Vk=[{provide:Ke,useValue:ET},{provide:H0,useValue:Mk,multi:!0},{provide:Ft,useFactory:Ok,deps:[]}];var Lk=[{provide:z0,useValue:"root"},{provide:Dp,useFactory:Fk,deps:[]},{provide:Zp,useClass:Rk,multi:!0,deps:[Ft,Oe,Ke]},{provide:Zp,useClass:kk,multi:!0,deps:[Ft]},xT,VT,OT,{provide:Q0,useExisting:xT},{provide:Os,useClass:Tk,deps:[]},[]];var BT=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(V(Ft))},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var ae="primary",uu=Symbol("RouteTitle"),og=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function qs(n){return new og(n)}function Bk(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o[0]===":")i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function jk(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Rn(n[t],e[t]))return!1;return!0}function Rn(n,e){let t=n?ag(n):void 0,r=e?ag(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!KT(n[i],e[i]))return!1;return!0}function ag(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function KT(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function QT(n){return n.length>0?n[n.length-1]:null}function Lr(n){return N0(n)?n:Ma(n)?Ee(Promise.resolve(n)):W(n)}var $k={exact:XT,subset:JT},YT={exact:qk,subset:Gk,ignored:()=>!0};function jT(n,e,t){return $k[t.paths](n.root,e.root,t.matrixParams)&&YT[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function qk(n,e){return Rn(n,e)}function XT(n,e,t){if(!Pi(n.segments,e.segments)||!jl(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!XT(n.children[r],e.children[r],t))return!1;return!0}function Gk(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>KT(n[t],e[t]))}function JT(n,e,t){return ZT(n,e,e.segments,t)}function ZT(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Pi(i,t)||e.hasChildren()||!jl(i,t,r))}else if(n.segments.length===t.length){if(!Pi(n.segments,t)||!jl(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!JT(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Pi(n.segments,i)||!jl(n.segments,i,r)||!n.children[ae]?!1:ZT(n.children[ae],e,s,r)}}function jl(n,e,t){return e.every((r,i)=>YT[t](n[i].parameters,r.parameters))}var Or=class{constructor(e=new ve([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=qs(this.queryParams),this._queryParamMap}toString(){return Hk.serialize(this)}},ve=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return $l(this)}},Ri=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=qs(this.parameters),this._parameterMap}toString(){return tI(this)}};function zk(n,e){return Pi(n,e)&&n.every((t,r)=>Rn(t.parameters,e[r].parameters))}function Pi(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function Wk(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===ae&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==ae&&(t=t.concat(e(i,r)))}),t}var xg=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>new Ja,providedIn:"root"});let n=e;return n})(),Ja=class{parse(e){let t=new cg(e);return new Or(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Wa(e.root,!0)}`,r=Yk(e.queryParams),i=typeof e.fragment=="string"?`#${Kk(e.fragment)}`:"";return`${t}${r}${i}`}},Hk=new Ja;function $l(n){return n.segments.map(e=>tI(e)).join("/")}function Wa(n,e){if(!n.hasChildren())return $l(n);if(e){let t=n.children[ae]?Wa(n.children[ae],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==ae&&r.push(`${i}:${Wa(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=Wk(n,(r,i)=>i===ae?[Wa(n.children[ae],!1)]:[`${i}:${Wa(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[ae]!=null?`${$l(n)}/${t[0]}`:`${$l(n)}/(${t.join("//")})`}}function eI(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ul(n){return eI(n).replace(/%3B/gi,";")}function Kk(n){return encodeURI(n)}function ug(n){return eI(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ql(n){return decodeURIComponent(n)}function $T(n){return ql(n.replace(/\+/g,"%20"))}function tI(n){return`${ug(n.path)}${Qk(n.parameters)}`}function Qk(n){return Object.entries(n).map(([e,t])=>`;${ug(e)}=${ug(t)}`).join("")}function Yk(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Ul(t)}=${Ul(i)}`).join("&"):`${Ul(t)}=${Ul(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var Xk=/^[^\/()?;#]+/;function ng(n){let e=n.match(Xk);return e?e[0]:""}var Jk=/^[^\/()?;=#]+/;function Zk(n){let e=n.match(Jk);return e?e[0]:""}var ex=/^[^=?&#]+/;function tx(n){let e=n.match(ex);return e?e[0]:""}var nx=/^[^&#]+/;function rx(n){let e=n.match(nx);return e?e[0]:""}var cg=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ve([],{}):new ve([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[ae]=new ve(e,t)),r}parseSegment(){let e=ng(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Re(4009,!1);return this.capture(e),new Ri(ql(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=Zk(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=ng(this.remaining);i&&(r=i,this.capture(r))}e[ql(t)]=ql(r)}parseQueryParam(e){let t=tx(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=rx(this.remaining);o&&(r=o,this.capture(r))}let i=$T(t),s=$T(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=ng(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new Re(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=ae);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[ae]:new ve([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Re(4011,!1)}};function nI(n){return n.segments.length>0?new ve([],{[ae]:n}):n}function rI(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=rI(i);if(r===ae&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new ve(n.segments,e);return ix(t)}function ix(n){if(n.numberOfChildren===1&&n.children[ae]){let e=n.children[ae];return new ve(n.segments.concat(e.segments),e.children)}return n}function Za(n){return n instanceof Or}function sx(n,e,t=null,r=null){let i=iI(n);return sI(i,e,t,r)}function iI(n){let e;function t(s){let o={};for(let u of s.children){let l=t(u);o[u.outlet]=l}let a=new ve(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=nI(r);return e??i}function sI(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return rg(i,i,i,t,r);let s=ox(e);if(s.toRoot())return rg(i,i,new ve([],{}),t,r);let o=ax(s,i,n),a=o.processChildren?Qa(o.segmentGroup,o.index,s.commands):aI(o.segmentGroup,o.index,s.commands);return rg(i,o.segmentGroup,a,t,r)}function Gl(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function eu(n){return typeof n=="object"&&n!=null&&n.outlets}function rg(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,l])=>{s[u]=Array.isArray(l)?l.map(h=>`${h}`):`${l}`});let o;n===e?o=t:o=oI(n,e,t);let a=nI(rI(o));return new Or(a,s,i)}function oI(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=oI(s,e,t)}),new ve(n.segments,r)}var zl=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Gl(r[0]))throw new Re(4003,!1);let i=r.find(eu);if(i&&i!==QT(r))throw new Re(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ox(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new zl(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,l])=>{a[u]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new zl(t,e,r)}var Bs=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function ax(n,e,t){if(n.isAbsolute)return new Bs(e,!0,0);if(!t)return new Bs(e,!1,NaN);if(t.parent===null)return new Bs(t,!0,0);let r=Gl(n.commands[0])?0:1,i=t.segments.length-1+r;return ux(t,i,n.numberOfDoubleDots)}function ux(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Re(4005,!1);i=r.segments.length}return new Bs(r,!1,i-s)}function cx(n){return eu(n[0])?n[0].outlets:{[ae]:n}}function aI(n,e,t){if(n??=new ve([],{}),n.segments.length===0&&n.hasChildren())return Qa(n,e,t);let r=lx(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new ve(n.segments.slice(0,r.pathIndex),{});return s.children[ae]=new ve(n.segments.slice(r.pathIndex),n.children),Qa(s,0,i)}else return r.match&&i.length===0?new ve(n.segments,{}):r.match&&!n.hasChildren()?lg(n,e,t):r.match?Qa(n,0,i):lg(n,e,t)}function Qa(n,e,t){if(t.length===0)return new ve(n.segments,{});{let r=cx(t),i={};if(Object.keys(r).some(s=>s!==ae)&&n.children[ae]&&n.numberOfChildren===1&&n.children[ae].segments.length===0){let s=Qa(n.children[ae],e,t);return new ve(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=aI(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new ve(n.segments,i)}}function lx(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(eu(a))break;let u=`${a}`,l=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&l&&typeof l=="object"&&l.outlets===void 0){if(!GT(u,l,o))return s;r+=2}else{if(!GT(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function lg(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(eu(s)){let u=hx(s.outlets);return new ve(r,u)}if(i===0&&Gl(t[0])){let u=n.segments[e];r.push(new Ri(u.path,qT(t[0]))),i++;continue}let o=eu(s)?s.outlets[ae]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Gl(a)?(r.push(new Ri(o,qT(a))),i+=2):(r.push(new Ri(o,{})),i++)}return new ve(r,{})}function hx(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=lg(new ve([],{}),0,r))}),e}function qT(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function GT(n,e,t){return n==t.path&&Rn(e,t.parameters)}var Ya="imperative",ht=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(ht||{}),tn=class{constructor(e,t){this.id=e,this.url=t}},tu=class extends tn{constructor(e,t,r="imperative",i=null){super(e,t),this.type=ht.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Vr=class extends tn{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=ht.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},$t=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}($t||{}),hg=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(hg||{}),ar=class extends tn{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=ht.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ni=class extends tn{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=ht.NavigationSkipped}},nu=class extends tn{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=ht.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Wl=class extends tn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ht.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dg=class extends tn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ht.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fg=class extends tn{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=ht.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},pg=class extends tn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ht.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},gg=class extends tn{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=ht.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},mg=class{constructor(e){this.route=e,this.type=ht.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},_g=class{constructor(e){this.route=e,this.type=ht.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},yg=class{constructor(e){this.snapshot=e,this.type=ht.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},vg=class{constructor(e){this.snapshot=e,this.type=ht.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},wg=class{constructor(e){this.snapshot=e,this.type=ht.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Eg=class{constructor(e){this.snapshot=e,this.type=ht.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var ru=class{},Gs=class{constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};var Tg=class{constructor(e){this.injector=e,this.outlet=null,this.route=null,this.children=new Zl(this.injector),this.attachRef=null}},Zl=(()=>{let e=class e{constructor(r){this.parentInjector=r,this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new Tg(this.parentInjector),this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)(V(Ss))},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Hl=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Ig(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Ig(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Cg(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Cg(e,this._root).map(t=>t.value)}};function Ig(n,e){if(n===e.value)return e;for(let t of e.children){let r=Ig(n,t);if(r)return r}return null}function Cg(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Cg(n,t);if(r.length)return r.unshift(e),r}return[]}var jt=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Us(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Kl=class extends Hl{constructor(e,t){super(e),this.snapshot=t,Mg(this,e)}toString(){return this.snapshot.toString()}};function uI(n){let e=dx(n),t=new Xt([new Ri("",{})]),r=new Xt({}),i=new Xt({}),s=new Xt({}),o=new Xt(""),a=new ki(t,r,s,o,i,ae,n,e.root);return a.snapshot=e.root,new Kl(new jt(a,[]),e)}function dx(n){let e={},t={},r={},i="",s=new js([],e,r,i,t,ae,n,null,{});return new Yl("",new jt(s,[]))}var ki=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(H(l=>l[uu]))??W(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(H(e=>qs(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(H(e=>qs(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ql(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:G(G({},e.params),n.params),data:G(G({},e.data),n.data),resolve:G(G(G(G({},n.data),e.data),i?.data),n._resolvedData)}:r={params:G({},n.params),data:G({},n.data),resolve:G(G({},n.data),n._resolvedData??{})},i&&lI(i)&&(r.resolve[uu]=i.title),r}var js=class{get title(){return this.data?.[uu]}constructor(e,t,r,i,s,o,a,u,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=qs(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=qs(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Yl=class extends Hl{constructor(e,t){super(t),this.url=e,Mg(this,t)}toString(){return cI(this._root)}};function Mg(n,e){e.value._routerState=n,e.children.forEach(t=>Mg(n,t))}function cI(n){let e=n.children.length>0?` { ${n.children.map(cI).join(", ")} } `:"";return`${n.value}${e}`}function ig(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Rn(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Rn(e.params,t.params)||n.paramsSubject.next(t.params),jk(e.url,t.url)||n.urlSubject.next(t.url),Rn(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Ag(n,e){let t=Rn(n.params,e.params)&&zk(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Ag(n.parent,e.parent))}function lI(n){return typeof n.title=="string"||n.title===null}var fx=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=ae,this.activateEvents=new xt,this.deactivateEvents=new xt,this.attachEvents=new xt,this.detachEvents=new xt,this.parentContexts=Z(Zl),this.location=Z(xa),this.changeDetector=Z(Rr),this.inputBinder=Z(Fg,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Re(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Re(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Re(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new Re(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,l=new Dg(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:l,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Fe({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Sr]});let n=e;return n})(),Dg=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===ki?this.route:e===Zl?this.childContexts:this.parent.get(e,t)}},Fg=new J("");function px(n,e,t){let r=iu(n,e._root,t?t._root:void 0);return new Kl(r,e)}function iu(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=gx(n,e,t);return new jt(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>iu(n,a)),o}}let r=mx(e.value),i=e.children.map(s=>iu(n,s));return new jt(r,i)}}function gx(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return iu(n,r,i);return iu(n,r)})}function mx(n){return new ki(new Xt(n.url),new Xt(n.params),new Xt(n.queryParams),new Xt(n.fragment),new Xt(n.data),n.outlet,n.component,n)}var su=class{constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},hI="ngNavigationCancelingError";function Xl(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Za(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=dI(!1,$t.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function dI(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[hI]=!0,t.cancellationCode=e,t}function _x(n){return fI(n)&&Za(n.url)}function fI(n){return!!n&&n[hI]}var yx=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=G0({type:e,selectors:[["ng-component"]],standalone:!0,features:[Z0],decls:1,vars:0,template:function(i,s){i&1&&J0(0,"router-outlet")},dependencies:[fx],encapsulation:2});let n=e;return n})();function vx(n,e){return n.providers&&!n._injector&&(n._injector=X0(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Og(n){let e=n.children&&n.children.map(Og),t=e?de(G({},n),{children:e}):G({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ae&&(t.component=yx),t}function fn(n){return n.outlet||ae}function wx(n,e){let t=n.filter(r=>fn(r)===e);return t.push(...n.filter(r=>fn(r)!==e)),t}function cu(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Ex=(n,e,t,r)=>H(i=>(new bg(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),bg=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),ig(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Us(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Us(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Us(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Us(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Eg(s.value.snapshot))}),e.children.length&&this.forwardEvent(new vg(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(ig(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),ig(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=cu(i.snapshot);o.attachRef=null,o.route=i,o.injector=a??o.injector,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},Jl=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},$s=class{constructor(e,t){this.component=e,this.route=t}};function Tx(n,e,t){let r=n._root,i=e?e._root:null;return Ha(r,i,t,[r.value])}function Ix(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Ws(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!q0(n)?n:e.get(n):r}function Ha(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Us(e);return n.children.forEach(o=>{Cx(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Xa(a,t.getContext(o),i)),i}function Cx(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=Ax(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new Jl(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Ha(n,e,a?a.children:null,r,i):Ha(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new $s(a.outlet.component,o))}else o&&Xa(e,a,i),i.canActivateChecks.push(new Jl(r)),s.component?Ha(n,null,a?a.children:null,r,i):Ha(n,null,t,r,i);return i}function Ax(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Pi(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Pi(n.url,e.url)||!Rn(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ag(n,e)||!Rn(n.queryParams,e.queryParams);case"paramsChange":default:return!Ag(n,e)}}function Xa(n,e,t){let r=Us(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?Xa(o,e.children.getContext(s),t):Xa(o,null,t):Xa(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new $s(e.outlet.component,i)):t.canDeactivateChecks.push(new $s(null,i)):t.canDeactivateChecks.push(new $s(null,i))}function lu(n){return typeof n=="function"}function Dx(n){return typeof n=="boolean"}function bx(n){return n&&lu(n.canLoad)}function Sx(n){return n&&lu(n.canActivate)}function Rx(n){return n&&lu(n.canActivateChild)}function Px(n){return n&&lu(n.canDeactivate)}function Nx(n){return n&&lu(n.canMatch)}function pI(n){return n instanceof k0||n?.name==="EmptyError"}var Bl=Symbol("INITIAL_VALUE");function zs(){return Ie(n=>yp(n.map(e=>e.pipe(As(1),bs(Bl)))).pipe(H(e=>{for(let t of e)if(t!==!0){if(t===Bl)return Bl;if(t===!1||kx(t))return t}return!0}),Ut(e=>e!==Bl),As(1)))}function kx(n){return Za(n)||n instanceof su}function xx(n,e){return Jt(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?W(de(G({},t),{guardsResult:!0})):Mx(o,r,i,n).pipe(Jt(a=>a&&Dx(a)?Fx(r,s,n,e):W(a)),H(a=>de(G({},t),{guardsResult:a})))})}function Mx(n,e,t,r){return Ee(n).pipe(Jt(i=>Bx(i.component,i.route,t,e,r)),Cn(i=>i!==!0,!0))}function Fx(n,e,t,r){return Ee(e).pipe(Ii(i=>x0(Vx(i.route.parent,r),Ox(i.route,r),Ux(n,i.path,t),Lx(n,i.route,t))),Cn(i=>i!==!0,!0))}function Ox(n,e){return n!==null&&e&&e(new wg(n)),W(!0)}function Vx(n,e){return n!==null&&e&&e(new yg(n)),W(!0)}function Lx(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return W(!0);let i=r.map(s=>vp(()=>{let o=cu(e)??t,a=Ws(s,o),u=Sx(a)?a.canActivate(e,n):hn(o,()=>a(e,n));return Lr(u).pipe(Cn())}));return W(i).pipe(zs())}function Ux(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>Ix(o)).filter(o=>o!==null).map(o=>vp(()=>{let a=o.guards.map(u=>{let l=cu(o.node)??t,h=Ws(u,l),f=Rx(h)?h.canActivateChild(r,n):hn(l,()=>h(r,n));return Lr(f).pipe(Cn())});return W(a).pipe(zs())}));return W(s).pipe(zs())}function Bx(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return W(!0);let o=s.map(a=>{let u=cu(e)??i,l=Ws(a,u),h=Px(l)?l.canDeactivate(n,e,t,r):hn(u,()=>l(n,e,t,r));return Lr(h).pipe(Cn())});return W(o).pipe(zs())}function jx(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return W(!0);let s=i.map(o=>{let a=Ws(o,n),u=bx(a)?a.canLoad(e,t):hn(n,()=>a(e,t));return Lr(u)});return W(s).pipe(zs(),gI(r))}function gI(n){return R0(He(e=>{if(typeof e!="boolean")throw Xl(n,e)}),H(e=>e===!0))}function $x(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return W(!0);let s=i.map(o=>{let a=Ws(o,n),u=Nx(a)?a.canMatch(e,t):hn(n,()=>a(e,t));return Lr(u)});return W(s).pipe(zs(),gI(r))}var ou=class{constructor(e){this.segmentGroup=e||null}},au=class extends Error{constructor(e){super(),this.urlTree=e}};function Ls(n){return Pa(new ou(n))}function qx(n){return Pa(new Re(4e3,!1))}function Gx(n){return Pa(dI(!1,$t.GuardRejected))}var Sg=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return W(r);if(i.numberOfChildren>1||!i.children[ae])return qx(`${e.redirectTo}`);i=i.children[ae]}}applyRedirectCommands(e,t,r,i,s){if(typeof t!="string"){let a=t,{queryParams:u,fragment:l,routeConfig:h,url:f,outlet:g,params:_,data:E,title:b}=i,I=hn(s,()=>a({params:_,data:E,queryParams:u,fragment:l,routeConfig:h,url:f,outlet:g,title:b}));if(I instanceof Or)throw new au(I);t=I}let o=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t[0]==="/")throw new au(o);return o}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new Or(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new ve(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new Re(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Rg={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function zx(n,e,t,r,i){let s=Vg(n,e,t);return s.matched?(r=vx(e,r),$x(r,e,t,i).pipe(H(o=>o===!0?s:G({},Rg)))):W(s)}function Vg(n,e,t){if(e.path==="**")return Wx(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?G({},Rg):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||Bk)(t,n,e);if(!i)return G({},Rg);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?G(G({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function Wx(n){return{matched:!0,parameters:n.length>0?QT(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function zT(n,e,t,r){return t.length>0&&Qx(n,t,r)?{segmentGroup:new ve(e,Kx(r,new ve(t,n.children))),slicedSegments:[]}:t.length===0&&Yx(n,t,r)?{segmentGroup:new ve(n.segments,Hx(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new ve(n.segments,n.children),slicedSegments:t}}function Hx(n,e,t,r){let i={};for(let s of t)if(eh(n,e,s)&&!r[fn(s)]){let o=new ve([],{});i[fn(s)]=o}return G(G({},r),i)}function Kx(n,e){let t={};t[ae]=e;for(let r of n)if(r.path===""&&fn(r)!==ae){let i=new ve([],{});t[fn(r)]=i}return t}function Qx(n,e,t){return t.some(r=>eh(n,e,r)&&fn(r)!==ae)}function Yx(n,e,t){return t.some(r=>eh(n,e,r))}function eh(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function Xx(n,e,t,r){return fn(n)!==r&&(r===ae||!eh(e,t,n))?!1:Vg(e,n,t).matched}function Jx(n,e,t){return e.length===0&&!n.children[t]}var Pg=class{};function Zx(n,e,t,r,i,s,o="emptyOnly"){return new Ng(n,e,t,r,i,o,s).recognize()}var eM=31,Ng=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Sg(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new Re(4002,`'${e.segmentGroup}'`)}recognize(){let e=zT(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(H(({children:t,rootSnapshot:r})=>{let i=new jt(r,t),s=new Yl("",i),o=sx(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(e){let t=new js([],Object.freeze({}),Object.freeze(G({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),ae,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,ae,t).pipe(H(r=>({children:r,rootSnapshot:t})),Cs(r=>{if(r instanceof au)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof ou?this.noMatchError(r):r}))}processSegmentGroup(e,t,r,i,s){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r,s):this.processSegment(e,t,r,r.segments,i,!0,s).pipe(H(o=>o instanceof jt?[o]:[]))}processChildren(e,t,r,i){let s=[];for(let o of Object.keys(r.children))o==="primary"?s.unshift(o):s.push(o);return Ee(s).pipe(Ii(o=>{let a=r.children[o],u=wx(t,o);return this.processSegmentGroup(e,u,a,o,i)}),Zn((o,a)=>(o.push(...a),o)),wp(null),V0(),Jt(o=>{if(o===null)return Ls(r);let a=mI(o);return tM(a),W(a)}))}processSegment(e,t,r,i,s,o,a){return Ee(t).pipe(Ii(u=>this.processSegmentAgainstRoute(u._injector??e,t,u,r,i,s,o,a).pipe(Cs(l=>{if(l instanceof ou)return W(null);throw l}))),Cn(u=>!!u),Cs(u=>{if(pI(u))return Jx(r,i,s)?W(new Pg):Ls(r);throw u}))}processSegmentAgainstRoute(e,t,r,i,s,o,a,u){return Xx(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o,u):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o,u):Ls(i):Ls(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o,a){let{matched:u,parameters:l,consumedSegments:h,positionalParamSegments:f,remainingSegments:g}=Vg(t,i,s);if(!u)return Ls(t);typeof i.redirectTo=="string"&&i.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>eM&&(this.allowRedirects=!1));let _=new js(s,l,Object.freeze(G({},this.urlTree.queryParams)),this.urlTree.fragment,WT(i),fn(i),i.component??i._loadedComponent??null,i,HT(i)),E=Ql(_,a,this.paramsInheritanceStrategy);_.params=Object.freeze(E.params),_.data=Object.freeze(E.data);let b=this.applyRedirects.applyRedirectCommands(h,i.redirectTo,f,_,e);return this.applyRedirects.lineralizeSegments(i,b).pipe(Jt(I=>this.processSegment(e,r,t,I.concat(g),o,!1,a)))}matchSegmentAgainstRoute(e,t,r,i,s,o){let a=zx(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),a.pipe(Ie(u=>u.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(Ie(({routes:l})=>{let h=r._loadedInjector??e,{parameters:f,consumedSegments:g,remainingSegments:_}=u,E=new js(g,f,Object.freeze(G({},this.urlTree.queryParams)),this.urlTree.fragment,WT(r),fn(r),r.component??r._loadedComponent??null,r,HT(r)),b=Ql(E,o,this.paramsInheritanceStrategy);E.params=Object.freeze(b.params),E.data=Object.freeze(b.data);let{segmentGroup:I,slicedSegments:M}=zT(t,g,_,l);if(M.length===0&&I.hasChildren())return this.processChildren(h,l,I,E).pipe(H(x=>new jt(E,x)));if(l.length===0&&M.length===0)return W(new jt(E,[]));let B=fn(r)===s;return this.processSegment(h,l,I,M,B?ae:s,!0,E).pipe(H(x=>new jt(E,x instanceof jt?[x]:[])))}))):Ls(t)))}getChildConfig(e,t,r){return t.children?W({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?W({routes:t._loadedRoutes,injector:t._loadedInjector}):jx(e,t,r,this.urlSerializer).pipe(Jt(i=>i?this.configLoader.loadChildren(e,t).pipe(He(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):Gx(t))):W({routes:[],injector:e})}};function tM(n){n.sort((e,t)=>e.value.outlet===ae?-1:t.value.outlet===ae?1:e.value.outlet.localeCompare(t.value.outlet))}function nM(n){let e=n.value.routeConfig;return e&&e.path===""}function mI(n){let e=[],t=new Set;for(let r of n){if(!nM(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=mI(r.children);e.push(new jt(r.value,i))}return e.filter(r=>!t.has(r))}function WT(n){return n.data||{}}function HT(n){return n.resolve||{}}function rM(n,e,t,r,i,s){return Jt(o=>Zx(n,e,t,r,o.extractedUrl,i,s).pipe(H(({state:a,tree:u})=>de(G({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function iM(n,e){return Jt(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return W(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let l of _I(u))o.add(l);let a=0;return Ee(o).pipe(Ii(u=>s.has(u)?sM(u,r,n,e):(u.data=Ql(u,u.parent,n).resolve,W(void 0))),He(()=>a++),Ep(1),Jt(u=>a===o.size?W(t):Dr))})}function _I(n){let e=n.children.map(t=>_I(t)).flat();return[n,...e]}function sM(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!lI(i)&&(s[uu]=i.title),oM(s,n,e,r).pipe(H(o=>(n._resolvedData=o,n.data=Ql(n,n.parent,t).resolve,null)))}function oM(n,e,t,r){let i=ag(n);if(i.length===0)return W({});let s={};return Ee(i).pipe(Jt(o=>aM(n[o],e,t,r).pipe(Cn(),He(a=>{if(a instanceof su)throw Xl(new Ja,a);s[o]=a}))),Ep(1),O0(s),Cs(o=>pI(o)?Dr:Pa(o)))}function aM(n,e,t,r){let i=cu(e)??r,s=Ws(n,i),o=s.resolve?s.resolve(e,t):hn(i,()=>s(e,t));return Lr(o)}function sg(n){return Ie(e=>{let t=n(e);return t?Ee(t).pipe(H(()=>e)):W(e)})}var yI=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===ae);return i}getResolvedTitleForRoute(r){return r.data[uu]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>Z(uM),providedIn:"root"});let n=e;return n})(),uM=(()=>{let e=class e extends yI{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(V(BT))},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Lg=new J("",{providedIn:"root",factory:()=>({})}),Ug=new J(""),cM=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Z(Mp)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return W(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=Lr(r.loadComponent()).pipe(H(vI),He(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),Ds(()=>{this.componentLoaders.delete(r)})),s=new _p(i,()=>new Yt).pipe(mp());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return W({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=lM(i,this.compiler,r,this.onLoadEndListener).pipe(Ds(()=>{this.childrenLoaders.delete(i)})),a=new _p(o,()=>new Yt).pipe(mp());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function lM(n,e,t,r){return Lr(n.loadChildren()).pipe(H(vI),Jt(i=>i instanceof Y0||Array.isArray(i)?W(i):Ee(e.compileModuleAsync(i))),H(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Ug,[],{optional:!0,self:!0}).flat()),{routes:o.map(Og),injector:s}}))}function hM(n){return n&&typeof n=="object"&&"default"in n}function vI(n){return hM(n)?n.default:n}var Bg=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>Z(dM),providedIn:"root"});let n=e;return n})(),dM=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),fM=new J("");var pM=new J(""),gM=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Yt,this.transitionAbortSubject=new Yt,this.configLoader=Z(cM),this.environmentInjector=Z(Ss),this.urlSerializer=Z(xg),this.rootContexts=Z(Zl),this.location=Z(La),this.inputBindingEnabled=Z(Fg,{optional:!0})!==null,this.titleStrategy=Z(yI),this.options=Z(Lg,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Z(Bg),this.createViewTransition=Z(fM,{optional:!0}),this.navigationErrorHandler=Z(pM,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>W(void 0),this.rootComponentType=null;let r=s=>this.events.next(new mg(s)),i=s=>this.events.next(new _g(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(de(G(G({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new Xt({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Ya,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ut(o=>o.id!==0),H(o=>de(G({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Ie(o=>{let a=!1,u=!1;return W(o).pipe(Ie(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",$t.SupersededByNewNavigation),Dr;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?de(G({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let h=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),f=l.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!h&&f!=="reload"){let g="";return this.events.next(new Ni(l.id,this.urlSerializer.serialize(l.rawUrl),g,hg.IgnoredSameUrlNavigation)),l.resolve(!1),Dr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return W(l).pipe(Ie(g=>{let _=this.transitions?.getValue();return this.events.next(new tu(g.id,this.urlSerializer.serialize(g.extractedUrl),g.source,g.restoredState)),_!==this.transitions?.getValue()?Dr:Promise.resolve(g)}),rM(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),He(g=>{o.targetSnapshot=g.targetSnapshot,o.urlAfterRedirects=g.urlAfterRedirects,this.currentNavigation=de(G({},this.currentNavigation),{finalUrl:g.urlAfterRedirects});let _=new Wl(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(_)}));if(h&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:g,extractedUrl:_,source:E,restoredState:b,extras:I}=l,M=new tu(g,this.urlSerializer.serialize(_),E,b);this.events.next(M);let B=uI(this.rootComponentType).snapshot;return this.currentTransition=o=de(G({},l),{targetSnapshot:B,urlAfterRedirects:_,extras:de(G({},I),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=_,W(o)}else{let g="";return this.events.next(new Ni(l.id,this.urlSerializer.serialize(l.extractedUrl),g,hg.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Dr}}),He(l=>{let h=new dg(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),H(l=>(this.currentTransition=o=de(G({},l),{guards:Tx(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),o)),xx(this.environmentInjector,l=>this.events.next(l)),He(l=>{if(o.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw Xl(this.urlSerializer,l.guardsResult);let h=new fg(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(h)}),Ut(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",$t.GuardRejected),!1)),sg(l=>{if(l.guards.canActivateChecks.length)return W(l).pipe(He(h=>{let f=new pg(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}),Ie(h=>{let f=!1;return W(h).pipe(iM(this.paramsInheritanceStrategy,this.environmentInjector),He({next:()=>f=!0,complete:()=>{f||this.cancelNavigationTransition(h,"",$t.NoDataFromResolver)}}))}),He(h=>{let f=new gg(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}))}),sg(l=>{let h=f=>{let g=[];f.routeConfig?.loadComponent&&!f.routeConfig._loadedComponent&&g.push(this.configLoader.loadComponent(f.routeConfig).pipe(He(_=>{f.component=_}),H(()=>{})));for(let _ of f.children)g.push(...h(_));return g};return yp(h(l.targetSnapshot.root)).pipe(wp(null),As(1))}),sg(()=>this.afterPreactivation()),Ie(()=>{let{currentSnapshot:l,targetSnapshot:h}=o,f=this.createViewTransition?.(this.environmentInjector,l.root,h.root);return f?Ee(f).pipe(H(()=>o)):W(o)}),H(l=>{let h=px(r.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o=de(G({},l),{targetRouterState:h}),this.currentNavigation.targetRouterState=h,o}),He(()=>{this.events.next(new ru)}),Ex(this.rootContexts,r.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),As(1),He({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Vr(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),B0(this.transitionAbortSubject.pipe(He(l=>{throw l}))),Ds(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",$t.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Cs(l=>{if(u=!0,fI(l))this.events.next(new ar(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),_x(l)?this.events.next(new Gs(l.url,l.navigationBehaviorOptions)):o.resolve(!1);else{let h=new nu(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0);try{let f=hn(this.environmentInjector,()=>this.navigationErrorHandler?.(h));if(f instanceof su){let{message:g,cancellationCode:_}=Xl(this.urlSerializer,f);this.events.next(new ar(o.id,this.urlSerializer.serialize(o.extractedUrl),g,_)),this.events.next(new Gs(f.redirectTo,f.navigationBehaviorOptions))}else{this.events.next(h);let g=r.errorHandler(l);o.resolve(!!g)}}catch(f){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(f)}}return Dr}))}))}cancelNavigationTransition(r,i,s){let o=new ar(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function mM(n){return n!==Ya}var _M=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>Z(yM),providedIn:"root"});let n=e;return n})(),kg=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},yM=(()=>{let e=class e extends kg{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),wI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:()=>Z(vM),providedIn:"root"});let n=e;return n})(),vM=(()=>{let e=class e extends wI{constructor(){super(...arguments),this.location=Z(La),this.urlSerializer=Z(xg),this.options=Z(Lg,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Z(Bg),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Or,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=uI(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof tu)this.stateMemento=this.createStateMemento();else if(r instanceof Ni)this.rawUrlTree=i.initialUrl;else if(r instanceof Wl){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof ru?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof ar&&(r.code===$t.GuardRejected||r.code===$t.NoDataFromResolver)?this.restoreHistory(i):r instanceof nu?this.restoreHistory(i,!0):r instanceof Vr&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=G(G({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=G(G({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ka=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Ka||{});function wM(n,e){n.events.pipe(Ut(t=>t instanceof Vr||t instanceof ar||t instanceof nu||t instanceof Ni),H(t=>t instanceof Vr||t instanceof Ni?Ka.COMPLETE:(t instanceof ar?t.code===$t.Redirect||t.code===$t.SupersededByNewNavigation:!1)?Ka.REDIRECTING:Ka.FAILED),Ut(t=>t!==Ka.REDIRECTING),As(1)).subscribe(()=>{e()})}function EM(n){throw n}var TM={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},IM={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},jg=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Z(Tl),this.stateManager=Z(wI),this.options=Z(Lg,{optional:!0})||{},this.pendingTasks=Z(wl),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Z(gM),this.urlSerializer=Z(xg),this.location=Z(La),this.urlHandlingStrategy=Z(Bg),this._events=new Yt,this.errorHandler=this.options.errorHandler||EM,this.navigated=!1,this.routeReuseStrategy=Z(_M),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Z(Ug,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Z(Fg,{optional:!0}),this.eventsSubscription=new S0,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof ar&&i.code!==$t.Redirect&&i.code!==$t.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Vr)this.navigated=!0;else if(i instanceof Gs){let a=i.navigationBehaviorOptions,u=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),l=G({info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:s.extras.replaceUrl||this.urlUpdateStrategy==="eager"||mM(s.source)},a);this.scheduleNavigation(u,Ya,null,l,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}AM(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ya,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let l=G({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Og),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:l}=i,h=l?this.currentUrlTree.fragment:a,f=null;switch(u){case"merge":f=G(G({},this.currentUrlTree.queryParams),o);break;case"preserve":f=this.currentUrlTree.queryParams;break;default:f=o||null}f!==null&&(f=this.removeEmptyProps(f));let g;try{let _=s?s.snapshot:this.routerState.snapshot.root;g=iI(_)}catch{(typeof r[0]!="string"||r[0][0]!=="/")&&(r=[]),g=this.currentUrlTree.root}return sI(g,r,f,h??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Za(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Ya,null,i)}navigate(r,i={skipLocationChange:!1}){return CM(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=G({},TM):i===!1?s=G({},IM):s=i,Za(r))return jT(this.currentUrlTree,r,s);let o=this.parseUrl(r);return jT(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,l,h;a?(u=a.resolve,l=a.reject,h=a.promise):h=new Promise((g,_)=>{u=g,l=_});let f=this.pendingTasks.add();return wM(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(f))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:l,promise:h,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),h.catch(g=>Promise.reject(g))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function CM(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new Re(4008,!1)}function AM(n){return!(n instanceof ru)&&!(n instanceof Gs)}var N$=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Yt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let l=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=r.events.subscribe(h=>{h instanceof Vr&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:K0(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(re(jg),re(ki),Ap("tabindex"),re(nr),re(tr),re(Vs))},e.\u0275dir=Fe({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&Dn("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&Np("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Di],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Di],replaceUrl:[2,"replaceUrl","replaceUrl",Di],routerLink:"routerLink"},standalone:!0,features:[Pp,Sr]});let n=e;return n})();var DM=new J("");function k$(n,...e){return Ai([{provide:Ug,multi:!0,useValue:n},[],{provide:ki,useFactory:bM,deps:[jg]},{provide:xp,multi:!0,useFactory:SM},e.map(t=>t.\u0275providers)])}function bM(n){return n.routerState.root}function SM(){let n=Z(Rs);return e=>{let t=n.get(Il);if(e!==t.components[0])return;let r=n.get(jg),i=n.get(RM);n.get(PM)===1&&r.initialNavigation(),n.get(NM,null,Cp.Optional)?.setUpPreloading(),n.get(DM,null,Cp.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var RM=new J("",{factory:()=>new Yt}),PM=new J("",{providedIn:"root",factory:()=>1});var NM=new J("");var NI=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(re(nr),re(tr))},e.\u0275dir=Fe({type:e});let n=e;return n})(),_u=(()=>{let e=class e extends NI{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275dir=Fe({type:e,features:[Bt]});let n=e;return n})(),Mi=new J(""),kM={provide:Mi,useExisting:An(()=>xM),multi:!0},xM=(()=>{let e=class e extends _u{writeValue(r){this.setProperty("checked",r)}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275dir=Fe({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,s){i&1&&Dn("change",function(a){return s.onChange(a.target.checked)})("blur",function(){return s.onTouched()})},features:[bn([kM]),Bt]});let n=e;return n})(),MM={provide:Mi,useExisting:An(()=>kI),multi:!0};function FM(){let n=sr()?sr().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var OM=new J(""),kI=(()=>{let e=class e extends NI{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!FM())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(re(nr),re(tr),re(OM,8))},e.\u0275dir=Fe({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Dn("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[bn([MM]),Bt]});let n=e;return n})();function Ur(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function xI(n){return n!=null&&typeof n.length=="number"}var ch=new J(""),lh=new J(""),VM=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,EI=class{static min(e){return LM(e)}static max(e){return UM(e)}static required(e){return BM(e)}static requiredTrue(e){return jM(e)}static email(e){return $M(e)}static minLength(e){return qM(e)}static maxLength(e){return GM(e)}static pattern(e){return zM(e)}static nullValidator(e){return MI(e)}static compose(e){return BI(e)}static composeAsync(e){return jI(e)}};function LM(n){return e=>{if(Ur(e.value)||Ur(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function UM(n){return e=>{if(Ur(e.value)||Ur(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function BM(n){return Ur(n.value)?{required:!0}:null}function jM(n){return n.value===!0?null:{required:!0}}function $M(n){return Ur(n.value)||VM.test(n.value)?null:{email:!0}}function qM(n){return e=>Ur(e.value)||!xI(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function GM(n){return e=>xI(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function zM(n){if(!n)return MI;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Ur(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function MI(n){return null}function FI(n){return n!=null}function OI(n){return Ma(n)?Ee(n):n}function VI(n){let e={};return n.forEach(t=>{e=t!=null?G(G({},e),t):e}),Object.keys(e).length===0?null:e}function LI(n,e){return e.map(t=>t(n))}function WM(n){return!n.validate}function UI(n){return n.map(e=>WM(e)?e:t=>e.validate(t))}function BI(n){if(!n)return null;let e=n.filter(FI);return e.length==0?null:function(t){return VI(LI(t,e))}}function Hg(n){return n!=null?BI(UI(n)):null}function jI(n){if(!n)return null;let e=n.filter(FI);return e.length==0?null:function(t){let r=LI(t,e).map(OI);return M0(r).pipe(H(VI))}}function Kg(n){return n!=null?jI(UI(n)):null}function TI(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function $I(n){return n._rawValidators}function qI(n){return n._rawAsyncValidators}function $g(n){return n?Array.isArray(n)?n:[n]:[]}function nh(n,e){return Array.isArray(n)?n.includes(e):n===e}function II(n,e){let t=$g(e);return $g(n).forEach(i=>{nh(t,i)||t.push(i)}),t}function CI(n,e){return $g(e).filter(t=>!nh(n,t))}var rh=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Hg(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Kg(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ur=class extends rh{get formDirective(){return null}get path(){return null}},xi=class extends rh{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ih=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},HM={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Y$=de(G({},HM),{"[class.ng-submitted]":"isSubmitted"}),X$=(()=>{let e=class e extends ih{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(re(xi,2))},e.\u0275dir=Fe({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&kp("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Bt]});let n=e;return n})(),J$=(()=>{let e=class e extends ih{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(re(ur,10))},e.\u0275dir=Fe({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&kp("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Bt]});let n=e;return n})();var hu="VALID",th="INVALID",Hs="PENDING",du="DISABLED",Br=class{},sh=class extends Br{constructor(e,t){super(),this.value=e,this.source=t}},pu=class extends Br{constructor(e,t){super(),this.pristine=e,this.source=t}},gu=class extends Br{constructor(e,t){super(),this.touched=e,this.source=t}},Ks=class extends Br{constructor(e,t){super(),this.status=e,this.source=t}},qg=class extends Br{constructor(e){super(),this.source=e}},Gg=class extends Br{constructor(e){super(),this.source=e}};function Qg(n){return(hh(n)?n.validators:n)||null}function KM(n){return Array.isArray(n)?Hg(n):n||null}function Yg(n,e){return(hh(e)?e.asyncValidators:n)||null}function QM(n){return Array.isArray(n)?Kg(n):n||null}function hh(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function GI(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Re(1e3,"");if(!r[t])throw new Re(1001,"")}function zI(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Re(1002,"")})}var Qs=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._events=new Yt,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===hu}get invalid(){return this.status===th}get pending(){return this.status==Hs}get disabled(){return this.status===du}get enabled(){return this.status!==du}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(II(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(II(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(CI(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(CI(e,this._rawAsyncValidators))}hasValidator(e){return nh(this._rawValidators,e)}hasAsyncValidator(e){return nh(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(de(G({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new gu(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new gu(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(de(G({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new pu(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new pu(!0,r))}markAsPending(e={}){this.status=Hs;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ks(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(de(G({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=du,this.errors=null,this._forEachChild(i=>{i.disable(de(G({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new sh(this.value,r)),this._events.next(new Ks(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(de(G({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=hu,this._forEachChild(r=>{r.enable(de(G({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(de(G({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===hu||this.status===Hs)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new sh(this.value,t)),this._events.next(new Ks(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(de(G({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?du:hu}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Hs,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=OI(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Ks(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new xt,this.statusChanges=new xt}_calculateStatus(){return this._allControlsDisabled()?du:this.errors?th:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Hs)?Hs:this._anyControlsHaveStatus(th)?th:hu}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new pu(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new gu(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){hh(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=KM(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=QM(this._rawAsyncValidators)}},Ys=class extends Qs{constructor(e,t,r){super(Qg(t),Yg(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){zI(this,!0,e),Object.keys(e).forEach(r=>{GI(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var zg=class extends Ys{};var yu=new J("CallSetDisabledState",{providedIn:"root",factory:()=>dh}),dh="always";function WI(n,e){return[...e.path,n]}function oh(n,e,t=dh){Xg(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),XM(n,e),ZM(n,e),JM(n,e),YM(n,e)}function AI(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),uh(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function ah(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function YM(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Xg(n,e){let t=$I(n);e.validator!==null?n.setValidators(TI(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=qI(n);e.asyncValidator!==null?n.setAsyncValidators(TI(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();ah(e._rawValidators,i),ah(e._rawAsyncValidators,i)}function uh(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=$I(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=qI(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return ah(e._rawValidators,r),ah(e._rawAsyncValidators,r),t}function XM(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&HI(n,e)})}function JM(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&HI(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function HI(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function ZM(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function KI(n,e){n==null,Xg(n,e)}function eF(n,e){return uh(n,e)}function QI(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function tF(n){return Object.getPrototypeOf(n.constructor)===_u}function YI(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function XI(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===kI?t=s:tF(s)?r=s:i=s}),i||r||t||null}function nF(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var rF={provide:ur,useExisting:An(()=>iF)},fu=Promise.resolve(),iF=(()=>{let e=class e extends ur{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new xt,this.form=new Ys({},Hg(r),Kg(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){fu.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),oh(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){fu.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){fu.then(()=>{let i=this._findContainer(r.path),s=new Ys({});KI(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){fu.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){fu.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,YI(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(re(ch,10),re(lh,10),re(yu,8))},e.\u0275dir=Fe({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Dn("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[bn([rF]),Bt]});let n=e;return n})();function DI(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function bI(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var mu=class extends Qs{constructor(e=null,t,r){super(Qg(t),Yg(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),hh(t)&&(t.nonNullable||t.initialValueIsDefault)&&(bI(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){DI(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){DI(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){bI(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var sF=n=>n instanceof mu;var oF={provide:xi,useExisting:An(()=>aF)},SI=Promise.resolve(),aF=(()=>{let e=class e extends xi{constructor(r,i,s,o,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this.control=new mu,this._registered=!1,this.name="",this.update=new xt,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=XI(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),QI(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){oh(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){SI.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Di(i);SI.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?WI(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(re(ur,9),re(ch,10),re(lh,10),re(Mi,10),re(Rr,8),re(yu,8))},e.\u0275dir=Fe({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[bn([oF]),Bt,Sr]});let n=e;return n})(),eq=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Fe({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})(),uF={provide:Mi,useExisting:An(()=>cF),multi:!0},cF=(()=>{let e=class e extends _u{writeValue(r){let i=r??"";this.setProperty("value",i)}registerOnChange(r){this.onChange=i=>{r(i==""?null:parseFloat(i))}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275dir=Fe({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,s){i&1&&Dn("input",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},features:[bn([uF]),Bt]});let n=e;return n})();var JI=new J("");var lF={provide:ur,useExisting:An(()=>hF)},hF=(()=>{let e=class e extends ur{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new xt,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(uh(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return oh(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){AI(r.control||null,r,!1),nF(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,YI(this.form,this.directives),this.ngSubmit.emit(r),this.form._events.next(new qg(this.control)),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1,this.form._events.next(new Gg(this.form))}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(AI(i||null,r),sF(s)&&(oh(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);KI(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&eF(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Xg(this.form,this),this._oldForm&&uh(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(re(ch,10),re(lh,10),re(yu,8))},e.\u0275dir=Fe({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&Dn("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[bn([lF]),Bt,Sr]});let n=e;return n})();var dF={provide:xi,useExisting:An(()=>fF)},fF=(()=>{let e=class e extends xi{set isDisabled(r){}constructor(r,i,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new xt,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=XI(this,o)}ngOnChanges(r){this._added||this._setUpControl(),QI(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return WI(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(re(ur,13),re(ch,10),re(lh,10),re(Mi,10),re(JI,8))},e.\u0275dir=Fe({type:e,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[bn([dF]),Bt,Sr]});let n=e;return n})(),pF={provide:Mi,useExisting:An(()=>eC),multi:!0};function ZI(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function gF(n){return n.split(":")[0]}var eC=(()=>{let e=class e extends _u{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i=this._getOptionId(r),s=ZI(i,r);this.setProperty("value",s)}registerOnChange(r){this.onChange=i=>{this.value=this._getOptionValue(i),r(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),r))return i;return null}_getOptionValue(r){let i=gF(r);return this._optionMap.has(i)?this._optionMap.get(i):r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275dir=Fe({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){i&1&&Dn("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[bn([pF]),Bt]});let n=e;return n})(),tq=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(r){this._select!=null&&(this._select._optionMap.set(this.id,r),this._setElementValue(ZI(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._setElementValue(r),this._select&&this._select.writeValue(this._select.value)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(re(tr),re(nr),re(eC,9))},e.\u0275dir=Fe({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),mF={provide:Mi,useExisting:An(()=>tC),multi:!0};function RI(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function _F(n){return n.split(":")[0]}var tC=(()=>{let e=class e extends _u{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i;if(Array.isArray(r)){let s=r.map(o=>this._getOptionId(o));i=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else i=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(r){this.onChange=i=>{let s=[],o=i.selectedOptions;if(o!==void 0){let a=o;for(let u=0;u<a.length;u++){let l=a[u],h=this._getOptionValue(l.value);s.push(h)}}else{let a=i.options;for(let u=0;u<a.length;u++){let l=a[u];if(l.selected){let h=this._getOptionValue(l.value);s.push(h)}}}this.value=s,r(s)}}_registerOption(r){let i=(this._idCounter++).toString();return this._optionMap.set(i,r),i}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,r))return i;return null}_getOptionValue(r){let i=_F(r);return this._optionMap.has(i)?this._optionMap.get(i)._value:r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=er(e)))(s||e)}})(),e.\u0275dir=Fe({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){i&1&&Dn("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[bn([mF]),Bt]});let n=e;return n})(),nq=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(r){this._select!=null&&(this._value=r,this._setElementValue(RI(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._select?(this._value=r,this._setElementValue(RI(this.id,r)),this._select.writeValue(this._select.value)):this._setElementValue(r)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}_setSelected(r){this._renderer.setProperty(this._element.nativeElement,"selected",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(re(tr),re(nr),re(tC,9))},e.\u0275dir=Fe({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();var nC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({});let n=e;return n})(),Wg=class extends Qs{constructor(e,t,r){super(Qg(t),Yg(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){zI(this,!1,e),e.forEach((r,i)=>{GI(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function PI(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var rq=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return PI(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Ys(s,o)}record(r,i=null){let s=this._reduceControls(r);return new zg(s,i)}control(r,i,s){let o={};return this.useNonNullable?(PI(i)?o=i:(o.validators=i,o.asyncValidators=s),new mu(r,de(G({},o),{nonNullable:!0}))):new mu(r,i,s)}array(r,i,s){let o=r.map(a=>this._createControl(a));return new Wg(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof mu)return r;if(r instanceof Qs)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var iq=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:yu,useValue:r.callSetDisabledState??dh}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({imports:[nC]});let n=e;return n})(),sq=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:JI,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:yu,useValue:r.callSetDisabledState??dh}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({imports:[nC]});let n=e;return n})();var vu=class{constructor(e,t,r,i,s,o,a,u,l,h,f){this.obraSocial=null,this.especialidad=null,this.imagenes=[],this.lastLogin=null,this.nombre=e,this.apellido=t,this.dni=r,this.edad=i,this.obraSocial=s,this.especialidad=o,this.contrase\u00F1a=a,this.mail=u,this.imagenes=l,this.code=h,this.lastLogin=f}};var yF="firebase",vF="10.12.2";Ve.registerVersion(yF,vF,"app-compat");var wF="firebase",EF="10.12.2";it(wF,EF,"app");var gn=new Ns("ANGULARFIRE2_VERSION");function rG(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var TF=(n,e)=>{let t=e?[e]:Pl(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},pn=class{constructor(){return TF(IF)}},IF="app-check";function Jg(){}var fh=class{zone;delegate;constructor(e,t=P0){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Zg=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Jg,{},Jg,Jg)),t.pipe(He({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Pn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new fh(Zone.current)),this.insideAngular=t.run(()=>new fh(Zone.current,Ts)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(V(Oe))};static \u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function rC(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function em(n){return n.pipe(br(rC().outsideAngular))}function Ne(n){return CF(rC())(n)}function CF(n){return function(t){return t=t.lift(new Zg(n.ngZone)),t.pipe(Is(n.outsideAngular),br(n.insideAngular))}}var wu=class{constructor(e){return e}},tm=class{constructor(){return Pl()}};function AF(n){return n&&n.length===1?n[0]:new wu(ir())}var nm=new J("angularfire2._apps"),DF={provide:wu,useFactory:AF,deps:[[new Ci,nm]]},bF={provide:tm,deps:[[new Ci,nm]]};function SF(n){return(e,t)=>{let r=t.get(Ke);it("angularfire",gn.full,"core"),it("angularfire",gn.full,"app"),it("angular",El.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new wu(i)}}function gG(n,...e){return Ai([DF,bF,{provide:nm,useFactory:SF(n),multi:!0,deps:[Oe,Rs,Pn,...e]}])}var RF=new Map,PF={activated:!1,tokenObservers:[]},NF={initialized:!1,enabled:!1};function mn(n){return RF.get(n)||Object.assign({},PF)}function uC(){return NF}var kF="https://content-firebaseappcheck.googleapis.com/v1";var xF="exchangeDebugToken",iC={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},DG=24*60*60*1e3;var im=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return R(this,null,function*(){this.stop();try{this.pending=new rt,this.pending.promise.catch(t=>{}),yield MF(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new rt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function MF(n){return new Promise(e=>{setTimeout(e,n)})}var FF={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},jr=new sT("appCheck","AppCheck",FF);function cC(n){if(!mn(n).activated)throw jr.create("use-before-activation",{appName:n.name})}function lC(r,i){return R(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let _=yield o.getHeartbeatsHeader();_&&(s["X-Firebase-Client"]=_)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,a)}catch(_){throw jr.create("fetch-network-error",{originalErrorMessage:_?.message})}if(u.status!==200)throw jr.create("fetch-status-error",{httpStatus:u.status});let l;try{l=yield u.json()}catch(_){throw jr.create("fetch-parse-error",{originalErrorMessage:_?.message})}let h=l.ttl.match(/^([\d.]+)(s)$/);if(!h||!h[2]||isNaN(Number(h[1])))throw jr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let f=Number(h[1])*1e3,g=Date.now();return{token:l.token,expireTimeMillis:g+f,issuedAtTimeMillis:g}})}function hC(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${kF}/projects/${t}/apps/${r}:${xF}?key=${i}`,body:{debug_token:e}}}var OF="firebase-app-check-database",VF=1,sm="firebase-app-check-store";var gh=null;function LF(){return gh||(gh=new Promise((n,e)=>{try{let t=indexedDB.open(OF,VF);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(jr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(sm,{keyPath:"compositeKey"})}}}catch(t){e(jr.create("storage-open",{originalErrorMessage:t?.message}))}}),gh)}function UF(n,e){return BF(jF(n),e)}function BF(n,e){return R(this,null,function*(){let r=(yield LF()).transaction(sm,"readwrite"),s=r.objectStore(sm).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var l;a(jr.create("storage-set",{originalErrorMessage:(l=u.target.error)===null||l===void 0?void 0:l.message}))}})})}function jF(n){return`${n.options.appId}-${n.name}`}var om=new Nr("@firebase/app-check");function rm(n,e){return Al()?UF(n,e).catch(t=>{om.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function dC(){return uC().enabled}function fC(){return R(this,null,function*(){let n=uC();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var $F={error:"UNKNOWN_ERROR"};function qF(n){return Cl.encodeString(JSON.stringify(n),!1)}function am(n,e=!1){return R(this,null,function*(){let t=n.app;cC(t);let r=mn(t),i=r.token,s;if(i&&!Eu(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(Eu(u)?i=u:yield rm(t,void 0))}if(!e&&i&&Eu(i))return{token:i.token};let o=!1;if(dC()){r.exchangeTokenPromise||(r.exchangeTokenPromise=lC(hC(t,yield fC()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield rm(t,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield mn(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?om.warn(u.message):om.error(u),s=u}let a;return i?s?Eu(i)?a={token:i.token,internalError:s}:a=oC(s):(a={token:i.token},r.token=i,yield rm(t,i)):a=oC(s),o&&HF(t,a),a})}function GF(n){return R(this,null,function*(){let e=n.app;cC(e);let{provider:t}=mn(e);if(dC()){let r=yield fC(),{token:i}=yield lC(hC(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function zF(n,e,t,r){let{app:i}=n,s=mn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Eu(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),sC(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>sC(n))}function pC(n,e){let t=mn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function sC(n){let{app:e}=n,t=mn(e),r=t.tokenRefresher;r||(r=WF(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function WF(n){let{app:e}=n;return new im(()=>R(this,null,function*(){let t=mn(e),r;if(t.token?r=yield am(n,!0):r=yield am(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=mn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},iC.RETRIAL_MIN_WAIT,iC.RETRIAL_MAX_WAIT)}function HF(n,e){let t=mn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Eu(n){return n.expireTimeMillis-Date.now()>0}function oC(n){return{token:qF($F),error:n}}var um=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=mn(this.app);for(let t of e)pC(this.app,t.next);return Promise.resolve()}};function KF(n,e){return new um(n,e)}function QF(n){return{getToken:e=>am(n,e),getLimitedUseToken:()=>GF(n),addTokenListener:e=>zF(n,"INTERNAL",e),removeTokenListener:e=>pC(n.app,e)}}var YF="@firebase/app-check",XF="0.8.4";var JF="app-check",aC="app-check-internal";function ZF(){rr(new lt(JF,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return KF(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(aC).initialize()})),rr(new lt(aC,n=>{let e=n.getProvider("app-check").getImmediate();return QF(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),it(YF,XF)}ZF();var eO=["localhost","0.0.0.0","127.0.0.1"],LG=typeof window<"u"&&eO.includes(window.location.hostname);var tO=["ngOnDestroy"],mC=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(tO.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(l=>t.run(()=>l)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,l)=>o.then(h=>{let f=h?.(...l);return r?.spy?.apply&&r.spy.apply(s,l,f),f})})})});var _h=class{constructor(e){return e}},Nn=new J("angularfire2.app.options"),kn=new J("angularfire2.app.name");function cr(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Ve.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Ve.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;nO("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new _h(o)}var nO=(n,...e)=>{Fp()&&typeof console<"u"&&console[n](...e)},rO={provide:_h,useFactory:cr,deps:[Nn,Oe,[new Ci,kn]]},WG=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Nn,useValue:t},{provide:kn,useValue:r}]}}constructor(t){Ve.registerVersion("angularfire",gn.full,"core"),Ve.registerVersion("angularfire",gn.full,"app-compat"),Ve.registerVersion("angular",El.full,t.toString())}static \u0275fac=function(r){return new(r||n)(V(Ke))};static \u0275mod=vt({type:n});static \u0275inj=yt({providers:[rO]})}return n})();function $r(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return iO(i,o)||(gC("error",`${e} was already initialized on the ${t} Firebase App with different settings.${sO?" You may need to reload as Firebase is not HMR aware.":""}`),gC("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function iO(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var sO=typeof module<"u"&&!!module.hot,gC=(n,...e)=>{Fp()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Tu=new J("angularfire2.auth.use-emulator"),Iu=new J("angularfire2.auth.settings"),Cu=new J("angularfire2.auth.tenant-id"),Au=new J("angularfire2.auth.langugage-code"),Du=new J("angularfire2.auth.use-device-language"),bu=new J("angularfire.auth.persistence"),Su=(n,e,t,r,i,s,o,a)=>$r(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[l,h]of Object.entries(o))u.settings[l]=h;return a&&u.setPersistence(a),u},[t,r,i,s,o,a]),Xs=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,u,l,h,f,g,_){let E=new Yt,b=W(void 0).pipe(br(o.outsideAngular),Ie(()=>s.runOutsideAngular(()=>import("./chunk-4SAHTF7X.js"))),H(()=>cr(t,s,r)),H(I=>Su(I,s,a,l,h,f,u,g)),Tp({bufferSize:1,refCount:!1}));if(kr(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=W(null);else{b.pipe(Cn()).subscribe();let I=b.pipe(Ie(x=>x.getRedirectResult().then(U=>U,()=>null)),Ne,Tp({bufferSize:1,refCount:!1})),M=b.pipe(Ie(x=>new Lt(U=>({unsubscribe:s.runOutsideAngular(()=>x.onAuthStateChanged(Y=>U.next(Y),Y=>U.error(Y),()=>U.complete()))})))),B=b.pipe(Ie(x=>new Lt(U=>({unsubscribe:s.runOutsideAngular(()=>x.onIdTokenChanged(Y=>U.next(Y),Y=>U.error(Y),()=>U.complete()))}))));this.authState=I.pipe(Ip(M),Is(o.outsideAngular),br(o.insideAngular)),this.user=I.pipe(Ip(B),Is(o.outsideAngular),br(o.insideAngular)),this.idToken=this.user.pipe(Ie(x=>x?Ee(x.getIdToken()):W(null))),this.idTokenResult=this.user.pipe(Ie(x=>x?Ee(x.getIdTokenResult()):W(null))),this.credential=Na(I,E,this.authState.pipe(Ut(x=>!x))).pipe(H(x=>x?.user?x:null),Is(o.outsideAngular),br(o.insideAngular))}return mC(this,b,s,{spy:{apply:(I,M,B)=>{(I.startsWith("signIn")||I.startsWith("createUser"))&&B.then(x=>E.next(x))}}})}static \u0275fac=function(r){return new(r||n)(V(Nn),V(kn,8),V(Ke),V(Oe),V(Pn),V(Tu,8),V(Iu,8),V(Cu,8),V(Au,8),V(Du,8),V(bu,8),V(pn,8))};static \u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var _C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yC={};var qr,lm;(function(){var n;function e(T,y){function w(){}w.prototype=y.prototype,T.D=y.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(C,A,S){for(var v=Array(arguments.length-2),Yn=2;Yn<arguments.length;Yn++)v[Yn-2]=arguments[Yn];return y.prototype[A].apply(C,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,y,w){w||(w=0);var C=Array(16);if(typeof y=="string")for(var A=0;16>A;++A)C[A]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(A=0;16>A;++A)C[A]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=T.g[0],w=T.g[1],A=T.g[2];var S=T.g[3],v=y+(S^w&(A^S))+C[0]+3614090360&4294967295;y=w+(v<<7&4294967295|v>>>25),v=S+(A^y&(w^A))+C[1]+3905402710&4294967295,S=y+(v<<12&4294967295|v>>>20),v=A+(w^S&(y^w))+C[2]+606105819&4294967295,A=S+(v<<17&4294967295|v>>>15),v=w+(y^A&(S^y))+C[3]+3250441966&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(S^w&(A^S))+C[4]+4118548399&4294967295,y=w+(v<<7&4294967295|v>>>25),v=S+(A^y&(w^A))+C[5]+1200080426&4294967295,S=y+(v<<12&4294967295|v>>>20),v=A+(w^S&(y^w))+C[6]+2821735955&4294967295,A=S+(v<<17&4294967295|v>>>15),v=w+(y^A&(S^y))+C[7]+4249261313&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(S^w&(A^S))+C[8]+1770035416&4294967295,y=w+(v<<7&4294967295|v>>>25),v=S+(A^y&(w^A))+C[9]+2336552879&4294967295,S=y+(v<<12&4294967295|v>>>20),v=A+(w^S&(y^w))+C[10]+4294925233&4294967295,A=S+(v<<17&4294967295|v>>>15),v=w+(y^A&(S^y))+C[11]+2304563134&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(S^w&(A^S))+C[12]+1804603682&4294967295,y=w+(v<<7&4294967295|v>>>25),v=S+(A^y&(w^A))+C[13]+4254626195&4294967295,S=y+(v<<12&4294967295|v>>>20),v=A+(w^S&(y^w))+C[14]+2792965006&4294967295,A=S+(v<<17&4294967295|v>>>15),v=w+(y^A&(S^y))+C[15]+1236535329&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(A^S&(w^A))+C[1]+4129170786&4294967295,y=w+(v<<5&4294967295|v>>>27),v=S+(w^A&(y^w))+C[6]+3225465664&4294967295,S=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(S^y))+C[11]+643717713&4294967295,A=S+(v<<14&4294967295|v>>>18),v=w+(S^y&(A^S))+C[0]+3921069994&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(A^S&(w^A))+C[5]+3593408605&4294967295,y=w+(v<<5&4294967295|v>>>27),v=S+(w^A&(y^w))+C[10]+38016083&4294967295,S=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(S^y))+C[15]+3634488961&4294967295,A=S+(v<<14&4294967295|v>>>18),v=w+(S^y&(A^S))+C[4]+3889429448&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(A^S&(w^A))+C[9]+568446438&4294967295,y=w+(v<<5&4294967295|v>>>27),v=S+(w^A&(y^w))+C[14]+3275163606&4294967295,S=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(S^y))+C[3]+4107603335&4294967295,A=S+(v<<14&4294967295|v>>>18),v=w+(S^y&(A^S))+C[8]+1163531501&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(A^S&(w^A))+C[13]+2850285829&4294967295,y=w+(v<<5&4294967295|v>>>27),v=S+(w^A&(y^w))+C[2]+4243563512&4294967295,S=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(S^y))+C[7]+1735328473&4294967295,A=S+(v<<14&4294967295|v>>>18),v=w+(S^y&(A^S))+C[12]+2368359562&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(w^A^S)+C[5]+4294588738&4294967295,y=w+(v<<4&4294967295|v>>>28),v=S+(y^w^A)+C[8]+2272392833&4294967295,S=y+(v<<11&4294967295|v>>>21),v=A+(S^y^w)+C[11]+1839030562&4294967295,A=S+(v<<16&4294967295|v>>>16),v=w+(A^S^y)+C[14]+4259657740&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(w^A^S)+C[1]+2763975236&4294967295,y=w+(v<<4&4294967295|v>>>28),v=S+(y^w^A)+C[4]+1272893353&4294967295,S=y+(v<<11&4294967295|v>>>21),v=A+(S^y^w)+C[7]+4139469664&4294967295,A=S+(v<<16&4294967295|v>>>16),v=w+(A^S^y)+C[10]+3200236656&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(w^A^S)+C[13]+681279174&4294967295,y=w+(v<<4&4294967295|v>>>28),v=S+(y^w^A)+C[0]+3936430074&4294967295,S=y+(v<<11&4294967295|v>>>21),v=A+(S^y^w)+C[3]+3572445317&4294967295,A=S+(v<<16&4294967295|v>>>16),v=w+(A^S^y)+C[6]+76029189&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(w^A^S)+C[9]+3654602809&4294967295,y=w+(v<<4&4294967295|v>>>28),v=S+(y^w^A)+C[12]+3873151461&4294967295,S=y+(v<<11&4294967295|v>>>21),v=A+(S^y^w)+C[15]+530742520&4294967295,A=S+(v<<16&4294967295|v>>>16),v=w+(A^S^y)+C[2]+3299628645&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(A^(w|~S))+C[0]+4096336452&4294967295,y=w+(v<<6&4294967295|v>>>26),v=S+(w^(y|~A))+C[7]+1126891415&4294967295,S=y+(v<<10&4294967295|v>>>22),v=A+(y^(S|~w))+C[14]+2878612391&4294967295,A=S+(v<<15&4294967295|v>>>17),v=w+(S^(A|~y))+C[5]+4237533241&4294967295,w=A+(v<<21&4294967295|v>>>11),v=y+(A^(w|~S))+C[12]+1700485571&4294967295,y=w+(v<<6&4294967295|v>>>26),v=S+(w^(y|~A))+C[3]+2399980690&4294967295,S=y+(v<<10&4294967295|v>>>22),v=A+(y^(S|~w))+C[10]+4293915773&4294967295,A=S+(v<<15&4294967295|v>>>17),v=w+(S^(A|~y))+C[1]+2240044497&4294967295,w=A+(v<<21&4294967295|v>>>11),v=y+(A^(w|~S))+C[8]+1873313359&4294967295,y=w+(v<<6&4294967295|v>>>26),v=S+(w^(y|~A))+C[15]+4264355552&4294967295,S=y+(v<<10&4294967295|v>>>22),v=A+(y^(S|~w))+C[6]+2734768916&4294967295,A=S+(v<<15&4294967295|v>>>17),v=w+(S^(A|~y))+C[13]+1309151649&4294967295,w=A+(v<<21&4294967295|v>>>11),v=y+(A^(w|~S))+C[4]+4149444226&4294967295,y=w+(v<<6&4294967295|v>>>26),v=S+(w^(y|~A))+C[11]+3174756917&4294967295,S=y+(v<<10&4294967295|v>>>22),v=A+(y^(S|~w))+C[2]+718787259&4294967295,A=S+(v<<15&4294967295|v>>>17),v=w+(S^(A|~y))+C[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(A+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+S&4294967295}r.prototype.u=function(T,y){y===void 0&&(y=T.length);for(var w=y-this.blockSize,C=this.B,A=this.h,S=0;S<y;){if(A==0)for(;S<=w;)i(this,T,S),S+=this.blockSize;if(typeof T=="string"){for(;S<y;)if(C[A++]=T.charCodeAt(S++),A==this.blockSize){i(this,C),A=0;break}}else for(;S<y;)if(C[A++]=T[S++],A==this.blockSize){i(this,C),A=0;break}}this.h=A,this.o+=y},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;var w=8*this.o;for(y=T.length-8;y<T.length;++y)T[y]=w&255,w/=256;for(this.u(T),T=Array(16),y=w=0;4>y;++y)for(var C=0;32>C;C+=8)T[w++]=this.g[y]>>>C&255;return T};function s(T,y){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=y(T)}function o(T,y){this.h=y;for(var w=[],C=!0,A=T.length-1;0<=A;A--){var S=T[A]|0;C&&S==y||(w[A]=S,C=!1)}this.g=w}var a={};function u(T){return-128<=T&&128>T?s(T,function(y){return new o([y|0],0>y?-1:0)}):new o([T|0],0>T?-1:0)}function l(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return I(l(-T));for(var y=[],w=1,C=0;T>=w;C++)y[C]=T/w|0,w*=4294967296;return new o(y,0)}function h(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return I(h(T.substring(1),y));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=l(Math.pow(y,8)),C=f,A=0;A<T.length;A+=8){var S=Math.min(8,T.length-A),v=parseInt(T.substring(A,A+S),y);8>S?(S=l(Math.pow(y,S)),C=C.j(S).add(l(v))):(C=C.j(w),C=C.add(l(v)))}return C}var f=u(0),g=u(1),_=u(16777216);n=o.prototype,n.m=function(){if(b(this))return-I(this).m();for(var T=0,y=1,w=0;w<this.g.length;w++){var C=this.i(w);T+=(0<=C?C:4294967296+C)*y,y*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(E(this))return"0";if(b(this))return"-"+I(this).toString(T);for(var y=l(Math.pow(T,6)),w=this,C="";;){var A=U(w,y).g;w=M(w,A.j(y));var S=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=A,E(w))return S+C;for(;6>S.length;)S="0"+S;C=S+C}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function E(T){if(T.h!=0)return!1;for(var y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function b(T){return T.h==-1}n.l=function(T){return T=M(this,T),b(T)?-1:E(T)?0:1};function I(T){for(var y=T.g.length,w=[],C=0;C<y;C++)w[C]=~T.g[C];return new o(w,~T.h).add(g)}n.abs=function(){return b(this)?I(this):this},n.add=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],C=0,A=0;A<=y;A++){var S=C+(this.i(A)&65535)+(T.i(A)&65535),v=(S>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);C=v>>>16,S&=65535,v&=65535,w[A]=v<<16|S}return new o(w,w[w.length-1]&-2147483648?-1:0)};function M(T,y){return T.add(I(y))}n.j=function(T){if(E(this)||E(T))return f;if(b(this))return b(T)?I(this).j(I(T)):I(I(this).j(T));if(b(T))return I(this.j(I(T)));if(0>this.l(_)&&0>T.l(_))return l(this.m()*T.m());for(var y=this.g.length+T.g.length,w=[],C=0;C<2*y;C++)w[C]=0;for(C=0;C<this.g.length;C++)for(var A=0;A<T.g.length;A++){var S=this.i(C)>>>16,v=this.i(C)&65535,Yn=T.i(A)>>>16,ha=T.i(A)&65535;w[2*C+2*A]+=v*ha,B(w,2*C+2*A),w[2*C+2*A+1]+=S*ha,B(w,2*C+2*A+1),w[2*C+2*A+1]+=v*Yn,B(w,2*C+2*A+1),w[2*C+2*A+2]+=S*Yn,B(w,2*C+2*A+2)}for(C=0;C<y;C++)w[C]=w[2*C+1]<<16|w[2*C];for(C=y;C<2*y;C++)w[C]=0;return new o(w,0)};function B(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function x(T,y){this.g=T,this.h=y}function U(T,y){if(E(y))throw Error("division by zero");if(E(T))return new x(f,f);if(b(T))return y=U(I(T),y),new x(I(y.g),I(y.h));if(b(y))return y=U(T,I(y)),new x(I(y.g),y.h);if(30<T.g.length){if(b(T)||b(y))throw Error("slowDivide_ only works with positive integers.");for(var w=g,C=y;0>=C.l(T);)w=Y(w),C=Y(C);var A=Q(w,1),S=Q(C,1);for(C=Q(C,2),w=Q(w,2);!E(C);){var v=S.add(C);0>=v.l(T)&&(A=A.add(w),S=v),C=Q(C,1),w=Q(w,1)}return y=M(T,A.j(y)),new x(A,y)}for(A=f;0<=T.l(y);){for(w=Math.max(1,Math.floor(T.m()/y.m())),C=Math.ceil(Math.log(w)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),S=l(w),v=S.j(y);b(v)||0<v.l(T);)w-=C,S=l(w),v=S.j(y);E(S)&&(S=g),A=A.add(S),T=M(T,v)}return new x(A,T)}n.A=function(T){return U(this,T).h},n.and=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],C=0;C<y;C++)w[C]=this.i(C)&T.i(C);return new o(w,this.h&T.h)},n.or=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],C=0;C<y;C++)w[C]=this.i(C)|T.i(C);return new o(w,this.h|T.h)},n.xor=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],C=0;C<y;C++)w[C]=this.i(C)^T.i(C);return new o(w,this.h^T.h)};function Y(T){for(var y=T.g.length+1,w=[],C=0;C<y;C++)w[C]=T.i(C)<<1|T.i(C-1)>>>31;return new o(w,T.h)}function Q(T,y){var w=y>>5;y%=32;for(var C=T.g.length-w,A=[],S=0;S<C;S++)A[S]=0<y?T.i(S+w)>>>y|T.i(S+w+1)<<32-y:T.i(S+w);return new o(A,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,lm=yC.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=h,qr=yC.Integer=o}).apply(typeof _C<"u"?_C:typeof self<"u"?self:typeof window<"u"?window:{});var yh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lr={};var hm,dm,Js,fm,Ru,vh,pm,gm,mm;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,d,p){return c==Array.prototype||c==Object.prototype||(c[d]=p.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof yh=="object"&&yh];for(var d=0;d<c.length;++d){var p=c[d];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function i(c,d){if(d)e:{var p=r;c=c.split(".");for(var m=0;m<c.length-1;m++){var D=c[m];if(!(D in p))break e;p=p[D]}c=c[c.length-1],m=p[c],d=d(m),d!=m&&d!=null&&e(p,c,{configurable:!0,writable:!0,value:d})}}function s(c,d){c instanceof String&&(c+="");var p=0,m=!1,D={next:function(){if(!m&&p<c.length){var N=p++;return{value:d(N,c[N]),done:!1}}return m=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}i("Array.prototype.values",function(c){return c||function(){return s(this,function(d,p){return p})}});var o=o||{},a=this||self;function u(c){var d=typeof c;return d=d!="object"?d:c?Array.isArray(c)?"array":d:"null",d=="array"||d=="object"&&typeof c.length=="number"}function l(c){var d=typeof c;return d=="object"&&c!=null||d=="function"}function h(c,d,p){return c.call.apply(c.bind,arguments)}function f(c,d,p){if(!c)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var D=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(D,m),c.apply(d,D)}}return function(){return c.apply(d,arguments)}}function g(c,d,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function _(c,d){var p=Array.prototype.slice.call(arguments,1);return function(){var m=p.slice();return m.push.apply(m,arguments),c.apply(this,m)}}function E(c,d){function p(){}p.prototype=d.prototype,c.aa=d.prototype,c.prototype=new p,c.prototype.constructor=c,c.Qb=function(m,D,N){for(var j=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)j[Te-2]=arguments[Te];return d.prototype[D].apply(m,j)}}function b(c){let d=c.length;if(0<d){let p=Array(d);for(let m=0;m<d;m++)p[m]=c[m];return p}return[]}function I(c,d){for(let p=1;p<arguments.length;p++){let m=arguments[p];if(u(m)){let D=c.length||0,N=m.length||0;c.length=D+N;for(let j=0;j<N;j++)c[D+j]=m[j]}else c.push(m)}}class M{constructor(d,p){this.i=d,this.j=p,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function B(c){return/^[\s\xa0]*$/.test(c)}function x(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function U(c){return U[" "](c),c}U[" "]=function(){};var Y=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function Q(c,d,p){for(let m in c)d.call(p,c[m],m,c)}function T(c,d){for(let p in c)d.call(void 0,c[p],p,c)}function y(c){let d={};for(let p in c)d[p]=c[p];return d}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(c,d){let p,m;for(let D=1;D<arguments.length;D++){m=arguments[D];for(p in m)c[p]=m[p];for(let N=0;N<w.length;N++)p=w[N],Object.prototype.hasOwnProperty.call(m,p)&&(c[p]=m[p])}}function A(c){var d=1;c=c.split(":");let p=[];for(;0<d&&c.length;)p.push(c.shift()),d--;return c.length&&p.push(c.join(":")),p}function S(c){a.setTimeout(()=>{throw c},0)}function v(){var c=Gf;let d=null;return c.g&&(d=c.g,c.g=c.g.next,c.g||(c.h=null),d.next=null),d}class Yn{constructor(){this.h=this.g=null}add(d,p){let m=ha.get();m.set(d,p),this.h?this.h.next=m:this.g=m,this.h=m}}var ha=new M(()=>new iN,c=>c.reset());class iN{constructor(){this.next=this.g=this.h=null}set(d,p){this.h=d,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let da,fa=!1,Gf=new Yn,bE=()=>{let c=a.Promise.resolve(void 0);da=()=>{c.then(sN)}};var sN=()=>{for(var c;c=v();){try{c.h.call(c.g)}catch(p){S(p)}var d=ha;d.j(c),100>d.h&&(d.h++,c.next=d.g,d.g=c)}fa=!1};function Tr(){this.s=this.s,this.C=this.C}Tr.prototype.s=!1,Tr.prototype.ma=function(){this.s||(this.s=!0,this.N())},Tr.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function pt(c,d){this.type=c,this.g=this.target=d,this.defaultPrevented=!1}pt.prototype.h=function(){this.defaultPrevented=!0};var oN=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,d=Object.defineProperty({},"passive",{get:function(){c=!0}});try{let p=()=>{};a.addEventListener("test",p,d),a.removeEventListener("test",p,d)}catch{}return c}();function pa(c,d){if(pt.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var p=this.type=c.type,m=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=d,d=c.relatedTarget){if(Y){e:{try{U(d.nodeName);var D=!0;break e}catch{}D=!1}D||(d=null)}}else p=="mouseover"?d=c.fromElement:p=="mouseout"&&(d=c.toElement);this.relatedTarget=d,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:aN[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&pa.aa.h.call(this)}}E(pa,pt);var aN={2:"touch",3:"pen",4:"mouse"};pa.prototype.h=function(){pa.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var ga="closure_listenable_"+(1e6*Math.random()|0),uN=0;function cN(c,d,p,m,D){this.listener=c,this.proxy=null,this.src=d,this.type=p,this.capture=!!m,this.ha=D,this.key=++uN,this.da=this.fa=!1}function tl(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function nl(c){this.src=c,this.g={},this.h=0}nl.prototype.add=function(c,d,p,m,D){var N=c.toString();c=this.g[N],c||(c=this.g[N]=[],this.h++);var j=Wf(c,d,m,D);return-1<j?(d=c[j],p||(d.fa=!1)):(d=new cN(d,this.src,N,!!m,D),d.fa=p,c.push(d)),d};function zf(c,d){var p=d.type;if(p in c.g){var m=c.g[p],D=Array.prototype.indexOf.call(m,d,void 0),N;(N=0<=D)&&Array.prototype.splice.call(m,D,1),N&&(tl(d),c.g[p].length==0&&(delete c.g[p],c.h--))}}function Wf(c,d,p,m){for(var D=0;D<c.length;++D){var N=c[D];if(!N.da&&N.listener==d&&N.capture==!!p&&N.ha==m)return D}return-1}var Hf="closure_lm_"+(1e6*Math.random()|0),Kf={};function SE(c,d,p,m,D){if(m&&m.once)return PE(c,d,p,m,D);if(Array.isArray(d)){for(var N=0;N<d.length;N++)SE(c,d[N],p,m,D);return null}return p=Jf(p),c&&c[ga]?c.K(d,p,l(m)?!!m.capture:!!m,D):RE(c,d,p,!1,m,D)}function RE(c,d,p,m,D,N){if(!d)throw Error("Invalid event type");var j=l(D)?!!D.capture:!!D,Te=Yf(c);if(Te||(c[Hf]=Te=new nl(c)),p=Te.add(d,p,m,j,N),p.proxy)return p;if(m=lN(),p.proxy=m,m.src=c,m.listener=p,c.addEventListener)oN||(D=j),D===void 0&&(D=!1),c.addEventListener(d.toString(),m,D);else if(c.attachEvent)c.attachEvent(kE(d.toString()),m);else if(c.addListener&&c.removeListener)c.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return p}function lN(){function c(p){return d.call(c.src,c.listener,p)}let d=hN;return c}function PE(c,d,p,m,D){if(Array.isArray(d)){for(var N=0;N<d.length;N++)PE(c,d[N],p,m,D);return null}return p=Jf(p),c&&c[ga]?c.L(d,p,l(m)?!!m.capture:!!m,D):RE(c,d,p,!0,m,D)}function NE(c,d,p,m,D){if(Array.isArray(d))for(var N=0;N<d.length;N++)NE(c,d[N],p,m,D);else m=l(m)?!!m.capture:!!m,p=Jf(p),c&&c[ga]?(c=c.i,d=String(d).toString(),d in c.g&&(N=c.g[d],p=Wf(N,p,m,D),-1<p&&(tl(N[p]),Array.prototype.splice.call(N,p,1),N.length==0&&(delete c.g[d],c.h--)))):c&&(c=Yf(c))&&(d=c.g[d.toString()],c=-1,d&&(c=Wf(d,p,m,D)),(p=-1<c?d[c]:null)&&Qf(p))}function Qf(c){if(typeof c!="number"&&c&&!c.da){var d=c.src;if(d&&d[ga])zf(d.i,c);else{var p=c.type,m=c.proxy;d.removeEventListener?d.removeEventListener(p,m,c.capture):d.detachEvent?d.detachEvent(kE(p),m):d.addListener&&d.removeListener&&d.removeListener(m),(p=Yf(d))?(zf(p,c),p.h==0&&(p.src=null,d[Hf]=null)):tl(c)}}}function kE(c){return c in Kf?Kf[c]:Kf[c]="on"+c}function hN(c,d){if(c.da)c=!0;else{d=new pa(d,this);var p=c.listener,m=c.ha||c.src;c.fa&&Qf(c),c=p.call(m,d)}return c}function Yf(c){return c=c[Hf],c instanceof nl?c:null}var Xf="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jf(c){return typeof c=="function"?c:(c[Xf]||(c[Xf]=function(d){return c.handleEvent(d)}),c[Xf])}function gt(){Tr.call(this),this.i=new nl(this),this.M=this,this.F=null}E(gt,Tr),gt.prototype[ga]=!0,gt.prototype.removeEventListener=function(c,d,p,m){NE(this,c,d,p,m)};function Ct(c,d){var p,m=c.F;if(m)for(p=[];m;m=m.F)p.push(m);if(c=c.M,m=d.type||d,typeof d=="string")d=new pt(d,c);else if(d instanceof pt)d.target=d.target||c;else{var D=d;d=new pt(m,c),C(d,D)}if(D=!0,p)for(var N=p.length-1;0<=N;N--){var j=d.g=p[N];D=rl(j,m,!0,d)&&D}if(j=d.g=c,D=rl(j,m,!0,d)&&D,D=rl(j,m,!1,d)&&D,p)for(N=0;N<p.length;N++)j=d.g=p[N],D=rl(j,m,!1,d)&&D}gt.prototype.N=function(){if(gt.aa.N.call(this),this.i){var c=this.i,d;for(d in c.g){for(var p=c.g[d],m=0;m<p.length;m++)tl(p[m]);delete c.g[d],c.h--}}this.F=null},gt.prototype.K=function(c,d,p,m){return this.i.add(String(c),d,!1,p,m)},gt.prototype.L=function(c,d,p,m){return this.i.add(String(c),d,!0,p,m)};function rl(c,d,p,m){if(d=c.i.g[String(d)],!d)return!0;d=d.concat();for(var D=!0,N=0;N<d.length;++N){var j=d[N];if(j&&!j.da&&j.capture==p){var Te=j.listener,ct=j.ha||j.src;j.fa&&zf(c.i,j),D=Te.call(ct,m)!==!1&&D}}return D&&!m.defaultPrevented}function xE(c,d,p){if(typeof c=="function")p&&(c=g(c,p));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:a.setTimeout(c,d||0)}function ME(c){c.g=xE(()=>{c.g=null,c.i&&(c.i=!1,ME(c))},c.l);let d=c.h;c.h=null,c.m.apply(null,d)}class dN extends Tr{constructor(d,p){super(),this.m=d,this.l=p,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:ME(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ma(c){Tr.call(this),this.h=c,this.g={}}E(ma,Tr);var FE=[];function OE(c){Q(c.g,function(d,p){this.g.hasOwnProperty(p)&&Qf(d)},c),c.g={}}ma.prototype.N=function(){ma.aa.N.call(this),OE(this)},ma.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zf=a.JSON.stringify,fN=a.JSON.parse,pN=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function ep(){}ep.prototype.h=null;function VE(c){return c.h||(c.h=c.i())}function LE(){}var _a={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function tp(){pt.call(this,"d")}E(tp,pt);function np(){pt.call(this,"c")}E(np,pt);var vi={},UE=null;function il(){return UE=UE||new gt}vi.La="serverreachability";function BE(c){pt.call(this,vi.La,c)}E(BE,pt);function ya(c){let d=il();Ct(d,new BE(d))}vi.STAT_EVENT="statevent";function jE(c,d){pt.call(this,vi.STAT_EVENT,c),this.stat=d}E(jE,pt);function At(c){let d=il();Ct(d,new jE(d,c))}vi.Ma="timingevent";function $E(c,d){pt.call(this,vi.Ma,c),this.size=d}E($E,pt);function va(c,d){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},d)}function wa(){this.g=!0}wa.prototype.xa=function(){this.g=!1};function gN(c,d,p,m,D,N){c.info(function(){if(c.g)if(N)for(var j="",Te=N.split("&"),ct=0;ct<Te.length;ct++){var me=Te[ct].split("=");if(1<me.length){var mt=me[0];me=me[1];var _t=mt.split("_");j=2<=_t.length&&_t[1]=="type"?j+(mt+"="+me+"&"):j+(mt+"=redacted&")}}else j=null;else j=N;return"XMLHTTP REQ ("+m+") [attempt "+D+"]: "+d+`
`+p+`
`+j})}function mN(c,d,p,m,D,N,j){c.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+D+"]: "+d+`
`+p+`
`+N+" "+j})}function ys(c,d,p,m){c.info(function(){return"XMLHTTP TEXT ("+d+"): "+yN(c,p)+(m?" "+m:"")})}function _N(c,d){c.info(function(){return"TIMEOUT: "+d})}wa.prototype.info=function(){};function yN(c,d){if(!c.g)return d;if(!d)return null;try{var p=JSON.parse(d);if(p){for(c=0;c<p.length;c++)if(Array.isArray(p[c])){var m=p[c];if(!(2>m.length)){var D=m[1];if(Array.isArray(D)&&!(1>D.length)){var N=D[0];if(N!="noop"&&N!="stop"&&N!="close")for(var j=1;j<D.length;j++)D[j]=""}}}}return Zf(p)}catch{return d}}var sl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qE={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},rp;function ol(){}E(ol,ep),ol.prototype.g=function(){return new XMLHttpRequest},ol.prototype.i=function(){return{}},rp=new ol;function Ir(c,d,p,m){this.j=c,this.i=d,this.l=p,this.R=m||1,this.U=new ma(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new GE}function GE(){this.i=null,this.g="",this.h=!1}var zE={},ip={};function sp(c,d,p){c.L=1,c.v=ll(Xn(d)),c.m=p,c.P=!0,WE(c,null)}function WE(c,d){c.F=Date.now(),al(c),c.A=Xn(c.v);var p=c.A,m=c.R;Array.isArray(m)||(m=[String(m)]),o0(p.i,"t",m),c.C=0,p=c.j.J,c.h=new GE,c.g=C0(c.j,p?d:null,!c.m),0<c.O&&(c.M=new dN(g(c.Y,c,c.g),c.O)),d=c.U,p=c.g,m=c.ca;var D="readystatechange";Array.isArray(D)||(D&&(FE[0]=D.toString()),D=FE);for(var N=0;N<D.length;N++){var j=SE(p,D[N],m||d.handleEvent,!1,d.h||d);if(!j)break;d.g[j.key]=j}d=c.H?y(c.H):{},c.m?(c.u||(c.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,d)):(c.u="GET",c.g.ea(c.A,c.u,null,d)),ya(),gN(c.i,c.u,c.A,c.l,c.R,c.m)}Ir.prototype.ca=function(c){c=c.target;let d=this.M;d&&Jn(c)==3?d.j():this.Y(c)},Ir.prototype.Y=function(c){try{if(c==this.g)e:{let _t=Jn(this.g);var d=this.g.Ba();let Es=this.g.Z();if(!(3>_t)&&(_t!=3||this.g&&(this.h.h||this.g.oa()||f0(this.g)))){this.J||_t!=4||d==7||(d==8||0>=Es?ya(3):ya(2)),op(this);var p=this.g.Z();this.X=p;t:if(HE(this)){var m=f0(this.g);c="";var D=m.length,N=Jn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wi(this),Ea(this);var j="";break t}this.h.i=new a.TextDecoder}for(d=0;d<D;d++)this.h.h=!0,c+=this.h.i.decode(m[d],{stream:!(N&&d==D-1)});m.length=0,this.h.g+=c,this.C=0,j=this.h.g}else j=this.g.oa();if(this.o=p==200,mN(this.i,this.u,this.A,this.l,this.R,_t,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Te,ct=this.g;if((Te=ct.g?ct.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Te)){var me=Te;break t}}me=null}if(p=me)ys(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ap(this,p);else{this.o=!1,this.s=3,At(12),wi(this),Ea(this);break e}}if(this.P){p=!0;let ln;for(;!this.J&&this.C<j.length;)if(ln=vN(this,j),ln==ip){_t==4&&(this.s=4,At(14),p=!1),ys(this.i,this.l,null,"[Incomplete Response]");break}else if(ln==zE){this.s=4,At(15),ys(this.i,this.l,j,"[Invalid Chunk]"),p=!1;break}else ys(this.i,this.l,ln,null),ap(this,ln);if(HE(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_t!=4||j.length!=0||this.h.h||(this.s=1,At(16),p=!1),this.o=this.o&&p,!p)ys(this.i,this.l,j,"[Invalid Chunked Response]"),wi(this),Ea(this);else if(0<j.length&&!this.W){this.W=!0;var mt=this.j;mt.g==this&&mt.ba&&!mt.M&&(mt.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),fp(mt),mt.M=!0,At(11))}}else ys(this.i,this.l,j,null),ap(this,j);_t==4&&wi(this),this.o&&!this.J&&(_t==4?w0(this.j,this):(this.o=!1,al(this)))}else ON(this.g),p==400&&0<j.indexOf("Unknown SID")?(this.s=3,At(12)):(this.s=0,At(13)),wi(this),Ea(this)}}}catch{}finally{}};function HE(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function vN(c,d){var p=c.C,m=d.indexOf(`
`,p);return m==-1?ip:(p=Number(d.substring(p,m)),isNaN(p)?zE:(m+=1,m+p>d.length?ip:(d=d.slice(m,m+p),c.C=m+p,d)))}Ir.prototype.cancel=function(){this.J=!0,wi(this)};function al(c){c.S=Date.now()+c.I,KE(c,c.I)}function KE(c,d){if(c.B!=null)throw Error("WatchDog timer not null");c.B=va(g(c.ba,c),d)}function op(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Ir.prototype.ba=function(){this.B=null;let c=Date.now();0<=c-this.S?(_N(this.i,this.A),this.L!=2&&(ya(),At(17)),wi(this),this.s=2,Ea(this)):KE(this,this.S-c)};function Ea(c){c.j.G==0||c.J||w0(c.j,c)}function wi(c){op(c);var d=c.M;d&&typeof d.ma=="function"&&d.ma(),c.M=null,OE(c.U),c.g&&(d=c.g,c.g=null,d.abort(),d.ma())}function ap(c,d){try{var p=c.j;if(p.G!=0&&(p.g==c||up(p.h,c))){if(!c.K&&up(p.h,c)&&p.G==3){try{var m=p.Da.g.parse(d)}catch{m=null}if(Array.isArray(m)&&m.length==3){var D=m;if(D[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<c.F)gl(p),fl(p);else break e;dp(p),At(18)}}else p.za=D[1],0<p.za-p.T&&37500>D[2]&&p.F&&p.v==0&&!p.C&&(p.C=va(g(p.Za,p),6e3));if(1>=XE(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Ti(p,11)}else if((c.K||p.g==c)&&gl(p),!B(d))for(D=p.Da.g.parse(d),d=0;d<D.length;d++){let me=D[d];if(p.T=me[0],me=me[1],p.G==2)if(me[0]=="c"){p.K=me[1],p.ia=me[2];let mt=me[3];mt!=null&&(p.la=mt,p.j.info("VER="+p.la));let _t=me[4];_t!=null&&(p.Aa=_t,p.j.info("SVER="+p.Aa));let Es=me[5];Es!=null&&typeof Es=="number"&&0<Es&&(m=1.5*Es,p.L=m,p.j.info("backChannelRequestTimeoutMs_="+m)),m=p;let ln=c.g;if(ln){let _l=ln.g?ln.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_l){var N=m.h;N.g||_l.indexOf("spdy")==-1&&_l.indexOf("quic")==-1&&_l.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(cp(N,N.h),N.h=null))}if(m.D){let pp=ln.g?ln.g.getResponseHeader("X-HTTP-Session-Id"):null;pp&&(m.ya=pp,Se(m.I,m.D,pp))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-c.F,p.j.info("Handshake RTT: "+p.R+"ms")),m=p;var j=c;if(m.qa=I0(m,m.J?m.ia:null,m.W),j.K){JE(m.h,j);var Te=j,ct=m.L;ct&&(Te.I=ct),Te.B&&(op(Te),al(Te)),m.g=j}else y0(m);0<p.i.length&&pl(p)}else me[0]!="stop"&&me[0]!="close"||Ti(p,7);else p.G==3&&(me[0]=="stop"||me[0]=="close"?me[0]=="stop"?Ti(p,7):hp(p):me[0]!="noop"&&p.l&&p.l.ta(me),p.v=0)}}ya(4)}catch{}}var wN=class{constructor(c,d){this.g=c,this.map=d}};function QE(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function YE(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function XE(c){return c.h?1:c.g?c.g.size:0}function up(c,d){return c.h?c.h==d:c.g?c.g.has(d):!1}function cp(c,d){c.g?c.g.add(d):c.h=d}function JE(c,d){c.h&&c.h==d?c.h=null:c.g&&c.g.has(d)&&c.g.delete(d)}QE.prototype.cancel=function(){if(this.i=ZE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let c of this.g.values())c.cancel();this.g.clear()}};function ZE(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let d=c.i;for(let p of c.g.values())d=d.concat(p.D);return d}return b(c.i)}function EN(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(u(c)){for(var d=[],p=c.length,m=0;m<p;m++)d.push(c[m]);return d}d=[],p=0;for(m in c)d[p++]=c[m];return d}function TN(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(u(c)||typeof c=="string"){var d=[];c=c.length;for(var p=0;p<c;p++)d.push(p);return d}d=[],p=0;for(let m in c)d[p++]=m;return d}}}function e0(c,d){if(c.forEach&&typeof c.forEach=="function")c.forEach(d,void 0);else if(u(c)||typeof c=="string")Array.prototype.forEach.call(c,d,void 0);else for(var p=TN(c),m=EN(c),D=m.length,N=0;N<D;N++)d.call(void 0,m[N],p&&p[N],c)}var t0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function IN(c,d){if(c){c=c.split("&");for(var p=0;p<c.length;p++){var m=c[p].indexOf("="),D=null;if(0<=m){var N=c[p].substring(0,m);D=c[p].substring(m+1)}else N=c[p];d(N,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function Ei(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Ei){this.h=c.h,ul(this,c.j),this.o=c.o,this.g=c.g,cl(this,c.s),this.l=c.l;var d=c.i,p=new Ca;p.i=d.i,d.g&&(p.g=new Map(d.g),p.h=d.h),n0(this,p),this.m=c.m}else c&&(d=String(c).match(t0))?(this.h=!1,ul(this,d[1]||"",!0),this.o=Ta(d[2]||""),this.g=Ta(d[3]||"",!0),cl(this,d[4]),this.l=Ta(d[5]||"",!0),n0(this,d[6]||"",!0),this.m=Ta(d[7]||"")):(this.h=!1,this.i=new Ca(null,this.h))}Ei.prototype.toString=function(){var c=[],d=this.j;d&&c.push(Ia(d,r0,!0),":");var p=this.g;return(p||d=="file")&&(c.push("//"),(d=this.o)&&c.push(Ia(d,r0,!0),"@"),c.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&c.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&c.push("/"),c.push(Ia(p,p.charAt(0)=="/"?DN:AN,!0))),(p=this.i.toString())&&c.push("?",p),(p=this.m)&&c.push("#",Ia(p,SN)),c.join("")};function Xn(c){return new Ei(c)}function ul(c,d,p){c.j=p?Ta(d,!0):d,c.j&&(c.j=c.j.replace(/:$/,""))}function cl(c,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);c.s=d}else c.s=null}function n0(c,d,p){d instanceof Ca?(c.i=d,RN(c.i,c.h)):(p||(d=Ia(d,bN)),c.i=new Ca(d,c.h))}function Se(c,d,p){c.i.set(d,p)}function ll(c){return Se(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Ta(c,d){return c?d?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Ia(c,d,p){return typeof c=="string"?(c=encodeURI(c).replace(d,CN),p&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function CN(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var r0=/[#\/\?@]/g,AN=/[#\?:]/g,DN=/[#\?]/g,bN=/[#\?@]/g,SN=/#/g;function Ca(c,d){this.h=this.g=null,this.i=c||null,this.j=!!d}function Cr(c){c.g||(c.g=new Map,c.h=0,c.i&&IN(c.i,function(d,p){c.add(decodeURIComponent(d.replace(/\+/g," ")),p)}))}n=Ca.prototype,n.add=function(c,d){Cr(this),this.i=null,c=vs(this,c);var p=this.g.get(c);return p||this.g.set(c,p=[]),p.push(d),this.h+=1,this};function i0(c,d){Cr(c),d=vs(c,d),c.g.has(d)&&(c.i=null,c.h-=c.g.get(d).length,c.g.delete(d))}function s0(c,d){return Cr(c),d=vs(c,d),c.g.has(d)}n.forEach=function(c,d){Cr(this),this.g.forEach(function(p,m){p.forEach(function(D){c.call(d,D,m,this)},this)},this)},n.na=function(){Cr(this);let c=Array.from(this.g.values()),d=Array.from(this.g.keys()),p=[];for(let m=0;m<d.length;m++){let D=c[m];for(let N=0;N<D.length;N++)p.push(d[m])}return p},n.V=function(c){Cr(this);let d=[];if(typeof c=="string")s0(this,c)&&(d=d.concat(this.g.get(vs(this,c))));else{c=Array.from(this.g.values());for(let p=0;p<c.length;p++)d=d.concat(c[p])}return d},n.set=function(c,d){return Cr(this),this.i=null,c=vs(this,c),s0(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[d]),this.h+=1,this},n.get=function(c,d){return c?(c=this.V(c),0<c.length?String(c[0]):d):d};function o0(c,d,p){i0(c,d),0<p.length&&(c.i=null,c.g.set(vs(c,d),b(p)),c.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let c=[],d=Array.from(this.g.keys());for(var p=0;p<d.length;p++){var m=d[p];let N=encodeURIComponent(String(m)),j=this.V(m);for(m=0;m<j.length;m++){var D=N;j[m]!==""&&(D+="="+encodeURIComponent(String(j[m]))),c.push(D)}}return this.i=c.join("&")};function vs(c,d){return d=String(d),c.j&&(d=d.toLowerCase()),d}function RN(c,d){d&&!c.j&&(Cr(c),c.i=null,c.g.forEach(function(p,m){var D=m.toLowerCase();m!=D&&(i0(this,m),o0(this,D,p))},c)),c.j=d}function PN(c,d){let p=new wa;if(a.Image){let m=new Image;m.onload=_(Ar,p,"TestLoadImage: loaded",!0,d,m),m.onerror=_(Ar,p,"TestLoadImage: error",!1,d,m),m.onabort=_(Ar,p,"TestLoadImage: abort",!1,d,m),m.ontimeout=_(Ar,p,"TestLoadImage: timeout",!1,d,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=c}else d(!1)}function NN(c,d){let p=new wa,m=new AbortController,D=setTimeout(()=>{m.abort(),Ar(p,"TestPingServer: timeout",!1,d)},1e4);fetch(c,{signal:m.signal}).then(N=>{clearTimeout(D),N.ok?Ar(p,"TestPingServer: ok",!0,d):Ar(p,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(D),Ar(p,"TestPingServer: error",!1,d)})}function Ar(c,d,p,m,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),m(p)}catch{}}function kN(){this.g=new pN}function xN(c,d,p){let m=p||"";try{e0(c,function(D,N){let j=D;l(D)&&(j=Zf(D)),d.push(m+N+"="+encodeURIComponent(j))})}catch(D){throw d.push(m+"type="+encodeURIComponent("_badmap")),D}}function Aa(c){this.l=c.Ub||null,this.j=c.eb||!1}E(Aa,ep),Aa.prototype.g=function(){return new hl(this.l,this.j)},Aa.prototype.i=function(c){return function(){return c}}({});function hl(c,d){gt.call(this),this.D=c,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(hl,gt),n=hl.prototype,n.open=function(c,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=d,this.readyState=1,ba(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(d.body=c),(this.D||a).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Da(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ba(this)),this.g&&(this.readyState=3,ba(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;a0(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function a0(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var d=c.value?c.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!c.done}))&&(this.response=this.responseText+=d)}c.done?Da(this):ba(this),this.readyState==3&&a0(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Da(this))},n.Qa=function(c){this.g&&(this.response=c,Da(this))},n.ga=function(){this.g&&Da(this)};function Da(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ba(c)}n.setRequestHeader=function(c,d){this.u.append(c,d)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let c=[],d=this.h.entries();for(var p=d.next();!p.done;)p=p.value,c.push(p[0]+": "+p[1]),p=d.next();return c.join(`\r
`)};function ba(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(hl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function u0(c){let d="";return Q(c,function(p,m){d+=m,d+=":",d+=p,d+=`\r
`}),d}function lp(c,d,p){e:{for(m in p){var m=!1;break e}m=!0}m||(p=u0(p),typeof c=="string"?p!=null&&encodeURIComponent(String(p)):Se(c,d,p))}function je(c){gt.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(je,gt);var MN=/^https?$/i,FN=["POST","PUT"];n=je.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,d,p,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);d=d?d.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():rp.g(),this.v=this.o?VE(this.o):VE(rp),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(d,String(c),!0),this.B=!1}catch(N){c0(this,N);return}if(c=p||"",p=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var D in m)p.set(D,m[D]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let N of m.keys())p.set(N,m.get(N));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(p.keys()).find(N=>N.toLowerCase()=="content-type"),D=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(FN,d,void 0))||m||D||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[N,j]of p)this.g.setRequestHeader(N,j);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{d0(this),this.u=!0,this.g.send(c),this.u=!1}catch(N){c0(this,N)}};function c0(c,d){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=d,c.m=5,l0(c),dl(c)}function l0(c){c.A||(c.A=!0,Ct(c,"complete"),Ct(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Ct(this,"complete"),Ct(this,"abort"),dl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),dl(this,!0)),je.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?h0(this):this.bb())},n.bb=function(){h0(this)};function h0(c){if(c.h&&typeof o<"u"&&(!c.v[1]||Jn(c)!=4||c.Z()!=2)){if(c.u&&Jn(c)==4)xE(c.Ea,0,c);else if(Ct(c,"readystatechange"),Jn(c)==4){c.h=!1;try{let j=c.Z();e:switch(j){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var p;if(!(p=d)){var m;if(m=j===0){var D=String(c.D).match(t0)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),m=!MN.test(D?D.toLowerCase():"")}p=m}if(p)Ct(c,"complete"),Ct(c,"success");else{c.m=6;try{var N=2<Jn(c)?c.g.statusText:""}catch{N=""}c.l=N+" ["+c.Z()+"]",l0(c)}}finally{dl(c)}}}}function dl(c,d){if(c.g){d0(c);let p=c.g,m=c.v[0]?()=>{}:null;c.g=null,c.v=null,d||Ct(c,"ready");try{p.onreadystatechange=m}catch{}}}function d0(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function Jn(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<Jn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var d=this.g.responseText;return c&&d.indexOf(c)==0&&(d=d.substring(c.length)),fN(d)}};function f0(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function ON(c){let d={};c=(c.g&&2<=Jn(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<c.length;m++){if(B(c[m]))continue;var p=A(c[m]);let D=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let N=d[D]||[];d[D]=N,N.push(p)}T(d,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sa(c,d,p){return p&&p.internalChannelParams&&p.internalChannelParams[c]||d}function p0(c){this.Aa=0,this.i=[],this.j=new wa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Sa("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Sa("baseRetryDelayMs",5e3,c),this.cb=Sa("retryDelaySeedMs",1e4,c),this.Wa=Sa("forwardChannelMaxRetries",2,c),this.wa=Sa("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new QE(c&&c.concurrentRequestLimit),this.Da=new kN,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=p0.prototype,n.la=8,n.G=1,n.connect=function(c,d,p,m){At(0),this.W=c,this.H=d||{},p&&m!==void 0&&(this.H.OSID=p,this.H.OAID=m),this.F=this.X,this.I=I0(this,null,this.W),pl(this)};function hp(c){if(g0(c),c.G==3){var d=c.U++,p=Xn(c.I);if(Se(p,"SID",c.K),Se(p,"RID",d),Se(p,"TYPE","terminate"),Ra(c,p),d=new Ir(c,c.j,d),d.L=2,d.v=ll(Xn(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(d.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=d.v,p=!0),p||(d.g=C0(d.j,null),d.g.ea(d.v)),d.F=Date.now(),al(d)}T0(c)}function fl(c){c.g&&(fp(c),c.g.cancel(),c.g=null)}function g0(c){fl(c),c.u&&(a.clearTimeout(c.u),c.u=null),gl(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function pl(c){if(!YE(c.h)&&!c.s){c.s=!0;var d=c.Ga;da||bE(),fa||(da(),fa=!0),Gf.add(d,c),c.B=0}}function VN(c,d){return XE(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=d.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=va(g(c.Ga,c,d),E0(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;let D=new Ir(this,this.j,c),N=this.o;if(this.S&&(N?(N=y(N),C(N,this.S)):N=this.S),this.m!==null||this.O||(D.H=N,N=null),this.P)e:{for(var d=0,p=0;p<this.i.length;p++){t:{var m=this.i[p];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(d+=m,4096<d){d=p;break e}if(d===4096||p===this.i.length-1){d=p+1;break e}}d=1e3}else d=1e3;d=_0(this,D,d),p=Xn(this.I),Se(p,"RID",c),Se(p,"CVER",22),this.D&&Se(p,"X-HTTP-Session-Id",this.D),Ra(this,p),N&&(this.O?d="headers="+encodeURIComponent(String(u0(N)))+"&"+d:this.m&&lp(p,this.m,N)),cp(this.h,D),this.Ua&&Se(p,"TYPE","init"),this.P?(Se(p,"$req",d),Se(p,"SID","null"),D.T=!0,sp(D,p,null)):sp(D,p,d),this.G=2}}else this.G==3&&(c?m0(this,c):this.i.length==0||YE(this.h)||m0(this))};function m0(c,d){var p;d?p=d.l:p=c.U++;let m=Xn(c.I);Se(m,"SID",c.K),Se(m,"RID",p),Se(m,"AID",c.T),Ra(c,m),c.m&&c.o&&lp(m,c.m,c.o),p=new Ir(c,c.j,p,c.B+1),c.m===null&&(p.H=c.o),d&&(c.i=d.D.concat(c.i)),d=_0(c,p,1e3),p.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),cp(c.h,p),sp(p,m,d)}function Ra(c,d){c.H&&Q(c.H,function(p,m){Se(d,m,p)}),c.l&&e0({},function(p,m){Se(d,m,p)})}function _0(c,d,p){p=Math.min(c.i.length,p);var m=c.l?g(c.l.Na,c.l,c):null;e:{var D=c.i;let N=-1;for(;;){let j=["count="+p];N==-1?0<p?(N=D[0].g,j.push("ofs="+N)):N=0:j.push("ofs="+N);let Te=!0;for(let ct=0;ct<p;ct++){let me=D[ct].g,mt=D[ct].map;if(me-=N,0>me)N=Math.max(0,D[ct].g-100),Te=!1;else try{xN(mt,j,"req"+me+"_")}catch{m&&m(mt)}}if(Te){m=j.join("&");break e}}}return c=c.i.splice(0,p),d.D=c,m}function y0(c){if(!c.g&&!c.u){c.Y=1;var d=c.Fa;da||bE(),fa||(da(),fa=!0),Gf.add(d,c),c.v=0}}function dp(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=va(g(c.Fa,c),E0(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,v0(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=va(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,At(10),fl(this),v0(this))};function fp(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function v0(c){c.g=new Ir(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var d=Xn(c.qa);Se(d,"RID","rpc"),Se(d,"SID",c.K),Se(d,"AID",c.T),Se(d,"CI",c.F?"0":"1"),!c.F&&c.ja&&Se(d,"TO",c.ja),Se(d,"TYPE","xmlhttp"),Ra(c,d),c.m&&c.o&&lp(d,c.m,c.o),c.L&&(c.g.I=c.L);var p=c.g;c=c.ia,p.L=1,p.v=ll(Xn(d)),p.m=null,p.P=!0,WE(p,c)}n.Za=function(){this.C!=null&&(this.C=null,fl(this),dp(this),At(19))};function gl(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function w0(c,d){var p=null;if(c.g==d){gl(c),fp(c),c.g=null;var m=2}else if(up(c.h,d))p=d.D,JE(c.h,d),m=1;else return;if(c.G!=0){if(d.o)if(m==1){p=d.m?d.m.length:0,d=Date.now()-d.F;var D=c.B;m=il(),Ct(m,new $E(m,p)),pl(c)}else y0(c);else if(D=d.s,D==3||D==0&&0<d.X||!(m==1&&VN(c,d)||m==2&&dp(c)))switch(p&&0<p.length&&(d=c.h,d.i=d.i.concat(p)),D){case 1:Ti(c,5);break;case 4:Ti(c,10);break;case 3:Ti(c,6);break;default:Ti(c,2)}}}function E0(c,d){let p=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(p*=2),p*d}function Ti(c,d){if(c.j.info("Error code "+d),d==2){var p=g(c.fb,c),m=c.Xa;let D=!m;m=new Ei(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ul(m,"https"),ll(m),D?PN(m.toString(),p):NN(m.toString(),p)}else At(2);c.G=0,c.l&&c.l.sa(d),T0(c),g0(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),At(2)):(this.j.info("Failed to ping google.com"),At(1))};function T0(c){if(c.G=0,c.ka=[],c.l){let d=ZE(c.h);(d.length!=0||c.i.length!=0)&&(I(c.ka,d),I(c.ka,c.i),c.h.i.length=0,b(c.i),c.i.length=0),c.l.ra()}}function I0(c,d,p){var m=p instanceof Ei?Xn(p):new Ei(p);if(m.g!="")d&&(m.g=d+"."+m.g),cl(m,m.s);else{var D=a.location;m=D.protocol,d=d?d+"."+D.hostname:D.hostname,D=+D.port;var N=new Ei(null);m&&ul(N,m),d&&(N.g=d),D&&cl(N,D),p&&(N.l=p),m=N}return p=c.D,d=c.ya,p&&d&&Se(m,p,d),Se(m,"VER",c.la),Ra(c,m),m}function C0(c,d,p){if(d&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return d=c.Ca&&!c.pa?new je(new Aa({eb:p})):new je(c.pa),d.Ha(c.J),d}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function A0(){}n=A0.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ml(){}ml.prototype.g=function(c,d){return new Vt(c,d)};function Vt(c,d){gt.call(this),this.g=new p0(d),this.l=c,this.h=d&&d.messageUrlParams||null,c=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(c?c["X-WebChannel-Content-Type"]=d.messageContentType:c={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(c?c["X-WebChannel-Client-Profile"]=d.va:c={"X-WebChannel-Client-Profile":d.va}),this.g.S=c,(c=d&&d.Sb)&&!B(c)&&(this.g.m=c),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!B(d)&&(this.g.D=d,c=this.h,c!==null&&d in c&&(c=this.h,d in c&&delete c[d])),this.j=new ws(this)}E(Vt,gt),Vt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Vt.prototype.close=function(){hp(this.g)},Vt.prototype.o=function(c){var d=this.g;if(typeof c=="string"){var p={};p.__data__=c,c=p}else this.u&&(p={},p.__data__=Zf(c),c=p);d.i.push(new wN(d.Ya++,c)),d.G==3&&pl(d)},Vt.prototype.N=function(){this.g.l=null,delete this.j,hp(this.g),delete this.g,Vt.aa.N.call(this)};function D0(c){tp.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var d=c.__sm__;if(d){e:{for(let p in d){c=p;break e}c=void 0}(this.i=c)&&(c=this.i,d=d!==null&&c in d?d[c]:void 0),this.data=d}else this.data=c}E(D0,tp);function b0(){np.call(this),this.status=1}E(b0,np);function ws(c){this.g=c}E(ws,A0),ws.prototype.ua=function(){Ct(this.g,"a")},ws.prototype.ta=function(c){Ct(this.g,new D0(c))},ws.prototype.sa=function(c){Ct(this.g,new b0)},ws.prototype.ra=function(){Ct(this.g,"b")},ml.prototype.createWebChannel=ml.prototype.g,Vt.prototype.send=Vt.prototype.o,Vt.prototype.open=Vt.prototype.m,Vt.prototype.close=Vt.prototype.close,mm=lr.createWebChannelTransport=function(){return new ml},gm=lr.getStatEventTarget=function(){return il()},pm=lr.Event=vi,vh=lr.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},sl.NO_ERROR=0,sl.TIMEOUT=8,sl.HTTP_ERROR=6,Ru=lr.ErrorCode=sl,qE.COMPLETE="complete",fm=lr.EventType=qE,LE.EventType=_a,_a.OPEN="a",_a.CLOSE="b",_a.ERROR="c",_a.MESSAGE="d",gt.prototype.listen=gt.prototype.K,Js=lr.WebChannel=LE,dm=lr.FetchXmlHttpFactory=Aa,je.prototype.listenOnce=je.prototype.L,je.prototype.getLastError=je.prototype.Ka,je.prototype.getLastErrorCode=je.prototype.Ba,je.prototype.getStatus=je.prototype.Z,je.prototype.getResponseJson=je.prototype.Oa,je.prototype.getResponseText=je.prototype.oa,je.prototype.send=je.prototype.ea,je.prototype.setWithCredentials=je.prototype.Ha,hm=lr.XhrIo=je}).apply(typeof yh<"u"?yh:typeof self<"u"?self:typeof window<"u"?window:{});var vC="@firebase/firestore";var Je=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Je.UNAUTHENTICATED=new Je(null),Je.GOOGLE_CREDENTIALS=new Je("google-credentials-uid"),Je.FIRST_PARTY=new Je("first-party-uid"),Je.MOCK_USER=new Je("mock-user");var Po="10.12.1";var Yr=new Nr("@firebase/firestore");function ro(){return Yr.logLevel}function vA(n){Yr.setLogLevel(n)}function O(n,...e){if(Yr.logLevel<=en.DEBUG){let t=e.map(vy);Yr.debug(`Firestore (${Po}): ${n}`,...t)}}function Ge(n,...e){if(Yr.logLevel<=en.ERROR){let t=e.map(vy);Yr.error(`Firestore (${Po}): ${n}`,...t)}}function rn(n,...e){if(Yr.logLevel<=en.WARN){let t=e.map(vy);Yr.warn(`Firestore (${Po}): ${n}`,...t)}}function vy(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function z(n="Unexpected state"){let e=`FIRESTORE (${Po}) INTERNAL ASSERTION FAILED: `+n;throw Ge(e),new Error(e)}function K(n,e){n||z()}function wA(n,e){n||z()}function q(n,e){return n}var k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},F=class extends Dl{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ze=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ph=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Em=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Je.UNAUTHENTICATED))}shutdown(){}},Tm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Im=class{constructor(e){this.t=e,this.currentUser=Je.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Ze;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ze,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>R(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ze)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(K(typeof r.accessToken=="string"),new Ph(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return K(e===null||typeof e=="string"),new Je(e)}},Cm=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Je.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Am=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Cm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Je.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Dm=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},bm=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(K(typeof t.token=="string"),this.R=t.token,new Dm(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function oO(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Nh=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=oO(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function ie(n,e){return n<e?-1:n>e?1:0}function fo(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function EA(n){return n+"\0"}var Le=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new F(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ie(this.nanoseconds,e.nanoseconds):ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var X=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Le(0,0))}static max(){return new n(new Le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var kh=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&z(),r===void 0?r=e.length-t:r>e.length-t&&z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},pe=class n extends kh{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new F(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},aO=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ze=class n extends kh{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return aO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new F(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new F(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new F(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new F(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var $=class n{constructor(e){this.path=e}static fromPath(e){return new n(pe.fromString(e))}static fromName(e){return new n(pe.fromString(e).popFirst(5))}static empty(){return new n(pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new pe(e.slice()))}};var po=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Sm(n){return n.fields.find(e=>e.kind===2)}function Oi(n){return n.fields.filter(e=>e.kind!==2)}po.UNKNOWN_ID=-1;var co=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ju=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,sn.min())}};function TA(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new Le(t+1,0):new Le(t,r));return new sn(i,$.empty(),e)}function IA(n){return new sn(n.readTime,n.key,-1)}var sn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(X.min(),$.empty(),-1)}static max(){return new n(X.max(),$.empty(),-1)}};function wy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=$.comparator(n.documentKey,e.documentKey),t!==0?t:ie(n.largestBatchId,e.largestBatchId))}var CA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",xh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function oi(n){return R(this,null,function*(){if(n.code!==k.FAILED_PRECONDITION||n.message!==CA)throw n;O("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let l=u;t(e[l]).next(h=>{o[l]=h,++a,a===s&&r(o)},h=>i(h))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Mh=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ze,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new $i(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Ey(r.target.error);this.V.reject(new $i(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new $i(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(O("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Pm(t)}},Xr=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(Fa())===12.2&&Ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return O("SimpleDb","Removing database:",e),Vi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Al())return!1;if(n.C())return!0;let e=Fa(),t=n.S(e),r=0<t&&t<10,i=AA(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return R(this,null,function*(){return this.db||(O("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new $i(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new F(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new F(k.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new $i(e,o))},i.onupgradeneeded=s=>{O("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{O("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return R(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Mh.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(l=>(a.g(),l)).catch(l=>(a.abort(l),P.reject(l))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,l=u.name!=="FirebaseError"&&o<3;if(O("SimpleDb","Transaction failed with error:",u.message,"Retrying:",l),this.close(),!l)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function AA(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Rm=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Vi(this.B.delete())}},$i=class extends F{constructor(e,t){super(k.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ai(n){return n.name==="IndexedDbTransactionError"}var Pm=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(O("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(O("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Vi(r)}add(e){return O("SimpleDb","ADD",this.store.name,e,e),Vi(this.store.add(e))}get(e){return Vi(this.store.get(e)).next(t=>(t===void 0&&(t=null),O("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return O("SimpleDb","DELETE",this.store.name,e),Vi(this.store.delete(e))}count(){return O("SimpleDb","COUNT",this.store.name),Vi(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new P((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new P((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){O("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new P((r,i)=>{t.onerror=s=>{let o=Ey(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new P((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Rm(a),l=t(a.primaryKey,a.value,u);if(l instanceof P){let h=l.catch(f=>(u.done(),P.reject(f)));r.push(h)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>P.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Vi(n){return new P((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Ey(r.target.error);t(i)}})}var wC=!1;function Ey(n){let e=Xr.S(Fa());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new F("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wC||(wC=!0,setTimeout(()=>{throw r},0)),r}}return n}var Nm=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){O("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>R(this,null,function*(){this.task=null;try{O("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){ai(t)?O("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield oi(t)}yield this.X(6e4)}))}},km=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return R(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return P.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return O("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(O("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=IA(s);wy(o,r)>0&&(r=o)}),new sn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var qt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function cc(n){return n==null}function $u(n){return n===0&&1/n==-1/0}function DA(n){return typeof n=="number"&&Number.isInteger(n)&&!$u(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=EC(e)),e=uO(n.get(t),e);return EC(e)}function uO(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function EC(n){return n+""}function xn(n){let e=n.length;if(K(e>=2),e===2)return K(n.charAt(0)===""&&n.charAt(1)===""),pe.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&z(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:z()}s=o+2}return new pe(r)}var TC=["userId","batchId"];function Ch(n,e){return[n,Dt(e)]}function bA(n,e,t){return[n,Dt(e),t]}var cO={},lO=["prefixPath","collectionGroup","readTime","documentId"],hO=["prefixPath","collectionGroup","documentId"],dO=["collectionGroup","readTime","prefixPath","documentId"],fO=["canonicalId","targetId"],pO=["targetId","path"],gO=["path","targetId"],mO=["collectionId","parent"],_O=["indexId","uid"],yO=["uid","sequenceNumber"],vO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wO=["indexId","uid","orderedDocumentKey"],EO=["userId","collectionPath","documentId"],TO=["userId","collectionPath","largestBatchId"],IO=["userId","collectionGroup","largestBatchId"],SA=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],CO=[...SA,"documentOverlays"],RA=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],PA=RA,NA=[...PA,"indexConfiguration","indexState","indexEntries"],AO=NA;var qu=class extends xh{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function ot(n,e){let t=q(n);return Xr.F(t._e,e)}function IC(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function es(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function kA(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Pe=class n{constructor(e,t){this.comparator=e,this.root=t||Fn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Fn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uo(this.root,e,this.comparator,!1)}getReverseIterator(){return new uo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uo(this.root,e,this.comparator,!0)}},uo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Fn=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();let e=this.left.check();if(e!==this.right.check())throw z();return e+(this.isRed()?0:1)}};Fn.EMPTY=null,Fn.RED=!0,Fn.BLACK=!1;Fn.EMPTY=new class{constructor(){this.size=0}get key(){throw z()}get value(){throw z()}get color(){throw z()}get left(){throw z()}get right(){throw z()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Fn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ce=class n{constructor(e){this.comparator=e,this.data=new Pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fh(this.data.getIterator())}getIteratorFrom(e){return new Fh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Fh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Zs(n){return n.hasNext()?n.getNext():void 0}var Gt=class n{constructor(e){this.fields=e,e.sort(ze.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ce(ze.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fo(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Oh=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function xA(){return typeof atob<"u"}var st=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Oh("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};st.EMPTY_BYTE_STRING=new st("");var DO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fr(n){if(K(!!n),typeof n=="string"){let e=0,t=DO.exec(n);if(K(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$e(n.seconds),nanos:$e(n.nanos)}}function $e(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Jr(n){return typeof n=="string"?st.fromBase64String(n):st.fromUint8Array(n)}function Dd(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ty(n){let e=n.mapValue.fields.__previous_value__;return Dd(e)?Ty(e):e}function Gu(n){let e=fr(n.mapValue.fields.__local_write_time__.timestampValue);return new Le(e.seconds,e.nanos)}var xm=class{constructor(e,t,r,i,s,o,a,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=l}},Zr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Kr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ah={nullValue:"NULL_VALUE"};function qi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Dd(n)?4:MA(n)?9007199254740991:10:z()}function Ln(n,e){if(n===e)return!0;let t=qi(n);if(t!==qi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Gu(n).isEqual(Gu(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=fr(i.timestampValue),a=fr(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Jr(i.bytesValue).isEqual(Jr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return $e(i.geoPointValue.latitude)===$e(s.geoPointValue.latitude)&&$e(i.geoPointValue.longitude)===$e(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return $e(i.integerValue)===$e(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=$e(i.doubleValue),a=$e(s.doubleValue);return o===a?$u(o)===$u(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return fo(n.arrayValue.values||[],e.arrayValue.values||[],Ln);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(IC(o)!==IC(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Ln(o[u],a[u])))return!1;return!0}(n,e);default:return z()}}function zu(n,e){return(n.values||[]).find(t=>Ln(t,e))!==void 0}function ei(n,e){if(n===e)return 0;let t=qi(n),r=qi(e);if(t!==r)return ie(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ie(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=$e(s.integerValue||s.doubleValue),u=$e(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return CC(n.timestampValue,e.timestampValue);case 4:return CC(Gu(n),Gu(e));case 5:return ie(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Jr(s),u=Jr(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let l=0;l<a.length&&l<u.length;l++){let h=ie(a[l],u[l]);if(h!==0)return h}return ie(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=ie($e(s.latitude),$e(o.latitude));return a!==0?a:ie($e(s.longitude),$e(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let l=0;l<a.length&&l<u.length;++l){let h=ei(a[l],u[l]);if(h)return h}return ie(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Kr.mapValue&&o===Kr.mapValue)return 0;if(s===Kr.mapValue)return 1;if(o===Kr.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),l=o.fields||{},h=Object.keys(l);u.sort(),h.sort();for(let f=0;f<u.length&&f<h.length;++f){let g=ie(u[f],h[f]);if(g!==0)return g;let _=ei(a[u[f]],l[h[f]]);if(_!==0)return _}return ie(u.length,h.length)}(n.mapValue,e.mapValue);default:throw z()}}function CC(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ie(n,e);let t=fr(n),r=fr(e),i=ie(t.seconds,r.seconds);return i!==0?i:ie(t.nanos,r.nanos)}function go(n){return Mm(n)}function Mm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=fr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Jr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return $.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Mm(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Mm(t.fields[o])}`;return i+"}"}(n.mapValue):z()}function Gi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Fm(n){return!!n&&"integerValue"in n}function Wu(n){return!!n&&"arrayValue"in n}function AC(n){return!!n&&"nullValue"in n}function DC(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Dh(n){return!!n&&"mapValue"in n}function Ou(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return es(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ou(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ou(n.arrayValue.values[t]);return e}return Object.assign({},n)}function MA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function bO(n){return"nullValue"in n?Ah:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Gi(Zr.empty(),$.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:z()}function SO(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Gi(Zr.empty(),$.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Kr:z()}function bC(n,e){let t=ei(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function SC(n,e){let t=ei(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Et=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Dh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ou(t)}setAll(e){let t=ze.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Ou(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Dh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ln(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Dh(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){es(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ou(this.value))}};function FA(n){let e=[];return es(n.fields,(t,r)=>{let i=new ze([t]);if(Dh(r)){let s=FA(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Gt(e)}var et=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,X.min(),X.min(),X.min(),Et.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,X.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,X.min(),X.min(),Et.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,X.min(),X.min(),Et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(X.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Un=class{constructor(e,t){this.position=e,this.inclusive=t}};function RC(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=$.comparator($.fromName(o.referenceValue),t.key):r=ei(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function PC(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ln(n.position[t],e.position[t]))return!1;return!0}var zi=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function RO(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Vh=class{},he=class n extends Vh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Lm(e,t,r):t==="array-contains"?new jm(e,r):t==="in"?new Lh(e,r):t==="not-in"?new $m(e,r):t==="array-contains-any"?new qm(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Um(e,r):new Bm(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ei(t,this.value)):t!==null&&qi(this.value)===qi(t)&&this.matchesComparison(ei(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},we=class n extends Vh{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return mo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function mo(n){return n.op==="and"}function Om(n){return n.op==="or"}function Iy(n){return OA(n)&&mo(n)}function OA(n){for(let e of n.filters)if(e instanceof we)return!1;return!0}function Vm(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+go(n.value);if(Iy(n))return n.filters.map(e=>Vm(e)).join(",");{let e=n.filters.map(t=>Vm(t)).join(",");return`${n.op}(${e})`}}function VA(n,e){return n instanceof he?function(r,i){return i instanceof he&&r.op===i.op&&r.field.isEqual(i.field)&&Ln(r.value,i.value)}(n,e):n instanceof we?function(r,i){return i instanceof we&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&VA(o,i.filters[a]),!0):!1}(n,e):void z()}function LA(n,e){let t=n.filters.concat(e);return we.create(t,n.op)}function UA(n){return n instanceof he?function(t){return`${t.field.canonicalString()} ${t.op} ${go(t.value)}`}(n):n instanceof we?function(t){return t.op.toString()+" {"+t.getFilters().map(UA).join(" ,")+"}"}(n):"Filter"}var Lm=class extends he{constructor(e,t,r){super(e,t,r),this.key=$.fromName(r.referenceValue)}matches(e){let t=$.comparator(e.key,this.key);return this.matchesComparison(t)}},Um=class extends he{constructor(e,t){super(e,"in",t),this.keys=BA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Bm=class extends he{constructor(e,t){super(e,"not-in",t),this.keys=BA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function BA(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>$.fromName(r.referenceValue))}var jm=class extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Wu(t)&&zu(t.arrayValue,this.value)}},Lh=class extends he{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&zu(this.value.arrayValue,t)}},$m=class extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if(zu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!zu(this.value.arrayValue,t)}},qm=class extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Wu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>zu(this.value.arrayValue,r))}};var Gm=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function zm(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Gm(n,e,t,r,i,s,o)}function Wi(n){let e=q(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Vm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),cc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>go(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>go(r)).join(",")),e.ue=t}return e.ue}function lc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!RO(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!VA(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!PC(n.startAt,e.startAt)&&PC(n.endAt,e.endAt)}function Uh(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Bh(n,e){return n.filters.filter(t=>t instanceof he&&t.field.isEqual(e))}function NC(n,e,t){let r=Ah,i=!0;for(let s of Bh(n,e)){let o=Ah,a=!0;switch(s.op){case"<":case"<=":o=bO(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ah}bC({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];bC({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function kC(n,e,t){let r=Kr,i=!0;for(let s of Bh(n,e)){let o=Kr,a=!0;switch(s.op){case">=":case">":o=SO(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Kr}SC({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];SC({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var _n=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function jA(n,e,t,r,i,s,o,a){return new _n(n,e,t,r,i,s,o,a)}function No(n){return new _n(n)}function xC(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Cy(n){return n.collectionGroup!==null}function lo(n){let e=q(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ce(ze.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new zi(s,r))}),t.has(ze.keyField().canonicalString())||e.ce.push(new zi(ze.keyField(),r))}return e.ce}function bt(n){let e=q(n);return e.le||(e.le=PO(e,lo(n))),e.le}function PO(n,e){if(n.limitType==="F")return zm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new zi(i.field,s)});let t=n.endAt?new Un(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Un(n.startAt.position,n.startAt.inclusive):null;return zm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Wm(n,e){let t=n.filters.concat([e]);return new _n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function jh(n,e,t){return new _n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function hc(n,e){return lc(bt(n),bt(e))&&n.limitType===e.limitType}function $A(n){return`${Wi(bt(n))}|lt:${n.limitType}`}function io(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>UA(i)).join(", ")}]`),cc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>go(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>go(i)).join(",")),`Target(${r})`}(bt(n))}; limitType=${n.limitType})`}function dc(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):$.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of lo(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let l=RC(o,a,u);return o.inclusive?l<=0:l<0}(r.startAt,lo(r),i)||r.endAt&&!function(o,a,u){let l=RC(o,a,u);return o.inclusive?l>=0:l>0}(r.endAt,lo(r),i))}(n,e)}function qA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function GA(n){return(e,t)=>{let r=!1;for(let i of lo(n)){let s=NO(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function NO(n,e,t){let r=n.field.isKeyField()?$.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),l=a.data.field(s);return u!==null&&l!==null?ei(u,l):z()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return z()}}var Bn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){es(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return kA(this.inner)}size(){return this.innerSize}};var kO=new Pe($.comparator);function Ot(){return kO}var zA=new Pe($.comparator);function Mu(...n){let e=zA;for(let t of n)e=e.insert(t.key,t);return e}function WA(n){let e=zA;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Mn(){return Vu()}function HA(){return Vu()}function Vu(){return new Bn(n=>n.toString(),(n,e)=>n.isEqual(e))}var xO=new Pe($.comparator),MO=new Ce($.comparator);function oe(...n){let e=MO;for(let t of n)e=e.add(t);return e}var FO=new Ce(ie);function Ay(){return FO}function KA(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$u(e)?"-0":e}}function QA(n){return{integerValue:""+n}}function YA(n,e){return DA(e)?QA(e):KA(n,e)}var _o=class{constructor(){this._=void 0}};function OO(n,e,t){return n instanceof ti?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Dd(s)&&(s=Ty(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof pr?JA(n,e):n instanceof gr?ZA(n,e):function(i,s){let o=XA(i,s),a=MC(o)+MC(i.Pe);return Fm(o)&&Fm(i.Pe)?QA(a):KA(i.serializer,a)}(n,e)}function VO(n,e,t){return n instanceof pr?JA(n,e):n instanceof gr?ZA(n,e):t}function XA(n,e){return n instanceof ni?function(r){return Fm(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var ti=class extends _o{},pr=class extends _o{constructor(e){super(),this.elements=e}};function JA(n,e){let t=eD(e);for(let r of n.elements)t.some(i=>Ln(i,r))||t.push(r);return{arrayValue:{values:t}}}var gr=class extends _o{constructor(e){super(),this.elements=e}};function ZA(n,e){let t=eD(e);for(let r of n.elements)t=t.filter(i=>!Ln(i,r));return{arrayValue:{values:t}}}var ni=class extends _o{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function MC(n){return $e(n.integerValue||n.doubleValue)}function eD(n){return Wu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Hi=class{constructor(e,t){this.field=e,this.transform=t}};function LO(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof pr&&i instanceof pr||r instanceof gr&&i instanceof gr?fo(r.elements,i.elements,Ln):r instanceof ni&&i instanceof ni?Ln(r.Pe,i.Pe):r instanceof ti&&i instanceof ti}(n.transform,e.transform)}var Hm=class{constructor(e,t){this.version=e,this.transformResults=t}},qe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function bh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var yo=class{};function tD(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ii(n.key,qe.none()):new ri(n.key,n.data,qe.none());{let t=n.data,r=Et.empty(),i=new Ce(ze.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new yn(n.key,r,new Gt(i.toArray()),qe.none())}}function UO(n,e,t){n instanceof ri?function(i,s,o){let a=i.value.clone(),u=OC(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof yn?function(i,s,o){if(!bh(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=OC(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(nD(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Lu(n,e,t,r){return n instanceof ri?function(s,o,a,u){if(!bh(s.precondition,o))return a;let l=s.value.clone(),h=VC(s.fieldTransforms,u,o);return l.setAll(h),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof yn?function(s,o,a,u){if(!bh(s.precondition,o))return a;let l=VC(s.fieldTransforms,u,o),h=o.data;return h.setAll(nD(s)),h.setAll(l),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(s,o,a){return bh(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function BO(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=XA(r.transform,i||null);s!=null&&(t===null&&(t=Et.empty()),t.set(r.field,s))}return t||null}function FC(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&fo(r,i,(s,o)=>LO(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var ri=class extends yo{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},yn=class extends yo{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function nD(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function OC(n,e,t){let r=new Map;K(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,VO(o,a,t[i]))}return r}function VC(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,OO(s,o,e))}return r}var ii=class extends yo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Hu=class extends yo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ku=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&UO(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Lu(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Lu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=HA();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=tD(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(X.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oe())}isEqual(e){return this.batchId===e.batchId&&fo(this.mutations,e.mutations,(t,r)=>FC(t,r))&&fo(this.baseMutations,e.baseMutations,(t,r)=>FC(t,r))}},Km=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){K(e.mutations.length===r.length);let i=function(){return xO}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Qu=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Qm=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ye,fe;function rD(n){switch(n){default:return z();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0}}function iD(n){if(n===void 0)return Ge("GRPC error has no .code"),k.UNKNOWN;switch(n){case Ye.OK:return k.OK;case Ye.CANCELLED:return k.CANCELLED;case Ye.UNKNOWN:return k.UNKNOWN;case Ye.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case Ye.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case Ye.INTERNAL:return k.INTERNAL;case Ye.UNAVAILABLE:return k.UNAVAILABLE;case Ye.UNAUTHENTICATED:return k.UNAUTHENTICATED;case Ye.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case Ye.NOT_FOUND:return k.NOT_FOUND;case Ye.ALREADY_EXISTS:return k.ALREADY_EXISTS;case Ye.PERMISSION_DENIED:return k.PERMISSION_DENIED;case Ye.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case Ye.ABORTED:return k.ABORTED;case Ye.OUT_OF_RANGE:return k.OUT_OF_RANGE;case Ye.UNIMPLEMENTED:return k.UNIMPLEMENTED;case Ye.DATA_LOSS:return k.DATA_LOSS;default:return z()}}(fe=Ye||(Ye={}))[fe.OK=0]="OK",fe[fe.CANCELLED=1]="CANCELLED",fe[fe.UNKNOWN=2]="UNKNOWN",fe[fe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fe[fe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fe[fe.NOT_FOUND=5]="NOT_FOUND",fe[fe.ALREADY_EXISTS=6]="ALREADY_EXISTS",fe[fe.PERMISSION_DENIED=7]="PERMISSION_DENIED",fe[fe.UNAUTHENTICATED=16]="UNAUTHENTICATED",fe[fe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fe[fe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fe[fe.ABORTED=10]="ABORTED",fe[fe.OUT_OF_RANGE=11]="OUT_OF_RANGE",fe[fe.UNIMPLEMENTED=12]="UNIMPLEMENTED",fe[fe.INTERNAL=13]="INTERNAL",fe[fe.UNAVAILABLE=14]="UNAVAILABLE",fe[fe.DATA_LOSS=15]="DATA_LOSS";var LC=null;function sD(){return new TextEncoder}var jO=new qr([4294967295,4294967295],0);function UC(n){let e=sD().encode(n),t=new lm;return t.update(e),new Uint8Array(t.digest())}function BC(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new qr([t,r],0),new qr([i,s],0)]}var Ym=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ji(`Invalid padding: ${t}`);if(r<0)throw new ji(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ji(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ji(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=qr.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(qr.fromNumber(r)));return i.compare(jO)===1&&(i=new qr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=UC(e),[r,i]=BC(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=UC(e),[r,i]=BC(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ji=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Yu=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Xu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(X.min(),i,new Pe(ie),Ot(),oe())}},Xu=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,oe(),oe(),oe())}};var ho=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},$h=class{constructor(e,t){this.targetId=e,this.me=t}},qh=class{constructor(e,t,r=st.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Gh=class{constructor(){this.fe=0,this.ge=$C(),this.pe=st.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=oe(),t=oe(),r=oe();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:z()}}),new Xu(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=$C()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,K(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Xm=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ot(),this.qe=jC(),this.Qe=new Pe(ie)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Uh(s))if(r===0){let o=new $(s.path);this.Ue(t,o,et.newNoDocument(o,X.min()))}else K(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let l=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,l)}LC?.et(function(h,f,g,_,E){var b,I,M,B,x,U;let Y={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},Q=f.unchangedNames;return Q&&(Y.bloomFilter={applied:E===0,hashCount:(b=Q?.hashCount)!==null&&b!==void 0?b:0,bitmapLength:(B=(M=(I=Q?.bits)===null||I===void 0?void 0:I.bitmap)===null||M===void 0?void 0:M.length)!==null&&B!==void 0?B:0,padding:(U=(x=Q?.bits)===null||x===void 0?void 0:x.padding)!==null&&U!==void 0?U:0,mightContain:T=>{var y;return(y=_?.mightContain(T))!==null&&y!==void 0&&y}}),Y}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Jr(r).toUint8Array()}catch(u){if(u instanceof Oh)return rn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Ym(o,i,s)}catch(u){return rn(u instanceof ji?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Uh(a.target)){let u=new $(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,et.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=oe();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let l=this.Je(u);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Yu(e,t,this.Qe,this.ke,r);return this.ke=Ot(),this.qe=jC(),this.Qe=new Pe(ie),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Gh,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ce(ie),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Gh),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function jC(){return new Pe($.comparator)}function $C(){return new Pe($.comparator)}var $O={asc:"ASCENDING",desc:"DESCENDING"},qO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},GO={and:"AND",or:"OR"},Jm=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Zm(n,e){return n.useProto3Json||cc(e)?e:{value:e}}function vo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function oD(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function zO(n,e){return vo(n,e.toTimestamp())}function We(n){return K(!!n),X.fromTimestamp(function(t){let r=fr(t);return new Le(r.seconds,r.nanos)}(n))}function Dy(n,e){return e_(n,e).canonicalString()}function e_(n,e){let t=function(i){return new pe(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function aD(n){let e=pe.fromString(n);return K(_D(e)),e}function Ju(n,e){return Dy(n.databaseId,e.path)}function On(n,e){let t=aD(e);if(t.get(1)!==n.databaseId.projectId)throw new F(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new F(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new $(lD(t))}function uD(n,e){return Dy(n.databaseId,e)}function cD(n){let e=aD(n);return e.length===4?pe.emptyPath():lD(e)}function t_(n){return new pe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function lD(n){return K(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function qC(n,e,t){return{name:Ju(n,e),fields:t.value.mapValue.fields}}function hD(n,e,t){let r=On(n,e.name),i=We(e.updateTime),s=e.createTime?We(e.createTime):X.min(),o=new Et({mapValue:{fields:e.fields}}),a=et.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function WO(n,e){return"found"in e?function(r,i){K(!!i.found),i.found.name,i.found.updateTime;let s=On(r,i.found.name),o=We(i.found.updateTime),a=i.found.createTime?We(i.found.createTime):X.min(),u=new Et({mapValue:{fields:i.found.fields}});return et.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){K(!!i.missing),K(!!i.readTime);let s=On(r,i.missing),o=We(i.readTime);return et.newNoDocument(s,o)}(n,e):z()}function HO(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:z()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,h){return l.useProto3Json?(K(h===void 0||typeof h=="string"),st.fromBase64String(h||"")):(K(h===void 0||h instanceof Buffer||h instanceof Uint8Array),st.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){let h=l.code===void 0?k.UNKNOWN:iD(l.code);return new F(h,l.message||"")}(o);t=new qh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=On(n,r.document.name),s=We(r.document.updateTime),o=r.document.createTime?We(r.document.createTime):X.min(),a=new Et({mapValue:{fields:r.document.fields}}),u=et.newFoundDocument(i,s,o,a),l=r.targetIds||[],h=r.removedTargetIds||[];t=new ho(l,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=On(n,r.document),s=r.readTime?We(r.readTime):X.min(),o=et.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ho([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=On(n,r.document),s=r.removedTargetIds||[];t=new ho([],s,i,null)}else{if(!("filter"in e))return z();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Qm(i,s),a=r.targetId;t=new $h(a,o)}}return t}function Zu(n,e){let t;if(e instanceof ri)t={update:qC(n,e.key,e.value)};else if(e instanceof ii)t={delete:Ju(n,e.key)};else if(e instanceof yn)t={update:qC(n,e.key,e.data),updateMask:ZO(e.fieldMask)};else{if(!(e instanceof Hu))return z();t={verify:Ju(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof ti)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof pr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof gr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ni)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw z()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:zO(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:z()}(n,e.precondition)),t}function n_(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?qe.updateTime(We(s.updateTime)):s.exists!==void 0?qe.exists(s.exists):qe.none()}(e.currentDocument):qe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)K(a.setToServerValue==="REQUEST_TIME"),u=new ti;else if("appendMissingElements"in a){let h=a.appendMissingElements.values||[];u=new pr(h)}else if("removeAllFromArray"in a){let h=a.removeAllFromArray.values||[];u=new gr(h)}else"increment"in a?u=new ni(o,a.increment):z();let l=ze.fromServerFormat(a.fieldPath);return new Hi(l,u)}(n,i)):[];if(e.update){e.update.name;let i=On(n,e.update.name),s=new Et({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let l=u.fieldPaths||[];return new Gt(l.map(h=>ze.fromServerFormat(h)))}(e.updateMask);return new yn(i,s,o,t,r)}return new ri(i,s,t,r)}if(e.delete){let i=On(n,e.delete);return new ii(i,t)}if(e.verify){let i=On(n,e.verify);return new Hu(i,t)}return z()}function KO(n,e){return n&&n.length>0?(K(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?We(i.updateTime):We(s);return o.isEqual(X.min())&&(o=We(s)),new Hm(o,i.transformResults||[])}(t,e))):[]}function dD(n,e){return{documents:[uD(n,e.path)]}}function fD(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=uD(n,i);let s=function(l){if(l.length!==0)return mD(we.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(l){if(l.length!==0)return l.map(h=>function(g){return{field:so(g.field),direction:YO(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Zm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{_t:t,parent:i}}function pD(n){let e=cD(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){K(r===1);let h=t.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(f){let g=gD(f);return g instanceof we&&Iy(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(E){return new zi(oo(E.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,cc(g)?null:g}(t.limit));let u=null;t.startAt&&(u=function(f){let g=!!f.before,_=f.values||[];return new Un(_,g)}(t.startAt));let l=null;return t.endAt&&(l=function(f){let g=!f.before,_=f.values||[];return new Un(_,g)}(t.endAt)),jA(e,i,o,s,a,"F",u,l)}function QO(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function gD(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=oo(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=oo(t.unaryFilter.field);return he.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=oo(t.unaryFilter.field);return he.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=oo(t.unaryFilter.field);return he.create(o,"!=",{nullValue:"NULL_VALUE"});default:return z()}}(n):n.fieldFilter!==void 0?function(t){return he.create(oo(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return we.create(t.compositeFilter.filters.map(r=>gD(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return z()}}(t.compositeFilter.op))}(n):z()}function YO(n){return $O[n]}function XO(n){return qO[n]}function JO(n){return GO[n]}function so(n){return{fieldPath:n.canonicalString()}}function oo(n){return ze.fromServerFormat(n.fieldPath)}function mD(n){return n instanceof he?function(t){if(t.op==="=="){if(DC(t.value))return{unaryFilter:{field:so(t.field),op:"IS_NAN"}};if(AC(t.value))return{unaryFilter:{field:so(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(DC(t.value))return{unaryFilter:{field:so(t.field),op:"IS_NOT_NAN"}};if(AC(t.value))return{unaryFilter:{field:so(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:so(t.field),op:XO(t.op),value:t.value}}}(n):n instanceof we?function(t){let r=t.getFilters().map(i=>mD(i));return r.length===1?r[0]:{compositeFilter:{op:JO(t.op),filters:r}}}(n):z()}function ZO(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _D(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var wo=class n{constructor(e,t,r,i,s=X.min(),o=X.min(),a=st.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var zh=class{constructor(e){this.ct=e}};function e1(n,e){let t;if(e.document)t=hD(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=$.fromSegments(e.noDocument.path),i=Qi(e.noDocument.readTime);t=et.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return z();{let r=$.fromSegments(e.unknownDocument.path),i=Qi(e.unknownDocument.version);t=et.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Le(i[0],i[1]);return X.fromTimestamp(s)}(e.readTime)),t}function GC(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Wh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Ju(s,o.key),fields:o.data.value.mapValue.fields,updateTime:vo(s,o.version.toTimestamp()),createTime:vo(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ki(e.version)};else{if(!e.isUnknownDocument())return z();r.unknownDocument={path:t.path.toArray(),version:Ki(e.version)}}return r}function Wh(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ki(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Qi(n){let e=new Le(n.seconds,n.nanoseconds);return X.fromTimestamp(e)}function Li(n,e){let t=(e.baseMutations||[]).map(s=>n_(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>n_(n.ct,s)),i=Le.fromMillis(e.localWriteTimeMs);return new Ku(e.batchId,i,t,r)}function Fu(n){let e=Qi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Qi(n.lastLimboFreeSnapshotVersion):X.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return K(s.documents.length===1),bt(No(cD(s.documents[0])))}(n.query):function(s){return bt(pD(s))}(n.query),new wo(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,st.fromBase64String(n.resumeToken))}function yD(n,e){let t=Ki(e.snapshotVersion),r=Ki(e.lastLimboFreeSnapshotVersion),i;i=Uh(e.target)?dD(n.ct,e.target):fD(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Wi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function by(n){let e=pD({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?jh(e,e.limit,"L"):e}function _m(n,e){return new Qu(e.largestBatchId,n_(n.ct,e.overlayMutation))}function zC(n,e){let t=e.path.lastSegment();return[n,Dt(e.path.popLast()),t]}function WC(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ki(r.readTime),documentKey:Dt(r.documentKey.path),largestBatchId:r.largestBatchId}}var r_=class{getBundleMetadata(e,t){return HC(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Qi(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return HC(e).put(function(i){return{bundleId:i.id,createTime:Ki(We(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return KC(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:by(s.bundledQuery),readTime:Qi(s.readTime)}}(r)})}saveNamedQuery(e,t){return KC(e).put(function(i){return{name:i.name,readTime:Ki(We(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function HC(n){return ot(n,"bundles")}function KC(n){return ot(n,"namedQueries")}var Hh=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Pu(e).get(zC(this.userId,t)).next(r=>r?_m(this.serializer,r):null)}getOverlays(e,t){let r=Mn();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Qu(t,o);i.push(this.ht(e,a))}),P.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Dt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Pu(e).j("collectionPathOverlayIndex",a))}),P.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Mn(),s=Dt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Pu(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let l=_m(this.serializer,u);i.set(l.getKey(),l)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Mn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Pu(e).J({index:"collectionGroupOverlayIndex",range:a},(u,l,h)=>{let f=_m(this.serializer,l);s.size()<i||f.largestBatchId===o?(s.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>s)}ht(e,t){return Pu(e).put(function(i,s,o){let[a,u,l]=zC(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:l,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Zu(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Pu(n){return ot(n,"documentOverlays")}var hr=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt($e(e.integerValue));else if("doubleValue"in e){let r=$e(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),$u(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"&&(r=fr(r)),t.At(`${r.seconds||""}`),t.dt(r.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Jr(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?MA(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):z()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),$.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};hr.bt=new hr;function t1(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function QC(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=t1(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var i_=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),r=QC(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),r=QC(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},s_=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},o_=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},Ui=class{constructor(){this.Gt=new i_,this.zt=new s_(this.Gt),this.jt=new o_(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var Bi=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Gr(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=YC(n.arrayValue,e.arrayValue),t!==0?t:(t=YC(n.directionalValue,e.directionalValue),t!==0?t:$.comparator(n.documentKey,e.documentKey)))}function YC(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Kh=class{constructor(e){this.Yt=new Ce((t,r)=>ze.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(K(e.collectionGroup===this.collectionId),this.en)return!1;let t=Sm(e);if(t!==void 0&&!this.nn(t))return!1;let r=Oi(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new Ce(ze.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new co(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new co(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new co(r.field,r.dir==="asc"?0:1)));return new po(po.UNKNOWN_ID,this.collectionId,t,ju.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function vD(n){var e,t;if(K(n instanceof he||n instanceof we),n instanceof he){if(n instanceof Lh){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>he.create(n.field,"==",s)))||[];return we.create(i,"or")}return n}let r=n.filters.map(i=>vD(i));return we.create(r,n.op)}function n1(n){if(n.getFilters().length===0)return[];let e=c_(vD(n));return K(wD(e)),a_(e)||u_(e)?[e]:e.getFilters()}function a_(n){return n instanceof he}function u_(n){return n instanceof we&&Iy(n)}function wD(n){return a_(n)||u_(n)||function(t){if(t instanceof we&&Om(t)){for(let r of t.getFilters())if(!a_(r)&&!u_(r))return!1;return!0}return!1}(n)}function c_(n){if(K(n instanceof he||n instanceof we),n instanceof he)return n;if(n.filters.length===1)return c_(n.filters[0]);let e=n.filters.map(r=>c_(r)),t=we.create(e,n.op);return t=Qh(t),wD(t)?t:(K(t instanceof we),K(mo(t)),K(t.filters.length>1),t.filters.reduce((r,i)=>Sy(r,i)))}function Sy(n,e){let t;return K(n instanceof he||n instanceof we),K(e instanceof he||e instanceof we),t=n instanceof he?e instanceof he?function(i,s){return we.create([i,s],"and")}(n,e):XC(n,e):e instanceof he?XC(e,n):function(i,s){if(K(i.filters.length>0&&s.filters.length>0),mo(i)&&mo(s))return LA(i,s.getFilters());let o=Om(i)?i:s,a=Om(i)?s:i,u=o.filters.map(l=>Sy(l,a));return we.create(u,"or")}(n,e),Qh(t)}function XC(n,e){if(mo(e))return LA(e,n.getFilters());{let t=e.filters.map(r=>Sy(n,r));return we.create(t,"or")}}function Qh(n){if(K(n instanceof he||n instanceof we),n instanceof he)return n;let e=n.getFilters();if(e.length===1)return Qh(e[0]);if(OA(n))return n;let t=e.map(i=>Qh(i)),r=[];return t.forEach(i=>{i instanceof he?r.push(i):i instanceof we&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:we.create(r,n.op)}var l_=class{constructor(){this._n=new ec}addToCollectionParentIndex(e,t){return this._n.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(sn.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(sn.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},ec=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ce(pe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ce(pe.comparator)).toArray()}};var wh=new Uint8Array(0),h_=class{constructor(e,t){this.databaseId=t,this.an=new ec,this.un=new Bn(r=>Wi(r),(r,i)=>lc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:Dt(i)};return JC(e).put(s)}return P.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[EA(t),""],!1,!0);return JC(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(xn(o.parent))}return r})}addFieldIndex(e,t){let r=Nu(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=to(e);return s.next(a=>{o.put(WC(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Nu(e),i=to(e),s=eo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Nu(e),r=eo(e),i=to(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return P.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Kh(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=eo(e),i=!0,s=new Map;return P.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=oe(),a=[];return P.forEach(s,(u,l)=>{O("IndexedDbIndexManager",`Using index ${function(x){return`id=${x.indexId}|cg=${x.collectionGroup}|f=${x.fields.map(U=>`${U.fieldPath}:${U.kind}`).join(",")}`}(u)} to execute ${Wi(t)}`);let h=function(x,U){let Y=Sm(U);if(Y===void 0)return null;for(let Q of Bh(x,Y.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(l,u),f=function(x,U){let Y=new Map;for(let Q of Oi(U))for(let T of Bh(x,Q.fieldPath))switch(T.op){case"==":case"in":Y.set(Q.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Y.set(Q.fieldPath.canonicalString(),T.value),Array.from(Y.values())}return null}(l,u),g=function(x,U){let Y=[],Q=!0;for(let T of Oi(U)){let y=T.kind===0?NC(x,T.fieldPath,x.startAt):kC(x,T.fieldPath,x.startAt);Y.push(y.value),Q&&(Q=y.inclusive)}return new Un(Y,Q)}(l,u),_=function(x,U){let Y=[],Q=!0;for(let T of Oi(U)){let y=T.kind===0?kC(x,T.fieldPath,x.endAt):NC(x,T.fieldPath,x.endAt);Y.push(y.value),Q&&(Q=y.inclusive)}return new Un(Y,Q)}(l,u),E=this.hn(u,l,g),b=this.hn(u,l,_),I=this.Pn(u,l,f),M=this.In(u.indexId,h,E,g.inclusive,b,_.inclusive,I);return P.forEach(M,B=>r.G(B,t.limit).next(x=>{x.forEach(U=>{let Y=$.fromSegments(U.documentKey);o.has(Y)||(o=o.add(Y),a.push(Y))})}))}).next(()=>a)}return P.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=n1(we.create(e.filters,"and")).map(r=>zm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),l=u/(t!=null?t.length:1),h=[];for(let f=0;f<u;++f){let g=t?this.Tn(t[f/l]):wh,_=this.En(e,g,r[f%l],i),E=this.dn(e,g,s[f%l],o),b=a.map(I=>this.En(e,g,I,!0));h.push(...this.createRange(_,E,b))}return h}En(e,t,r,i){let s=new Bi(e,$.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new Bi(e,$.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new Kh(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return P.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let l=new Ce(ze.comparator),h=!1;for(let f of u.filters)for(let g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:l=l.add(g.field));for(let f of u.orderBy)f.field.isKeyField()||(l=l.add(f.field));return l.size+(h?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new Ui;for(let i of Oi(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);hr.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new Ui;return hr.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new Ui;return hr.bt.Pt(Gi(this.databaseId,t),r.Ht(function(s){let o=Oi(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new Ui);let s=0;for(let o of Oi(e)){let a=r[s++];for(let u of i)if(this.Vn(t,o.fieldPath)&&Wu(a))i=this.mn(i,o,a);else{let l=u.Ht(o.kind);hr.bt.Pt(a,l)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new Ui;u.seed(a.Wt()),hr.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof he&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Nu(e),i=to(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return P.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(h,f){let g=f?new ju(f.sequenceNumber,new sn(Qi(f.readTime),new $(xn(f.documentKey)),f.largestBatchId)):ju.empty(),_=h.fields.map(([E,b])=>new co(ze.fromServerFormat(E),b));return new po(h.indexId,h.collectionGroup,_,g)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ie(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Nu(e),s=to(e);return this.gn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>P.forEach(a,u=>s.put(WC(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return P.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),P.forEach(a,u=>this.pn(e,i,u).next(l=>{let h=this.yn(s,u);return l.isEqual(h)?P.resolve():this.wn(e,s,u,l,h)}))))})}Sn(e,t,r,i){return eo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return eo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=eo(e),s=new Ce(Gr);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new Bi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new Ce(Gr),i=this.An(t,e);if(i==null)return r;let s=Sm(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Wu(o))for(let a of o.arrayValue.values||[])r=r.add(new Bi(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new Bi(t.indexId,e.key,wh,i));return r}wn(e,t,r,i,s){O("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,l,h,f,g){let _=u.getIterator(),E=l.getIterator(),b=Zs(_),I=Zs(E);for(;b||I;){let M=!1,B=!1;if(b&&I){let x=h(b,I);x<0?B=!0:x>0&&(M=!0)}else b!=null?B=!0:M=!0;M?(f(I),I=Zs(E)):B?(g(b),b=Zs(_)):(b=Zs(_),I=Zs(E))}}(i,s,Gr,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),P.waitFor(o)}gn(e){let t=1;return to(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Gr(o,a)).filter((o,a,u)=>!a||Gr(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Gr(o,e),u=Gr(o,t);if(a===0)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,wh,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,wh,[]];s.push(IDBKeyRange.bound(a,u))}return s}Dn(e,t){return Gr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ZC)}getMinOffset(e,t){return P.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||z())).next(ZC)}};function JC(n){return ot(n,"collectionParents")}function eo(n){return ot(n,"indexEntries")}function Nu(n){return ot(n,"indexConfiguration")}function to(n){return ot(n,"indexState")}function ZC(n){K(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;wy(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new sn(e.readTime,e.documentKey,t)}var eA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function ED(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.J({range:o},(h,f,g)=>(a++,g.delete()));s.push(u.next(()=>{K(a===1)}));let l=[];for(let h of t.mutations){let f=bA(e,h.key.path,t.batchId);s.push(i.delete(f)),l.push(h.key)}return P.waitFor(s).next(()=>l)}function Yh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw z();e=n.noDocument}return JSON.stringify(e).length}nn.DEFAULT_COLLECTION_PERCENTILE=10,nn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nn.DEFAULT=new nn(41943040,nn.DEFAULT_COLLECTION_PERCENTILE,nn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nn.DISABLED=new nn(-1,0,0);var Xh=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){K(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zr(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ao(e),o=zr(e);return o.add({}).next(a=>{K(typeof a=="number");let u=new Ku(a,t,r,i),l=function(_,E,b){let I=b.baseMutations.map(B=>Zu(_.ct,B)),M=b.mutations.map(B=>Zu(_.ct,B));return{userId:E,batchId:b.batchId,localWriteTimeMs:b.localWriteTime.toMillis(),baseMutations:I,mutations:M}}(this.serializer,this.userId,u),h=[],f=new Ce((g,_)=>ie(g.canonicalString(),_.canonicalString()));for(let g of i){let _=bA(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(l)),h.push(s.put(_,cO))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),P.waitFor(h).next(()=>u)})}lookupMutationBatch(e,t){return zr(e).get(t).next(r=>r?(K(r.userId===this.userId),Li(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?P.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return zr(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(K(a.batchId>=r),s=Li(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return zr(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zr(e).U("userMutationsIndex",t).next(r=>r.map(i=>Li(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ch(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ao(e).J({range:i},(o,a,u)=>{let[l,h,f]=o,g=xn(h);if(l===this.userId&&t.path.isEqual(g))return zr(e).get(f).next(_=>{if(!_)throw z();K(_.userId===this.userId),s.push(Li(this.serializer,_))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(ie),i=[];return t.forEach(s=>{let o=Ch(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=ao(e).J({range:a},(l,h,f)=>{let[g,_,E]=l,b=xn(_);g===this.userId&&s.path.isEqual(b)?r=r.add(E):f.done()});i.push(u)}),P.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ch(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ce(ie);return ao(e).J({range:o},(u,l,h)=>{let[f,g,_]=u,E=xn(g);f===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(_)):h.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(zr(e).get(s).next(o=>{if(o===null)throw z();K(o.userId===this.userId),r.push(Li(this.serializer,o))}))}),P.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return ED(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),P.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ao(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=xn(s[1]);i.push(u)}else a.done()}).next(()=>{K(i.length===0)})})}containsKey(e,t){return TD(e,this.userId,t)}xn(e){return ID(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function TD(n,e,t){let r=Ch(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ao(n).J({range:s,H:!0},(a,u,l)=>{let[h,f,g]=a;h===e&&f===i&&(o=!0),l.done()}).next(()=>o)}function zr(n){return ot(n,"mutations")}function ao(n){return ot(n,"documentMutations")}function ID(n){return ot(n,"mutationQueues")}var Eo=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var d_=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let r=new Eo(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>X.fromTimestamp(new Le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>no(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(K(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return no(e).J((o,a)=>{let u=Fu(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>P.waitFor(s)).next(()=>i)}forEachTarget(e,t){return no(e).J((r,i)=>{let s=Fu(i);t(s)})}Bn(e){return tA(e).get("targetGlobalKey").next(t=>(K(t!==null),t))}kn(e,t){return tA(e).put("targetGlobalKey",t)}qn(e,t){return no(e).put(yD(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Wi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return no(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let l=Fu(a);lc(t,l.target)&&(s=l,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Wr(e);return t.forEach(o=>{let a=Dt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),P.waitFor(i)}removeMatchingKeys(e,t,r){let i=Wr(e);return P.forEach(t,s=>{let o=Dt(s.path);return P.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Wr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Wr(e),s=oe();return i.J({range:r,H:!0},(o,a,u)=>{let l=xn(o[1]),h=new $(l);s=s.add(h)}).next(()=>s)}containsKey(e,t){let r=Dt(t.path),i=IDBKeyRange.bound([r],[EA(r)],!1,!0),s=0;return Wr(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}ot(e,t){return no(e).get(t).next(r=>r?Fu(r):null)}};function no(n){return ot(n,"targets")}function tA(n){return ot(n,"targetGlobal")}function Wr(n){return ot(n,"targetDocuments")}function nA([n,e],[t,r]){let i=ie(n,t);return i===0?ie(e,r):i}var f_=class{constructor(e){this.Kn=e,this.buffer=new Ce(nA),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();nA(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},p_=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){O("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>R(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ai(t)?O("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield oi(t)}yield this.zn(3e5)}))}},g_=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(qt.oe);let r=new f_(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(eA)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),eA):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,u,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(s=f,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(l=Date.now(),ro()<=en.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${f} documents in `+(l-u)+`ms
Total Duration: ${l-h}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}};function r1(n,e){return new g_(n,e)}var m_=class{constructor(e,t){this.db=e,this.garbageCollector=r1(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return Eh(e,r)}removeReference(e,t,r){return Eh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Eh(e,t)}er(e,t){return function(i,s){let o=!1;return ID(i).Y(a=>TD(i,a,s).next(u=>(u&&(o=!0),P.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=t){let u=this.er(e,o).next(l=>{if(!l)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,X.min()),Wr(e).delete(function(f){return[0,Dt(f.path)]}(o))))});i.push(u)}}).next(()=>P.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Eh(e,t)}Xn(e,t){let r=Wr(e),i,s=qt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:l})=>{o===0?(s!==qt.oe&&t(new $(xn(i)),s),s=l,i=u):s=qt.oe}).next(()=>{s!==qt.oe&&t(new $(xn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Eh(n,e){return Wr(n).put(function(r,i){return{targetId:0,path:Dt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var Jh=class{constructor(){this.changes=new Bn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,et.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var __=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Fi(e).put(r)}removeEntry(e,t,r){return Fi(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Wh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=et.newInvalidDocument(t);return Fi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ku(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:et.newInvalidDocument(t)};return Fi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ku(t))},(i,s)=>{r={document:this.nr(t,s),size:Yh(s)}}).next(()=>r)}getEntries(e,t){let r=Ot();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=Ot(),i=new Pe($.comparator);return this.ir(e,t,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,Yh(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return P.resolve();let i=new Ce(sA);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ku(i.first()),ku(i.last())),o=i.getIterator(),a=o.getNext();return Fi(e).J({index:"documentKeyIndex",range:s},(u,l,h)=>{let f=$.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&sA(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,l),a=o.hasNext()?o.getNext():null),a?h.$(ku(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Wh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Fi(e).U(IDBKeyRange.bound(a,u,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let h=Ot();for(let f of l){let g=this.nr($.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(dc(t,g)||i.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,i){let s=Ot(),o=iA(t,r),a=iA(t,sn.max());return Fi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,l,h)=>{let f=this.nr($.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(f.key,f),s.size===i&&h.done()}).next(()=>s)}newChangeBuffer(e){return new y_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return rA(e).get("remoteDocumentGlobalKey").next(t=>(K(!!t),t))}tr(e,t){return rA(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=e1(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(X.min())))return r}return et.newInvalidDocument(e)}};function CD(n){return new __(n)}var y_=class extends Jh{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Bn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ce((s,o)=>ie(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=GC(this.ar.serializer,o);i=i.add(s.path.popLast());let l=Yh(u);r+=l-a.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=GC(this.ar.serializer,o.convertToNoDocument(X.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),P.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function rA(n){return ot(n,"remoteDocumentGlobal")}function Fi(n){return ot(n,"remoteDocumentsV14")}function ku(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function iA(n,e){let t=e.documentKey.path.toArray();return[n,Wh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function sA(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ie(t[s],r[s]),i)return i;return i=ie(t.length,r.length),i||(i=ie(t[t.length-2],r[r.length-2]),i||ie(t[t.length-1],r[r.length-1]))}var v_=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Zh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Lu(r.mutation,i,Gt.empty(),Le.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=oe()){let i=Mn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Mu();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Mn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oe()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ot(),o=Vu(),a=function(){return Vu()}();return t.forEach((u,l)=>{let h=r.get(l.key);i.has(l.key)&&(h===void 0||h.mutation instanceof yn)?s=s.insert(l.key,l):h!==void 0?(o.set(l.key,h.mutation.getFieldMask()),Lu(h.mutation,l,h.mutation.getFieldMask(),Le.now())):o.set(l.key,Gt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((l,h)=>o.set(l,h)),t.forEach((l,h)=>{var f;return a.set(l,new v_(h,(f=o.get(l))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Vu(),i=new Pe((o,a)=>o-a),s=oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let l=t.get(u);if(l===null)return;let h=r.get(u)||Gt.empty();h=a.applyToLocalView(l,h),r.set(u,h);let f=(i.get(a.batchId)||oe()).add(u);i=i.insert(a.batchId,f)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),l=u.key,h=u.value,f=HA();h.forEach(g=>{if(!s.has(g)){let _=tD(t.get(g),r.get(g));_!==null&&f.set(g,_),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,f))}return P.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return $.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Cy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):P.resolve(Mn()),a=-1,u=s;return o.next(l=>P.forEach(l,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(h)?P.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{u=u.insert(h,g)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,u,l,oe())).next(h=>({batchId:a,changes:WA(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $(t)).next(r=>{let i=Mu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Mu();return this.indexManager.getCollectionParents(e,s).next(a=>P.forEach(a,u=>{let l=function(f,g){return new _n(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,l)=>{let h=l.getKey();o.get(h)===null&&(o=o.insert(h,et.newInvalidDocument(h)))});let a=Mu();return o.forEach((u,l)=>{let h=s.get(u);h!==void 0&&Lu(h.mutation,l,Gt.empty(),Le.now()),dc(t,l)&&(a=a.insert(u,l))}),a})}};var w_=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return P.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:We(i.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:by(i.bundledQuery),readTime:We(i.readTime)}}(t)),P.resolve()}};var E_=class{constructor(){this.overlays=new Pe($.comparator),this.hr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Mn();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=Mn(),s=t.length+1,o=new $(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Pe((l,h)=>l-h),o=this.overlays.getIterator();for(;o.hasNext();){let l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let h=s.get(l.largestBatchId);h===null&&(h=Mn(),s=s.insert(l.largestBatchId,h)),h.set(l.getKey(),l)}}let a=Mn(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,h)=>a.set(l,h)),!(a.size()>=i)););return P.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Qu(t,r));let s=this.hr.get(t);s===void 0&&(s=oe(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var tc=class{constructor(){this.Pr=new Ce(Xe.Ir),this.Tr=new Ce(Xe.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new Xe(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new Xe(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new $(new pe([])),r=new Xe(t,e),i=new Xe(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new $(new pe([])),r=new Xe(t,e),i=new Xe(t,e+1),s=oe();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Xe(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Xe=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return $.comparator(e.key,t.key)||ie(e.pr,t.pr)}static Er(e,t){return ie(e.pr,t.pr)||$.comparator(e.key,t.key)}};var T_=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Ce(Xe.Ir)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ku(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new Xe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Xe(t,0),i=new Xe(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(ie);return t.forEach(i=>{let s=new Xe(i,0),o=new Xe(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),P.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;$.isDocumentKey(s)||(s=s.child(""));let o=new Xe(new $(s),0),a=new Ce(ie);return this.wr.forEachWhile(u=>{let l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(u.pr)),!0)},o),P.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){K(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return P.forEach(t.mutations,i=>{let s=new Xe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new Xe(t,0),i=this.wr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var I_=class{constructor(e){this.vr=e,this.docs=function(){return new Pe($.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():et.newInvalidDocument(t))}getEntries(e,t){let r=Ot();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():et.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ot(),o=t.path,a=new $(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:l,value:{document:h}}=u.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||wy(IA(h),r)<=0||(i.has(h.key)||dc(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,r,i){z()}Fr(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new C_(this)}getSize(e){return P.resolve(this.size)}},C_=class extends Jh{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var A_=class{constructor(e){this.persistence=e,this.Mr=new Bn(t=>Wi(t),lc),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.Or=0,this.Nr=new tc,this.targetCount=0,this.Lr=Eo.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),P.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new Eo(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.qn(t),P.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.Nr.containsKey(t))}};var ed=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new qt(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new A_(this),this.indexManager=new l_,this.remoteDocumentCache=function(i){return new I_(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new zh(t),this.$r=new w_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new E_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new T_(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new D_(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return P.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},D_=class extends xh{constructor(e){super(),this.currentSequenceNumber=e}},td=class n{constructor(e){this.persistence=e,this.zr=new tc,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw z()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),P.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Jr,r=>{let i=$.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,X.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return P.or([()=>P.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var b_=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Mh("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",TC,{unique:!0}),u.createObjectStore("documentMutations")}(e),oA(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=P.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),oA(e)),o=o.next(()=>function(u){let l=u.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",h)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,l){return l.store("mutations").U().next(h=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",TC,{unique:!0});let f=l.store("mutations"),g=h.map(_=>f.put(_));return P.waitFor(g)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let l=u.createObjectStore("documentOverlays",{keyPath:EO});l.createIndex("collectionPathOverlayIndex",TO,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",IO,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let l=u.createObjectStore("remoteDocumentsV14",{keyPath:lO});l.createIndex("documentKeyIndex",hO),l.createIndex("collectionGroupIndex",dO)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:_O}).createIndex("sequenceNumberIndex",yO,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:vO}).createIndex("documentKeyIndex",wO,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}ei(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Yh(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>P.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>P.forEach(a,u=>{K(u.userId===s.userId);let l=Li(this.serializer,u);return ED(e,s.userId,l).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new pe(o),l=function(f){return[0,Dt(f)]}(u);s.push(t.get(l).next(h=>h?P.resolve():(f=>t.put({targetId:0,path:Dt(f),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>P.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:mO});let r=t.store("collectionParents"),i=new ec,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Dt(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new pe(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],l)=>{let h=xn(a);return s(h.popLast())}))}ri(e){let t=e.store("targets");return t.J((r,i)=>{let s=Fu(i),o=yD(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(f){return f.document?new $(pe.fromString(f.document.name).popFirst(5)):f.noDocument?$.fromSegments(f.noDocument.path):f.unknownDocument?$.fromSegments(f.unknownDocument.path):z()}(o).path.toArray(),l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(l))}).next(()=>P.waitFor(i))}si(e,t){let r=t.store("mutations"),i=CD(this.serializer),s=new ed(td.Hr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var l;let h=(l=a.get(u.userId))!==null&&l!==void 0?l:oe();Li(this.serializer,u).keys().forEach(f=>h=h.add(f)),a.set(u.userId,h)}),P.forEach(a,(u,l)=>{let h=new Je(l),f=Hh.lt(this.serializer,h),g=s.getIndexManager(h),_=Xh.lt(h,this.serializer,g,s.referenceDelegate);return new Zh(i,_,f,g).recalculateAndSaveOverlaysForDocumentKeys(new qu(t,qt.oe),u).next()})})}};function oA(n){n.createObjectStore("targetDocuments",{keyPath:pO}).createIndex("documentTargetsIndex",gO,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",fO,{unique:!0}),n.createObjectStore("targetGlobal")}var ym="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",S_=class n{constructor(e,t,r,i,s,o,a,u,l,h,f=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=l,this.ai=h,this.ui=f,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=g=>Promise.resolve(),!n.D())throw new F(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new m_(this,i),this.Ti=t+"main",this.serializer=new zh(u),this.Ei=new Xr(this.Ti,this.ui,new b_(this.serializer)),this.Qr=new d_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=CD(this.serializer),this.$r=new r_,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,h===!1&&Ge("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new F(k.FAILED_PRECONDITION,ym);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new qt(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>R(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(t=>R(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>R(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Th(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(ai(e))return O("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return xu(e).get("owner").next(t=>P.resolve(this.Si(t)))}bi(e){return Th(e).delete(this.clientId)}Di(){return R(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=ot(t,"clientMetadata");return r.U().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return P.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?P.resolve(!0):xu(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new F(k.FAILED_PRECONDITION,ym);return!1}}return!(!this.networkEnabled||!this.inForeground)||Th(e).U().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&O("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return R(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new qu(e,qt.oe);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Th(e).U().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return Xh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new h_(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Hh.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){O("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===16?AO:u===15?NA:u===14?PA:u===13?RA:u===12?CO:u===11?SA:void z()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new qu(a,this.kr?this.kr.next():qt.oe),t==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw Ge(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new F(k.FAILED_PRECONDITION,CA);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return xu(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new F(k.FAILED_PRECONDITION,ym)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xu(e).put("owner",t)}static D(){return Xr.D()}yi(e){let t=xu(e);return t.get("owner").next(r=>this.Si(r)?(O("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):P.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Ge(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;Vp()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return O("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ge("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Ge("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function xu(n){return ot(n,"owner")}function Th(n){return ot(n,"clientMetadata")}function Ry(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var R_=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=oe(),i=oe();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var P_=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var nd=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Vp()?8:AA(Fa())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new P_;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(ro()<=en.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",io(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),P.resolve()):(ro()<=en.DEBUG&&O("QueryEngine","Query:",io(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(ro()<=en.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",io(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bt(t))):P.resolve())}ji(e,t){if(xC(t))return P.resolve(null);let r=bt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=jh(t,null,"F"),r=bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=oe(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let l=this.Zi(t,a);return this.Xi(t,l,o,u.readTime)?this.ji(e,jh(t,null,"F")):this.es(e,l,t,u)}))})))}Hi(e,t,r,i){return xC(t)||i.isEqual(X.min())?P.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?P.resolve(null):(ro()<=en.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),io(t)),this.es(e,o,t,TA(i,-1)).next(a=>a))})}Zi(e,t){let r=new Ce(GA(e));return t.forEach((i,s)=>{dc(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return ro()<=en.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",io(t)),this.zi.getDocumentsMatchingQuery(e,t,sn.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var N_=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new Pe(ie),this.rs=new Bn(s=>Wi(s),lc),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Zh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function AD(n,e,t,r){return new N_(n,e,t,r)}function DD(n,e){return R(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=oe();for(let l of i){o.push(l.batchId);for(let h of l.mutations)u=u.add(h.key)}for(let l of s){a.push(l.batchId);for(let h of l.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(r,u).next(l=>({us:l,removedBatchIds:o,addedBatchIds:a}))})})})}function i1(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,l,h){let f=l.batch,g=f.keys(),_=P.resolve();return g.forEach(E=>{_=_.next(()=>h.getEntry(u,E)).next(b=>{let I=l.docVersions.get(E);K(I!==null),b.version.compareTo(I)<0&&(f.applyToRemoteDocument(b,l),b.isValidDocument()&&(b.setReadTime(l.commitVersion),h.addEntry(b)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(u,f))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=oe();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(u=u.add(a.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function bD(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function s1(n,e){let t=q(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let a=[];e.targetChanges.forEach((h,f)=>{let g=i.get(f);if(!g)return;a.push(t.Qr.removeMatchingKeys(s,h.removedDocuments,f).next(()=>t.Qr.addMatchingKeys(s,h.addedDocuments,f)));let _=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(st.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),i=i.insert(f,_),function(b,I,M){return b.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0}(g,_,h)&&a.push(t.Qr.updateTargetData(s,_))});let u=Ot(),l=oe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),a.push(SD(s,o,e.documentUpdates).next(h=>{u=h.cs,l=h.ls})),!r.isEqual(X.min())){let h=t.Qr.getLastRemoteSnapshotVersion(s).next(f=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(h)}return P.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,l)).next(()=>u)}).then(s=>(t.ns=i,s))}function SD(n,e,t){let r=oe(),i=oe();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ot();return t.forEach((a,u)=>{let l=s.get(a);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(X.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):O("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",u.version)}),{cs:o,ls:i}})}function o1(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function To(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,P.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new wo(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Io(n,e,t){return R(this,null,function*(){let r=q(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ai(o))throw o;O("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function rd(n,e,t){let r=q(n),i=X.min(),s=oe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,l,h){let f=q(u),g=f.rs.get(h);return g!==void 0?P.resolve(f.ns.get(g)):f.Qr.getTargetData(l,h)}(r,o,bt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:X.min(),t?s:oe())).next(a=>(ND(r,qA(e),a),{documents:a,hs:s})))}function RD(n,e){let t=q(n),r=q(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function PD(n,e){let t=q(n),r=t.ss.get(e)||X.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,TA(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(ND(t,e,i),i))}function ND(n,e,t){let r=n.ss.get(e)||X.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function a1(n,e,t,r){return R(this,null,function*(){let i=q(n),s=oe(),o=Ot();for(let l of t){let h=e.Ps(l.metadata.name);l.document&&(s=s.add(h));let f=e.Is(l);f.setReadTime(e.Ts(l.metadata.readTime)),o=o.insert(h,f)}let a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield To(i,function(h){return bt(No(pe.fromString(`__bundle__/docs/${h}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",l=>SD(l,a,o).next(h=>(a.apply(l),h)).next(h=>i.Qr.removeMatchingKeysForTargetId(l,u.targetId).next(()=>i.Qr.addMatchingKeys(l,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,h.cs,h.ls)).next(()=>h.cs)))})}function u1(r,i){return R(this,arguments,function*(n,e,t=oe()){let s=yield To(n,bt(by(e.bundledQuery))),o=q(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=We(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,e);let l=s.withResumeToken(st.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(l.targetId,l),o.Qr.updateTargetData(a,l).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function aA(n,e){return`firestore_clients_${n}_${e}`}function uA(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function vm(n,e){return`firestore_targets_${n}_${e}`}var id=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new F(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Ge("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Uu=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new F(r.error.code,r.error.message))),s?new n(e,r.state,i):(Ge("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},sd=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Ay();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=DA(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ge("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},k_=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ge("SharedClientState",`Failed to parse online state: ${e}`),null)}},nc=class{constructor(){this.activeTargetIds=Ay()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Bu=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Pe(ie),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=aA(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new nc),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return R(this,null,function*(){let e=yield this.syncEngine.Bi();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(aA(this.persistenceKey,r));if(i){let s=sd.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(vm(this.persistenceKey,e));if(r){let i=Uu.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vm(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return O("SharedClientState","READ",e,t),t}setItem(e,t){O("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){O("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(O("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Ge("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>R(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=qt.oe;if(s!=null)try{let a=JSON.parse(s);K(typeof a=="number"),o=a}catch(a){Ge("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==qt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){let i=new id(this.currentUser,e,t,r),s=uA(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=uA(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=vm(this.persistenceKey,e),s=new Uu(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return sd.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return id.Es(new Je(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return Uu.Es(i,t)}xs(e){return k_.Es(e)}Js(e){return JSON.parse(e)}zs(e){return R(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);O("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=Ay();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},od=class{constructor(){this.no=new nc,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new nc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var x_=class{io(e){}shutdown(){}};var ad=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){O("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){O("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ih=null;function wm(){return Ih===null?Ih=function(){return 268435456+Math.round(2147483648*Math.random())}():Ih++,"0x"+Ih.toString(16)}var c1={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var M_=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}};var wt="WebChannelConnection",F_=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=r+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,r,i,s,o){let a=wm(),u=this.vo(t,r.toUriEncodedString());O("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let l={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(l,s,o),this.Mo(t,u,l,i).then(h=>(O("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw rn("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",u,"request:",i),h})}xo(t,r,i,s,o,a){return this.Co(t,r,i,s,o)}Fo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Po}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}vo(t,r){let i=c1[t];return`${this.wo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,r,i){let s=wm();return new Promise((o,a)=>{let u=new hm;u.setWithCredentials(!0),u.listenOnce(fm.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ru.NO_ERROR:let h=u.getResponseJson();O(wt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),o(h);break;case Ru.TIMEOUT:O(wt,`RPC '${e}' ${s} timed out`),a(new F(k.DEADLINE_EXCEEDED,"Request time out"));break;case Ru.HTTP_ERROR:let f=u.getStatus();if(O(wt,`RPC '${e}' ${s} failed with status:`,f,"response text:",u.getResponseText()),f>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);let _=g?.error;if(_&&_.status&&_.message){let E=function(I){let M=I.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(M)>=0?M:k.UNKNOWN}(_.status);a(new F(E,_.message))}else a(new F(k.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new F(k.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{O(wt,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);O(wt,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",l,r,15)})}Oo(e,t,r){let i=wm(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=mm(),a=gm(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.xmlHttpFactory=new dm({})),this.Fo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let h=s.join("");O(wt,`Creating RPC '${e}' stream ${i}: ${h}`,u);let f=o.createWebChannel(h,u),g=!1,_=!1,E=new M_({lo:I=>{_?O(wt,`Not sending because RPC '${e}' stream ${i} is closed:`,I):(g||(O(wt,`Opening RPC '${e}' stream ${i} transport.`),f.open(),g=!0),O(wt,`RPC '${e}' stream ${i} sending:`,I),f.send(I))},ho:()=>f.close()}),b=(I,M,B)=>{I.listen(M,x=>{try{B(x)}catch(U){setTimeout(()=>{throw U},0)}})};return b(f,Js.EventType.OPEN,()=>{_||(O(wt,`RPC '${e}' stream ${i} transport opened.`),E.mo())}),b(f,Js.EventType.CLOSE,()=>{_||(_=!0,O(wt,`RPC '${e}' stream ${i} transport closed`),E.po())}),b(f,Js.EventType.ERROR,I=>{_||(_=!0,rn(wt,`RPC '${e}' stream ${i} transport errored:`,I),E.po(new F(k.UNAVAILABLE,"The operation could not be completed")))}),b(f,Js.EventType.MESSAGE,I=>{var M;if(!_){let B=I.data[0];K(!!B);let x=B,U=x.error||((M=x[0])===null||M===void 0?void 0:M.error);if(U){O(wt,`RPC '${e}' stream ${i} received error:`,U);let Y=U.status,Q=function(w){let C=Ye[w];if(C!==void 0)return iD(C)}(Y),T=U.message;Q===void 0&&(Q=k.INTERNAL,T="Unknown error status: "+Y+" with message "+U.message),_=!0,E.po(new F(Q,T)),f.close()}else O(wt,`RPC '${e}' stream ${i} received:`,B),E.yo(B)}}),b(a,pm.STAT_EVENT,I=>{I.stat===vh.PROXY?O(wt,`RPC '${e}' stream ${i} detected buffering proxy`):I.stat===vh.NOPROXY&&O(wt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.fo()},0),E}};function kD(){return typeof window<"u"?window:null}function Sh(){return typeof document<"u"?document:null}function fc(n){return new Jm(n,!0)}var rc=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=r,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),r=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var ud=class{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.Go=r,this.zo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new rc(e,t)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return R(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){return R(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){return R(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(Ge(t.toString()),Ge("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Ao(t)})}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.jo===t&&this.u_(r,i)},r=>{e(()=>{let i=new F(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.c_(i)})})}u_(e,t){let r=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{r(()=>this.listener.Po())}),this.stream.To(()=>{r(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{r(()=>this.c_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>R(this,null,function*(){this.state=0,this.start()}))}c_(e){return O("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(O("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},O_=class extends ud{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=HO(this.serializer,e),r=function(s){if(!("targetChange"in s))return X.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?X.min():o.readTime?We(o.readTime):X.min()}(e);return this.listener.h_(t,r)}P_(e){let t={};t.database=t_(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Uh(u)?{documents:dD(s,u)}:{query:fD(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=oD(s,o.resumeToken);let l=Zm(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(X.min())>0){a.readTime=vo(s,o.snapshotVersion.toTimestamp());let l=Zm(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);let r=QO(this.serializer,e);r&&(t.labels=r),this.i_(t)}I_(e){let t={};t.database=t_(this.serializer),t.removeTarget=e,this.i_(t)}},V_=class extends ud{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(K(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let t=KO(e.writeResults,e.commitTime),r=We(e.commitTime);return this.listener.A_(r,t)}return K(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=t_(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Zu(this.serializer,r))};this.i_(t)}};var L_=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new F(k.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,e_(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new F(k.UNKNOWN,s.toString())})}xo(e,t,r,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.xo(e,e_(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new F(k.UNKNOWN,o.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},U_=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Ge(t),this.y_=!1):O("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var B_=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(o=>{r.enqueueAndForget(()=>R(this,null,function*(){ui(this)&&(O("RemoteStore","Restarting streams for network reachability change."),yield function(u){return R(this,null,function*(){let l=q(u);l.M_.add(4),yield ko(l),l.N_.set("Unknown"),l.M_.delete(4),yield pc(l)})}(this))}))}),this.N_=new U_(r,i)}};function pc(n){return R(this,null,function*(){if(ui(n))for(let e of n.x_)yield e(!0)})}function ko(n){return R(this,null,function*(){for(let e of n.x_)yield e(!1)})}function bd(n,e){let t=q(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),ky(t)?Ny(t):Mo(t).Xo()&&Py(t,e))}function Co(n,e){let t=q(n),r=Mo(t);t.F_.delete(e),r.Xo()&&xD(t,e),t.F_.size===0&&(r.Xo()?r.n_():ui(t)&&t.N_.set("Unknown"))}function Py(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Mo(n).P_(e)}function xD(n,e){n.L_.xe(e),Mo(n).I_(e)}function Ny(n){n.L_=new Xm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Mo(n).start(),n.N_.w_()}function ky(n){return ui(n)&&!Mo(n).Zo()&&n.F_.size>0}function ui(n){return q(n).M_.size===0}function MD(n){n.L_=void 0}function l1(n){return R(this,null,function*(){n.N_.set("Online")})}function h1(n){return R(this,null,function*(){n.F_.forEach((e,t)=>{Py(n,e)})})}function d1(n,e){return R(this,null,function*(){MD(n),ky(n)?(n.N_.D_(e),Ny(n)):n.N_.set("Unknown")})}function f1(n,e,t){return R(this,null,function*(){if(n.N_.set("Online"),e instanceof qh&&e.state===2&&e.cause)try{yield function(i,s){return R(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,e)}catch(r){O("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield cd(n,r)}else if(e instanceof ho?n.L_.Ke(e):e instanceof $h?n.L_.He(e):n.L_.We(e),!t.isEqual(X.min()))try{let r=yield bD(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){let h=s.F_.get(l);h&&s.F_.set(l,h.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,l)=>{let h=s.F_.get(u);if(!h)return;s.F_.set(u,h.withResumeToken(st.EMPTY_BYTE_STRING,h.snapshotVersion)),xD(s,u);let f=new wo(h.target,u,l,h.sequenceNumber);Py(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){O("RemoteStore","Failed to raise snapshot:",r),yield cd(n,r)}})}function cd(n,e,t){return R(this,null,function*(){if(!ai(e))throw e;n.M_.add(1),yield ko(n),n.N_.set("Offline"),t||(t=()=>bD(n.localStore)),n.asyncQueue.enqueueRetryable(()=>R(this,null,function*(){O("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield pc(n)}))})}function FD(n,e){return e().catch(t=>cd(n,t,e))}function xo(n){return R(this,null,function*(){let e=q(n),t=si(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;p1(e);)try{let i=yield o1(e.localStore,r);if(i===null){e.v_.length===0&&t.n_();break}r=i.batchId,g1(e,i)}catch(i){yield cd(e,i)}OD(e)&&VD(e)})}function p1(n){return ui(n)&&n.v_.length<10}function g1(n,e){n.v_.push(e);let t=si(n);t.Xo()&&t.E_&&t.d_(e.mutations)}function OD(n){return ui(n)&&!si(n).Zo()&&n.v_.length>0}function VD(n){si(n).start()}function m1(n){return R(this,null,function*(){si(n).V_()})}function _1(n){return R(this,null,function*(){let e=si(n);for(let t of n.v_)e.d_(t.mutations)})}function y1(n,e,t){return R(this,null,function*(){let r=n.v_.shift(),i=Km.from(r,e,t);yield FD(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield xo(n)})}function v1(n,e){return R(this,null,function*(){e&&si(n).E_&&(yield function(r,i){return R(this,null,function*(){if(function(o){return rD(o)&&o!==k.ABORTED}(i.code)){let s=r.v_.shift();si(r).t_(),yield FD(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield xo(r)}})}(n,e)),OD(n)&&VD(n)})}function cA(n,e){return R(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),O("RemoteStore","RemoteStore received new credentials");let r=ui(t);t.M_.add(3),yield ko(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield pc(t)})}function j_(n,e){return R(this,null,function*(){let t=q(n);e?(t.M_.delete(2),yield pc(t)):e||(t.M_.add(2),yield ko(t),t.N_.set("Unknown"))})}function Mo(n){return n.B_||(n.B_=function(t,r,i){let s=q(t);return s.f_(),new O_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:l1.bind(null,n),To:h1.bind(null,n),Ao:d1.bind(null,n),h_:f1.bind(null,n)}),n.x_.push(e=>R(this,null,function*(){e?(n.B_.t_(),ky(n)?Ny(n):n.N_.set("Unknown")):(yield n.B_.stop(),MD(n))}))),n.B_}function si(n){return n.k_||(n.k_=function(t,r,i){let s=q(t);return s.f_(),new V_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:()=>Promise.resolve(),To:m1.bind(null,n),Ao:v1.bind(null,n),R_:_1.bind(null,n),A_:y1.bind(null,n)}),n.x_.push(e=>R(this,null,function*(){e?(n.k_.t_(),yield xo(n)):(yield n.k_.stop(),n.v_.length>0&&(O("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var $_=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ze,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new F(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Fo(n,e){if(Ge("AsyncQueue",`${e}: ${n}`),ai(n))return new F(k.UNAVAILABLE,`${e}: ${n}`);throw n}var ld=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||$.comparator(t.key,r.key):(t,r)=>$.comparator(t.key,r.key),this.keyedMap=Mu(),this.sortedSet=new Pe(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var hd=class{constructor(){this.q_=new Pe($.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):z():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},Ao=class n{constructor(e,t,r,i,s,o,a,u,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,ld.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var q_=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},G_=class{constructor(){this.queries=new Bn(e=>$A(e),hc),this.onlineState="Unknown",this.z_=new Set}};function xy(n,e){return R(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new q_,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Fo(o,`Initialization of query '${io(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&Fy(t)})}function My(n,e){return R(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function w1(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&Fy(t)}function E1(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(t);r.queries.delete(e)}function Fy(n){n.z_.forEach(e=>{e.next()})}var z_,lA;(lA=z_||(z_={})).J_="default",lA.Cache="cache";var ic=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ao(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Ao.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==z_.Cache}};var W_=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var dd=class{constructor(e){this.serializer=e}Ps(e){return On(this.serializer,e)}Is(e){return e.metadata.exists?hD(this.serializer,e.document,!1):et.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return We(e)}},H_=class{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=LD(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let r=pe.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,r=new dd(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||oe()).add(s);t.set(o,a)}}return t}complete(){return R(this,null,function*(){let e=yield a1(this.localStore,new dd(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let r of this.queries)yield u1(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function LD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var fd=class{constructor(e){this.key=e}},pd=class{constructor(e){this.key=e}},gd=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=oe(),this.mutatedKeys=oe(),this.Ia=GA(e),this.Ta=new ld(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new hd,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,f)=>{let g=i.get(h),_=dc(this.query,f)?f:null,E=!!g&&this.mutatedKeys.has(g.key),b=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),I=!1;g&&_?g.data.isEqual(_.data)?E!==b&&(r.track({type:3,doc:_}),I=!0):this.Ra(g,_)||(r.track({type:2,doc:_}),I=!0,(u&&this.Ia(_,u)>0||l&&this.Ia(_,l)<0)&&(a=!0)):!g&&_?(r.track({type:0,doc:_}),I=!0):g&&!_&&(r.track({type:1,doc:g}),I=!0,(u||l)&&(a=!0)),I&&(_?(o=o.add(_),s=b?s.add(h):s.delete(h)):(o=o.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{Ta:o,Aa:r,Xi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((h,f)=>function(_,E){let b=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}};return b(_)-b(E)}(h.type,f.type)||this.Ia(h.doc,f.doc)),this.Va(r),i=i!=null&&i;let a=t&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,l=u!==this.ha;return this.ha=u,o.length!==0||l?{snapshot:new Ao(this.query,e.Ta,s,o,e.mutatedKeys,u===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new hd,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=oe(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new pd(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new fd(r))}),t}pa(e){this.la=e.hs,this.Pa=oe();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Ao.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},K_=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Q_=class{constructor(e){this.key=e,this.wa=!1}},Y_=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new Bn(a=>$A(a),hc),this.Da=new Map,this.Ca=new Set,this.va=new Pe($.comparator),this.Fa=new Map,this.Ma=new tc,this.xa={},this.Oa=new Map,this.Na=Eo.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function T1(n,e,t=!0){return R(this,null,function*(){let r=Sd(n),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield UD(r,e,t,!0),i})}function I1(n,e){return R(this,null,function*(){let t=Sd(n);yield UD(t,e,!0,!1)})}function UD(n,e,t,r){return R(this,null,function*(){let i=yield To(n.localStore,bt(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Oy(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&bd(n.remoteStore,i),a})}function Oy(n,e,t,r,i){return R(this,null,function*(){n.Ba=(f,g,_)=>function(b,I,M,B){return R(this,null,function*(){let x=I.view.da(M);x.Xi&&(x=yield rd(b.localStore,I.query,!1).then(({documents:T})=>I.view.da(T,x)));let U=B&&B.targetChanges.get(I.targetId),Y=B&&B.targetMismatches.get(I.targetId)!=null,Q=I.view.applyChanges(x,b.isPrimaryClient,U,Y);return X_(b,I.targetId,Q.fa),Q.snapshot})}(n,f,g,_);let s=yield rd(n.localStore,e,!0),o=new gd(e,s.hs),a=o.da(s.documents),u=Xu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),l=o.applyChanges(a,n.isPrimaryClient,u);X_(n,t,l.fa);let h=new K_(e,t,o);return n.ba.set(e,h),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),l.snapshot})}function C1(n,e,t){return R(this,null,function*(){let r=q(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!hc(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Io(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Co(r.remoteStore,i.targetId),Do(r,i.targetId)}).catch(oi))):(Do(r,i.targetId),yield Io(r.localStore,i.targetId,!0))})}function A1(n,e){return R(this,null,function*(){let t=q(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Co(t.remoteStore,r.targetId))})}function D1(n,e,t){return R(this,null,function*(){let r=By(n);try{let i=yield function(o,a){let u=q(o),l=Le.now(),h=a.reduce((_,E)=>_.add(E.key),oe()),f,g;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let E=Ot(),b=oe();return u.os.getEntries(_,h).next(I=>{E=I,E.forEach((M,B)=>{B.isValidDocument()||(b=b.add(M))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,E)).next(I=>{f=I;let M=[];for(let B of a){let x=BO(B,f.get(B.key).overlayedDocument);x!=null&&M.push(new yn(B.key,x,FA(x.value.mapValue),qe.exists(!0)))}return u.mutationQueue.addMutationBatch(_,l,M,a)}).next(I=>{g=I;let M=I.applyToLocalDocumentSet(f,b);return u.documentOverlayCache.saveOverlays(_,I.batchId,M)})}).then(()=>({batchId:g.batchId,changes:WA(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let l=o.xa[o.currentUser.toKey()];l||(l=new Pe(ie)),l=l.insert(a,u),o.xa[o.currentUser.toKey()]=l}(r,i.batchId,t),yield yr(r,i.changes),yield xo(r.remoteStore)}catch(i){let s=Fo(i,"Failed to persist write");t.reject(s)}})}function BD(n,e){return R(this,null,function*(){let t=q(n);try{let r=yield s1(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(K(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?K(o.wa):i.removedDocuments.size>0&&(K(o.wa),o.wa=!1))}),yield yr(t,r,e)}catch(r){yield oi(r)}})}function hA(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=q(o);u.onlineState=a;let l=!1;u.queries.forEach((h,f)=>{for(let g of f.U_)g.j_(a)&&(l=!0)}),l&&Fy(u)}(r.eventManager,e),i.length&&r.Sa.h_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function b1(n,e,t){return R(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new Pe($.comparator);o=o.insert(s,et.newNoDocument(s,X.min()));let a=oe().add(s),u=new Yu(X.min(),new Map,new Pe(ie),o,a);yield BD(r,u),r.va=r.va.remove(s),r.Fa.delete(e),Uy(r)}else yield Io(r.localStore,e,!1).then(()=>Do(r,e,t)).catch(oi)})}function S1(n,e){return R(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield i1(t.localStore,e);Ly(t,r,null),Vy(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield yr(t,i)}catch(i){yield oi(i)}})}function R1(n,e,t){return R(this,null,function*(){let r=q(n);try{let i=yield function(o,a){let u=q(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let h;return u.mutationQueue.lookupMutationBatch(l,a).next(f=>(K(f!==null),h=f.keys(),u.mutationQueue.removeMutationBatch(l,f))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,h,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,h)).next(()=>u.localDocuments.getDocuments(l,h))})}(r.localStore,e);Ly(r,e,t),Vy(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield yr(r,i)}catch(i){yield oi(i)}})}function P1(n,e){return R(this,null,function*(){let t=q(n);ui(t.remoteStore)||O("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=q(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){let i=Fo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Vy(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function Ly(n,e,t){let r=q(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Do(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Vr(e).forEach(r=>{n.Ma.containsKey(r)||jD(n,r)})}function jD(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(Co(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),Uy(n))}function X_(n,e,t){for(let r of t)r instanceof fd?(n.Ma.addReference(r.key,e),N1(n,r)):r instanceof pd?(O("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||jD(n,r.key)):z()}function N1(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(O("SyncEngine","New document in limbo: "+t),n.Ca.add(r),Uy(n))}function Uy(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new $(pe.fromString(e)),r=n.Na.next();n.Fa.set(r,new Q_(t)),n.va=n.va.insert(t,r),bd(n.remoteStore,new wo(bt(No(t.path)),r,"TargetPurposeLimboResolution",qt.oe))}}function yr(n,e,t){return R(this,null,function*(){let r=q(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,e,t).then(l=>{if((l||t)&&r.isPrimaryClient){let h=l&&!l.fromCache;r.sharedClientState.updateQueryState(u.targetId,h?"current":"not-current")}if(l){i.push(l);let h=R_.Ki(u.targetId,l);s.push(h)}}))}),yield Promise.all(o),r.Sa.h_(i),yield function(u,l){return R(this,null,function*(){let h=q(u);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>P.forEach(l,g=>P.forEach(g.qi,_=>h.persistence.referenceDelegate.addReference(f,g.targetId,_)).next(()=>P.forEach(g.Qi,_=>h.persistence.referenceDelegate.removeReference(f,g.targetId,_)))))}catch(f){if(!ai(f))throw f;O("LocalStore","Failed to update sequence numbers: "+f)}for(let f of l){let g=f.targetId;if(!f.fromCache){let _=h.ns.get(g),E=_.snapshotVersion,b=_.withLastLimboFreeSnapshotVersion(E);h.ns=h.ns.insert(g,b)}}})}(r.localStore,s))})}function k1(n,e){return R(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){O("SyncEngine","User change. New user:",e.toKey());let r=yield DD(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(a=>{a.forEach(u=>{u.reject(new F(k.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield yr(t,r.us)}})}function x1(n,e){let t=q(n),r=t.Fa.get(e);if(r&&r.wa)return oe().add(r.key);{let i=oe(),s=t.Da.get(e);if(!s)return i;for(let o of s){let a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function M1(n,e){return R(this,null,function*(){let t=q(n),r=yield rd(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&X_(t,e.targetId,i.fa),i})}function F1(n,e){return R(this,null,function*(){let t=q(n);return PD(t.localStore,e).then(r=>yr(t,r))})}function O1(n,e,t,r){return R(this,null,function*(){let i=q(n),s=yield function(a,u){let l=q(a),h=q(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.vn(f,u).next(g=>g?l.localDocuments.getDocuments(f,g):P.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield xo(i.remoteStore):t==="acknowledged"||t==="rejected"?(Ly(i,e,r||null),Vy(i,e),function(a,u){q(q(a).mutationQueue).Mn(u)}(i.localStore,e)):z(),yield yr(i,s)):O("SyncEngine","Cannot apply mutation batch with id: "+e)})}function V1(n,e){return R(this,null,function*(){let t=q(n);if(Sd(t),By(t),e===!0&&t.La!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield dA(t,r.toArray());t.La=!0,yield j_(t.remoteStore,!0);for(let s of i)bd(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let r=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Do(t,o),Io(t.localStore,o,!0))),Co(t.remoteStore,o)}),yield i,yield dA(t,r),function(o){let a=q(o);a.Fa.forEach((u,l)=>{Co(a.remoteStore,l)}),a.Ma.mr(),a.Fa=new Map,a.va=new Pe($.comparator)}(t),t.La=!1,yield j_(t.remoteStore,!1)}})}function dA(n,e,t){return R(this,null,function*(){let r=q(n),i=[],s=[];for(let o of e){let a,u=r.Da.get(o);if(u&&u.length!==0){a=yield To(r.localStore,bt(u[0]));for(let l of u){let h=r.ba.get(l),f=yield M1(r,h);f.snapshot&&s.push(f.snapshot)}}else{let l=yield RD(r.localStore,o);a=yield To(r.localStore,l),yield Oy(r,$D(l),o,!1,a.resumeToken)}i.push(a)}return r.Sa.h_(s),i})}function $D(n){return jA(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function L1(n){return function(t){return q(q(t).persistence).Bi()}(q(n).localStore)}function U1(n,e,t,r){return R(this,null,function*(){let i=q(n);if(i.La)return void O("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield PD(i.localStore,qA(s[0])),a=Yu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",st.EMPTY_BYTE_STRING);yield yr(i,o,a);break}case"rejected":yield Io(i.localStore,e,!0),Do(i,e,r);break;default:z()}})}function B1(n,e,t){return R(this,null,function*(){let r=Sd(n);if(r.La){for(let i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){O("SyncEngine","Adding an already active target "+i);continue}let s=yield RD(r.localStore,i),o=yield To(r.localStore,s);yield Oy(r,$D(s),o.targetId,!1,o.resumeToken),bd(r.remoteStore,o)}for(let i of t)r.Da.has(i)&&(yield Io(r.localStore,i,!1).then(()=>{Co(r.remoteStore,i),Do(r,i)}).catch(oi))}})}function Sd(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=BD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=x1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=b1.bind(null,e),e.Sa.h_=w1.bind(null,e.eventManager),e.Sa.ka=E1.bind(null,e.eventManager),e}function By(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=S1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=R1.bind(null,e),e}function j1(n,e,t){let r=q(n);(function(s,o,a){return R(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(_,E){let b=q(_),I=We(E.createTime);return b.persistence.runTransaction("hasNewerBundle","readonly",M=>b.$r.getBundleMetadata(M,E.id)).then(M=>!!M&&M.createTime.compareTo(I)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(LD(u));let l=new H_(u,s.localStore,o.serializer),h=yield o.qa();for(;h;){let g=yield l._a(h);g&&a._updateProgress(g),h=yield o.qa()}let f=yield l.complete();return yield yr(s,f.ca,void 0),yield function(_,E){let b=q(_);return b.persistence.runTransaction("Save bundle","readwrite",I=>b.$r.saveBundleMetadata(I,E))}(s.localStore,u),a._completeWith(f.progress),Promise.resolve(f.ua)}catch(u){return rn("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var sc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return R(this,null,function*(){this.serializer=fc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return AD(this.persistence,new nd,e.initialUser,this.serializer)}createPersistence(e){return new ed(td.Hr,this.serializer)}createSharedClientState(e){return new od}terminate(){return R(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var md=class n extends sc{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return R(this,null,function*(){yield gp(n.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield By(this.Qa.syncEngine),yield xo(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return AD(this.persistence,new nd,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new p_(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new km(t,this.persistence);return new Nm(e.asyncQueue,r)}createPersistence(e){let t=Ry(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?nn.withCacheSize(this.cacheSizeBytes):nn.DEFAULT;return new S_(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,kD(),Sh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new od}},J_=class n extends md{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return R(this,null,function*(){yield gp(n.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof Bu&&(this.sharedClientState.syncEngine={Zs:O1.bind(null,t),Xs:U1.bind(null,t),eo:B1.bind(null,t),Bi:L1.bind(null,t),Ys:F1.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>R(this,null,function*(){yield V1(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=kD();if(!Bu.D(t))throw new F(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Ry(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Bu(t,e.asyncQueue,r,e.clientId,e.initialUser)}},oc=class{initialize(e,t){return R(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hA(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=k1.bind(null,this.syncEngine),yield j_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new G_}()}createDatastore(e){let t=fc(e.databaseInfo.databaseId),r=function(s){return new F_(s)}(e.databaseInfo);return function(s,o,a,u){return new L_(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new B_(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>hA(this.syncEngine,t,0),function(){return ad.D()?new ad:new x_}())}createSyncEngine(e,t){return function(i,s,o,a,u,l,h){let f=new Y_(i,s,o,a,u,l);return h&&(f.La=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return R(this,null,function*(){var e;yield function(r){return R(this,null,function*(){let i=q(r);O("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield ko(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function fA(n,e=10240){let t=0;return{read(){return R(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return R(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var bo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Ge("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Z_=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Ze,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return R(this,null,function*(){return this.metadata.promise})}qa(){return R(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return R(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),r=Number(t);isNaN(r)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(r);return new W_(JSON.parse(i),e.length+r)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return R(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return R(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return R(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var ey=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return R(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new F(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return R(this,null,function*(){let o=q(i),a={documents:s.map(f=>Ju(o.serializer,f))},u=yield o.xo("BatchGetDocuments",o.serializer.databaseId,pe.emptyPath(),a,s.length),l=new Map;u.forEach(f=>{let g=WO(o.serializer,f);l.set(g.key.toString(),g)});let h=[];return s.forEach(f=>{let g=l.get(f.toString());K(!!g),h.push(g)}),h})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ii(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return R(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=$.fromPath(r);this.mutations.push(new Hu(i,this.precondition(i)))}),yield function(r,i){return R(this,null,function*(){let s=q(r),o={writes:i.map(a=>Zu(s.serializer,a))};yield s.Co("Commit",s.serializer.databaseId,pe.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw z();t=X.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new F(k.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(X.min())?qe.exists(!1):qe.updateTime(t):qe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(X.min()))throw new F(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qe.updateTime(t)}return qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var ty=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Yo=new rc(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>R(this,null,function*(){let e=new ey(this.datastore),t=this.tu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(e){try{let t=this.updateFunction(e);return!cc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!rD(t)}return!1}};var ny=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Je.UNAUTHENTICATED,this.clientId=Nh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>R(this,null,function*(){O("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(O("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new F(k.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ze;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Fo(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Rh(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>R(this,null,function*(){r.isEqual(i)||(yield DD(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function ry(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield jy(n);O("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>cA(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>cA(e.remoteStore,i)),n._onlineComponents=e})}function qD(n){return n.name==="FirebaseError"?n.code===k.FAILED_PRECONDITION||n.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function jy(n){return R(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Rh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!qD(t))throw t;rn("Error using user provided cache. Falling back to memory cache: "+t),yield Rh(n,new sc)}}else O("FirestoreClient","Using default OfflineComponentProvider"),yield Rh(n,new sc);return n._offlineComponents})}function Rd(n){return R(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O("FirestoreClient","Using user provided OnlineComponentProvider"),yield ry(n,n._uninitializedComponentsProvider._online)):(O("FirestoreClient","Using default OnlineComponentProvider"),yield ry(n,new oc))),n._onlineComponents})}function GD(n){return jy(n).then(e=>e.persistence)}function $y(n){return jy(n).then(e=>e.localStore)}function zD(n){return Rd(n).then(e=>e.remoteStore)}function qy(n){return Rd(n).then(e=>e.syncEngine)}function $1(n){return Rd(n).then(e=>e.datastore)}function So(n){return R(this,null,function*(){let e=yield Rd(n),t=e.eventManager;return t.onListen=T1.bind(null,e.syncEngine),t.onUnlisten=C1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=I1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=A1.bind(null,e.syncEngine),t})}function q1(n){return n.asyncQueue.enqueue(()=>R(this,null,function*(){let e=yield GD(n),t=yield zD(n);return e.setNetworkEnabled(!0),function(i){let s=q(i);return s.M_.delete(0),pc(s)}(t)}))}function G1(n){return n.asyncQueue.enqueue(()=>R(this,null,function*(){let e=yield GD(n),t=yield zD(n);return e.setNetworkEnabled(!1),function(i){return R(this,null,function*(){let s=q(i);s.M_.add(0),yield ko(s),s.N_.set("Offline")})}(t)}))}function z1(n,e){let t=new Ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s,o){return R(this,null,function*(){try{let a=yield function(l,h){let f=q(l);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new F(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Fo(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield $y(n),e,t)})),t.promise}function WD(n,e,t={}){let r=new Ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(s,o,a,u,l){let h=new bo({next:g=>{o.enqueueAndForget(()=>My(s,f));let _=g.docs.has(a);!_&&g.fromCache?l.reject(new F(k.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&u&&u.source==="server"?l.reject(new F(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(g)},error:g=>l.reject(g)}),f=new ic(No(a.path),h,{includeMetadataChanges:!0,ra:!0});return xy(s,f)}(yield So(n),n.asyncQueue,e,t,r)})),r.promise}function W1(n,e){let t=new Ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s,o){return R(this,null,function*(){try{let a=yield rd(i,s,!0),u=new gd(s,a.hs),l=u.da(a.documents),h=u.applyChanges(l,!1);o.resolve(h.snapshot)}catch(a){let u=Fo(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield $y(n),e,t)})),t.promise}function HD(n,e,t={}){let r=new Ze;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(s,o,a,u,l){let h=new bo({next:g=>{o.enqueueAndForget(()=>My(s,f)),g.fromCache&&u.source==="server"?l.reject(new F(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(g)},error:g=>l.reject(g)}),f=new ic(a,h,{includeMetadataChanges:!0,ra:!0});return xy(s,f)}(yield So(n),n.asyncQueue,e,t,r)})),r.promise}function H1(n,e){let t=new bo(e);return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s){q(i).z_.add(s),s.next()}(yield So(n),t)})),()=>{t.$a(),n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return function(i,s){q(i).z_.delete(s)}(yield So(n),t)}))}}function K1(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?sD().encode(o):o,function(h,f){return new Z_(h,f)}(function(h,f){if(h instanceof Uint8Array)return fA(h,f);if(h instanceof ArrayBuffer)return fA(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,fc(e));n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){j1(yield qy(n),i,r)}))}function Q1(n,e){return n.asyncQueue.enqueue(()=>R(this,null,function*(){return function(r,i){let s=q(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield $y(n),e)}))}function KD(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var pA=new Map;function Gy(n,e,t){if(!t)throw new F(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function zy(n,e,t,r){if(e===!0&&r===!0)throw new F(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gA(n){if(!$.isDocumentKey(n))throw new F(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mA(n){if($.isDocumentKey(n))throw new F(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Pd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":z()}function ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new F(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Pd(n);throw new F(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function QD(n,e){if(e<=0)throw new F(k.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var _d=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new F(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new F(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=KD((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new F(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new F(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new F(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Yi=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _d({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new F(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new F(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _d(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Em;switch(r.type){case"firstParty":return new Am(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new F(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=pA.get(t);r&&(O("ComponentProvider","Removing Datastore"),pA.delete(t),r.terminate())}(this),Promise.resolve()}};function Wy(n,e,t,r={}){var i;let s=(n=ge(n,Yi))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&rn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=Je.MOCK_USER;else{a=Ms(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new F(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Je(l)}n._authCredentials=new Tm(new Ph(a,u))}}var dt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},De=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Vn=class n extends dt{constructor(e,t,r){super(e,t,No(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new De(this.firestore,null,new $(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Hy(n,e,...t){if(n=ne(n),Gy("collection","path",e),n instanceof Yi){let r=pe.fromString(e,...t);return mA(r),new Vn(n,null,r)}{if(!(n instanceof De||n instanceof Vn))throw new F(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return mA(r),new Vn(n.firestore,null,r)}}function YD(n,e){if(n=ge(n,Yi),Gy("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new F(k.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new dt(n,null,function(r){return new _n(pe.emptyPath(),r)}(e))}function gc(n,e,...t){if(n=ne(n),arguments.length===1&&(e=Nh.newId()),Gy("doc","path",e),n instanceof Yi){let r=pe.fromString(e,...t);return gA(r),new De(n,null,new $(r))}{if(!(n instanceof De||n instanceof Vn))throw new F(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return gA(r),new De(n.firestore,n instanceof Vn?n.converter:null,new $(r))}}function Ky(n,e){return n=ne(n),e=ne(e),(n instanceof De||n instanceof Vn)&&(e instanceof De||e instanceof Vn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Qy(n,e){return n=ne(n),e=ne(e),n instanceof dt&&e instanceof dt&&n.firestore===e.firestore&&hc(n._query,e._query)&&n.converter===e.converter}var iy=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new rc(this,"async_queue_retry"),this.hu=()=>{let t=Sh();t&&O("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};let e=Sh();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Sh();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ze;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return R(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!ai(e))throw e;O("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Ge("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=$_.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&z()}verifyOperationInProgress(){}du(){return R(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function sy(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var oy=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ze,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var XD=-1,ke=class extends Yi{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new iy}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||JD(this),this._firestoreClient.terminate()}};function Ez(n,e){let t=typeof n=="object"?n:ir(),r=typeof n=="string"?n:e||"(default)",i=bi(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=xs("firestore");s&&Wy(i,...s)}return i}function nt(n){return n._firestoreClient||JD(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function JD(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,l,h){return new xm(a,u,l,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,KD(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new ny(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function ZD(n,e){ub(n=ge(n,ke));let t=nt(n);if(t._uninitializedComponentsProvider)throw new F(k.FAILED_PRECONDITION,"SDK cache is already specified.");rn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new oc;return tb(t,i,new md(i,r.cacheSizeBytes,e?.forceOwnership))}function eb(n){ub(n=ge(n,ke));let e=nt(n);if(e._uninitializedComponentsProvider)throw new F(k.FAILED_PRECONDITION,"SDK cache is already specified.");rn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new oc;return tb(e,r,new J_(r,t.cacheSizeBytes))}function tb(n,e,t){let r=new Ze;return n.asyncQueue.enqueue(()=>R(this,null,function*(){try{yield Rh(n,t),yield ry(n,e),r.resolve()}catch(i){let s=i;if(!qD(s))throw s;rn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function nb(n){if(n._initialized&&!n._terminated)throw new F(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ze;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{yield function(r){return R(this,null,function*(){if(!Xr.D())return Promise.resolve();let i=r+"main";yield Xr.delete(i)})}(Ry(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function rb(n){return function(t){let r=new Ze;return t.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return P1(yield qy(t),r)})),r.promise}(nt(n=ge(n,ke)))}function ib(n){return q1(nt(n=ge(n,ke)))}function sb(n){return G1(nt(n=ge(n,ke)))}function ob(n,e){let t=nt(n=ge(n,ke)),r=new oy;return K1(t,n._databaseId,e,r),r}function ab(n,e){return Q1(nt(n=ge(n,ke)),e).then(t=>t?new dt(n,null,t.query):null)}function ub(n){if(n._initialized||n._terminated)throw new F(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var jn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(st.fromBase64String(e))}catch(t){throw new F(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(st.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var vn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new F(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ze(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var mr=class{constructor(e){this._methodName=e}};var Xi=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ie(this._lat,e._lat)||ie(this._long,e._long)}};var Y1=/^__.*__$/,ay=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new yn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ri(e,this.data,t,this.fieldTransforms)}},yd=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new yn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function cb(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}var vd=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return wd(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(cb(this.fu)&&Y1.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},uy=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fc(e)}Fu(e,t,r,i=!1){return new vd({fu:e,methodName:t,vu:r,path:ze.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ts(n){let e=n._freezeSettings(),t=fc(n._databaseId);return new uy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Nd(n,e,t,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);Jy("Data must be an object, but it was:",o,r);let a=db(r,o),u,l;if(s.merge)u=new Gt(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){let h=[];for(let f of s.mergeFields){let g=fy(e,f,t);if(!o.contains(g))throw new F(k.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);pb(h,g)||h.push(g)}u=new Gt(h),l=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,l=o.fieldTransforms;return new ay(new Et(a),u,l)}var ac=class n extends mr{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function lb(n,e,t){return new vd({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var cy=class n extends mr{_toFieldTransform(e){return new Hi(e.path,new ti)}isEqual(e){return e instanceof n}},ly=class n extends mr{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=lb(this,e,!0),r=this.Mu.map(s=>ns(s,t)),i=new pr(r);return new Hi(e.path,i)}isEqual(e){return e instanceof n&&Lp(this.Mu,e.Mu)}},hy=class n extends mr{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=lb(this,e,!0),r=this.Mu.map(s=>ns(s,t)),i=new gr(r);return new Hi(e.path,i)}isEqual(e){return e instanceof n&&Lp(this.Mu,e.Mu)}},dy=class n extends mr{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new ni(e.serializer,YA(e.serializer,this.xu));return new Hi(e.path,t)}isEqual(e){return e instanceof n&&this.xu===e.xu}};function Yy(n,e,t,r){let i=n.Fu(1,e,t);Jy("Data must be an object, but it was:",i,r);let s=[],o=Et.empty();es(r,(u,l)=>{let h=Zy(e,u,t);l=ne(l);let f=i.Su(h);if(l instanceof ac)s.push(h);else{let g=ns(l,f);g!=null&&(s.push(h),o.set(h,g))}});let a=new Gt(s);return new yd(o,a,i.fieldTransforms)}function Xy(n,e,t,r,i,s){let o=n.Fu(1,e,t),a=[fy(e,r,t)],u=[i];if(s.length%2!=0)throw new F(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(fy(e,s[g])),u.push(s[g+1]);let l=[],h=Et.empty();for(let g=a.length-1;g>=0;--g)if(!pb(l,a[g])){let _=a[g],E=u[g];E=ne(E);let b=o.Su(_);if(E instanceof ac)l.push(_);else{let I=ns(E,b);I!=null&&(l.push(_),h.set(_,I))}}let f=new Gt(l);return new yd(h,f,o.fieldTransforms)}function hb(n,e,t,r=!1){return ns(t,n.Fu(r?4:3,e))}function ns(n,e){if(fb(n=ne(n)))return Jy("Unsupported field value:",e,n),db(n,e);if(n instanceof mr)return function(r,i){if(!cb(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=ns(a,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return YA(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Le.fromDate(r);return{timestampValue:vo(i.serializer,s)}}if(r instanceof Le){let s=new Le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:vo(i.serializer,s)}}if(r instanceof Xi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jn)return{bytesValue:oD(i.serializer,r._byteString)};if(r instanceof De){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Dy(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Pd(r)}`)}(n,e)}function db(n,e){let t={};return kA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):es(n,(r,i)=>{let s=ns(i,e.pu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function fb(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Le||n instanceof Xi||n instanceof jn||n instanceof De||n instanceof mr)}function Jy(n,e,t){if(!fb(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Pd(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function fy(n,e,t){if((e=ne(e))instanceof vn)return e._internalPath;if(typeof e=="string")return Zy(n,e);throw wd("Field path arguments must be of type string or ",n,!1,void 0,t)}var X1=new RegExp("[~\\*/\\[\\]]");function Zy(n,e,t){if(e.search(X1)>=0)throw wd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new vn(...e.split("."))._internalPath}catch{throw wd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function wd(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new F(k.INVALID_ARGUMENT,a+n+u)}function pb(n,e){return n.some(t=>t.isEqual(e))}var Ji=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new De(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new py(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(kd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},py=class extends Ji{data(){return super.data()}};function kd(n,e){return typeof e=="string"?Zy(n,e):e instanceof vn?e._internalPath:e._delegate._internalPath}function gb(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new F(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var uc=class{},Zi=class extends uc{};function vr(n,e,...t){let r=[];e instanceof uc&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof gy).length,a=s.filter(u=>u instanceof Ed).length;if(o>1||o>0&&a>0)throw new F(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Ed=class n extends Zi{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Ab(e._query,t),new dt(e.firestore,e.converter,Wm(e._query,t))}_parse(e){let t=ts(e.firestore);return function(s,o,a,u,l,h,f){let g;if(l.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new F(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){yA(f,h);let _=[];for(let E of f)_.push(_A(u,s,E));g={arrayValue:{values:_}}}else g=_A(u,s,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||yA(f,h),g=hb(a,o,f,h==="in"||h==="not-in");return he.create(l,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function mb(n,e,t){let r=e,i=kd("where",n);return Ed._create(i,r,t)}var gy=class n extends uc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:we.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)Ab(o,u),o=Wm(o,u)}(e._query,t),new dt(e.firestore,e.converter,Wm(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var my=class n extends Zi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new F(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new F(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new zi(s,o)}(e._query,this._field,this._direction);return new dt(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new _n(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function _b(n,e="asc"){let t=e,r=kd("orderBy",n);return my._create(r,t)}var Td=class n extends Zi{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new dt(e.firestore,e.converter,jh(e._query,this._limit,this._limitType))}};function yb(n){return QD("limit",n),Td._create("limit",n,"F")}function vb(n){return QD("limitToLast",n),Td._create("limitToLast",n,"L")}var Id=class n extends Zi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Cb(e,this.type,this._docOrFields,this._inclusive);return new dt(e.firestore,e.converter,function(i,s){return new _n(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function wb(...n){return Id._create("startAt",n,!0)}function Eb(...n){return Id._create("startAfter",n,!1)}var Cd=class n extends Zi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Cb(e,this.type,this._docOrFields,this._inclusive);return new dt(e.firestore,e.converter,function(i,s){return new _n(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Tb(...n){return Cd._create("endBefore",n,!1)}function Ib(...n){return Cd._create("endAt",n,!0)}function Cb(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof Ji)return function(s,o,a,u,l){if(!u)throw new F(k.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let h=[];for(let f of lo(s))if(f.field.isKeyField())h.push(Gi(o,u.key));else{let g=u.data.field(f.field);if(Dd(g))throw new F(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let _=f.field.canonicalString();throw new F(k.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(g)}return new Un(h,l)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=ts(n.firestore);return function(o,a,u,l,h,f){let g=o.explicitOrderBy;if(h.length>g.length)throw new F(k.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let E=0;E<h.length;E++){let b=h[E];if(g[E].field.isKeyField()){if(typeof b!="string")throw new F(k.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof b}`);if(!Cy(o)&&b.indexOf("/")!==-1)throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${b}' contains a slash.`);let I=o.path.child(pe.fromString(b));if(!$.isDocumentKey(I))throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);let M=new $(I);_.push(Gi(a,M))}else{let I=hb(u,l,b);_.push(I)}}return new Un(_,f)}(n._query,n.firestore._databaseId,i,e,t,r)}}function _A(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new F(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cy(e)&&t.indexOf("/")!==-1)throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(pe.fromString(t));if(!$.isDocumentKey(r))throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Gi(n,new $(r))}if(t instanceof De)return Gi(n,t._key);throw new F(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Pd(t)}.`)}function yA(n,e){if(!Array.isArray(n)||n.length===0)throw new F(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ab(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new F(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new F(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ro=class{convertValue(e,t="none"){switch(qi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Jr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return es(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Xi($e(e.latitude),$e(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ty(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Gu(e));default:return null}}convertTimestamp(e){let t=fr(e);return new Le(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=pe.fromString(e);K(_D(r));let i=new Zr(r.get(1),r.get(3)),s=new $(r.popFirst(5));return i.isEqual(t)||Ge(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function xd(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var _y=class extends Ro{constructor(e){super(),this.firestore=e}convertBytes(e){return new jn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}};var dr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},on=class extends Ji{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Qr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(kd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Qr=class extends on{data(e={}){return super.data(e)}},wn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new dr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Qr(this._firestore,this._userDataWriter,r.key,r,new dr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Qr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new dr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Qr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new dr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),l=-1,h=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:J1(a.type),doc:u,oldIndex:l,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function J1(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function ev(n,e){return n instanceof on&&e instanceof on?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof wn&&e instanceof wn&&n._firestore===e._firestore&&Qy(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Db(n){n=ge(n,De);let e=ge(n.firestore,ke);return WD(nt(e),n._key).then(t=>iv(e,n,t))}var _r=class extends Ro{constructor(e){super(),this.firestore=e}convertBytes(e){return new jn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}};function bb(n){n=ge(n,De);let e=ge(n.firestore,ke),t=nt(e),r=new _r(e);return z1(t,n._key).then(i=>new on(e,r,n._key,i,new dr(i!==null&&i.hasLocalMutations,!0),n.converter))}function Sb(n){n=ge(n,De);let e=ge(n.firestore,ke);return WD(nt(e),n._key,{source:"server"}).then(t=>iv(e,n,t))}function Rb(n){n=ge(n,dt);let e=ge(n.firestore,ke),t=nt(e),r=new _r(e);return gb(n._query),HD(t,n._query).then(i=>new wn(e,r,n,i))}function Pb(n){n=ge(n,dt);let e=ge(n.firestore,ke),t=nt(e),r=new _r(e);return W1(t,n._query).then(i=>new wn(e,r,n,i))}function Nb(n){n=ge(n,dt);let e=ge(n.firestore,ke),t=nt(e),r=new _r(e);return HD(t,n._query,{source:"server"}).then(i=>new wn(e,r,n,i))}function tv(n,e,t){n=ge(n,De);let r=ge(n.firestore,ke),i=xd(n.converter,e,t);return Oo(r,[Nd(ts(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,qe.none())])}function nv(n,e,t,...r){n=ge(n,De);let i=ge(n.firestore,ke),s=ts(i),o;return o=typeof(e=ne(e))=="string"||e instanceof vn?Xy(s,"updateDoc",n._key,e,t,r):Yy(s,"updateDoc",n._key,e),Oo(i,[o.toMutation(n._key,qe.exists(!0))])}function kb(n){return Oo(ge(n.firestore,ke),[new ii(n._key,qe.none())])}function xb(n,e){let t=ge(n.firestore,ke),r=gc(n),i=xd(n.converter,e);return Oo(t,[Nd(ts(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,qe.exists(!1))]).then(()=>r)}function rv(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||sy(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(sy(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let u,l,h;if(n instanceof De)l=ge(n.firestore,ke),h=No(n._key.path),u={next:f=>{e[o]&&e[o](iv(l,n,f))},error:e[o+1],complete:e[o+2]};else{let f=ge(n,dt);l=ge(f.firestore,ke),h=f._query;let g=new _r(l);u={next:_=>{e[o]&&e[o](new wn(l,g,f,_))},error:e[o+1],complete:e[o+2]},gb(n._query)}return function(g,_,E,b){let I=new bo(b),M=new ic(_,I,E);return g.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return xy(yield So(g),M)})),()=>{I.$a(),g.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return My(yield So(g),M)}))}}(nt(l),h,a,u)}function Mb(n,e){return H1(nt(n=ge(n,ke)),sy(e)?e:{next:e})}function Oo(n,e){return function(r,i){let s=new Ze;return r.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){return D1(yield qy(r),i,s)})),s.promise}(nt(n),e)}function iv(n,e,t){let r=t.docs.get(e._key),i=new _r(n);return new on(n,i,e._key,r,new dr(t.hasPendingWrites,t.fromCache),e.converter)}var Z1={maxAttempts:5};var Ad=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ts(e)}set(e,t,r){this._verifyNotCommitted();let i=Hr(e,this._firestore),s=xd(i.converter,t,r),o=Nd(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,qe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Hr(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof vn?Xy(this._dataReader,"WriteBatch.update",s._key,t,r,i):Yy(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,qe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Hr(e,this._firestore);return this._mutations=this._mutations.concat(new ii(t._key,qe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new F(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Hr(n,e){if((n=ne(n)).firestore!==e)throw new F(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var yy=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ts(t)}get(t){let r=Hr(t,this._firestore),i=new _y(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return z();let o=s[0];if(o.isFoundDocument())return new Ji(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Ji(this._firestore,i,r._key,null,r.converter);throw z()})}set(t,r,i){let s=Hr(t,this._firestore),o=xd(s.converter,r,i),a=Nd(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Hr(t,this._firestore),a;return a=typeof(r=ne(r))=="string"||r instanceof vn?Xy(this._dataReader,"Transaction.update",o._key,r,i,s):Yy(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Hr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Hr(e,this._firestore),r=new _r(this._firestore);return super.get(e).then(i=>new on(this._firestore,r,t._key,i._document,new dr(!1,!1),t.converter))}};function Fb(n,e,t){n=ge(n,ke);let r=Object.assign(Object.assign({},Z1),t);return function(s){if(s.maxAttempts<1)throw new F(k.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Ze;return s.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let l=yield $1(s);new ty(s.asyncQueue,l,a,o,u).Xa()})),u.promise}(nt(n),i=>e(new yy(n,i)),r)}function Ob(){return new ac("deleteField")}function Vb(){return new cy("serverTimestamp")}function Lb(...n){return new ly("arrayUnion",n)}function Ub(...n){return new hy("arrayRemove",n)}function Bb(n){return new dy("increment",n)}(function(e,t=!0){(function(i){Po=i})(Fs),rr(new lt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new ke(new Im(r.getProvider("auth-internal")),new bm(r.getProvider("app-check-internal")),function(l,h){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new F(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zr(l.options.projectId,h)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),it(vC,"4.6.3",e),it(vC,"4.6.3","esm2017")})();var eV="@firebase/firestore-compat",tV="0.3.32";function lv(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new F("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function jb(){if(typeof Uint8Array>"u")throw new F("unimplemented","Uint8Arrays are not available in this environment.")}function $b(){if(!xA())throw new F("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Md=class n{constructor(e){this._delegate=e}static fromBase64String(e){return $b(),new n(jn.fromBase64String(e))}static fromUint8Array(e){return jb(),new n(jn.fromUint8Array(e))}toBase64(){return $b(),this._delegate.toBase64()}toUint8Array(){return jb(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function sv(n){return nV(n,["next","error","complete"])}function nV(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var ov=class{enableIndexedDbPersistence(e,t){return ZD(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return eb(e._delegate)}clearIndexedDbPersistence(e){return nb(e._delegate)}},Fd=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Zr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&rn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){Wy(this._delegate,e,t,r)}enableNetwork(){return ib(this._delegate)}disableNetwork(){return sb(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,zy("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return rb(this._delegate)}onSnapshotsInSync(e){return Mb(this._delegate,e)}get app(){if(!this._appCompat)throw new F("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Uo(this,Hy(this._delegate,e))}catch(t){throw St(t,"collection()","Firestore.collection()")}}doc(e){try{return new $n(this,gc(this._delegate,e))}catch(t){throw St(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new os(this,YD(this._delegate,e))}catch(t){throw St(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Fb(this._delegate,t=>e(new Od(this,t)))}batch(){return nt(this._delegate),new Vd(new Ad(this._delegate,e=>Oo(this._delegate,e)))}loadBundle(e){return ob(this._delegate,e)}namedQuery(e){return ab(this._delegate,e).then(t=>t?new os(this,t):null)}},Vo=class extends Ro{constructor(e){super(),this.firestore=e}convertBytes(e){return new Md(new jn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return $n.forKey(t,this.firestore,null)}};function rV(n){vA(n)}var Od=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Vo(e)}get(e){let t=rs(e);return this._delegate.get(t).then(r=>new is(this._firestore,new on(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=rs(e);return r?(lv("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=rs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=rs(e);return this._delegate.delete(t),this}},Vd=class{constructor(e){this._delegate=e}set(e,t,r){let i=rs(e);return r?(lv("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=rs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=rs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Lo=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Qr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ss(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Vo(e),t),i.set(t,s)),s}};Lo.INSTANCES=new WeakMap;var $n=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Vo(e)}static forPath(e,t,r){if(e.length%2!==0)throw new F("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new De(t._delegate,r,new $(e)))}static forKey(e,t,r){return new n(t,new De(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Uo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Uo(this.firestore,Hy(this._delegate,e))}catch(t){throw St(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof De?Ky(this._delegate,e):!1}set(e,t){t=lv("DocumentReference.set",t);try{return t?tv(this._delegate,e,t):tv(this._delegate,e)}catch(r){throw St(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?nv(this._delegate,e):nv(this._delegate,e,t,...r)}catch(i){throw St(i,"updateDoc()","DocumentReference.update()")}}delete(){return kb(this._delegate)}onSnapshot(...e){let t=qb(e),r=Gb(e,i=>new is(this.firestore,new on(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return rv(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=bb(this._delegate):e?.source==="server"?t=Sb(this._delegate):t=Db(this._delegate),t.then(r=>new is(this.firestore,new on(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Lo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function St(n,e,t){return n.message=n.message.replace(e,t),n}function qb(n){for(let e of n)if(typeof e=="object"&&!sv(e))return e;return{}}function Gb(n,e){var t,r;let i;return sv(n[0])?i=n[0]:sv(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var is=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new $n(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ev(this._delegate,e._delegate)}},ss=class extends is{data(e){let t=this._delegate.data(e);return this._delegate._converter||wA(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},os=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Vo(e)}where(e,t,r){try{return new n(this.firestore,vr(this._delegate,mb(e,t,r)))}catch(i){throw St(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,vr(this._delegate,_b(e,t)))}catch(r){throw St(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,vr(this._delegate,yb(e)))}catch(t){throw St(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,vr(this._delegate,vb(e)))}catch(t){throw St(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,vr(this._delegate,wb(...e)))}catch(t){throw St(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,vr(this._delegate,Eb(...e)))}catch(t){throw St(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,vr(this._delegate,Tb(...e)))}catch(t){throw St(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,vr(this._delegate,Ib(...e)))}catch(t){throw St(t,"endAt()","Query.endAt()")}}isEqual(e){return Qy(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Pb(this._delegate):e?.source==="server"?t=Nb(this._delegate):t=Rb(this._delegate),t.then(r=>new mc(this.firestore,new wn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=qb(e),r=Gb(e,i=>new mc(this.firestore,new wn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return rv(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Lo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},av=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ss(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},mc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new os(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ss(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new av(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ss(this._firestore,r))})}isEqual(e){return ev(this._delegate,e._delegate)}},Uo=class n extends os{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new $n(this.firestore,e):null}doc(e){try{return e===void 0?new $n(this.firestore,gc(this._delegate)):new $n(this.firestore,gc(this._delegate,e))}catch(t){throw St(t,"doc()","CollectionReference.doc()")}}add(e){return xb(this._delegate,e).then(t=>new $n(this.firestore,t))}isEqual(e){return Ky(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Lo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function rs(n){return ge(n,De)}var uv=class n{constructor(...e){this._delegate=new vn(...e)}static documentId(){return new n(ze.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof vn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var cv=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=Vb();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=Ob();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=Lb(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=Ub(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=Bb(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var iV={Firestore:Fd,GeoPoint:Xi,Timestamp:Le,Blob:Md,Transaction:Od,WriteBatch:Vd,DocumentReference:$n,DocumentSnapshot:is,Query:os,QueryDocumentSnapshot:ss,QuerySnapshot:mc,CollectionReference:Uo,FieldPath:uv,FieldValue:cv,setLogLevel:rV,CACHE_SIZE_UNLIMITED:XD};function sV(n,e){n.INTERNAL.registerComponent(new lt("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},iV)))}function oV(n){sV(n,(e,t)=>new Fd(e,t,new ov)),n.registerVersion(eV,tV)}oV(Ve);function aV(n,e=Ts){return new Lt(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function zb(n,e){return aV(n,e)}function uV(n,e){return zb(n,e).pipe(bs(void 0),vl(),H(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function fv(n,e){return zb(n,e).pipe(H(t=>({payload:t,type:"query"})))}var Ld=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=Yb(r,t);return new Bd(i,s,this.afs)}snapshotChanges(){return uV(this.ref,this.afs.schedulers.outsideAngular).pipe(Ne)}valueChanges(e={}){return this.snapshotChanges().pipe(H(({payload:t})=>e.idField?de(G({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Ee(this.ref.get(e)).pipe(Ne)}};function Ud(n,e){return fv(n,e).pipe(bs(void 0),vl(),H(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let l=s.find(f=>f.doc.ref.isEqual(a.ref)),h=r?.payload.docs.find(f=>f.ref.isEqual(a.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(a.metadata)||!l&&h&&JSON.stringify(h.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function Wb(n,e,t){return Ud(n,t).pipe(Zn((r,i)=>cV(r,i.map(s=>s.payload),e),[]),yl(),H(r=>r.map(i=>({type:i.type,payload:i}))))}function cV(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=lV(n,r))}),n}function hv(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function lV(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return hv(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return hv(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return hv(n,e.oldIndex,1);break}return n}function Hb(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Bd=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Ud(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(H(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(bs(void 0),vl(),Ut(([r,i])=>i.length>0||!r),H(([,r])=>r),Ne)}auditTrail(e){return this.stateChanges(e).pipe(Zn((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Hb(e);return Wb(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ne)}valueChanges(e={}){return fv(this.query,this.afs.schedulers.outsideAngular).pipe(H(t=>t.payload.docs.map(r=>e.idField?de(G({},r.data()),{[e.idField]:r.id}):r.data())),Ne)}get(e){return Ee(this.query.get(e)).pipe(Ne)}add(e){return this.ref.add(e)}doc(e){return new Ld(this.ref.doc(e),this.afs)}},dv=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Ud(this.query,this.afs.schedulers.outsideAngular).pipe(Ne):Ud(this.query,this.afs.schedulers.outsideAngular).pipe(H(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ut(t=>t.length>0),Ne)}auditTrail(e){return this.stateChanges(e).pipe(Zn((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Hb(e);return Wb(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ne)}valueChanges(e={}){return fv(this.query,this.afs.schedulers.outsideAngular).pipe(H(r=>r.payload.docs.map(i=>e.idField?G({[e.idField]:i.id},i.data()):i.data())),Ne)}get(e){return Ee(this.query.get(e)).pipe(Ne)}},Kb=new J("angularfire2.enableFirestorePersistence"),Qb=new J("angularfire2.firestore.persistenceSettings"),hV=new J("angularfire2.firestore.settings"),dV=new J("angularfire2.firestore.use-emulator");function Yb(n,e=t=>t){return{query:e(n),ref:n}}var pv=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,l,h,f,g,_,E,b,I,M,B){this.schedulers=u;let x=cr(t,a,r),U=h;f&&Su(x,a,g,E,b,I,_,M),[this.firestore,this.persistenceEnabled$]=$r(`${x.name}.firestore`,"AngularFirestore",x.name,()=>{let Y=a.runOutsideAngular(()=>x.firestore());if(s&&Y.settings(s),U&&Y.useEmulator(...U),i&&!kr(o)){let Q=()=>{try{return Ee(Y.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),W(!1)}};return[Y,a.runOutsideAngular(Q)]}else return[Y,W(!1)]},[s,U,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=Yb(i,r),a=this.schedulers.ngZone.run(()=>s);return new Bd(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new dv(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Ld(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(V(Nn),V(kn,8),V(Kb,8),V(hV,8),V(Ke),V(Oe),V(Pn),V(Qb,8),V(dV,8),V(Xs,8),V(Tu,8),V(Iu,8),V(Cu,8),V(Au,8),V(Du,8),V(bu,8),V(pn,8))};static \u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),zz=(()=>{class n{constructor(){Ve.registerVersion("angularfire",gn.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:Kb,useValue:!0},{provide:Qb,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=vt({type:n});static \u0275inj=yt({providers:[pv]})}return n})();var Xb="@firebase/database",Jb="1.0.5";var Dw="";function bw(n){Dw=n}var Tv=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Qe(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:bl(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Iv=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Zt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var RS=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Tv(e)}}catch{}return new Iv},us=RS("localStorage"),Cv=RS("sessionStorage");var qo=new Nr("@firebase/database"),PS=function(){let n=1;return function(){return n++}}(),NS=function(n){let e=lT(n),t=new cT;t.update(e);let r=t.digest();return Cl.encodeByteArray(r)},Bc=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Bc.apply(null,r):typeof r=="object"?e+=Qe(r):e+=r,e+=" "}return e},cs=null,Zb=!0,kS=function(n,e){L(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(qo.logLevel=en.VERBOSE,cs=qo.log.bind(qo),e&&Cv.set("logging_enabled",!0)):typeof n=="function"?cs=n:(cs=null,Cv.remove("logging_enabled"))},at=function(...n){if(Zb===!0&&(Zb=!1,cs===null&&Cv.get("logging_enabled")===!0&&kS(!0)),cs){let e=Bc.apply(null,n);cs(e)}},jc=function(n){return function(...e){at(n,...e)}},Av=function(...n){let e="FIREBASE INTERNAL ERROR: "+Bc(...n);qo.error(e)},zn=function(...n){let e=`FIREBASE FATAL ERROR: ${Bc(...n)}`;throw qo.error(e),new Error(e)},Tt=function(...n){let e="FIREBASE WARNING: "+Bc(...n);qo.warn(e)},pV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},gf=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},gV=function(n){if(Sn()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},di="[MIN_NAME]",wr="[MAX_NAME]",hs=function(n,e){if(n===e)return 0;if(n===di||e===wr)return-1;if(e===di||n===wr)return 1;{let t=eS(n),r=eS(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},mV=function(n,e){return n===e?0:n<e?-1:1},_c=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Qe(e))},Sw=function(n){if(typeof n!="object"||n===null)return Qe(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Qe(e[r]),t+=":",t+=Sw(n[e[r]]);return t+="}",t},xS=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function ut(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var MS=function(n){L(!gf(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,u;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let l=[];for(u=t;u;u-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(i?1:0),l.reverse();let h=l.join(""),f="";for(u=0;u<64;u+=8){let g=parseInt(h.substr(u,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},_V=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},yV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function vV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var wV=new RegExp("^-?(0*)\\d{1,10}$"),EV=-2147483648,TV=2147483647,eS=function(n){if(wV.test(n)){let e=Number(n);if(e>=EV&&e<=TV)return e}return null},Jo=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Tt("Exception was thrown by user callback.",t),e},Math.floor(0))}},IV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ec=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Dv=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Tt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var bv=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(at("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Tt(e)}},Tc=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),$d="5",FS="v",OS="s",VS="r",LS="f",US=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,BS="ls",jS="p",Sv="ac",$S="websocket",qS="long_polling";var qd=class{constructor(e,t,r,i,s=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=us.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&us.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function CV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function GS(n,e,t){L(typeof e=="string","typeof type must == string"),L(typeof t=="object","typeof params must == object");let r;if(e===$S)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===qS)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);CV(n)&&(t.ns=n.namespace);let i=[];return ut(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Rv=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Zt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return rT(this.counters_)}};var gv={},mv={};function Rw(n){let e=n.toString();return gv[e]||(gv[e]=new Rv),gv[e]}function AV(n,e){let t=n.toString();return mv[t]||(mv[t]=e()),mv[t]}var Pv=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Jo(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var tS="start",DV="close",bV="pLPCommand",SV="pRTLPCB",zS="id",WS="pw",HS="ser",RV="cb",PV="seg",NV="ts",kV="d",xV="dframe",KS=1870,QS=30,MV=KS-QS,FV=25e3,OV=3e4,Dc=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=jc(e),this.stats_=Rw(t),this.urlFn=u=>(this.appCheckToken&&(u[Sv]=this.appCheckToken),GS(t,qS,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Pv(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(OV)),gV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Nv((...s)=>{let[o,a,u,l,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===tS)this.id=a,this.password=u;else if(o===DV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[tS]="t",r[HS]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[RV]=this.scriptTagHolder.uniqueCallbackIdentifier),r[FS]=$d,this.transportSessionId&&(r[OS]=this.transportSessionId),this.lastSessionId&&(r[BS]=this.lastSessionId),this.applicationId&&(r[jS]=this.applicationId),this.appCheckToken&&(r[Sv]=this.appCheckToken),typeof location<"u"&&location.hostname&&US.test(location.hostname)&&(r[VS]=LS);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Sn()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!_V()&&!yV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Qe(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=nT(t),i=xS(r,MV);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Sn())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[xV]="t",r[zS]=e,r[WS]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Qe(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Nv=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Sn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=PS(),window[bV+this.uniqueCallbackIdentifier]=e,window[SV+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){at("frame writing exception"),a.stack&&at(a.stack),at(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||at("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[zS]=this.myID,e[WS]=this.myPW,e[HS]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+QS+r.length<=KS;){let o=this.pendingSegs.shift();r=r+"&"+PV+i+"="+o.seg+"&"+NV+i+"="+o.ts+"&"+kV+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(FV)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Sn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{at("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var VV=16384,LV=45e3,Gd=null;typeof MozWebSocket<"u"?Gd=MozWebSocket:typeof WebSocket<"u"&&(Gd=WebSocket);var jo=(()=>{class n{constructor(t,r,i,s,o,a,u){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=jc(this.connId),this.stats_=Rw(r),this.connURL=n.connectionURL_(r,a,u,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[FS]=$d,!Sn()&&typeof location<"u"&&location.hostname&&US.test(location.hostname)&&(a[VS]=LS),r&&(a[OS]=r),i&&(a[BS]=i),s&&(a[Sv]=s),o&&(a[jS]=o),GS(t,$S,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,us.set("previous_websocket_failure",!0);try{let i;if(Sn()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${$d}/${Dw}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Gd(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Gd!==null&&!n.forceDisallow_}static previouslyFailed(){return us.isInMemoryStorage||us.get("previous_websocket_failure")===!0}markConnectionHealthy(){us.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=bl(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(L(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=Qe(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=xS(r,VV);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(LV))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),YS=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Dc,jo]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=jo&&jo.isAvailable(),i=r&&!jo.previouslyFailed();if(t.webSocketOnly&&(r||Tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[jo];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),UV=6e4,BV=5e3,jV=10*1024,$V=100*1024,_v="t",nS="d",qV="s",rS="r",GV="e",iS="o",sS="a",oS="n",aS="p",zV="h",kv=class{constructor(e,t,r,i,s,o,a,u,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=jc("c:"+this.id+":"),this.transportManager_=new YS(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Ec(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>$V?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>jV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(_v in e){let t=e[_v];t===sS?this.upgradeIfSecondaryHealthy_():t===rS?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===iS&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=_c("t",e),r=_c("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:aS,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:sS,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:oS,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=_c("t",e),r=_c("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=_c(_v,e);if(nS in e){let r=e[nS];if(t===zV){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===oS){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===qV?this.onConnectionShutdown_(r):t===rS?this.onReset_(r):t===GV?Av("Server Error: "+r):t===iS?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Av("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),$d!==r&&Tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Ec(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(UV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ec(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(BV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:aS,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(us.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var zd=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Wd=class{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Hd=class n extends Wd{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Op()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return L(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var uS=32,cS=768,ye=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function _e(){return new ye("")}function ue(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function fi(n){return n.pieces_.length-n.pieceNum_}function Ae(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ye(n.pieces_,e)}function Pw(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function WV(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function bc(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function XS(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ye(e,0)}function xe(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ye)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new ye(t,0)}function ce(n){return n.pieceNum_>=n.pieces_.length}function Rt(n,e){let t=ue(n),r=ue(e);if(t===null)return e;if(t===r)return Rt(Ae(n),Ae(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function HV(n,e){let t=bc(n,0),r=bc(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=hs(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Nw(n,e){if(fi(n)!==fi(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function an(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(fi(n)>fi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var xv=class{constructor(e,t){this.errorPrefix_=t,this.parts_=bc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Va(this.parts_[r]);JS(this)}};function KV(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Va(e),JS(n)}function QV(n){let e=n.parts_.pop();n.byteLength_-=Va(e),n.parts_.length>0&&(n.byteLength_-=1)}function JS(n){if(n.byteLength_>cS)throw new Error(n.errorPrefix_+"has a key path longer than "+cS+" bytes ("+n.byteLength_+").");if(n.parts_.length>uS)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+uS+") or object contains a cycle "+as(n))}function as(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Mv=class n extends Wd{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return L(e==="visible","Unknown event type: "+e),[this.visible_]}};var yc=1e3,YV=60*5*1e3,lS=30*1e3,XV=1.3,JV=3e4,ZV="server_kill",hS=3,kw=(()=>{class n extends zd{constructor(t,r,i,s,o,a,u,l){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=l,this.id=n.nextPersistentConnectionId_++,this.log_=jc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=yc,this.maxReconnectDelay_=YV,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!Sn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Mv.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Hd.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(Qe(o)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new rt,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,u=>{let l=u.d,h=u.s;n.warnOnListenWarnings_(l,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",u),h!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(h,l))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&Zt(t,"w")){let i=Pr(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();Tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||aT(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lS)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=oT(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Qe(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):Av("Unrecognized action received from server: "+Qe(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=yc,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=yc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>JV&&(this.reconnectDelay_=yc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*XV)}this.onConnectStatus_(!1)}establishConnection_(){return R(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,l=function(){u?u.close():(a=!0,i())},h=function(g){L(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(g)};this.realtime_={close:l,sendRequest:h};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?at("getToken() completed but was canceled"):(at("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=_&&_.token,u=new kv(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,E=>{Tt(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(ZV)},o))}catch(g){this.log_("Failed to get token: "+g),a||(this.repoInfo_.nodeAdmin&&Tt(g),l())}}})}interrupt(t){at("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){at("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Sl(this.interruptReasons_)&&(this.reconnectDelay_=yc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>Sw(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new ye(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){at("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=hS&&(this.reconnectDelay_=lS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){at("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=hS&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Sn()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+Dw.replace(/\./g,"-")]=1,Op()?t["framework.cordova"]=1:iT()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Hd.getInstance().currentlyOnline();return Sl(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),le=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Go=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new le(di,e),i=new le(di,t);return this.compare(r,i)!==0}minPost(){return le.MIN}};var jd,Kd=class extends Go{static get __EMPTY_NODE(){return jd}static set __EMPTY_NODE(e){jd=e}compare(e,t){return hs(e.name,t.name)}isDefinedOn(e){throw ks("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return le.MIN}maxPost(){return new le(wr,jd)}makePost(e,t){return L(typeof e=="string","KeyIndex indexValue must always be a string."),new le(e,jd)}toString(){return".key"}},Gn=new Kd;var $o=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},En=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??un.EMPTY_NODE,this.right=o??un.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return un.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return un.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Fv=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new En(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},un=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,En.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,En.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new $o(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new $o(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new $o(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new $o(this.root_,null,this.comparator_,!0,e)}};un.EMPTY_NODE=new Fv;function eL(n,e){return hs(n.name,e.name)}function xw(n,e){return hs(n,e)}var Ov;function tL(n){Ov=n}var ZS=function(n){return typeof n=="number"?"number:"+MS(n):"string:"+n},eR=function(n){if(n.isLeafNode()){let e=n.val();L(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Zt(e,".sv"),"Priority must be a string or number.")}else L(n===Ov||n.isEmpty(),"priority of unexpected type.");L(n===Ov||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var dS,zo=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,L(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),eR(this.priorityNode_)}static set __childrenNodeConstructor(t){dS=t}static get __childrenNodeConstructor(){return dS}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ce(t)?this:ue(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=ue(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(L(i!==".priority"||fi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ae(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ZS(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=MS(this.value_):t+=this.value_,this.lazyHash_=NS(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(L(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return L(s>=0,"Unknown leaf type: "+r),L(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),tR,nR;function nL(n){tR=n}function rL(n){nR=n}var Vv=class extends Go{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?hs(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return le.MIN}maxPost(){return new le(wr,new zo("[PRIORITY-POST]",nR))}makePost(e,t){let r=tR(e);return new le(t,new zo("[PRIORITY-POST]",r))}toString(){return".priority"}},be=new Vv;var iL=Math.log(2),Lv=class{constructor(e){let t=s=>parseInt(Math.log(s)/iL,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Qd=function(n,e,t,r){n.sort(e);let i=function(u,l){let h=l-u,f,g;if(h===0)return null;if(h===1)return f=n[u],g=t?t(f):f,new En(g,f.node,En.BLACK,null,null);{let _=parseInt(h/2,10)+u,E=i(u,_),b=i(_+1,l);return f=n[_],g=t?t(f):f,new En(g,f.node,En.BLACK,E,b)}},s=function(u){let l=null,h=null,f=n.length,g=function(E,b){let I=f-E,M=f;f-=E;let B=i(I+1,M),x=n[I],U=t?t(x):x;_(new En(U,x.node,b,null,B))},_=function(E){l?(l.left=E,l=E):(h=E,l=E)};for(let E=0;E<u.count;++E){let b=u.nextBitIsOne(),I=Math.pow(2,u.count-(E+1));b?g(I,En.BLACK):(g(I,En.BLACK),g(I,En.RED))}return h},o=new Lv(n.length),a=s(o);return new un(r||e,a)};var yv,Bo={},Wo=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return L(Bo&&be,"ChildrenNode.ts has not been loaded"),yv=yv||new n({".priority":Bo},{".priority":be}),yv}get(e){let t=Pr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof un?t:null}hasIndex(e){return Zt(this.indexSet_,e.toString())}addIndex(e,t){L(e!==Gn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(le.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=Qd(r,e.getCompare()):a=Bo;let u=e.toString(),l=Object.assign({},this.indexSet_);l[u]=e;let h=Object.assign({},this.indexes_);return h[u]=a,new n(h,l)}addToIndexes(e,t){let r=Oa(this.indexes_,(i,s)=>{let o=Pr(this.indexSet_,s);if(L(o,"Missing index implementation for "+s),i===Bo)if(o.isDefinedOn(e.node)){let a=[],u=t.getIterator(le.Wrap),l=u.getNext();for(;l;)l.name!==e.name&&a.push(l),l=u.getNext();return a.push(e),Qd(a,o.getCompare())}else return Bo;else{let a=t.get(e.name),u=i;return a&&(u=u.remove(new le(e.name,a))),u.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Oa(this.indexes_,i=>{if(i===Bo)return i;{let s=t.get(e.name);return s?i.remove(new le(e.name,s)):i}});return new n(r,this.indexSet_)}};var vc,se=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&eR(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return vc||(vc=new n(new un(xw),null,Wo.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||vc}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?vc:r}}getChild(t){let r=ue(t);return r===null?this:this.getImmediateChild(r).getChild(Ae(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(L(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new le(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?vc:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=ue(t);if(i===null)return r;{L(ue(t)!==".priority"||fi(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Ae(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(be,(a,u)=>{r[a]=u.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let u in r)a[u]=r[u];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+ZS(this.getPriority().val())+":"),this.forEachChild(be,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":NS(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new le(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new le(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new le(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===$c?-1:0}withIndex(t){if(t===Gn||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Gn||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(be),s=r.getIterator(be),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Gn?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Uv=class extends se{constructor(){super(new un(xw),se.EMPTY_NODE,Wo.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return se.EMPTY_NODE}isEmpty(){return!1}},$c=new Uv;Object.defineProperties(le,{MIN:{value:new le(di,se.EMPTY_NODE)},MAX:{value:new le(wr,$c)}});Kd.__EMPTY_NODE=se.EMPTY_NODE;zo.__childrenNodeConstructor=se;tL($c);rL($c);var sL=!0;function Ue(n,e=null){if(n===null)return se.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),L(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new zo(t,Ue(e))}if(!(n instanceof Array)&&sL){let t=[],r=!1;if(ut(n,(o,a)=>{if(o.substring(0,1)!=="."){let u=Ue(a);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),t.push(new le(o,u)))}}),t.length===0)return se.EMPTY_NODE;let s=Qd(t,eL,o=>o.name,xw);if(r){let o=Qd(t,be.getCompare());return new se(s,Ue(e),new Wo({".priority":o},{".priority":be}))}else return new se(s,Ue(e),Wo.Default)}else{let t=se.EMPTY_NODE;return ut(n,(r,i)=>{if(Zt(n,r)&&r.substring(0,1)!=="."){let s=Ue(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Ue(e))}}nL(Ue);var Sc=class extends Go{constructor(e){super(),this.indexPath_=e,L(!ce(e)&&ue(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?hs(e.name,t.name):s}makePost(e,t){let r=Ue(e),i=se.EMPTY_NODE.updateChild(this.indexPath_,r);return new le(t,i)}maxPost(){let e=se.EMPTY_NODE.updateChild(this.indexPath_,$c);return new le(wr,e)}toString(){return bc(this.indexPath_,0).join("/")}};var Bv=class extends Go{compare(e,t){let r=e.node.compareTo(t.node);return r===0?hs(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return le.MIN}maxPost(){return le.MAX}makePost(e,t){let r=Ue(e);return new le(t,r)}toString(){return".value"}},Mw=new Bv;function rR(n){return{type:"value",snapshotNode:n}}function Ho(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Rc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Pc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function oL(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Nc=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Rc(t,a)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ho(t,r)):o.trackChildChange(Pc(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(be,(i,s)=>{t.hasChild(i)||r.trackChildChange(Rc(i,s))}),t.isLeafNode()||t.forEachChild(be,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Pc(i,s,o))}else r.trackChildChange(Ho(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?se.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Yd=class n{constructor(e){this.indexedFilter_=new Nc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new le(t,r))||(r=se.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=se.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(se.EMPTY_NODE);let s=this;return t.forEachChild(be,(o,a)=>{s.matches(new le(o,a))||(i=i.updateImmediateChild(o,se.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var jv=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Yd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new le(t,r))||(r=se.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=se.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=se.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(se.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,se.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let f=this.index_.getCompare();o=(g,_)=>f(_,g)}else o=this.index_.getCompare();let a=e;L(a.numChildren()===this.limit_,"");let u=new le(t,r),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(a.hasChild(t)){let f=a.getImmediateChild(t),g=i.getChildAfterChild(this.index_,l,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let _=g==null?1:o(g,u);if(h&&!r.isEmpty()&&_>=0)return s?.trackChildChange(Pc(t,r,f)),a.updateImmediateChild(t,r);{s?.trackChildChange(Rc(t,f));let b=a.updateImmediateChild(t,se.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(s?.trackChildChange(Ho(g.name,g.node)),b.updateImmediateChild(g.name,g.node)):b}}else return r.isEmpty()?e:h&&o(l,u)>=0?(s!=null&&(s.trackChildChange(Rc(l.name,l.node)),s.trackChildChange(Ho(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(l.name,se.EMPTY_NODE)):e}};var kc=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=be}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return L(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:di}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return L(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:wr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===be}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function aL(n){return n.loadsAllData()?new Nc(n.getIndex()):n.hasLimit()?new jv(n):new Yd(n)}function uL(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function cL(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function $v(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function lL(n,e,t){let r;return n.index_===Gn||t?r=$v(n,e,t):r=$v(n,e,wr),r.startAfterSet_=!0,r}function qv(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function hL(n,e,t){let r;return n.index_===Gn||t?r=qv(n,e,t):r=qv(n,e,di),r.endBeforeSet_=!0,r}function mf(n,e){let t=n.copy();return t.index_=e,t}function fS(n){let e={};if(n.isDefault())return e;let t;if(n.index_===be?t="$priority":n.index_===Mw?t="$value":n.index_===Gn?t="$key":(L(n.index_ instanceof Sc,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Qe(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=Qe(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Qe(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Qe(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Qe(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function pS(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==be&&(e.i=n.index_.toString()),e}var Gv=class n extends zd{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=jc("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let u=fS(e._queryParams);this.restRequest_(s+".json",u,(l,h)=>{let f=h;if(l===404&&(f=null,l=null),l===null&&this.onDataUpdate_(s,f,!1,r),Pr(this.listens_,o)===a){let g;l?l===401?g="permission_denied":g="rest_error:"+l:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=fS(e._queryParams),r=e._path.toString(),i=new rt;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+uT(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=bl(a.responseText)}catch{Tt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,u)}else a.status!==401&&a.status!==404&&Tt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var zv=class{constructor(){this.rootNode_=se.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Xd(){return{value:null,children:new Map}}function Zo(n,e,t){if(ce(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=ue(e);n.children.has(r)||n.children.set(r,Xd());let i=n.children.get(r);e=Ae(e),Zo(i,e,t)}}function Wv(n,e){if(ce(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(be,(r,i)=>{Zo(n,new ye(r),i)}),Wv(n,e)}}else if(n.children.size>0){let t=ue(e);return e=Ae(e),n.children.has(t)&&Wv(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Hv(n,e,t){n.value!==null?t(e,n.value):dL(n,(r,i)=>{let s=new ye(e.toString()+"/"+r);Hv(i,s,t)})}function dL(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Kv=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ut(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var gS=10*1e3,fL=30*1e3,pL=5*60*1e3,Qv=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Kv(e);let r=gS+(fL-gS)*Math.random();Ec(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;ut(e,(i,s)=>{s>0&&Zt(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Ec(this.reportStats_.bind(this),Math.floor(Math.random()*2*pL))}};var qn=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(qn||{});function Fw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ow(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Vw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Yv=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=qn.ACK_USER_WRITE,this.source=Fw()}operationForChild(e){if(ce(this.path)){if(this.affectedTree.value!=null)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ye(e));return new n(_e(),t,this.revert)}}else return L(ue(this.path)===e,"operationForChild called for unrelated child."),new n(Ae(this.path),this.affectedTree,this.revert)}};var Jd=class n{constructor(e,t){this.source=e,this.path=t,this.type=qn.LISTEN_COMPLETE}operationForChild(e){return ce(this.path)?new n(this.source,_e()):new n(this.source,Ae(this.path))}};var Ko=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=qn.OVERWRITE}operationForChild(e){return ce(this.path)?new n(this.source,_e(),this.snap.getImmediateChild(e)):new n(this.source,Ae(this.path),this.snap)}};var xc=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=qn.MERGE}operationForChild(e){if(ce(this.path)){let t=this.children.subtree(new ye(e));return t.isEmpty()?null:t.value?new Ko(this.source,_e(),t.value):new n(this.source,_e(),t)}else return L(ue(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Ae(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Wn=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ce(e))return this.isFullyInitialized()&&!this.filtered_;let t=ue(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Xv=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function gL(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(oL(o.childName,o.snapshotNode))}),wc(n,i,"child_removed",e,r,t),wc(n,i,"child_added",e,r,t),wc(n,i,"child_moved",s,r,t),wc(n,i,"child_changed",e,r,t),wc(n,i,"value",e,r,t),i}function wc(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,u)=>_L(n,a,u)),o.forEach(a=>{let u=mL(n,a,s);i.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(u,n.query_))})})}function mL(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function _L(n,e,t){if(e.childName==null||t.childName==null)throw ks("Should only compare child_ events.");let r=new le(e.childName,e.snapshotNode),i=new le(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function _f(n,e){return{eventCache:n,serverCache:e}}function Ic(n,e,t,r){return _f(new Wn(e,t,r),n.serverCache)}function iR(n,e,t,r){return _f(n.eventCache,new Wn(e,t,r))}function Zd(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ls(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var vv,yL=()=>(vv||(vv=new un(mV)),vv),Pt=class n{constructor(e,t=yL()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return ut(e,(r,i)=>{t=t.set(new ye(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:_e(),value:this.value};if(ce(e))return null;{let r=ue(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Ae(e),t);return s!=null?{path:xe(new ye(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ce(e))return this;{let t=ue(e),r=this.children.get(t);return r!==null?r.subtree(Ae(e)):new n(null)}}set(e,t){if(ce(e))return new n(t,this.children);{let r=ue(e),s=(this.children.get(r)||new n(null)).set(Ae(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ce(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=ue(e),r=this.children.get(t);if(r){let i=r.remove(Ae(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ce(e))return this.value;{let t=ue(e),r=this.children.get(t);return r?r.get(Ae(e)):null}}setTree(e,t){if(ce(e))return t;{let r=ue(e),s=(this.children.get(r)||new n(null)).setTree(Ae(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(_e(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(xe(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,_e(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ce(e))return null;{let s=ue(e),o=this.children.get(s);return o?o.findOnPath_(Ae(e),xe(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,_e(),t)}foreachOnPath_(e,t,r){if(ce(e))return this;{this.value&&r(t,this.value);let i=ue(e),s=this.children.get(i);return s?s.foreachOnPath_(Ae(e),xe(t,i),r):new n(null)}}foreach(e){this.foreach_(_e(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(xe(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Tn=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new Pt(null))}};function Cc(n,e,t){if(ce(e))return new Tn(new Pt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=Rt(i,e);return s=s.updateChild(o,t),new Tn(n.writeTree_.set(i,s))}else{let i=new Pt(t),s=n.writeTree_.setTree(e,i);return new Tn(s)}}}function Jv(n,e,t){let r=n;return ut(t,(i,s)=>{r=Cc(r,xe(e,i),s)}),r}function mS(n,e){if(ce(e))return Tn.empty();{let t=n.writeTree_.setTree(e,new Pt(null));return new Tn(t)}}function Zv(n,e){return ds(n,e)!=null}function ds(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Rt(t.path,e)):null}function _S(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(be,(r,i)=>{e.push(new le(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new le(r,i.value))}),e}function li(n,e){if(ce(e))return n;{let t=ds(n,e);return t!=null?new Tn(new Pt(t)):new Tn(n.writeTree_.subtree(e))}}function ew(n){return n.writeTree_.isEmpty()}function Qo(n,e){return sR(_e(),n.writeTree_,e)}function sR(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(L(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=sR(xe(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(xe(n,".priority"),r)),t}}function yf(n,e){return cR(e,n)}function vL(n,e,t,r,i){L(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Cc(n.visibleWrites,e,t)),n.lastWriteId=r}function wL(n,e,t,r){L(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Jv(n.visibleWrites,e,t),n.lastWriteId=r}function EL(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function TL(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);L(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&IL(a,r.path)?i=!1:an(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return CL(n),!0;if(r.snap)n.visibleWrites=mS(n.visibleWrites,r.path);else{let a=r.children;ut(a,u=>{n.visibleWrites=mS(n.visibleWrites,xe(r.path,u))})}return!0}else return!1}function IL(n,e){if(n.snap)return an(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&an(xe(n.path,t),e))return!0;return!1}function CL(n){n.visibleWrites=oR(n.allWrites,AL,_e()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function AL(n){return n.visible}function oR(n,e,t){let r=Tn.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)an(t,o)?(a=Rt(t,o),r=Cc(r,a,s.snap)):an(o,t)&&(a=Rt(o,t),r=Cc(r,_e(),s.snap.getChild(a)));else if(s.children){if(an(t,o))a=Rt(t,o),r=Jv(r,a,s.children);else if(an(o,t))if(a=Rt(o,t),ce(a))r=Jv(r,_e(),s.children);else{let u=Pr(s.children,ue(a));if(u){let l=u.getChild(Ae(a));r=Cc(r,_e(),l)}}}else throw ks("WriteRecord should have .snap or .children")}}return r}function aR(n,e,t,r,i){if(!r&&!i){let s=ds(n.visibleWrites,e);if(s!=null)return s;{let o=li(n.visibleWrites,e);if(ew(o))return t;if(t==null&&!Zv(o,_e()))return null;{let a=t||se.EMPTY_NODE;return Qo(o,a)}}}else{let s=li(n.visibleWrites,e);if(!i&&ew(s))return t;if(!i&&t==null&&!Zv(s,_e()))return null;{let o=function(l){return(l.visible||i)&&(!r||!~r.indexOf(l.writeId))&&(an(l.path,e)||an(e,l.path))},a=oR(n.allWrites,o,e),u=t||se.EMPTY_NODE;return Qo(a,u)}}}function DL(n,e,t){let r=se.EMPTY_NODE,i=ds(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(be,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=li(n.visibleWrites,e);return t.forEachChild(be,(o,a)=>{let u=Qo(li(s,new ye(o)),a);r=r.updateImmediateChild(o,u)}),_S(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=li(n.visibleWrites,e);return _S(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function bL(n,e,t,r,i){L(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=xe(e,t);if(Zv(n.visibleWrites,s))return null;{let o=li(n.visibleWrites,s);return ew(o)?i.getChild(t):Qo(o,i.getChild(t))}}function SL(n,e,t,r){let i=xe(e,t),s=ds(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=li(n.visibleWrites,i);return Qo(o,r.getNode().getImmediateChild(t))}else return null}function RL(n,e){return ds(n.visibleWrites,e)}function PL(n,e,t,r,i,s,o){let a,u=li(n.visibleWrites,e),l=ds(u,_e());if(l!=null)a=l;else if(t!=null)a=Qo(u,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],f=o.getCompare(),g=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),_=g.getNext();for(;_&&h.length<i;)f(_,r)!==0&&h.push(_),_=g.getNext();return h}else return[]}function NL(){return{visibleWrites:Tn.empty(),allWrites:[],lastWriteId:-1}}function ef(n,e,t,r){return aR(n.writeTree,n.treePath,e,t,r)}function Lw(n,e){return DL(n.writeTree,n.treePath,e)}function yS(n,e,t,r){return bL(n.writeTree,n.treePath,e,t,r)}function tf(n,e){return RL(n.writeTree,xe(n.treePath,e))}function kL(n,e,t,r,i,s){return PL(n.writeTree,n.treePath,e,t,r,i,s)}function Uw(n,e,t){return SL(n.writeTree,n.treePath,e,t)}function uR(n,e){return cR(xe(n.treePath,e),n.writeTree)}function cR(n,e){return{treePath:n,writeTree:e}}var tw=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;L(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),L(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Pc(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Rc(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Ho(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Pc(r,e.snapshotNode,i.oldSnap));else throw ks("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var nw=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},lR=new nw,Mc=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Wn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Uw(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ls(this.viewCache_),s=kL(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function xL(n){return{filter:n}}function ML(n,e){L(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),L(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function FL(n,e,t,r,i){let s=new tw,o,a;if(t.type===qn.OVERWRITE){let l=t;l.source.fromUser?o=rw(n,e,l.path,l.snap,r,i,s):(L(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!ce(l.path),o=nf(n,e,l.path,l.snap,r,i,a,s))}else if(t.type===qn.MERGE){let l=t;l.source.fromUser?o=VL(n,e,l.path,l.children,r,i,s):(L(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=iw(n,e,l.path,l.children,r,i,a,s))}else if(t.type===qn.ACK_USER_WRITE){let l=t;l.revert?o=BL(n,e,l.path,r,i,s):o=LL(n,e,l.path,l.affectedTree,r,i,s)}else if(t.type===qn.LISTEN_COMPLETE)o=UL(n,e,t.path,r,s);else throw ks("Unknown operation type: "+t.type);let u=s.getChanges();return OL(e,o,u),{viewCache:o,changes:u}}function OL(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Zd(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(rR(Zd(e)))}}function hR(n,e,t,r,i,s){let o=e.eventCache;if(tf(r,t)!=null)return e;{let a,u;if(ce(t))if(L(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=ls(e),h=l instanceof se?l:se.EMPTY_NODE,f=Lw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{let l=ef(r,ls(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{let l=ue(t);if(l===".priority"){L(fi(t)===1,"Can't have a priority with additional path components");let h=o.getNode();u=e.serverCache.getNode();let f=yS(r,t,h,u);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{let h=Ae(t),f;if(o.isCompleteForChild(l)){u=e.serverCache.getNode();let g=yS(r,t,o.getNode(),u);g!=null?f=o.getNode().getImmediateChild(l).updateChild(h,g):f=o.getNode().getImmediateChild(l)}else f=Uw(r,l,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),l,f,h,i,s):a=o.getNode()}}return Ic(e,a,o.isFullyInitialized()||ce(t),n.filter.filtersNodes())}}function nf(n,e,t,r,i,s,o,a){let u=e.serverCache,l,h=o?n.filter:n.filter.getIndexedFilter();if(ce(t))l=h.updateFullNode(u.getNode(),r,null);else if(h.filtersNodes()&&!u.isFiltered()){let _=u.getNode().updateChild(t,r);l=h.updateFullNode(u.getNode(),_,null)}else{let _=ue(t);if(!u.isCompleteForPath(t)&&fi(t)>1)return e;let E=Ae(t),I=u.getNode().getImmediateChild(_).updateChild(E,r);_===".priority"?l=h.updatePriority(u.getNode(),I):l=h.updateChild(u.getNode(),_,I,E,lR,null)}let f=iR(e,l,u.isFullyInitialized()||ce(t),h.filtersNodes()),g=new Mc(i,f,s);return hR(n,f,t,i,g,a)}function rw(n,e,t,r,i,s,o){let a=e.eventCache,u,l,h=new Mc(i,e,s);if(ce(t))l=n.filter.updateFullNode(e.eventCache.getNode(),r,o),u=Ic(e,l,!0,n.filter.filtersNodes());else{let f=ue(t);if(f===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),r),u=Ic(e,l,a.isFullyInitialized(),a.isFiltered());else{let g=Ae(t),_=a.getNode().getImmediateChild(f),E;if(ce(g))E=r;else{let b=h.getCompleteChild(f);b!=null?Pw(g)===".priority"&&b.getChild(XS(g)).isEmpty()?E=b:E=b.updateChild(g,r):E=se.EMPTY_NODE}if(_.equals(E))u=e;else{let b=n.filter.updateChild(a.getNode(),f,E,g,h,o);u=Ic(e,b,a.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function vS(n,e){return n.eventCache.isCompleteForChild(e)}function VL(n,e,t,r,i,s,o){let a=e;return r.foreach((u,l)=>{let h=xe(t,u);vS(e,ue(h))&&(a=rw(n,a,h,l,i,s,o))}),r.foreach((u,l)=>{let h=xe(t,u);vS(e,ue(h))||(a=rw(n,a,h,l,i,s,o))}),a}function wS(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function iw(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,l;ce(t)?l=r:l=new Pt(null).setTree(t,r);let h=e.serverCache.getNode();return l.children.inorderTraversal((f,g)=>{if(h.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),E=wS(n,_,g);u=nf(n,u,new ye(f),E,i,s,o,a)}}),l.children.inorderTraversal((f,g)=>{let _=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!h.hasChild(f)&&!_){let E=e.serverCache.getNode().getImmediateChild(f),b=wS(n,E,g);u=nf(n,u,new ye(f),b,i,s,o,a)}}),u}function LL(n,e,t,r,i,s,o){if(tf(i,t)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(ce(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return nf(n,e,t,u.getNode().getChild(t),i,s,a,o);if(ce(t)){let l=new Pt(null);return u.getNode().forEachChild(Gn,(h,f)=>{l=l.set(new ye(h),f)}),iw(n,e,t,l,i,s,a,o)}else return e}else{let l=new Pt(null);return r.foreach((h,f)=>{let g=xe(t,h);u.isCompleteForPath(g)&&(l=l.set(h,u.getNode().getChild(g)))}),iw(n,e,t,l,i,s,a,o)}}function UL(n,e,t,r,i){let s=e.serverCache,o=iR(e,s.getNode(),s.isFullyInitialized()||ce(t),s.isFiltered());return hR(n,o,t,r,lR,i)}function BL(n,e,t,r,i,s){let o;if(tf(r,t)!=null)return e;{let a=new Mc(r,e,i),u=e.eventCache.getNode(),l;if(ce(t)||ue(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=ef(r,ls(e));else{let f=e.serverCache.getNode();L(f instanceof se,"serverChildren would be complete if leaf node"),h=Lw(r,f)}h=h,l=n.filter.updateFullNode(u,h,s)}else{let h=ue(t),f=Uw(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=u.getImmediateChild(h)),f!=null?l=n.filter.updateChild(u,h,f,Ae(t),a,s):e.eventCache.getNode().hasChild(h)?l=n.filter.updateChild(u,h,se.EMPTY_NODE,Ae(t),a,s):l=u,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ef(r,ls(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||tf(r,_e())!=null,Ic(e,l,o,n.filter.filtersNodes())}}var sw=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Nc(r.getIndex()),s=aL(r);this.processor_=xL(s);let o=t.serverCache,a=t.eventCache,u=i.updateFullNode(se.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(se.EMPTY_NODE,a.getNode(),null),h=new Wn(u,o.isFullyInitialized(),i.filtersNodes()),f=new Wn(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=_f(f,h),this.eventGenerator_=new Xv(this.query_)}get query(){return this.query_}};function jL(n){return n.viewCache_.serverCache.getNode()}function $L(n){return Zd(n.viewCache_)}function qL(n,e){let t=ls(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ce(e)&&!t.getImmediateChild(ue(e)).isEmpty())?t.getChild(e):null}function ES(n){return n.eventRegistrations_.length===0}function GL(n,e){n.eventRegistrations_.push(e)}function TS(n,e,t){let r=[];if(t){L(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function IS(n,e,t,r){e.type===qn.MERGE&&e.source.queryId!==null&&(L(ls(n.viewCache_),"We should always have a full cache before handling merges"),L(Zd(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=FL(n.processor_,i,e,t,r);return ML(n.processor_,s.viewCache),L(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,dR(n,s.changes,s.viewCache.eventCache.getNode(),null)}function zL(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(be,(s,o)=>{r.push(Ho(s,o))}),t.isFullyInitialized()&&r.push(rR(t.getNode())),dR(n,r,t.getNode(),e)}function dR(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return gL(n.eventGenerator_,e,t,i)}var rf,sf=class{constructor(){this.views=new Map}};function WL(n){L(!rf,"__referenceConstructor has already been defined"),rf=n}function HL(){return L(rf,"Reference.ts has not been loaded"),rf}function KL(n){return n.views.size===0}function Bw(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return L(s!=null,"SyncTree gave us an op for an invalid query."),IS(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(IS(o,e,t,r));return s}}function fR(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=ef(t,i?r:null),u=!1;a?u=!0:r instanceof se?(a=Lw(t,r),u=!1):(a=se.EMPTY_NODE,u=!1);let l=_f(new Wn(a,u,!1),new Wn(r,i,!1));return new sw(e,l)}return o}function QL(n,e,t,r,i,s){let o=fR(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),GL(o,t),zL(o,t)}function YL(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=pi(n);if(i==="default")for(let[u,l]of n.views.entries())o=o.concat(TS(l,t,r)),ES(l)&&(n.views.delete(u),l.query._queryParams.loadsAllData()||s.push(l.query));else{let u=n.views.get(i);u&&(o=o.concat(TS(u,t,r)),ES(u)&&(n.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!pi(n)&&s.push(new(HL())(e._repo,e._path)),{removed:s,events:o}}function pR(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function hi(n,e){let t=null;for(let r of n.views.values())t=t||qL(r,e);return t}function gR(n,e){if(e._queryParams.loadsAllData())return vf(n);{let r=e._queryIdentifier;return n.views.get(r)}}function mR(n,e){return gR(n,e)!=null}function pi(n){return vf(n)!=null}function vf(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var of;function XL(n){L(!of,"__referenceConstructor has already been defined"),of=n}function JL(){return L(of,"Reference.ts has not been loaded"),of}var ZL=1,af=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Pt(null),this.pendingWriteTree_=NL(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function jw(n,e,t,r,i){return vL(n.pendingWriteTree_,e,t,r,i),i?ea(n,new Ko(Fw(),e,t)):[]}function eU(n,e,t,r){wL(n.pendingWriteTree_,e,t,r);let i=Pt.fromObject(t);return ea(n,new xc(Fw(),e,i))}function ci(n,e,t=!1){let r=EL(n.pendingWriteTree_,e);if(TL(n.pendingWriteTree_,e)){let s=new Pt(null);return r.snap!=null?s=s.set(_e(),!0):ut(r.children,o=>{s=s.set(new ye(o),!0)}),ea(n,new Yv(r.path,s,t))}else return[]}function qc(n,e,t){return ea(n,new Ko(Ow(),e,t))}function tU(n,e,t){let r=Pt.fromObject(t);return ea(n,new xc(Ow(),e,r))}function nU(n,e){return ea(n,new Jd(Ow(),e))}function rU(n,e,t){let r=$w(n,t);if(r){let i=qw(r),s=i.path,o=i.queryId,a=Rt(s,e),u=new Jd(Vw(o),a);return Gw(n,s,u)}else return[]}function uf(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||mR(o,e))){let u=YL(o,e,t,r);KL(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let l=u.removed;if(a=u.events,!i){let h=l.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(s,(g,_)=>pi(_));if(h&&!f){let g=n.syncPointTree_.subtree(s);if(!g.isEmpty()){let _=oU(g);for(let E=0;E<_.length;++E){let b=_[E],I=b.query,M=wR(n,b);n.listenProvider_.startListening(Ac(I),Fc(n,I),M.hashFn,M.onComplete)}}}!f&&l.length>0&&!r&&(h?n.listenProvider_.stopListening(Ac(e),null):l.forEach(g=>{let _=n.queryToTagMap.get(Ef(g));n.listenProvider_.stopListening(Ac(g),_)}))}aU(n,l)}return a}function _R(n,e,t,r){let i=$w(n,r);if(i!=null){let s=qw(i),o=s.path,a=s.queryId,u=Rt(o,e),l=new Ko(Vw(a),u,t);return Gw(n,o,l)}else return[]}function iU(n,e,t,r){let i=$w(n,r);if(i){let s=qw(i),o=s.path,a=s.queryId,u=Rt(o,e),l=Pt.fromObject(t),h=new xc(Vw(a),u,l);return Gw(n,o,h)}else return[]}function ow(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(g,_)=>{let E=Rt(g,i);s=s||hi(_,E),o=o||pi(_)});let a=n.syncPointTree_.get(i);a?(o=o||pi(a),s=s||hi(a,_e())):(a=new sf,n.syncPointTree_=n.syncPointTree_.set(i,a));let u;s!=null?u=!0:(u=!1,s=se.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((_,E)=>{let b=hi(E,_e());b&&(s=s.updateImmediateChild(_,b))}));let l=mR(a,e);if(!l&&!e._queryParams.loadsAllData()){let g=Ef(e);L(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let _=uU();n.queryToTagMap.set(g,_),n.tagToQueryMap.set(_,g)}let h=yf(n.pendingWriteTree_,i),f=QL(a,e,t,h,s,u);if(!l&&!o&&!r){let g=gR(a,e);f=f.concat(cU(n,e,g))}return f}function wf(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let u=Rt(o,e),l=hi(a,u);if(l)return l});return aR(i,e,s,t,!0)}function sU(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(l,h)=>{let f=Rt(l,t);r=r||hi(h,f)});let i=n.syncPointTree_.get(t);i?r=r||hi(i,_e()):(i=new sf,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Wn(r,!0,!1):null,a=yf(n.pendingWriteTree_,e._path),u=fR(i,e,a,s?o.getNode():se.EMPTY_NODE,s);return $L(u)}function ea(n,e){return yR(e,n.syncPointTree_,null,yf(n.pendingWriteTree_,_e()))}function yR(n,e,t,r){if(ce(n.path))return vR(n,e,t,r);{let i=e.get(_e());t==null&&i!=null&&(t=hi(i,_e()));let s=[],o=ue(n.path),a=n.operationForChild(o),u=e.children.get(o);if(u&&a){let l=t?t.getImmediateChild(o):null,h=uR(r,o);s=s.concat(yR(a,u,l,h))}return i&&(s=s.concat(Bw(i,n,r,t))),s}}function vR(n,e,t,r){let i=e.get(_e());t==null&&i!=null&&(t=hi(i,_e()));let s=[];return e.children.inorderTraversal((o,a)=>{let u=t?t.getImmediateChild(o):null,l=uR(r,o),h=n.operationForChild(o);h&&(s=s.concat(vR(h,a,u,l)))}),i&&(s=s.concat(Bw(i,n,r,t))),s}function wR(n,e){let t=e.query,r=Fc(n,t);return{hashFn:()=>(jL(e)||se.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?rU(n,t._path,r):nU(n,t._path);{let s=vV(i,t);return uf(n,t,null,s)}}}}function Fc(n,e){let t=Ef(e);return n.queryToTagMap.get(t)}function Ef(n){return n._path.toString()+"$"+n._queryIdentifier}function $w(n,e){return n.tagToQueryMap.get(e)}function qw(n){let e=n.indexOf("$");return L(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ye(n.substr(0,e))}}function Gw(n,e,t){let r=n.syncPointTree_.get(e);L(r,"Missing sync point for query tag that we're tracking");let i=yf(n.pendingWriteTree_,e);return Bw(r,t,i,null)}function oU(n){return n.fold((e,t,r)=>{if(t&&pi(t))return[vf(t)];{let i=[];return t&&(i=pR(t)),ut(r,(s,o)=>{i=i.concat(o)}),i}})}function Ac(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(JL())(n._repo,n._path):n}function aU(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Ef(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function uU(){return ZL++}function cU(n,e,t){let r=e._path,i=Fc(n,e),s=wR(n,t),o=n.listenProvider_.startListening(Ac(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)L(!pi(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((l,h,f)=>{if(!ce(l)&&h&&pi(h))return[vf(h).query];{let g=[];return h&&(g=g.concat(pR(h).map(_=>_.query))),ut(f,(_,E)=>{g=g.concat(E)}),g}});for(let l=0;l<u.length;++l){let h=u[l];n.listenProvider_.stopListening(Ac(h),Fc(n,h))}}return o}var aw=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},uw=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=xe(this.path_,e);return new n(this.syncTree_,t)}node(){return wf(this.syncTree_,this.path_)}},lU=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},CS=function(n,e,t){if(!n||typeof n!="object")return n;if(L(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return hU(n[".sv"],e,t);if(typeof n[".sv"]=="object")return dU(n[".sv"],e);L(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},hU=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:L(!1,"Unexpected server value: "+n)}},dU=function(n,e,t){n.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&L(!1,"Unexpected increment value: "+r);let i=e.node();if(L(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},ER=function(n,e,t,r){return Ww(e,new uw(t,n),r)},zw=function(n,e,t){return Ww(n,new aw(e),t)};function Ww(n,e,t){let r=n.getPriority().val(),i=CS(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=CS(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new zo(a,Ue(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new zo(i))),o.forEachChild(be,(a,u)=>{let l=Ww(u,e.getImmediateChild(a),t);l!==u&&(s=s.updateImmediateChild(a,l))}),s}}var Oc=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Tf(n,e){let t=e instanceof ye?e:new ye(e),r=n,i=ue(t);for(;i!==null;){let s=Pr(r.node.children,i)||{children:{},childCount:0};r=new Oc(i,r,s),t=Ae(t),i=ue(t)}return r}function fs(n){return n.node.value}function Hw(n,e){n.node.value=e,cw(n)}function TR(n){return n.node.childCount>0}function fU(n){return fs(n)===void 0&&!TR(n)}function If(n,e){ut(n.node.children,(t,r)=>{e(new Oc(t,n,r))})}function IR(n,e,t,r){t&&!r&&e(n),If(n,i=>{IR(i,e,!0,r)}),t&&r&&e(n)}function pU(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Gc(n){return new ye(n.parent===null?n.name:Gc(n.parent)+"/"+n.name)}function cw(n){n.parent!==null&&gU(n.parent,n.name,n)}function gU(n,e,t){let r=fU(t),i=Zt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,cw(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,cw(n))}var mU=/[\[\].#$\/\u0000-\u001F\u007F]/,_U=/[\[\].#$\u0000-\u001F\u007F]/,wv=10*1024*1024,Cf=function(n){return typeof n=="string"&&n.length!==0&&!mU.test(n)},CR=function(n){return typeof n=="string"&&n.length!==0&&!_U.test(n)},yU=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),CR(n)},Vc=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!gf(n)||n&&typeof n=="object"&&Zt(n,".sv")},Hn=function(n,e,t,r){r&&e===void 0||zc(Mt(n,"value"),e,t)},zc=function(n,e,t){let r=t instanceof ye?new xv(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+as(r));if(typeof e=="function")throw new Error(n+"contains a function "+as(r)+" with contents = "+e.toString());if(gf(e))throw new Error(n+"contains "+e.toString()+" "+as(r));if(typeof e=="string"&&e.length>wv/3&&Va(e)>wv)throw new Error(n+"contains a string greater than "+wv+" utf8 bytes "+as(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(ut(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Cf(o)))throw new Error(n+" contains an invalid key ("+o+") "+as(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);KV(r,o),zc(n,a,r),QV(r)}),i&&s)throw new Error(n+' contains ".value" child '+as(r)+" in addition to actual children.")}},vU=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=bc(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Cf(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(HV);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&an(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},AR=function(n,e,t,r){if(r&&e===void 0)return;let i=Mt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];ut(e,(o,a)=>{let u=new ye(o);if(zc(i,a,xe(t,u)),Pw(u)===".priority"&&!Vc(a))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),vU(i,s)},Kw=function(n,e,t){if(!(t&&e===void 0)){if(gf(e))throw new Error(Mt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Vc(e))throw new Error(Mt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Wc=function(n,e,t,r){if(!(r&&t===void 0)&&!Cf(t))throw new Error(Mt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},ta=function(n,e,t,r){if(!(r&&t===void 0)&&!CR(t))throw new Error(Mt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},wU=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ta(n,e,t,r)},zt=function(n,e){if(ue(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},DR=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Cf(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!yU(t))throw new Error(Mt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var lw=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Af(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!Nw(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function bR(n,e,t){Af(n,t),SR(n,r=>Nw(r,e))}function Wt(n,e,t){Af(n,t),SR(n,r=>an(r,e)||an(e,r))}function SR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(EU(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function EU(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();cs&&at("event: "+t.toString()),Jo(r)}}}var RR="repo_interrupt",TU=25,hw=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new lw,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xd(),this.transactionQueueTree_=new Oc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function IU(n,e,t){if(n.stats_=Rw(n.repoInfo_),n.forceRestClient_||IV())n.server_=new Gv(n.repoInfo_,(r,i,s,o)=>{AS(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>DS(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Qe(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new kw(n.repoInfo_,e,(r,i,s,o)=>{AS(n,r,i,s,o)},r=>{DS(n,r)},r=>{CU(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=AV(n.repoInfo_,()=>new Qv(n.stats_,n.server_)),n.infoData_=new zv,n.infoSyncTree_=new af({startListening:(r,i,s,o)=>{let a=[],u=n.infoData_.getNode(r._path);return u.isEmpty()||(a=qc(n.infoSyncTree_,r._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Qw(n,"connected",!1),n.serverSyncTree_=new af({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,u)=>{let l=o(a,u);Wt(n.eventQueue_,r._path,l)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function PR(n){let t=n.infoData_.getNode(new ye(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Hc(n){return lU({timestamp:PR(n)})}function AS(n,e,t,r,i){n.dataUpdateCount++;let s=new ye(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let u=Oa(t,l=>Ue(l));o=iU(n.serverSyncTree_,s,u,i)}else{let u=Ue(t);o=_R(n.serverSyncTree_,s,u,i)}else if(r){let u=Oa(t,l=>Ue(l));o=tU(n.serverSyncTree_,s,u)}else{let u=Ue(t);o=qc(n.serverSyncTree_,s,u)}let a=s;o.length>0&&(a=Yo(n,s)),Wt(n.eventQueue_,a,o)}function DS(n,e){Qw(n,"connected",e),e===!1&&bU(n)}function CU(n,e){ut(e,(t,r)=>{Qw(n,t,r)})}function Qw(n,e,t){let r=new ye("/.info/"+e),i=Ue(t);n.infoData_.updateSnapshot(r,i);let s=qc(n.infoSyncTree_,r,i);Wt(n.eventQueue_,r,s)}function Df(n){return n.nextWriteId_++}function AU(n,e,t){let r=sU(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Ue(i).withIndex(e._queryParams.getIndex());ow(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=qc(n.serverSyncTree_,e._path,s);else{let a=Fc(n.serverSyncTree_,e);o=_R(n.serverSyncTree_,e._path,s,a)}return Wt(n.eventQueue_,e._path,o),uf(n.serverSyncTree_,e,t,null,!0),s},i=>(na(n,"get for query "+Qe(e)+" failed: "+i),Promise.reject(new Error(i))))}function Yw(n,e,t,r,i){na(n,"set",{path:e.toString(),value:t,priority:r});let s=Hc(n),o=Ue(t,r),a=wf(n.serverSyncTree_,e),u=zw(o,a,s),l=Df(n),h=jw(n.serverSyncTree_,e,u,l,!0);Af(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(g,_)=>{let E=g==="ok";E||Tt("set at "+e+" failed: "+g);let b=ci(n.serverSyncTree_,l,!E);Wt(n.eventQueue_,e,b),gi(n,i,g,_)});let f=Jw(n,e);Yo(n,f),Wt(n.eventQueue_,f,[])}function DU(n,e,t,r){na(n,"update",{path:e.toString(),value:t});let i=!0,s=Hc(n),o={};if(ut(t,(a,u)=>{i=!1,o[a]=ER(xe(e,a),Ue(u),n.serverSyncTree_,s)}),i)at("update() called with empty data.  Don't do anything."),gi(n,r,"ok",void 0);else{let a=Df(n),u=eU(n.serverSyncTree_,e,o,a);Af(n.eventQueue_,u),n.server_.merge(e.toString(),t,(l,h)=>{let f=l==="ok";f||Tt("update at "+e+" failed: "+l);let g=ci(n.serverSyncTree_,a,!f),_=g.length>0?Yo(n,e):e;Wt(n.eventQueue_,_,g),gi(n,r,l,h)}),ut(t,l=>{let h=Jw(n,xe(e,l));Yo(n,h)}),Wt(n.eventQueue_,e,[])}}function bU(n){na(n,"onDisconnectEvents");let e=Hc(n),t=Xd();Hv(n.onDisconnect_,_e(),(i,s)=>{let o=ER(i,s,n.serverSyncTree_,e);Zo(t,i,o)});let r=[];Hv(t,_e(),(i,s)=>{r=r.concat(qc(n.serverSyncTree_,i,s));let o=Jw(n,i);Yo(n,o)}),n.onDisconnect_=Xd(),Wt(n.eventQueue_,_e(),r)}function SU(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Wv(n.onDisconnect_,e),gi(n,t,r,i)})}function bS(n,e,t,r){let i=Ue(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Zo(n.onDisconnect_,e,i),gi(n,r,s,o)})}function RU(n,e,t,r,i){let s=Ue(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Zo(n.onDisconnect_,e,s),gi(n,i,o,a)})}function PU(n,e,t,r){if(Sl(t)){at("onDisconnect().update() called with empty data.  Don't do anything."),gi(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&ut(t,(o,a)=>{let u=Ue(a);Zo(n.onDisconnect_,xe(e,o),u)}),gi(n,r,i,s)})}function NU(n,e,t){let r;ue(e._path)===".info"?r=ow(n.infoSyncTree_,e,t):r=ow(n.serverSyncTree_,e,t),bR(n.eventQueue_,e._path,r)}function dw(n,e,t){let r;ue(e._path)===".info"?r=uf(n.infoSyncTree_,e,t):r=uf(n.serverSyncTree_,e,t),bR(n.eventQueue_,e._path,r)}function NR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(RR)}function kU(n){n.persistentConnection_&&n.persistentConnection_.resume(RR)}function na(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),at(t,...e)}function gi(n,e,t,r){e&&Jo(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function xU(n,e,t,r,i,s){na(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:PS(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Xw(n,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{zc("transaction failed: Data returned ",u,o.path),o.status=0;let l=Tf(n.transactionQueueTree_,e),h=fs(l)||[];h.push(o),Hw(l,h);let f;typeof u=="object"&&u!==null&&Zt(u,".priority")?(f=Pr(u,".priority"),L(Vc(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(wf(n.serverSyncTree_,e)||se.EMPTY_NODE).getPriority().val();let g=Hc(n),_=Ue(u,f),E=zw(_,a,g);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=E,o.currentWriteId=Df(n);let b=jw(n.serverSyncTree_,e,E,o.currentWriteId,o.applyLocally);Wt(n.eventQueue_,e,b),bf(n,n.transactionQueueTree_)}}function Xw(n,e,t){return wf(n.serverSyncTree_,e,t)||se.EMPTY_NODE}function bf(n,e=n.transactionQueueTree_){if(e||Sf(n,e),fs(e)){let t=xR(n,e);L(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&MU(n,Gc(e),t)}else TR(e)&&If(e,t=>{bf(n,t)})}function MU(n,e,t){let r=t.map(l=>l.currentWriteId),i=Xw(n,e,r),s=i,o=i.hash();for(let l=0;l<t.length;l++){let h=t[l];L(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let f=Rt(e,h.path);s=s.updateChild(f,h.currentOutputSnapshotRaw)}let a=s.val(!0),u=e;n.server_.put(u.toString(),a,l=>{na(n,"transaction put response",{path:u.toString(),status:l});let h=[];if(l==="ok"){let f=[];for(let g=0;g<t.length;g++)t[g].status=2,h=h.concat(ci(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Sf(n,Tf(n.transactionQueueTree_,e)),bf(n,n.transactionQueueTree_),Wt(n.eventQueue_,e,h);for(let g=0;g<f.length;g++)Jo(f[g])}else{if(l==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Tt("transaction at "+u.toString()+" failed: "+l);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=l}Yo(n,e)}},o)}function Yo(n,e){let t=kR(n,e),r=Gc(t),i=xR(n,t);return FU(n,i,r),r}function FU(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],l=Rt(t,u.path),h=!1,f;if(L(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)h=!0,f=u.abortReason,i=i.concat(ci(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=TU)h=!0,f="maxretry",i=i.concat(ci(n.serverSyncTree_,u.currentWriteId,!0));else{let g=Xw(n,u.path,o);u.currentInputSnapshot=g;let _=e[a].update(g.val());if(_!==void 0){zc("transaction failed: Data returned ",_,u.path);let E=Ue(_);typeof _=="object"&&_!=null&&Zt(_,".priority")||(E=E.updatePriority(g.getPriority()));let I=u.currentWriteId,M=Hc(n),B=zw(E,g,M);u.currentOutputSnapshotRaw=E,u.currentOutputSnapshotResolved=B,u.currentWriteId=Df(n),o.splice(o.indexOf(I),1),i=i.concat(jw(n.serverSyncTree_,u.path,B,u.currentWriteId,u.applyLocally)),i=i.concat(ci(n.serverSyncTree_,I,!0))}else h=!0,f="nodata",i=i.concat(ci(n.serverSyncTree_,u.currentWriteId,!0))}Wt(n.eventQueue_,t,i),i=[],h&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Sf(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Jo(r[a]);bf(n,n.transactionQueueTree_)}function kR(n,e){let t,r=n.transactionQueueTree_;for(t=ue(e);t!==null&&fs(r)===void 0;)r=Tf(r,t),e=Ae(e),t=ue(e);return r}function xR(n,e){let t=[];return MR(n,e,t),t.sort((r,i)=>r.order-i.order),t}function MR(n,e,t){let r=fs(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);If(e,i=>{MR(n,i,t)})}function Sf(n,e){let t=fs(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,Hw(e,t.length>0?t:void 0)}If(e,r=>{Sf(n,r)})}function Jw(n,e){let t=Gc(kR(n,e)),r=Tf(n.transactionQueueTree_,e);return pU(r,i=>{Ev(n,i)}),Ev(n,r),IR(r,i=>{Ev(n,i)}),t}function Ev(n,e){let t=fs(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(L(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(L(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(ci(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Hw(e,void 0):t.length=s+1,Wt(n.eventQueue_,Gc(e),i);for(let o=0;o<r.length;o++)Jo(r[o])}}function OU(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function VU(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Tt(`Invalid query segment '${t}' in query '${n}'`)}return e}var fw=function(n,e){let t=LU(n),r=t.namespace;t.domain==="firebase.com"&&zn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&zn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||pV();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new qd(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new ye(t.pathString)}},LU=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",u=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(i=OU(n.substring(h,f)));let g=VU(n.substring(Math.min(n.length,f)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(l+1),10)):l=e.length;let _=e.slice(0,l);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let E=e.indexOf(".");r=e.substring(0,E).toLowerCase(),t=e.substring(E+1),s=r}"ns"in g&&(s=g.ns)}return{host:e,port:u,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var SS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",UU=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=SS.charAt(t%64),t=Math.floor(t/64);L(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=SS.charAt(e[i]);return L(o.length===20,"nextPushId: Length should be 20."),o}}();var cf=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Qe(this.snapshot.exportVal())}},lf=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Lc=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var hf=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new rt;return SU(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){zt("OnDisconnect.remove",this._path);let e=new rt;return bS(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){zt("OnDisconnect.set",this._path),Hn("OnDisconnect.set",e,this._path,!1);let t=new rt;return bS(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){zt("OnDisconnect.setWithPriority",this._path),Hn("OnDisconnect.setWithPriority",e,this._path,!1),Kw("OnDisconnect.setWithPriority",t,!1);let r=new rt;return RU(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){zt("OnDisconnect.update",this._path),AR("OnDisconnect.update",e,this._path,!1);let t=new rt;return PU(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Nt=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ce(this._path)?null:Pw(this._path)}get ref(){return new Ht(this._repo,this._path)}get _queryIdentifier(){let e=pS(this._queryParams),t=Sw(e);return t==="{}"?"default":t}get _queryObject(){return pS(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=Nw(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+WV(this._path)}};function Rf(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function _i(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Gn){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==di)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==wr)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===be){if(e!=null&&!Vc(e)||t!=null&&!Vc(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(L(n.getIndex()instanceof Sc||n.getIndex()===Mw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Pf(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Ht=class n extends Nt{constructor(e,t){super(e,t,new kc,!1)}get parent(){let e=XS(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Xo=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ye(e),r=mi(this.ref,e);return new n(this._node.getChild(t),r,be)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,mi(this.ref,r),be)))}hasChild(e){let t=new ye(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Zw(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?mi(n._root,e):n._root}function eE(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=fw(e,n._repo.repoInfo_.nodeAdmin);DR("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&zn("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Zw(n,t.path.toString())}function mi(n,e){return n=ne(n),ue(n._path)===null?wU("child","path",e,!1):ta("child","path",e,!1),new Ht(n._repo,xe(n._path,e))}function FR(n,e){n=ne(n),zt("push",n._path),Hn("push",e,n._path,!0);let t=PR(n._repo),r=UU(t),i=mi(n,r),s=mi(n,r),o;return e!=null?o=Nf(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function OR(n){return zt("remove",n._path),Nf(n,null)}function Nf(n,e){n=ne(n),zt("set",n._path),Hn("set",e,n._path,!1);let t=new rt;return Yw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function VR(n,e){n=ne(n),zt("setPriority",n._path),Kw("setPriority",e,!1);let t=new rt;return Yw(n._repo,xe(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function LR(n,e,t){if(zt("setWithPriority",n._path),Hn("setWithPriority",e,n._path,!1),Kw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new rt;return Yw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function UR(n,e){AR("update",e,n._path,!1);let t=new rt;return DU(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function BR(n){n=ne(n);let e=new Lc(()=>{}),t=new Uc(e);return AU(n._repo,n,t).then(r=>new Xo(r,new Ht(n._repo,n._path),n._queryParams.getIndex()))}var Uc=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new cf("value",this,new Xo(e.snapshotNode,new Ht(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new lf(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},df=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new lf(this,e,t):null}createEvent(e,t){L(e.childName!=null,"Child events should have a childName.");let r=mi(new Ht(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new cf(e.type,this,new Xo(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Kc(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let u=t,l=(h,f)=>{dw(n._repo,n,a),u(h,f)};l.userCallback=t.userCallback,l.context=t.context,t=l}let o=new Lc(t,s||void 0),a=e==="value"?new Uc(o):new df(e,o);return NU(n._repo,n,a),()=>dw(n._repo,n,a)}function kf(n,e,t,r){return Kc(n,"value",e,t,r)}function tE(n,e,t,r){return Kc(n,"child_added",e,t,r)}function nE(n,e,t,r){return Kc(n,"child_changed",e,t,r)}function rE(n,e,t,r){return Kc(n,"child_moved",e,t,r)}function iE(n,e,t,r){return Kc(n,"child_removed",e,t,r)}function sE(n,e,t){let r=null,i=t?new Lc(t):null;e==="value"?r=new Uc(i):e&&(r=new df(e,i)),dw(n._repo,n,r)}var Kt=class{},ff=class extends Kt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Hn("endAt",this._value,e._path,!0);let t=qv(e._queryParams,this._value,this._key);if(Pf(t),_i(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Nt(e._repo,e._path,t,e._orderByCalled)}};function jR(n,e){return Wc("endAt","key",e,!0),new ff(n,e)}var pw=class extends Kt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Hn("endBefore",this._value,e._path,!1);let t=hL(e._queryParams,this._value,this._key);if(Pf(t),_i(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Nt(e._repo,e._path,t,e._orderByCalled)}};function $R(n,e){return Wc("endBefore","key",e,!0),new pw(n,e)}var pf=class extends Kt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Hn("startAt",this._value,e._path,!0);let t=$v(e._queryParams,this._value,this._key);if(Pf(t),_i(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Nt(e._repo,e._path,t,e._orderByCalled)}};function qR(n=null,e){return Wc("startAt","key",e,!0),new pf(n,e)}var gw=class extends Kt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Hn("startAfter",this._value,e._path,!1);let t=lL(e._queryParams,this._value,this._key);if(Pf(t),_i(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Nt(e._repo,e._path,t,e._orderByCalled)}};function GR(n,e){return Wc("startAfter","key",e,!0),new gw(n,e)}var mw=class extends Kt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Nt(e._repo,e._path,uL(e._queryParams,this._limit),e._orderByCalled)}};function zR(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new mw(n)}var _w=class extends Kt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Nt(e._repo,e._path,cL(e._queryParams,this._limit),e._orderByCalled)}};function WR(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new _w(n)}var yw=class extends Kt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Rf(e,"orderByChild");let t=new ye(this._path);if(ce(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Sc(t),i=mf(e._queryParams,r);return _i(i),new Nt(e._repo,e._path,i,!0)}};function HR(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ta("orderByChild","path",n,!1),new yw(n)}var vw=class extends Kt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Rf(e,"orderByKey");let t=mf(e._queryParams,Gn);return _i(t),new Nt(e._repo,e._path,t,!0)}};function KR(){return new vw}var ww=class extends Kt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Rf(e,"orderByPriority");let t=mf(e._queryParams,be);return _i(t),new Nt(e._repo,e._path,t,!0)}};function QR(){return new ww}var Ew=class extends Kt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Rf(e,"orderByValue");let t=mf(e._queryParams,Mw);return _i(t),new Nt(e._repo,e._path,t,!0)}};function YR(){return new Ew}var Tw=class extends Kt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Hn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new ff(this._value,this._key)._apply(new pf(this._value,this._key)._apply(e))}};function XR(n,e){return Wc("equalTo","key",e,!0),new Tw(n,e)}function cn(n,...e){let t=ne(n);for(let r of e)t=r._apply(t);return t}WL(Ht);XL(Ht);var BU="FIREBASE_DATABASE_EMULATOR_HOST",Iw={},jU=!1;function $U(n,e,t,r){n.repoInfo_=new qd(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function oE(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||zn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),at("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=fw(s,i),a=o.repoInfo,u,l;typeof process<"u"&&process.env&&(l=process.env[BU]),l?(u=!0,s=`http://${l}?ns=${a.namespace}`,o=fw(s,i),a=o.repoInfo):u=!o.repoInfo.secure;let h=i&&u?new Tc(Tc.OWNER):new bv(n.name,n.options,e);DR("Invalid Firebase Database URL",o),ce(o.path)||zn("Database URL must point to the root of a Firebase Database (not including a child path).");let f=GU(a,n,h,new Dv(n.name,t));return new Cw(f,n)}function qU(n,e){let t=Iw[e];(!t||t[n.key]!==n)&&zn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),NR(n),delete t[n.key]}function GU(n,e,t,r){let i=Iw[e.name];i||(i={},Iw[e.name]=i);let s=i[n.toURLString()];return s&&zn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new hw(n,jU,t,r),i[n.toURLString()]=s,s}var Cw=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(IU(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ht(this._repo,_e())),this._rootInternal}_delete(){return this._rootInternal!==null&&(qU(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&zn("Cannot call "+e+" on a deleted database.")}};function JR(){YS.IS_TRANSPORT_INITIALIZED&&Tt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function ZR(){JR(),Dc.forceDisallow()}function eP(){JR(),jo.forceDisallow(),Dc.forceAllow()}function Xz(n=ir(),e){let t=bi(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let r=xs("database");r&&aE(t,...r)}return t}function aE(n,e,t,r={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&zn("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&zn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Tc(Tc.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:Ms(r.mockUserToken,n.app.options.projectId);s=new Tc(o)}$U(i,e,t,s)}function tP(n){n=ne(n),n._checkNotDeleted("goOffline"),NR(n._repo)}function nP(n){n=ne(n),n._checkNotDeleted("goOnline"),kU(n._repo)}function rP(n,e){kS(n,e)}function zU(n){bw(Fs),rr(new lt("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return oE(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),it(Xb,Jb,n),it(Xb,Jb,"esm2017")}var WU={".sv":"timestamp"};function iP(){return WU}function sP(n){return{".sv":{increment:n}}}var Aw=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function oP(n,e,t){var r;if(n=ne(n),zt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new rt,o=(u,l,h)=>{let f=null;u?s.reject(u):(f=new Xo(h,new Ht(n._repo,n._path),be),s.resolve(new Aw(l,f)))},a=kf(n,()=>{});return xU(n._repo,n._path,e,o,a,i),s.promise}kw.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};kw.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};zU();var HU="@firebase/database-compat",KU="1.0.5";var QU=new Nr("@firebase/database-compat"),aP=function(n){let e="FIREBASE WARNING: "+n;QU.warn(e)};var YU=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(Mt(n,e)+"must be a boolean.")},XU=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Mt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var uE=class{constructor(e){this._delegate=e}cancel(e){ee("OnDisconnect.cancel",0,1,arguments.length),tt("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){ee("OnDisconnect.remove",0,1,arguments.length),tt("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){ee("OnDisconnect.set",1,2,arguments.length),tt("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){ee("OnDisconnect.setWithPriority",2,3,arguments.length),tt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(ee("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,aP("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}tt("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var cE=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return ee("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var ps=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return ee("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return ee("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return ee("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return ee("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return ee("DataSnapshot.child",0,1,arguments.length),e=String(e),ta("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return ee("DataSnapshot.hasChild",1,1,arguments.length),ta("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return ee("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return ee("DataSnapshot.forEach",1,1,arguments.length),tt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return ee("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return ee("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return ee("DataSnapshot.ref",0,0,arguments.length),new Er(this._database,this._delegate.ref)}get ref(){return this.getRef()}},xf=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;ee("Query.on",2,4,arguments.length),tt("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(l,h)=>{t.call(o.context,new ps(this.database,l),h)};a.userCallback=t,a.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return kf(this._delegate,a,u),t;case"child_added":return tE(this._delegate,a,u),t;case"child_removed":return iE(this._delegate,a,u),t;case"child_changed":return nE(this._delegate,a,u),t;case"child_moved":return rE(this._delegate,a,u),t;default:throw new Error(Mt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(ee("Query.off",0,3,arguments.length),XU("Query.off",e,!0),tt("Query.off","callback",t,!0),Up("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,sE(this._delegate,e,i)}else sE(this._delegate,e)}get(){return BR(this._delegate).then(e=>new ps(this.database,e))}once(e,t,r,i){ee("Query.once",1,4,arguments.length),tt("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new rt,a=(l,h)=>{let f=new ps(this.database,l);t&&t.call(s.context,f,h),o.resolve(f)};a.userCallback=t,a.context=s.context;let u=l=>{s.cancel&&s.cancel.call(s.context,l),o.reject(l)};switch(e){case"value":kf(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":tE(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":iE(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":nE(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":rE(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(Mt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return ee("Query.limitToFirst",1,1,arguments.length),new n(this.database,cn(this._delegate,zR(e)))}limitToLast(e){return ee("Query.limitToLast",1,1,arguments.length),new n(this.database,cn(this._delegate,WR(e)))}orderByChild(e){return ee("Query.orderByChild",1,1,arguments.length),new n(this.database,cn(this._delegate,HR(e)))}orderByKey(){return ee("Query.orderByKey",0,0,arguments.length),new n(this.database,cn(this._delegate,KR()))}orderByPriority(){return ee("Query.orderByPriority",0,0,arguments.length),new n(this.database,cn(this._delegate,QR()))}orderByValue(){return ee("Query.orderByValue",0,0,arguments.length),new n(this.database,cn(this._delegate,YR()))}startAt(e=null,t){return ee("Query.startAt",0,2,arguments.length),new n(this.database,cn(this._delegate,qR(e,t)))}startAfter(e=null,t){return ee("Query.startAfter",0,2,arguments.length),new n(this.database,cn(this._delegate,GR(e,t)))}endAt(e=null,t){return ee("Query.endAt",0,2,arguments.length),new n(this.database,cn(this._delegate,jR(e,t)))}endBefore(e=null,t){return ee("Query.endBefore",0,2,arguments.length),new n(this.database,cn(this._delegate,$R(e,t)))}equalTo(e,t){return ee("Query.equalTo",1,2,arguments.length),new n(this.database,cn(this._delegate,XR(e,t)))}toString(){return ee("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return ee("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(ee("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,tt(e,"cancel",i.cancel,!0),i.context=r,Up(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(Mt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new Er(this.database,new Ht(this._delegate._repo,this._delegate._path))}},Er=class n extends xf{constructor(e,t){super(e,new Nt(t._repo,t._path,new kc,!1)),this.database=e,this._delegate=t}getKey(){return ee("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return ee("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,mi(this._delegate,e))}getParent(){ee("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return ee("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){ee("Reference.set",1,2,arguments.length),tt("Reference.set","onComplete",t,!0);let r=Nf(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(ee("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,aP("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}zt("Reference.update",this._delegate._path),tt("Reference.update","onComplete",t,!0);let r=UR(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){ee("Reference.setWithPriority",2,3,arguments.length),tt("Reference.setWithPriority","onComplete",r,!0);let i=LR(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){ee("Reference.remove",0,1,arguments.length),tt("Reference.remove","onComplete",e,!0);let t=OR(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){ee("Reference.transaction",1,3,arguments.length),tt("Reference.transaction","transactionUpdate",e,!1),tt("Reference.transaction","onComplete",t,!0),YU("Reference.transaction","applyLocally",r,!0);let i=oP(this._delegate,e,{applyLocally:r}).then(s=>new cE(s.committed,new ps(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){ee("Reference.setPriority",1,2,arguments.length),tt("Reference.setPriority","onComplete",t,!0);let r=VR(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){ee("Reference.push",0,2,arguments.length),tt("Reference.push","onComplete",t,!0);let r=FR(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return zt("Reference.onDisconnect",this._delegate._path),new uE(new hf(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var gs=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:ZR,forceLongPolling:eP}}useEmulator(e,t,r={}){aE(this._delegate,e,t,r)}ref(e){if(ee("database.ref",0,1,arguments.length),e instanceof Er){let t=eE(this._delegate,e.toString());return new Er(this,t)}else{let t=Zw(this._delegate,e);return new Er(this,t)}}refFromURL(e){ee("database.refFromURL",1,1,arguments.length);let r=eE(this._delegate,e);return new Er(this,r)}goOffline(){return ee("database.goOffline",0,0,arguments.length),tP(this._delegate)}goOnline(){return ee("database.goOnline",0,0,arguments.length),nP(this._delegate)}};gs.ServerValue={TIMESTAMP:iP(),increment:n=>sP(n)};function JU({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){bw(t);let a=new Bp("database-standalone"),u=new Rl("auth-internal",a);u.setComponent(new lt("auth-internal",()=>r,"PRIVATE"));let l;return i&&(l=new Rl("app-check-internal",a),l.setComponent(new lt("app-check-internal",()=>i,"PRIVATE"))),{instance:new gs(oE(n,u,l,e,o),n),namespace:s}}var ZU=Object.freeze({__proto__:null,initStandalone:JU});var e2=gs.ServerValue;function t2(n){n.INTERNAL.registerComponent(new lt("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new gs(i,r)},"PUBLIC").setServiceProps({Reference:Er,Query:xf,Database:gs,DataSnapshot:ps,enableLogging:rP,INTERNAL:ZU,ServerValue:e2}).setMultipleInstances(!0)),n.registerVersion(HU,KU)}t2(Ve);function Qc(n,e,t="on",r=Ts){return new Lt(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(H(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),L0())}function n2(n){return typeof n=="string"}function r2(n){return typeof n.exportVal=="function"}function dP(n){return n==null}function fP(n){return typeof n.set=="function"}function uP(n,e){return fP(e)?e:n.ref(e)}function pP(n,e){if(n2(n))return e.stringCase();if(fP(n))return e.firebaseCase();if(r2(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function gP(n){return(dP(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function mP(n,e,t){e=gP(e);let r=e.map(i=>Qc(n,i,"on",t));return Na(...r)}function i2(n,e,t){let r=mP(n,e).pipe(Zn((i,s)=>[...i,s],[]));return o2(n,r,t)}function s2(n,e){return Qc(n,"value","on",e).pipe(H(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function o2(n,e,t){return s2(n,t).pipe(j0(e),H(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),U0(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),H(i=>i.actions))}function cP(n,e){return function(r,i){return pP(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function a2(n){return function(t){return t?pP(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function u2(n,e,t){return Qc(n,"value","once",t).pipe(Ie(r=>{let i=[W(r)];return e.forEach(s=>i.push(Qc(n,s,"on",t))),Na(...i).pipe(Zn(l2,[]))}),yl())}function _P(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function c2(n,e){if(dP(e))return 0;{let t=_P(n,e);return t===-1?n.length:t+1}}function l2(n,e){let{payload:t,prevKey:r,key:i}=e,s=_P(n,i),o=c2(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let l={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,n=[...n,l],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(u=>u.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function lP(n,e,t){return e=gP(e),u2(n,e,t)}function h2(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:cP(r,"update"),set:cP(r,"set"),push:i=>r.push(i),remove:a2(r),snapshotChanges(i){return lP(n,i,t).pipe(Ne)},stateChanges(i){return mP(n,i,t).pipe(Ne)},auditTrail(i){return i2(n,i,t).pipe(Ne)},valueChanges(i,s){return lP(n,i,t).pipe(H(a=>a.map(u=>s&&s.idField?de(G({},u.payload.val()),{[s.idField]:u.key}):u.payload.val())),Ne)}}}function hP(n,e){return function(){return Qc(n,"value","on",e)}}function d2(n,e){return{query:n,snapshotChanges(){return hP(n,e.schedulers.outsideAngular)().pipe(Ne)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return hP(n,e.schedulers.outsideAngular)().pipe(Ne,H(r=>r.payload.exists()?r.payload.val():null))}}}var f2=new J("angularfire2.realtimeDatabaseURL"),p2=new J("angularfire2.database.use-emulator"),yP=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,u,l,h,f,g,_,E,b,I){this.schedulers=a;let M=u,B=cr(t,o,r);l&&Su(B,o,h,g,_,E,f,b),this.database=$r(`${B.name}.database.${i}`,"AngularFireDatabase",B.name,()=>{let x=o.runOutsideAngular(()=>B.database(i||void 0));return M&&x.useEmulator(...M),x},[M])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>uP(this.database,t)),s=i;return r&&(s=r(i)),h2(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>uP(this.database,t));return d2(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(V(Nn),V(kn,8),V(f2,8),V(Ke),V(Oe),V(Pn),V(p2,8),V(Xs,8),V(Tu,8),V(Iu,8),V(Cu,8),V(Au,8),V(Du,8),V(bu,8),V(pn,8))};static \u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var bP="firebasestorage.googleapis.com",SP="storageBucket",m2=2*60*1e3,_2=10*60*1e3,y2=1e3;var Be=class n extends Dl{constructor(e,t,r=0){super(lE(e),`Firebase Storage: ${t} (${lE(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return lE(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},Me=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(Me||{});function lE(n){return"storage/"+n}function yE(){let n="An unknown error occurred, please check the error payload for server response.";return new Be(Me.UNKNOWN,n)}function v2(n){return new Be(Me.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function w2(n){return new Be(Me.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function E2(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Be(Me.UNAUTHENTICATED,n)}function T2(){return new Be(Me.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function I2(n){return new Be(Me.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function RP(){return new Be(Me.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function PP(){return new Be(Me.CANCELED,"User canceled the upload/download.")}function C2(n){return new Be(Me.INVALID_URL,"Invalid URL '"+n+"'.")}function A2(n){return new Be(Me.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function D2(){return new Be(Me.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+SP+"' property when initializing the app?")}function NP(){return new Be(Me.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function b2(){return new Be(Me.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function S2(){return new Be(Me.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function R2(n){return new Be(Me.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function ms(n){return new Be(Me.INVALID_ARGUMENT,n)}function kP(){return new Be(Me.APP_DELETED,"The Firebase app was deleted.")}function vE(n){return new Be(Me.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Xc(n,e){return new Be(Me.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Yc(n){throw new Be(Me.INTERNAL_ERROR,"Internal error: "+n)}var kt=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw A2(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(U){U.path.charAt(U.path.length-1)==="/"&&(U.path_=U.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function l(U){U.path_=decodeURIComponent(U.path)}let h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",_=new RegExp(`^https?://${f}/${h}/b/${i}/o${g}`,"i"),E={bucket:1,path:3},b=t===bP?"(?:storage.googleapis.com|storage.cloud.google.com)":t,I="([^?#]*)",M=new RegExp(`^https?://${b}/${i}/${I}`,"i"),x=[{regex:a,indices:u,postModify:s},{regex:_,indices:E,postModify:l},{regex:M,indices:{bucket:1,path:2},postModify:l}];for(let U=0;U<x.length;U++){let Y=x[U],Q=Y.regex.exec(e);if(Q){let T=Q[Y.indices.bucket],y=Q[Y.indices.path];y||(y=""),r=new n(T,y),Y.postModify(r);break}}if(r==null)throw C2(e);return r}},dE=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function P2(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function u(){return a===2}let l=!1;function h(...I){l||(l=!0,e.apply(null,I))}function f(I){i=setTimeout(()=>{i=null,n(_,u())},I)}function g(){s&&clearTimeout(s)}function _(I,...M){if(l){g();return}if(I){g(),h.call(null,I,...M);return}if(u()||o){g(),h.call(null,I,...M);return}r<64&&(r*=2);let x;a===1?(a=2,x=0):x=(r+Math.random())*1e3,f(x)}let E=!1;function b(I){E||(E=!0,g(),!l&&(i!==null?(I||(a=2),clearTimeout(i),f(0)):I||(a=1)))}return f(0),s=setTimeout(()=>{o=!0,b(!0)},t),b}function N2(n){n(!1)}function k2(n){return n!==void 0}function x2(n){return typeof n=="function"}function M2(n){return typeof n=="object"&&!Array.isArray(n)}function Of(n){return typeof n=="string"||n instanceof String}function vP(n){return wE()&&n instanceof Blob}function wE(){return typeof Blob<"u"}function fE(n,e,t,r){if(r<e)throw ms(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw ms(`Invalid value for '${n}'. Expected ${t} or less.`)}function yi(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function xP(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var sa=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(sa||{});function MP(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var pE=class{constructor(e,t,r,i,s,o,a,u,l,h,f,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=u,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=f,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,E)=>{this.resolve_=_,this.reject_=E,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new ia(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=a=>{let u=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let a=s.getErrorCode()===sa.NO_ERROR,u=s.getStatus();if(!a||MP(u,this.additionalRetryCodes_)&&this.retry){let h=s.getErrorCode()===sa.ABORT;r(!1,new ia(!1,null,h));return}let l=this.successCodes_.indexOf(u)!==-1;r(!0,new ia(l,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(a,a.getResponse());k2(u)?s(u):s()}catch(u){o(u)}else if(a!==null){let u=yE();u.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,u)):o(u)}else if(i.canceled){let u=this.appDelete_?kP():PP();o(u)}else{let u=RP();o(u)}};this.canceled_?t(!1,new ia(!1,null,!0)):this.backoffId_=P2(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&N2(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},ia=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function F2(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function O2(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function V2(n,e){e&&(n["X-Firebase-GMPID"]=e)}function L2(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function U2(n,e,t,r,i,s,o=!0){let a=xP(n.urlParams),u=n.url+a,l=Object.assign({},n.headers);return V2(l,e),F2(l,t),O2(l,s),L2(l,r),new pE(u,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function B2(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function j2(...n){let e=B2();if(e!==void 0){let t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(wE())return new Blob(n);throw new Be(Me.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function $2(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function q2(n){if(typeof atob>"u")throw R2("base-64");return atob(n)}var Qt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Jc=class{constructor(e,t){this.data=e,this.contentType=t||null}};function EE(n,e){switch(n){case Qt.RAW:return new Jc(FP(e));case Qt.BASE64:case Qt.BASE64URL:return new Jc(OP(n,e));case Qt.DATA_URL:return new Jc(z2(e),W2(e))}throw yE()}function FP(n){let e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=r,o=n.charCodeAt(++t);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function G2(n){let e;try{e=decodeURIComponent(n)}catch{throw Xc(Qt.DATA_URL,"Malformed data URL.")}return FP(e)}function OP(n,e){switch(n){case Qt.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Xc(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Qt.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Xc(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=q2(e)}catch(i){throw i.message.includes("polyfill")?i:Xc(n,"Invalid character found")}let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}var Ff=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw Xc(Qt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;r!=null&&(this.base64=H2(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}};function z2(n){let e=new Ff(n);return e.base64?OP(Qt.BASE64,e.rest):G2(e.rest)}function W2(n){return new Ff(n).contentType}function H2(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}var oa=class n{constructor(e,t){let r=0,i="";vP(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(vP(this.data_)){let r=this.data_,i=$2(r,e,t);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,e,t-e);return new n(r,!0)}}static getBlob(...e){if(wE()){let t=e.map(r=>r instanceof n?r.data_:r);return new n(j2.apply(null,t))}else{let t=e.map(o=>Of(o)?EE(Qt.RAW,o).data:o.data_),r=0;t.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new n(i,!0)}}uploadData(){return this.data_}};function TE(n){let e;try{e=JSON.parse(n)}catch{return null}return M2(e)?e:null}function K2(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Q2(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function VP(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function Y2(n,e){return e}var ft=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||Y2}},Mf=null;function X2(n){return!Of(n)||n.length<2?n:VP(n)}function Vf(){if(Mf)return Mf;let n=[];n.push(new ft("bucket")),n.push(new ft("generation")),n.push(new ft("metageneration")),n.push(new ft("name","fullPath",!0));function e(s,o){return X2(o)}let t=new ft("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new ft("size");return i.xform=r,n.push(i),n.push(new ft("timeCreated")),n.push(new ft("updated")),n.push(new ft("md5Hash",null,!0)),n.push(new ft("cacheControl",null,!0)),n.push(new ft("contentDisposition",null,!0)),n.push(new ft("contentEncoding",null,!0)),n.push(new ft("contentLanguage",null,!0)),n.push(new ft("contentType",null,!0)),n.push(new ft("metadata","customMetadata",!0)),Mf=n,Mf}function J2(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new kt(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function Z2(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return J2(r,n),r}function LP(n,e,t){let r=TE(e);return r===null?null:Z2(n,r,t)}function eB(n,e,t,r){let i=TE(e);if(i===null||!Of(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(l=>{let h=n.bucket,f=n.fullPath,g="/b/"+o(h)+"/o/"+o(f),_=yi(g,t,r),E=xP({alt:"media",token:l});return _+E})[0]}function IE(n,e){let t={},r=e.length;for(let i=0;i<r;i++){let s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}var wP="prefixes",EP="items";function tB(n,e,t){let r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[wP])for(let i of t[wP]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new kt(e,s));r.prefixes.push(o)}if(t[EP])for(let i of t[EP]){let s=n._makeStorageReference(new kt(e,i.name));r.items.push(s)}return r}function nB(n,e,t){let r=TE(t);return r===null?null:tB(n,e,r)}var In=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function Qn(n){if(!n)throw yE()}function Lf(n,e){function t(r,i){let s=LP(n,i,e);return Qn(s!==null),s}return t}function rB(n,e){function t(r,i){let s=nB(n,e,i);return Qn(s!==null),s}return t}function iB(n,e){function t(r,i){let s=LP(n,i,e);return Qn(s!==null),eB(s,i,n.host,n._protocol)}return t}function ca(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=T2():i=E2():t.getStatus()===402?i=w2(n.bucket):t.getStatus()===403?i=I2(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function Uf(n){let e=ca(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=v2(n.path)),s.serverResponse=i.serverResponse,s}return t}function UP(n,e,t){let r=e.fullServerUrl(),i=yi(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new In(i,s,Lf(n,t),o);return a.errorHandler=Uf(e),a}function sB(n,e,t,r,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),a=yi(o,n.host,n._protocol),u="GET",l=n.maxOperationRetryTime,h=new In(a,u,rB(n,e.bucket),l);return h.urlParams=s,h.errorHandler=ca(e),h}function oB(n,e,t){let r=e.fullServerUrl(),i=yi(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new In(i,s,iB(n,t),o);return a.errorHandler=Uf(e),a}function aB(n,e,t,r){let i=e.fullServerUrl(),s=yi(i,n.host,n._protocol),o="PATCH",a=IE(t,r),u={"Content-Type":"application/json; charset=utf-8"},l=n.maxOperationRetryTime,h=new In(s,o,Lf(n,r),l);return h.headers=u,h.body=a,h.errorHandler=Uf(e),h}function uB(n,e){let t=e.fullServerUrl(),r=yi(t,n.host,n._protocol),i="DELETE",s=n.maxOperationRetryTime;function o(u,l){}let a=new In(r,i,o,s);return a.successCodes=[200,204],a.errorHandler=Uf(e),a}function cB(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function BP(n,e,t){let r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=cB(null,e)),r}function lB(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let x="";for(let U=0;U<2;U++)x=x+Math.random().toString().slice(2);return x}let u=a();o["Content-Type"]="multipart/related; boundary="+u;let l=BP(e,r,i),h=IE(l,t),f="--"+u+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+u+`\r
Content-Type: `+l.contentType+`\r
\r
`,g=`\r
--`+u+"--",_=oa.getBlob(f,r,g);if(_===null)throw NP();let E={name:l.fullPath},b=yi(s,n.host,n._protocol),I="POST",M=n.maxUploadRetryTime,B=new In(b,I,Lf(n,t),M);return B.urlParams=E,B.headers=o,B.body=_.uploadData(),B.errorHandler=ca(e),B}var aa=class{constructor(e,t,r,i){this.current=e,this.total=t,this.finalized=!!r,this.metadata=i||null}};function CE(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{Qn(!1)}return Qn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function hB(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o=BP(e,r,i),a={name:o.fullPath},u=yi(s,n.host,n._protocol),l="POST",h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},f=IE(o,t),g=n.maxUploadRetryTime;function _(b){CE(b);let I;try{I=b.getResponseHeader("X-Goog-Upload-URL")}catch{Qn(!1)}return Qn(Of(I)),I}let E=new In(u,l,_,g);return E.urlParams=a,E.headers=h,E.body=f,E.errorHandler=ca(e),E}function dB(n,e,t,r){let i={"X-Goog-Upload-Command":"query"};function s(l){let h=CE(l,["active","final"]),f=null;try{f=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Qn(!1)}f||Qn(!1);let g=Number(f);return Qn(!isNaN(g)),new aa(g,r.size(),h==="final")}let o="POST",a=n.maxUploadRetryTime,u=new In(t,o,s,a);return u.headers=i,u.errorHandler=ca(e),u}var TP=256*1024;function fB(n,e,t,r,i,s,o,a){let u=new aa(0,0);if(o?(u.current=o.current,u.total=o.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw b2();let l=u.total-u.current,h=l;i>0&&(h=Math.min(h,i));let f=u.current,g=f+h,_="";h===0?_="finalize":l===h?_="upload, finalize":_="upload";let E={"X-Goog-Upload-Command":_,"X-Goog-Upload-Offset":`${u.current}`},b=r.slice(f,g);if(b===null)throw NP();function I(U,Y){let Q=CE(U,["active","final"]),T=u.current+h,y=r.size(),w;return Q==="final"?w=Lf(e,s)(U,Y):w=null,new aa(T,y,Q==="final",w)}let M="POST",B=e.maxUploadRetryTime,x=new In(t,M,I,B);return x.headers=E,x.body=b.uploadData(),x.progressCallback=a||null,x.errorHandler=ca(n),x}var jP={STATE_CHANGED:"state_changed"},It={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function hE(n){switch(n){case"running":case"pausing":case"canceling":return It.RUNNING;case"paused":return It.PAUSED;case"success":return It.SUCCESS;case"canceled":return It.CANCELED;case"error":return It.ERROR;default:return It.ERROR}}var gE=class{constructor(e,t,r){if(x2(e)||t!=null||r!=null)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{let s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}};function ra(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}var IP=null,mE=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=sa.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=sa.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=sa.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw Yc("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Yc("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Yc("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Yc("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Yc("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},_E=class extends mE{initXhr(){this.xhr_.responseType="text"}};function Kn(){return IP?IP():new _E}var Zc=class{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=Vf(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(Me.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let s=this.isExponentialBackoffExpired();if(MP(i.status,[]))if(s)i=RP();else{this.sleepTime=Math.max(this.sleepTime*2,y2),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(Me.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{let r=hB(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,Kn,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let e=this._uploadUrl;this._resolveToken((t,r)=>{let i=dB(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,Kn,t,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let e=TP*this._chunkMultiplier,t=new aa(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=fB(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(u){this._error=u,this._transition("error");return}let a=this._ref.storage._makeRequest(o,Kn,i,s,!1);this._request=a,a.getPromise().then(u=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(u.current),u.finalized?(this._metadata=u.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){TP*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{let r=UP(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,Kn,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{let r=lB(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,Kn,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){let t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=PP(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let e=hE(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,i){let s=new gE(t||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){let t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(hE(this._state)){case It.SUCCESS:ra(this._resolve.bind(null,this.snapshot))();break;case It.CANCELED:case It.ERROR:let t=this._reject;ra(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(hE(this._state)){case It.RUNNING:case It.PAUSED:e.next&&ra(e.next.bind(e,this.snapshot))();break;case It.SUCCESS:e.complete&&ra(e.complete.bind(e))();break;case It.CANCELED:case It.ERROR:e.error&&ra(e.error.bind(e,this._error))();break;default:e.error&&ra(e.error.bind(e,this._error))()}}resume(){let e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){let e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){let e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}};var ua=class n{constructor(e,t){this._service=e,t instanceof kt?this._location=t:this._location=kt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new kt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return VP(this._location.path)}get storage(){return this._service}get parent(){let e=K2(this._location.path);if(e===null)return null;let t=new kt(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw vE(e)}};function pB(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new Zc(n,new oa(e),t)}function gB(n){let e={prefixes:[],items:[]};return $P(n,e).then(()=>e)}function $P(n,e,t){return R(this,null,function*(){let i=yield qP(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield $P(n,e,i.nextPageToken))})}function qP(n,e){e!=null&&typeof e.maxResults=="number"&&fE("options.maxResults",1,1e3,e.maxResults);let t=e||{},r=sB(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,Kn)}function mB(n){n._throwIfRoot("getMetadata");let e=UP(n.storage,n._location,Vf());return n.storage.makeRequestWithTokens(e,Kn)}function _B(n,e){n._throwIfRoot("updateMetadata");let t=aB(n.storage,n._location,e,Vf());return n.storage.makeRequestWithTokens(t,Kn)}function yB(n){n._throwIfRoot("getDownloadURL");let e=oB(n.storage,n._location,Vf());return n.storage.makeRequestWithTokens(e,Kn).then(t=>{if(t===null)throw S2();return t})}function vB(n){n._throwIfRoot("deleteObject");let e=uB(n.storage,n._location);return n.storage.makeRequestWithTokens(e,Kn)}function GP(n,e){let t=Q2(n._location.path,e),r=new kt(n._location.bucket,t);return new ua(n.storage,r)}function wB(n){return/^[A-Za-z]+:\/\//.test(n)}function EB(n,e){return new ua(n,e)}function zP(n,e){if(n instanceof el){let t=n;if(t._bucket==null)throw D2();let r=new ua(t,t._bucket);return e!=null?zP(r,e):r}else return e!==void 0?GP(n,e):n}function TB(n,e){if(e&&wB(e)){if(n instanceof el)return EB(n,e);throw ms("To use ref(service, url), the first argument must be a Storage instance.")}else return zP(n,e)}function CP(n,e){let t=e?.[SP];return t==null?null:kt.makeFromBucketSpec(t,n)}function IB(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Ms(i,n.app.options.projectId))}var el=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=bP,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=m2,this._maxUploadRetryTime=_2,this._requests=new Set,i!=null?this._bucket=kt.makeFromBucketSpec(i,this._host):this._bucket=CP(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=kt.makeFromBucketSpec(this._url,e):this._bucket=CP(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){fE("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){fE("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return R(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return R(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ua(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new dE(kP());{let o=U2(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return R(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},AP="@firebase/storage",DP="0.12.5";var WP="storage";function HP(n,e,t){return n=ne(n),pB(n,e,t)}function KP(n){return n=ne(n),mB(n)}function QP(n,e){return n=ne(n),_B(n,e)}function YP(n,e){return n=ne(n),qP(n,e)}function XP(n){return n=ne(n),gB(n)}function JP(n){return n=ne(n),yB(n)}function ZP(n){return n=ne(n),vB(n)}function AE(n,e){return n=ne(n),TB(n,e)}function eN(n,e){return GP(n,e)}function C9(n=ir(),e){n=ne(n);let r=bi(n,WP).getImmediate({identifier:e}),i=xs("storage");return i&&DE(r,...i),r}function DE(n,e,t,r={}){IB(n,e,t,r)}function CB(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new el(t,r,i,e,Fs)}function AB(){rr(new lt(WP,CB,"PUBLIC").setMultipleInstances(!0)),it(AP,DP,""),it(AP,DP,"esm2017")}AB();var la=class{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var Bf=class{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new la(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new la(r,this,this._ref))},t)}on(e,t,r,i){let s;return t&&(typeof t=="function"?s=o=>t(new la(o,this,this._ref)):s={next:t.next?o=>t.next(new la(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,r||void 0,i||void 0)}},jf=class{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new _s(e,this._service))}get items(){return this._delegate.items.map(e=>new _s(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var _s=class n{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){let t=eN(this._delegate,e);return new n(t,this.storage)}get root(){return new n(this._delegate.root,this.storage)}get parent(){let e=this._delegate.parent;return e==null?null:new n(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Bf(HP(this._delegate,e,t),this)}putString(e,t=Qt.RAW,r){this._throwIfRoot("putString");let i=EE(t,e),s=Object.assign({},r);return s.contentType==null&&i.contentType!=null&&(s.contentType=i.contentType),new Bf(new Zc(this._delegate,new oa(i.data,!0),s),this)}listAll(){return XP(this._delegate).then(e=>new jf(e,this.storage))}list(e){return YP(this._delegate,e||void 0).then(t=>new jf(t,this.storage))}getMetadata(){return KP(this._delegate)}updateMetadata(e){return QP(this._delegate,e)}getDownloadURL(){return JP(this._delegate)}delete(){return this._throwIfRoot("delete"),ZP(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw vE(e)}};var $f=class{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(tN(e))throw ms("ref() expected a child path but got a URL, use refFromURL instead.");return new _s(AE(this._delegate,e),this)}refFromURL(e){if(!tN(e))throw ms("refFromURL() expected a full URL but got a child path, use ref() instead.");try{kt.makeFromUrl(e,this._delegate.host)}catch{throw ms("refFromUrl() expected a valid full URL but got an invalid one.")}return new _s(AE(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){DE(this._delegate,e,t,r)}};function tN(n){return/^[A-Za-z]+:\/\//.test(n)}var DB="@firebase/storage-compat",bB="0.3.8";var SB="storage-compat";function RB(n,{instanceIdentifier:e}){let t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new $f(t,r)}function PB(n){let e={TaskState:It,TaskEvent:jP,StringFormat:Qt,Storage:$f,Reference:_s};n.INTERNAL.registerComponent(new lt(SB,RB,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(DB,bB)}PB(Ve);function NB(n){return new Lt(e=>{let t=o=>e.next(o),r=o=>e.error(o),i=()=>e.complete();t(n.snapshot);let s=n.on("state_changed",t);return n.then(o=>{t(o),i()},o=>{t(n.snapshot),r(o)}),function(){s()}}).pipe(F0(0))}function nN(n){let e=NB(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>e,percentageChanges:()=>e.pipe(H(t=>t.bytesTransferred/t.totalBytes*100))}}function qf(n){return{getDownloadURL:()=>W(void 0).pipe(em,Ie(()=>n.getDownloadURL()),Ne),getMetadata:()=>W(void 0).pipe(em,Ie(()=>n.getMetadata()),Ne),delete:()=>Ee(n.delete()),child:e=>qf(n.child(e)),updateMetadata:e=>Ee(n.updateMetadata(e)),put:(e,t)=>{let r=n.put(e,t);return nN(r)},putString:(e,t,r)=>{let i=n.putString(e,t,r);return nN(i)},list:e=>Ee(n.list(e)),listAll:()=>Ee(n.listAll())}}var kB=new J("angularfire2.storageBucket"),xB=new J("angularfire2.storage.maxUploadRetryTime"),MB=new J("angularfire2.storage.maxOperationRetryTime"),FB=new J("angularfire2.storage.use-emulator"),rN=(()=>{class n{storage;constructor(t,r,i,s,o,a,u,l,h,f){let g=cr(t,o,r);this.storage=$r(`${g.name}.storage.${i}`,"AngularFireStorage",g.name,()=>{let _=o.runOutsideAngular(()=>g.storage(i||void 0)),E=h;return E&&_.useEmulator(...E),u&&_.setMaxUploadRetryTime(u),l&&_.setMaxOperationRetryTime(l),_},[u,l])}ref(t){return qf(this.storage.ref(t))}refFromURL(t){return qf(this.storage.refFromURL(t))}upload(t,r,i){let s=this.storage.ref(t);return qf(s).put(r,i)}static \u0275fac=function(r){return new(r||n)(V(Nn),V(kn,8),V(kB,8),V(Ke),V(Oe),V(Pn),V(xB,8),V(MB,8),V(FB,8),V(pn,8))};static \u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Q9=(()=>{let e=class e{constructor(r,i,s,o){this.auth=r,this.firestore=i,this.db=s,this.storage=o,this.PATH="Usuarios",this.loguado=!1,this.esAdmin=!1,this.items$=this.db.list(this.PATH).valueChanges()}getAll(){return this.items$}registrar(r){return R(this,null,function*(){let{mail:i,contrase\u00F1a:s,imagenes:o}=r,u=(yield this.auth.createUserWithEmailAndPassword(i,s)).user?.uid;if(u){let l=Array.isArray(o)?o.map(f=>new File([f],f)):[new File([o],o)],h=yield this.uploadImages(l,u);yield this.firestore.collection(this.PATH).doc(u).set(de(G({},r),{uid:u,imagenes:h}))}})}uploadImages(r,i){return R(this,null,function*(){let s=r.map((o,a)=>{let u=`users/${i}/profile_${a}`;return this.storage.upload(u,o).then(()=>this.storage.ref(u).getDownloadURL().toPromise())});return Promise.all(s)})}login(r,i){return R(this,null,function*(){try{let s=yield this.auth.signInWithEmailAndPassword(r,i);yield this.updateLastLogin(s.user.uid)}catch(s){throw console.error("Error de inicio de sesi\xF3n:",s),s}})}loginWithGoogle(){return R(this,null,function*(){try{let r=new jp,i=yield this.auth.signInWithPopup(r);yield this.updateLastLogin(i.user.uid)}catch(r){throw console.error("Error de inicio de sesi\xF3n con Google:",r),r}})}updateLastLogin(r){return R(this,null,function*(){let i=new Date;yield this.firestore.collection(this.PATH).doc(r).update({lastLogin:i})})}guardarUsuarioFirestore(r,i,s){return R(this,null,function*(){yield this.firestore.collection(this.PATH).doc(r).set({nombre:i,email:s,lastLogin:Ve.firestore.FieldValue.serverTimestamp()})})}logout(){return R(this,null,function*(){try{yield this.auth.signOut()}catch(r){throw console.error("Error al cerrar sesi\xF3n:",r),r}})}estaLogueado(){return this.auth.currentUser!==null}usuarioActual(){return new Promise((r,i)=>{this.auth.onAuthStateChanged(s=>{s?this.firestore.collection(this.PATH).doc(s.uid).valueChanges().subscribe(o=>{o?(o.lastLogin=o.lastLogin?o.lastLogin.toDate():null,r(new vu(o.nombre,o.apellido,o.dni,o.edad,o.obraSocial,o.especialidad,"",o.mail,o.imagenes,o.code,o.lastLogin))):i("No se encontr\xF3 el usuario en la base de datos")},o=>i(o)):i("No hay un usuario logueado")})})}getCurrentUser(){return this.auth.authState}getCurrentUserName(){return this.auth.authState.pipe(Ie(r=>r?this.firestore.collection(this.PATH).doc(r.uid).valueChanges().pipe(Ie(i=>W(i?.nombre||null))):W(null)))}verificarMensajeExistenteAlIniciarSesion(){return R(this,null,function*(){let r=Ve.auth().currentUser;if(!r){console.error("Usuario no autenticado al verificar el mensaje existente al iniciar sesi\xF3n");return}let i=yield this.firestore.collection("messages").ref.where("userEmail","==",r.email).get();if(i.empty){console.log("No hay mensajes existentes para este usuario al iniciar sesi\xF3n");return}let s=this.firestore.firestore.batch();i.forEach(o=>{s.delete(o.ref)}),yield s.commit(),console.log("Mensajes existentes eliminados para este usuario al iniciar sesi\xF3n")})}getAllUsers(){return this.firestore.collection(this.PATH).snapshotChanges().pipe(H(r=>r.map(i=>{let s=i.payload.doc.data();return new vu(s.nombre,s.apellido,s.dni,s.edad,s.obraSocial,s.especialidad,"",s.mail,s.imagenes,s.code,s.lastLogin?s.lastLogin.toDate():null)})))}};e.\u0275fac=function(i){return new(i||e)(V(Xs),V(pv),V(yP),V(rN))},e.\u0275prov=te({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{cj as a,lj as b,WN as c,Ij as d,e$ as e,fx as f,jg as g,N$ as h,k$ as i,xM as j,kI as k,EI as l,X$ as m,J$ as n,iF as o,aF as p,eq as q,cF as r,hF as s,fF as t,eC as u,tq as v,nq as w,rq as x,iq as y,sq as z,vu as A,gn as B,rG as C,TF as D,pn as E,Pn as F,wu as G,tm as H,gG as I,WG as J,Ez as K,zz as L,Xz as M,C9 as N,Q9 as O};
