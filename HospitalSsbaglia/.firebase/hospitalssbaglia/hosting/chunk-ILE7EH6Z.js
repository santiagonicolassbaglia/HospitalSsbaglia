import{a as J}from"./chunk-U4O4KU6Q.js";import{a as U}from"./chunk-MFCKY6MA.js";import{b as N,d as j,e as B,f as A,g as R,h as G,q,s as Y}from"./chunk-WQDWLB3F.js";import{d as L}from"./chunk-Q3TEWXKA.js";import{h as H,i as W,k as z}from"./chunk-TQDNXVMP.js";import{$a as g,Ga as c,Ha as M,Ua as v,Wa as _,Ya as r,Za as a,cb as C,db as l,eb as w,fa as P,fb as d,hb as E,ia as F,jb as h,kb as x,lb as b,nb as k,pa as p,pb as V,qa as u,rb as D,sb as O}from"./chunk-75HCPL27.js";import{j as T}from"./chunk-GLKGYJID.js";var K=(()=>{let s=class s{transform(e,t="fechaHora",n="asc"){return!e||e.length===0?[]:(e.sort((m,f)=>{let S=new Date(m[t]).getTime(),y=new Date(f[t]).getTime();return n==="asc"?S-y:y-S}),e)}};s.\u0275fac=function(t){return new(t||s)},s.\u0275pipe=F({name:"ordenarTurnos",type:s,pure:!0,standalone:!0});let o=s;return o})();function X(o,s){if(o&1){let i=g();r(0,"button",9),C("click",function(){p(i);let t=l().$implicit,n=l();return u(n.cancelarTurno(t,"Raz\xF3n de cancelaci\xF3n"))}),d(1,"Cancelar Turno"),a()}}function Z(o,s){if(o&1){let i=g();r(0,"button",9),C("click",function(){p(i);let t=l().$implicit,n=l();return u(n.rechazarTurno(t,"Raz\xF3n de rechazo"))}),d(1,"Rechazar Turno"),a()}}function $(o,s){if(o&1){let i=g();r(0,"button",9),C("click",function(){p(i);let t=l().$implicit,n=l();return u(n.aceptarTurno(t))}),d(1,"Aceptar Turno"),a()}}function ee(o,s){if(o&1){let i=g();r(0,"button",10),C("click",function(){p(i);let t=l().$implicit,n=l();return u(n.mostrarFormularioHistoriaClinica(t))}),d(1,"Finalizar Turno"),a()}}function te(o,s){if(o&1){let i=g();r(0,"button",11),C("click",function(){p(i);let t=l().$implicit,n=l();return u(n.verResenia(t))}),d(1,"Ver Rese\xF1a"),a()}}function ie(o,s){if(o&1){let i=g();r(0,"div")(1,"p"),d(2),a(),r(3,"button",11),C("click",function(){p(i);let t=l().$implicit;return u(t.mostrarresenia=!1)}),d(4,"Ocultar Rese\xF1a"),a()()}if(o&2){let i=l().$implicit;c(2),E("Rese\xF1a: ",i.comentario,"")}}function ne(o,s){if(o&1&&(r(0,"div",4)(1,"p"),d(2),a(),r(3,"p"),d(4),a(),r(5,"p"),d(6),V(7,"date"),a(),r(8,"p"),d(9),a(),v(10,X,2,0,"button",5)(11,Z,2,0,"button",5)(12,$,2,0,"button",5)(13,ee,2,0,"button",6)(14,te,2,0,"button",7)(15,ie,5,1,"div",8),a()),o&2){let i=s.$implicit;c(2),E("Especialidad: ",i.especialidad,""),c(2),E("Paciente: ",i.pacienteNombre,""),c(2),E("Fecha y Hora: ",D(7,10,i.fechaHora,"short")," "),c(3),E("Estado: ",i.estado,""),c(),_("ngIf",i.estado!=="realizado"&&i.estado!=="cancelado"),c(),_("ngIf",i.estado==="pendiente"),c(),_("ngIf",i.estado==="pendiente"),c(),_("ngIf",i.estado==="confirmado"),c(),_("ngIf",i.comentario&&!i.mostrarresenia),c(),_("ngIf",i.mostrarresenia)}}function oe(o,s){if(o&1){let i=g();r(0,"button",11),C("click",function(){p(i);let t=l().index,n=l(2);return u(n.eliminarDatoDinamico(t))}),d(1,"Eliminar"),a()}}function ae(o,s){if(o&1){let i=g();r(0,"div")(1,"label",25),d(2,"Clave:"),a(),r(3,"input",26),b("ngModelChange",function(t){let n=p(i).$implicit;return x(n.clave,t)||(n.clave=t),u(t)}),a(),r(4,"label",25),d(5,"Valor:"),a(),r(6,"input",26),b("ngModelChange",function(t){let n=p(i).$implicit;return x(n.valor,t)||(n.valor=t),u(t)}),a(),v(7,oe,2,0,"button",7),a()}if(o&2){let i=s.$implicit,e=s.index,t=l(2);c(),w("for","clave-",e,""),c(2),w("id","clave-",e,""),w("name","clave-",e,""),h("ngModel",i.clave),c(),w("for","valor-",e,""),c(2),w("id","valor-",e,""),w("name","valor-",e,""),h("ngModel",i.valor),c(),_("ngIf",t.datosClinicos.dinamicos.length>1)}}function re(o,s){if(o&1){let i=g();r(0,"button",11),C("click",function(){p(i);let t=l(2);return u(t.agregarDatoDinamico())}),d(1,"Agregar Dato Din\xE1mico"),a()}}function se(o,s){o&1&&(r(0,"div",27)(1,"p"),d(2,"Historia Cl\xEDnica guardada correctamente."),a()())}function ce(o,s){if(o&1){let i=g();r(0,"div",12)(1,"h3"),d(2,"Datos de Historia Cl\xEDnica"),a(),r(3,"form",13),C("ngSubmit",function(){p(i);let t=l();return u(t.finalizarTurno())}),r(4,"label",14),d(5,"Altura:"),a(),r(6,"input",15),b("ngModelChange",function(t){p(i);let n=l();return x(n.datosClinicos.altura,t)||(n.datosClinicos.altura=t),u(t)}),a(),r(7,"label",16),d(8,"Peso:"),a(),r(9,"input",17),b("ngModelChange",function(t){p(i);let n=l();return x(n.datosClinicos.peso,t)||(n.datosClinicos.peso=t),u(t)}),a(),r(10,"label",18),d(11,"Temperatura:"),a(),r(12,"input",19),b("ngModelChange",function(t){p(i);let n=l();return x(n.datosClinicos.temperatura,t)||(n.datosClinicos.temperatura=t),u(t)}),a(),r(13,"label",20),d(14,"Presi\xF3n:"),a(),r(15,"input",21),b("ngModelChange",function(t){p(i);let n=l();return x(n.datosClinicos.presion,t)||(n.datosClinicos.presion=t),u(t)}),a(),v(16,ae,8,15,"div",22)(17,re,2,0,"button",7),r(18,"button",23),d(19,"Guardar Historia Cl\xEDnica y Finalizar Turno"),a(),v(20,se,3,0,"div",24),a()()}if(o&2){let i=l();c(6),h("ngModel",i.datosClinicos.altura),c(3),h("ngModel",i.datosClinicos.peso),c(3),h("ngModel",i.datosClinicos.temperatura),c(3),h("ngModel",i.datosClinicos.presion),c(),_("ngForOf",i.datosClinicos.dinamicos),c(),_("ngIf",i.datosClinicos.dinamicos.length<3),c(3),_("ngIf",i.mensajeExito)}}var fe=(()=>{let s=class s{constructor(e,t,n){this.authService=e,this.turnoService=t,this.historiaClinicaService=n,this.turnos=[],this.turnosFiltrados=[],this.especialidades=[],this.pacientes=[],this.filtroEspecialidad="",this.filtroPaciente="",this.mostrarFormulario=!1,this.turnoSeleccionado=null,this.filtroGeneral="",this.mensajeExito=!1,this.datosClinicos={altura:"",peso:"",temperatura:"",presion:"",dinamicos:[{clave:"",valor:""}]}}ngOnInit(){return T(this,null,function*(){let e=yield this.authService.usuarioActual();this.turnoService.getTurnosByEspecialista(e.uid).subscribe(t=>{this.turnoService.cargarHistoriasClinicas(t).subscribe(n=>{this.turnos=n.map(m=>(m.fechaHora=this.convertTimestampToDate(m.fechaHora),m)).sort((m,f)=>m.fechaHora.getTime()-f.fechaHora.getTime()),this.turnosFiltrados=this.turnos,this.obtenerEspecialidadesYPacientes(this.turnos)})})})}convertTimestampToDate(e){return e instanceof Date?e:e.toDate()}obtenerEspecialidadesYPacientes(e){let t=new Set,n=new Set;e.forEach(m=>{t.add(m.especialidad),n.add({id:m.pacienteId,nombre:m.pacienteNombre})}),this.especialidades=Array.from(t),this.pacientes=Array.from(n)}aplicarFiltro(){this.turnosFiltrados=this.turnos.filter(e=>this.buscarEnTurno(e,this.filtroGeneral))}cancelarTurno(e,t){return T(this,null,function*(){e.estado!=="realizado"&&e.estado!=="cancelado"&&(e.estado="cancelado",e.comentario=t,yield this.turnoService.actualizarTurno(e))})}rechazarTurno(e,t){return T(this,null,function*(){e.estado==="pendiente"&&(e.estado="cancelado",e.comentario=t,yield this.turnoService.actualizarTurno(e))})}aceptarTurno(e){return T(this,null,function*(){e.estado==="pendiente"&&(e.estado="confirmado",e.historiaClinica||(e.historiaClinica={id:"",turnoId:e.id,pacienteId:e.pacienteId,especialistaId:e.especialistaId,fecha:new Date,altura:null,peso:null,temperatura:null,presion:"",nombrePaciente:e.pacienteNombre,nombreEspecialista:e.especialistaNombre,especialidad:e.especialidad,datosDinamicos:[{clave:"",valor:""}]}),yield this.turnoService.actualizarTurno(e))})}mostrarFormularioHistoriaClinica(e){this.turnoSeleccionado=e,this.mostrarFormulario=!0}agregarDatoDinamico(){this.datosClinicos.dinamicos.length<3&&this.datosClinicos.dinamicos.push({clave:"",valor:""})}eliminarDatoDinamico(e){this.datosClinicos.dinamicos.length>1&&this.datosClinicos.dinamicos.splice(e,1)}finalizarTurno(){return T(this,null,function*(){if(this.turnoSeleccionado){this.mensajeExito=!0,this.turnoSeleccionado.estado="realizado",yield this.turnoService.actualizarTurno(this.turnoSeleccionado);let e={id:"",turnoId:this.turnoSeleccionado.id,pacienteId:this.turnoSeleccionado.pacienteId,especialistaId:this.turnoSeleccionado.especialistaId,fecha:new Date,altura:this.datosClinicos.altura,peso:this.datosClinicos.peso,temperatura:this.datosClinicos.temperatura,presion:this.datosClinicos.presion,nombrePaciente:this.turnoSeleccionado.pacienteNombre,nombreEspecialista:this.turnoSeleccionado.especialistaNombre,especialidad:this.turnoSeleccionado.especialidad,datosDinamicos:this.datosClinicos.dinamicos};yield this.historiaClinicaService.agregarHistoriaClinica(e),this.mostrarFormulario=!1,this.turnoSeleccionado=null,this.datosClinicos={altura:"",peso:"",temperatura:"",presion:"",dinamicos:[{clave:"",valor:""}]}}})}verResenia(e){(e.estado==="realizado"||e.estado==="cancelado")&&(e.mostrarresenia=!e.mostrarresenia,e.mostrarresenia&&!e.comentario&&this.turnoService.obtenerComentario(e.id).subscribe(t=>{e.comentario=t||"No hay rese\xF1a"}))}buscarEnTurno(e,t){if(!t||(t=t.toLowerCase(),e.especialidad.toLowerCase().includes(t)||e.pacienteNombre.toLowerCase().includes(t)||e.estado.toLowerCase().includes(t)||e.fechaHora.toString().toLowerCase().includes(t)))return!0;if(e.historiaClinica){let{altura:n,peso:m,temperatura:f,presion:S,datosDinamicos:y}=e.historiaClinica;if(n.toString().includes(t)||m.toString().includes(t)||f.toString().includes(t)||S.toLowerCase().includes(t)||y.some(I=>I.clave.toLowerCase().includes(t)||I.valor.toLowerCase().includes(t)))return!0}return!1}};s.\u0275fac=function(t){return new(t||s)(M(L),M(U),M(J))},s.\u0275cmp=P({type:s,selectors:[["app-turnos-especialista"]],standalone:!0,features:[k],decls:5,vars:7,consts:[[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],["class","turno",4,"ngFor","ngForOf"],["class","formulario-historia-clinica ",4,"ngIf"],[1,"turno"],["style","margin-left: 1rem;",3,"click",4,"ngIf"],["style","margin-left: 1rem;","class","bajarPantallaoPagina",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],[4,"ngIf"],[2,"margin-left","1rem",3,"click"],[1,"bajarPantallaoPagina",2,"margin-left","1rem",3,"click"],[3,"click"],[1,"formulario-historia-clinica"],[1,"scroll-down",3,"ngSubmit"],["for","altura"],["id","altura","name","altura","required","",1,"inputHistoriaClinica",3,"ngModelChange","ngModel"],["for","peso"],["id","peso","name","peso","required","",1,"inputHistoriaClinica",3,"ngModelChange","ngModel"],["for","temperatura"],["id","temperatura","name","temperatura","required","",1,"inputHistoriaClinica",3,"ngModelChange","ngModel"],["for","presion"],["id","presion","name","presion","required","",1,"inputHistoriaClinica",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["type","submit",2,"margin-left","1rem"],["class","mensaje-exito",4,"ngIf"],[3,"for"],["required","",1,"inputHistoriaClinica",3,"ngModelChange","id","ngModel","name"],[1,"mensaje-exito"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"input",1),b("ngModelChange",function(f){return x(n.filtroGeneral,f)||(n.filtroGeneral=f),f}),C("input",function(){return n.aplicarFiltro()}),a()(),v(2,ne,16,13,"div",2),V(3,"ordenarTurnos"),v(4,ce,21,7,"div",3)),t&2&&(c(),h("ngModel",n.filtroGeneral),c(),_("ngForOf",O(3,3,n.turnosFiltrados,"fechaHora","desc")),c(2),_("ngIf",n.mostrarFormulario))},dependencies:[W,H,Y,G,N,j,B,q,R,A,z,K],styles:["h2[_ngcontent-%COMP%]{color:#2c3e50;text-align:center;margin-bottom:20px}div[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}input[type=text][_ngcontent-%COMP%]{width:calc(100% - 22px);padding:10px;margin-bottom:10px;border:1px solid #bdc3c7;border-radius:4px}.turno[_ngcontent-%COMP%]{background-color:#ecf0f1;border-left:5px solid #3498db;padding:15px;margin-bottom:20px;border-radius:4px}.turno[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#34495e}button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#2980b9}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:#0006}.modal-content[_ngcontent-%COMP%]{background-color:#fefefe;margin:auto;padding:20px;border-radius:4px;width:80%;max-width:500px}.close[_ngcontent-%COMP%]{color:#aaa;float:right;font-size:28px;font-weight:700}.close[_ngcontent-%COMP%]:hover, .close[_ngcontent-%COMP%]:focus{color:#000;text-decoration:none;cursor:pointer}formulario-historia-clinica[_ngcontent-%COMP%]{display:block;border:#3498db;padding:15px;margin-bottom:20px;border-radius:4px;width:100%;overflow-y:auto;height:100%}.inputHistoriaClinica[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #bdc3c7;border-radius:4px;height:100%;margin-top:10px;margin-bottom:10px;margin-left:10px}.scroll-down[_ngcontent-%COMP%]{scroll-behavior:smooth;overflow-y:scroll}.mensaje-exito[_ngcontent-%COMP%]{color:green;font-weight:700;text-align:center;margin-bottom:20px;margin-left:1rem}.bajarPantallaoPagina[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#0b7a7a;border:1px solid #0b7a7a;border-radius:5px;padding:5px 10px;cursor:pointer}"]});let o=s;return o})();export{fe as a};
