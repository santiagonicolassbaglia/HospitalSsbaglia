import{a as K}from"./chunk-Q7FLMN77.js";import{a as q}from"./chunk-U4O4KU6Q.js";import{a as J,d as ti}from"./chunk-ZNPDZJIK.js";import{b as U,d as z,g as N,n as W,o as R,p as B,s as G}from"./chunk-WQDWLB3F.js";import{d as L}from"./chunk-Q3TEWXKA.js";import{y as j}from"./chunk-W5EYEMU2.js";import{h as k,i as A,k as $}from"./chunk-TQDNXVMP.js";import{$a as v,Da as F,Ga as s,Ha as x,Ua as u,Wa as m,Y as w,Ya as l,Za as n,_a as E,ba as O,cb as h,db as _,fa as I,fb as a,hb as d,ib as H,jb as C,kb as b,lb as P,nb as D,pa as g,pb as T,qa as f,rb as V}from"./chunk-75HCPL27.js";import{a as M,b as y}from"./chunk-GLKGYJID.js";ti();var Q=(()=>{let c=class c{constructor(t){this.firestore=t,this.usuariosCollection="Usuarios",this.filtrarHistoriasClinicasPorEspecialidad=(i,o)=>i.filter(p=>p.especialidad===o)}getUsuario(t){return this.firestore.collection(this.usuariosCollection).doc(t).valueChanges()}actualizarUsuario(t){return this.firestore.collection(this.usuariosCollection).doc(t.uid).update(t)}};c.\u0275fac=function(i){return new(i||c)(O(j))},c.\u0275prov=w({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();function ai(r,c){if(r&1&&(l(0,"li"),a(1),n()),r&2){let e=c.$implicit;s(),H(" ",e.inicio," - ",e.fin," ")}}function oi(r,c){if(r&1&&(l(0,"li")(1,"strong"),a(2),n(),l(3,"ul"),u(4,ai,2,2,"li",3),n()()),r&2){let e=c.$implicit;s(2),d("",e.dia,":"),s(2),m("ngForOf",e.horarios)}}function si(r,c){if(r&1&&(l(0,"div")(1,"p")(2,"strong"),a(3,"Especialidades:"),n(),a(4),n(),l(5,"p")(6,"strong"),a(7,"Horarios:"),n()(),l(8,"ul"),u(9,oi,5,2,"li",3),n()()),r&2){let e=_(2);s(4),d(" ",e.usuario.especialidad.join(", "),""),s(5),m("ngForOf",e.disponibilidadHoraria)}}function li(r,c){if(r&1&&(l(0,"div"),E(1,"img",4),n()),r&2){let e=c.$implicit;s(),m("src",e,F)}}function ci(r,c){if(r&1&&(l(0,"div"),u(1,li,2,1,"div",3),n()),r&2){let e=_(2);s(),m("ngForOf",e.imagenes)}}function di(r,c){if(r&1){let e=v();l(0,"div")(1,"input",7),P("ngModelChange",function(i){let o=g(e).index,p=_().$implicit;return b(p.horarios[o].inicio,i)||(p.horarios[o].inicio=i),f(i)}),n(),l(2,"input",7),P("ngModelChange",function(i){let o=g(e).index,p=_().$implicit;return b(p.horarios[o].fin,i)||(p.horarios[o].fin=i),f(i)}),n(),l(3,"button",6),h("click",function(){let i=g(e).index,o=_().index,p=_(3);return f(p.eliminarHorario(o,i))}),a(4,"Eliminar Horario"),n()()}if(r&2){let e=c.index,t=_().$implicit;s(),C("ngModel",t.horarios[e].inicio),s(),C("ngModel",t.horarios[e].fin)}}function pi(r,c){if(r&1){let e=v();l(0,"div")(1,"p")(2,"strong"),a(3),n()(),u(4,di,5,2,"div",3),l(5,"button",6),h("click",function(){let i=g(e).index,o=_(3);return f(o.agregarHorario(i))}),a(6,"Agregar Horario"),n()()}if(r&2){let e=c.$implicit;s(3),d("",e.dia,":"),s(),m("ngForOf",e.horarios)}}function mi(r,c){if(r&1){let e=v();l(0,"div")(1,"h3"),a(2,"Mis Horarios"),n(),u(3,pi,7,2,"div",3),E(4,"br")(5,"br")(6,"br"),l(7,"button",5),h("click",function(){g(e);let i=_(2);return f(i.guardarDisponibilidad())}),a(8,"Guardar Disponibilidad"),n()()}if(r&2){let e=_(2);s(3),m("ngForOf",e.disponibilidadHoraria)}}function _i(r,c){if(r&1&&(l(0,"option",13),a(1),n()),r&2){let e=c.$implicit;m("value",e),s(),d(" ",e," ")}}function ui(r,c){if(r&1&&(l(0,"div",16)(1,"p")(2,"strong"),a(3),n(),a(4),n()()),r&2){let e=c.$implicit;s(3),d("",e.clave,":"),s(),d(" ",e.valor,"")}}function gi(r,c){if(r&1&&(l(0,"div",14)(1,"p")(2,"strong"),a(3,"Fecha:"),n(),a(4),T(5,"date"),n(),l(6,"p")(7,"strong"),a(8,"Altura:"),n(),a(9),n(),l(10,"p")(11,"strong"),a(12,"Peso:"),n(),a(13),n(),l(14,"p")(15,"strong"),a(16,"Temperatura:"),n(),a(17),n(),l(18,"p")(19,"strong"),a(20,"Presi\xF3n:"),n(),a(21),n(),l(22,"p")(23,"strong"),a(24,"Especialidad:"),n(),a(25),n(),u(26,ui,5,2,"div",15),n()),r&2){let e=c.$implicit;s(4),d(" ",V(5,7,e.fecha,"short"),""),s(5),d(" ",e.altura," cm"),s(4),d(" ",e.peso," kg"),s(4),d(" ",e.temperatura," \xB0C"),s(4),d(" ",e.presion,""),s(4),d(" ",e.especialidad,""),s(),m("ngForOf",e.datosDinamicos)}}function fi(r,c){if(r&1){let e=v();l(0,"div")(1,"div")(2,"h3"),a(3,"Seleccionar Especialidad"),n(),l(4,"select",8),P("ngModelChange",function(i){g(e);let o=_(2);return b(o.especialidadSeleccionada,i)||(o.especialidadSeleccionada=i),f(i)}),h("change",function(){g(e);let i=_(2);return f(i.filtrarHistoriasClinicas())}),l(5,"option",9),a(6,"Todas las especialidades"),n(),u(7,_i,2,2,"option",10),n()(),l(8,"div",11)(9,"h3"),a(10,"Historias Cl\xEDnicas"),n(),u(11,gi,27,10,"div",12),n(),l(12,"button",6),h("click",function(){g(e);let i=_(2);return f(i.generatePDF())}),a(13,"Descargar Historia Cl\xEDnica en PDF"),n()()}if(r&2){let e=_(2);s(4),C("ngModel",e.especialidadSeleccionada),s(3),m("ngForOf",e.especialidades),s(4),m("ngForOf",e.historiasClinicasFiltradas)}}function hi(r,c){if(r&1&&(l(0,"div",1)(1,"h2"),a(2,"Mi Perfil"),n(),l(3,"div")(4,"p")(5,"strong"),a(6,"Nombre:"),n(),a(7),n(),l(8,"p")(9,"strong"),a(10,"Apellido:"),n(),a(11),n(),l(12,"p")(13,"strong"),a(14,"DNI:"),n(),a(15),n(),l(16,"p")(17,"strong"),a(18,"Edad:"),n(),a(19),n(),l(20,"p")(21,"strong"),a(22,"Obra Social:"),n(),a(23),n(),l(24,"p")(25,"strong"),a(26,"Correo Electr\xF3nico:"),n(),a(27),n(),u(28,si,10,2,"div",2)(29,ci,2,1,"div",2)(30,mi,9,1,"div",2),n(),u(31,fi,14,3,"div",2),n()),r&2){let e=_();s(7),d(" ",e.usuario.nombre,""),s(4),d(" ",e.usuario.apellido,""),s(4),d(" ",e.usuario.dni,""),s(4),d(" ",e.usuario.edad,""),s(4),d(" ",e.usuario.obraSocial||"No especificada",""),s(4),d(" ",e.usuario.mail,""),s(),m("ngIf",e.esEspecialista),s(),m("ngIf",e.imagenes.length),s(),m("ngIf",e.esEspecialista),s(),m("ngIf",!e.esEspecialista)}}var Ai=(()=>{let c=class c{constructor(t,i,o,p){this.authService=t,this.usuarioService=i,this.especialistaService=o,this.historiaClinicaService=p,this.esEspecialista=!1,this.disponibilidadHoraria=[],this.imagenes=[],this.historiasClinicas=[],this.historiasClinicasFiltradas=[],this.especialidades=[],this.especialidadSeleccionada=""}ngOnInit(){this.authService.getCurrentUser().subscribe(t=>{t&&this.usuarioService.getUsuario(t.uid).subscribe(i=>{this.usuario=i,i&&(this.imagenes=this.obtenerURLsImagenes(i.imagenes)),i&&i.especialidad.length>0&&(this.esEspecialista=!0,this.cargarDisponibilidadHoraria(t.uid)),i&&this.cargarHistoriasClinicas(i.uid)})})}cargarDisponibilidadHoraria(t){this.especialistaService.getDisponibilidad(t).subscribe(i=>{this.disponibilidadHoraria=i.length?i:this.inicializarDisponibilidad()})}inicializarDisponibilidad(){return[{dia:"Lunes",horarios:[]},{dia:"Martes",horarios:[]},{dia:"Mi\xE9rcoles",horarios:[]},{dia:"Jueves",horarios:[]},{dia:"Viernes",horarios:[]},{dia:"S\xE1bado",horarios:[]},{dia:"Domingo",horarios:[]}]}obtenerURLsImagenes(t){return t.map(i=>typeof i=="string"?i:URL.createObjectURL(i))}actualizarPerfil(){this.usuario&&this.usuarioService.actualizarUsuario(this.usuario).then(()=>{console.log("Perfil actualizado correctamente.")}).catch(t=>{console.error("Error al actualizar perfil:",t)})}agregarHorario(t){this.disponibilidadHoraria[t].horarios||(this.disponibilidadHoraria[t].horarios=[]),this.disponibilidadHoraria[t].horarios.push({inicio:"",fin:""})}eliminarHorario(t,i){this.disponibilidadHoraria[t].horarios.splice(i,1)}guardarDisponibilidad(){this.usuario&&this.usuario.uid&&(this.disponibilidadHoraria.every(i=>i.horarios.every(o=>o.inicio&&o.fin))?this.especialistaService.guardarDisponibilidad(this.usuario.uid,this.disponibilidadHoraria).then(()=>{console.log("Disponibilidad horaria guardada correctamente."),this.cargarDisponibilidadHoraria(this.usuario.uid)}).catch(i=>{console.error("Error al guardar disponibilidad horaria:",i)}):console.error("Error: Algunos horarios no est\xE1n completos."))}convertirTimestampAFecha(t){return y(M({},t),{fecha:t.fecha.toDate()})}cargarHistoriasClinicas(t){this.historiaClinicaService.obtenerHistoriasPorPaciente(t).subscribe(i=>{this.historiasClinicas=i.map(o=>{let p=M({id:o.payload.doc.id},o.payload.doc.data()),S=this.convertirTimestampAFecha(p),{fecha:X,altura:Y,peso:Z,temperatura:ii,presion:ei,especialidad:xi}=S;return X&&Y&&Z&&ii&&ei?S:null}).filter(o=>o!==null),this.especialidades=[...new Set(this.historiasClinicas.map(o=>o.especialidad))],this.filtrarHistoriasClinicas()})}filtrarHistoriasClinicas(){this.especialidadSeleccionada?this.historiasClinicasFiltradas=this.historiasClinicas.filter(t=>t.especialidad===this.especialidadSeleccionada):this.historiasClinicasFiltradas=[...this.historiasClinicas],this.historiaClinicaReciente=this.historiasClinicasFiltradas.reduce((t,i)=>!t||i.fecha>t.fecha?i:t,void 0)}generatePDF(){let t=new J,i=10;t.text("Historia Cl\xEDnica",10,i),i+=10,this.historiasClinicasFiltradas.forEach(o=>{t.text(`Fecha: ${new Date(o.fecha).toLocaleString()}`,10,i),i+=10,t.text(`Altura: ${o.altura} cm`,10,i),i+=10,t.text(`Peso: ${o.peso} kg`,10,i),i+=10,t.text(`Temperatura: ${o.temperatura} \xB0C`,10,i),i+=10,t.text(`Presi\xF3n: ${o.presion}`,10,i),i+=10,t.text(`Especialidad: ${o.especialidad}`,10,i),i+=10,o.datosDinamicos.forEach(p=>{t.text(`${p.clave}: ${p.valor}`,10,i),i+=10}),i+=10}),t.save("historia_clinica.pdf")}};c.\u0275fac=function(i){return new(i||c)(x(L),x(Q),x(K),x(q))},c.\u0275cmp=I({type:c,selectors:[["app-mi-perfil"]],standalone:!0,features:[D],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[4,"ngIf"],[4,"ngFor","ngForOf"],["alt","Imagen",2,"width","50rem","height","48rem",3,"src"],[2,"color","chartreuse",3,"click"],[3,"click"],["type","time",3,"ngModelChange","ngModel"],[3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"historias-clinicas"],["class","historia-clinica",4,"ngFor","ngForOf"],[3,"value"],[1,"historia-clinica"],["class","datos-dinamicos",4,"ngFor","ngForOf"],[1,"datos-dinamicos"]],template:function(i,o){i&1&&u(0,hi,32,10,"div",0),i&2&&m("ngIf",o.usuario)},dependencies:[A,k,G,R,B,U,W,z,N,$],styles:[".container[_ngcontent-%COMP%]{margin:0 auto;padding:20px;max-width:800px;font-family:Arial,sans-serif;background-color:#f9f9f9;border-radius:8px;box-shadow:0 4px 8px #0000001a}h2[_ngcontent-%COMP%]{color:#333;text-align:center;margin-bottom:20px}h3[_ngcontent-%COMP%]{color:#555;margin-top:30px}.profile-details[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:20px}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{flex:1 1 45%;margin:0;color:#555}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}.images-section[_ngcontent-%COMP%]{margin-top:20px}.images-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 10px;color:#555}.images-section[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;border-radius:8px;margin:5px;box-shadow:0 2px 4px #0000001a}.imagen-container[_ngcontent-%COMP%]{display:inline-block;margin:10px}.availability-section[_ngcontent-%COMP%]{margin-top:20px}.availability-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#555}.availability-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}button[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 20px;margin-top:20px;font-size:16px;color:#fff;background-color:#007bff;border:none;border-radius:8px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.historias-clinicas[_ngcontent-%COMP%]{margin-top:20px}.historias-clinicas[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:10px}.historia-clinica[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:15px;background-color:#fff;box-shadow:0 2px 4px #0000001a}.historia-clinica[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:5px;color:#555}.historia-clinica[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700;color:#333}.datos-dinamicos[_ngcontent-%COMP%]{margin-top:10px}.datos-dinamicos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}"]});let r=c;return r})();export{Ai as a};
