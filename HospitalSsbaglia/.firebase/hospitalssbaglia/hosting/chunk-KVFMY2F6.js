import{a as Q}from"./chunk-Q7FLMN77.js";import{a as K}from"./chunk-U4O4KU6Q.js";import{a as q,d as ai}from"./chunk-ZNPDZJIK.js";import{b as $,d as N,g as W,n as R,o as B,p as J,s as G}from"./chunk-WQDWLB3F.js";import{d as z}from"./chunk-Q3TEWXKA.js";import{y as U}from"./chunk-W5EYEMU2.js";import{h as A,i as L,k as j}from"./chunk-TQDNXVMP.js";import{$a as v,Da as H,Ga as c,Ha as h,Ua as g,Wa as u,Y as w,Ya as l,Za as n,_a as E,ba as F,cb as x,db as m,fa as I,fb as a,hb as p,ia as D,jb as C,kb as b,lb as P,nb as T,pa as f,pb as S,qa as _,qb as V,rb as k}from"./chunk-75HCPL27.js";import{a as M,b as O}from"./chunk-GLKGYJID.js";ai();var Y=(()=>{let s=class s{transform(e){let i=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado","Domingo"];return e.sort((o,d)=>i.indexOf(o.dia)-i.indexOf(d.dia))}};s.\u0275fac=function(i){return new(i||s)},s.\u0275pipe=D({name:"ordenarDias",type:s,pure:!0,standalone:!0});let r=s;return r})();var Z=(()=>{let s=class s{constructor(e){this.firestore=e,this.usuariosCollection="Usuarios",this.filtrarHistoriasClinicasPorEspecialidad=(i,o)=>i.filter(d=>d.especialidad===o)}getUsuario(e){return this.firestore.collection(this.usuariosCollection).doc(e).valueChanges()}actualizarUsuario(e){return this.firestore.collection(this.usuariosCollection).doc(e.uid).update(e)}};s.\u0275fac=function(i){return new(i||s)(F(U))},s.\u0275prov=w({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();function si(r,s){if(r&1&&(l(0,"div",4),E(1,"img",5),n()),r&2){let t=s.$implicit;c(),u("src",t,H)}}function ci(r,s){if(r&1&&(l(0,"div"),g(1,si,2,1,"div",3),n()),r&2){let t=m(2);c(),u("ngForOf",t.imagenes)}}function li(r,s){if(r&1){let t=v();l(0,"div",11)(1,"input",12),P("ngModelChange",function(i){let o=f(t).index,d=m().$implicit;return b(d.horarios[o].inicio,i)||(d.horarios[o].inicio=i),_(i)}),n(),l(2,"input",12),P("ngModelChange",function(i){let o=f(t).index,d=m().$implicit;return b(d.horarios[o].fin,i)||(d.horarios[o].fin=i),_(i)}),n(),l(3,"button",13),x("click",function(){let i=f(t).index,o=m().index,d=m(3);return _(d.eliminarHorario(o,i))}),a(4,"Eliminar"),n()()}if(r&2){let t=s.index,e=m().$implicit;c(),C("ngModel",e.horarios[t].inicio),c(),C("ngModel",e.horarios[t].fin)}}function di(r,s){if(r&1){let t=v();l(0,"div",8)(1,"p")(2,"strong"),a(3),n()(),g(4,li,5,2,"div",9),l(5,"button",10),x("click",function(){let i=f(t).index,o=m(3);return _(o.agregarHorario(i))}),a(6,"Agregar Horario"),n()()}if(r&2){let t=s.$implicit;c(3),p("",t.dia,":"),c(),u("ngForOf",t.horarios)}}function pi(r,s){if(r&1){let t=v();l(0,"div")(1,"p")(2,"strong"),a(3,"Especialidades:"),n(),a(4),n(),l(5,"h3"),a(6,"Mis Horarios"),n(),g(7,di,7,2,"div",6),S(8,"ordenarDias"),E(9,"br"),l(10,"button",7),x("click",function(){f(t);let i=m(2);return _(i.guardarDisponibilidad())}),a(11,"Guardar Disponibilidad"),n()()}if(r&2){let t=m(2);c(4),p(" ",t.usuario.especialidad.join(", "),""),c(3),u("ngForOf",V(8,2,t.disponibilidadHoraria))}}function mi(r,s){if(r&1&&(l(0,"option",20),a(1),n()),r&2){let t=s.$implicit;u("value",t),c(),p(" ",t," ")}}function ui(r,s){if(r&1&&(l(0,"div",23)(1,"p")(2,"strong"),a(3),n(),a(4),n()()),r&2){let t=s.$implicit;c(3),p("",t.clave,":"),c(),p(" ",t.valor,"")}}function gi(r,s){if(r&1&&(l(0,"div",21)(1,"p")(2,"strong"),a(3,"Fecha:"),n(),a(4),S(5,"date"),n(),l(6,"p")(7,"strong"),a(8,"Altura:"),n(),a(9),n(),l(10,"p")(11,"strong"),a(12,"Peso:"),n(),a(13),n(),l(14,"p")(15,"strong"),a(16,"Temperatura:"),n(),a(17),n(),l(18,"p")(19,"strong"),a(20,"Presi\xF3n:"),n(),a(21),n(),l(22,"p")(23,"strong"),a(24,"Especialidad:"),n(),a(25),n(),g(26,ui,5,2,"div",22),n()),r&2){let t=s.$implicit;c(4),p(" ",k(5,7,t.fecha,"short"),""),c(5),p(" ",t.altura," cm"),c(4),p(" ",t.peso," kg"),c(4),p(" ",t.temperatura," \xB0C"),c(4),p(" ",t.presion,""),c(4),p(" ",t.especialidad,""),c(),u("ngForOf",t.datosDinamicos)}}function fi(r,s){if(r&1){let t=v();l(0,"div")(1,"div")(2,"h3"),a(3,"Seleccionar Especialidad"),n(),l(4,"select",14),P("ngModelChange",function(i){f(t);let o=m(2);return b(o.especialidadSeleccionada,i)||(o.especialidadSeleccionada=i),_(i)}),x("change",function(){f(t);let i=m(2);return _(i.filtrarHistoriasClinicas())}),l(5,"option",15),a(6,"Todas las especialidades"),n(),g(7,mi,2,2,"option",16),n()(),l(8,"div",17)(9,"h3"),a(10,"Historias Cl\xEDnicas"),n(),g(11,gi,27,10,"div",18),n(),l(12,"button",19),x("click",function(){f(t);let i=m(2);return _(i.generatePDF())}),a(13,"Descargar Historia Cl\xEDnica en PDF"),n()()}if(r&2){let t=m(2);c(4),C("ngModel",t.especialidadSeleccionada),c(3),u("ngForOf",t.especialidades),c(4),u("ngForOf",t.historiasClinicasFiltradas)}}function _i(r,s){if(r&1&&(l(0,"div",1)(1,"h2"),a(2,"Mi Perfil"),n(),l(3,"div")(4,"p")(5,"strong"),a(6,"Nombre:"),n(),a(7),n(),l(8,"p")(9,"strong"),a(10,"Apellido:"),n(),a(11),n(),l(12,"p")(13,"strong"),a(14,"DNI:"),n(),a(15),n(),l(16,"p")(17,"strong"),a(18,"Edad:"),n(),a(19),n(),l(20,"p")(21,"strong"),a(22,"Obra Social:"),n(),a(23),n(),l(24,"p")(25,"strong"),a(26,"Correo Electr\xF3nico:"),n(),a(27),n(),g(28,ci,2,1,"div",2),n(),g(29,pi,12,4,"div",2)(30,fi,14,3,"div",2),n()),r&2){let t=m();c(7),p(" ",t.usuario.nombre,""),c(4),p(" ",t.usuario.apellido,""),c(4),p(" ",t.usuario.dni,""),c(4),p(" ",t.usuario.edad,""),c(4),p(" ",t.usuario.obraSocial||"No especificada",""),c(4),p(" ",t.usuario.mail,""),c(),u("ngIf",t.imagenes.length),c(),u("ngIf",t.esEspecialista),c(),u("ngIf",!t.esEspecialista)}}var Li=(()=>{let s=class s{constructor(e,i,o,d){this.authService=e,this.usuarioService=i,this.especialistaService=o,this.historiaClinicaService=d,this.esEspecialista=!1,this.disponibilidadHoraria=[],this.imagenes=[],this.historiasClinicas=[],this.historiasClinicasFiltradas=[],this.especialidades=[],this.especialidadSeleccionada=""}ngOnInit(){this.authService.getCurrentUser().subscribe(e=>{e&&this.usuarioService.getUsuario(e.uid).subscribe(i=>{this.usuario=i,i&&(this.imagenes=this.obtenerURLsImagenes(i.imagenes)),i&&i.especialidad.length>0&&(this.esEspecialista=!0,this.cargarDisponibilidadHoraria(e.uid)),i&&this.cargarHistoriasClinicas(i.uid)})})}cargarDisponibilidadHoraria(e){this.especialistaService.getDisponibilidad(e).subscribe(i=>{this.disponibilidadHoraria=i.length?i:this.inicializarDisponibilidad()})}inicializarDisponibilidad(){return[{dia:"Lunes",horarios:[]},{dia:"Martes",horarios:[]},{dia:"Mi\xE9rcoles",horarios:[]},{dia:"Jueves",horarios:[]},{dia:"Viernes",horarios:[]},{dia:"S\xE1bado",horarios:[]},{dia:"Domingo",horarios:[]}]}obtenerURLsImagenes(e){return e.map(i=>typeof i=="string"?i:URL.createObjectURL(i))}actualizarPerfil(){this.usuario&&this.usuarioService.actualizarUsuario(this.usuario).then(()=>{console.log("Perfil actualizado correctamente.")}).catch(e=>{console.error("Error al actualizar perfil:",e)})}agregarHorario(e){this.disponibilidadHoraria[e].horarios||(this.disponibilidadHoraria[e].horarios=[]),this.disponibilidadHoraria[e].horarios.push({inicio:"",fin:""})}eliminarHorario(e,i){this.disponibilidadHoraria[e].horarios.splice(i,1)}guardarDisponibilidad(){this.usuario&&this.usuario.uid&&(this.disponibilidadHoraria.every(i=>i.horarios.every(o=>o.inicio&&o.fin))?this.especialistaService.guardarDisponibilidad(this.usuario.uid,this.disponibilidadHoraria).then(()=>{console.log("Disponibilidad horaria guardada correctamente."),this.cargarDisponibilidadHoraria(this.usuario.uid)}).catch(i=>{console.error("Error al guardar disponibilidad horaria:",i)}):console.error("Error: Algunos horarios no est\xE1n completos."))}convertirTimestampAFecha(e){return O(M({},e),{fecha:e.fecha.toDate()})}cargarHistoriasClinicas(e){this.historiaClinicaService.obtenerHistoriasPorPaciente(e).subscribe(i=>{this.historiasClinicas=i.map(o=>{let d=M({id:o.payload.doc.id},o.payload.doc.data()),y=this.convertirTimestampAFecha(d),{fecha:ii,altura:ei,peso:ti,temperatura:ni,presion:ri,especialidad:xi}=y;return ii&&ei&&ti&&ni&&ri?y:null}).filter(o=>o!==null),this.especialidades=[...new Set(this.historiasClinicas.map(o=>o.especialidad))],this.filtrarHistoriasClinicas()})}filtrarHistoriasClinicas(){this.especialidadSeleccionada?this.historiasClinicasFiltradas=this.historiasClinicas.filter(e=>e.especialidad===this.especialidadSeleccionada):this.historiasClinicasFiltradas=[...this.historiasClinicas],this.historiaClinicaReciente=this.historiasClinicasFiltradas.reduce((e,i)=>!e||i.fecha>e.fecha?i:e,void 0)}generatePDF(){let e=new q,i=10;e.text("Historia Cl\xEDnica",10,i),i+=10,this.historiasClinicasFiltradas.forEach(o=>{e.text(`Fecha: ${new Date(o.fecha).toLocaleString()}`,10,i),i+=10,e.text(`Altura: ${o.altura} cm`,10,i),i+=10,e.text(`Peso: ${o.peso} kg`,10,i),i+=10,e.text(`Temperatura: ${o.temperatura} \xB0C`,10,i),i+=10,e.text(`Presi\xF3n: ${o.presion}`,10,i),i+=10,e.text(`Especialidad: ${o.especialidad}`,10,i),i+=10,o.datosDinamicos.forEach(d=>{e.text(`${d.clave}: ${d.valor}`,10,i),i+=10}),i+=10}),e.save("historia_clinica.pdf")}};s.\u0275fac=function(i){return new(i||s)(h(z),h(Z),h(Q),h(K))},s.\u0275cmp=I({type:s,selectors:[["app-mi-perfil"]],standalone:!0,features:[T],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[4,"ngIf"],["class","imagen-container",4,"ngFor","ngForOf"],[1,"imagen-container"],["alt","Imagen",1,"perfil-imagen",3,"src"],["class","dia-container",4,"ngFor","ngForOf"],[1,"btn","btn-primary","guardar-btn",3,"click"],[1,"dia-container"],["class","horario-container",4,"ngFor","ngForOf"],[1,"agregarHorario",3,"click"],[1,"horario-container"],["type","time",1,"time-input",3,"ngModelChange","ngModel"],[1,"btn","btn-danger",3,"click"],[3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"historias-clinicas"],["class","historia-clinica",4,"ngFor","ngForOf"],[3,"click"],[3,"value"],[1,"historia-clinica"],["class","datos-dinamicos",4,"ngFor","ngForOf"],[1,"datos-dinamicos"]],template:function(i,o){i&1&&g(0,_i,31,9,"div",0),i&2&&u("ngIf",o.usuario)},dependencies:[L,A,G,B,J,$,R,N,W,j,Y],styles:[".container[_ngcontent-%COMP%]{margin:0 auto;padding:20px;max-width:800px;font-family:Arial,sans-serif;background-color:#f9f9f9;border-radius:8px;box-shadow:0 4px 8px #0000001a}h2[_ngcontent-%COMP%]{color:#333;text-align:center;margin-bottom:20px}h3[_ngcontent-%COMP%]{color:#555;margin-top:30px}.profile-details[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:20px}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{flex:1 1 45%;margin:0;color:#555}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}.images-section[_ngcontent-%COMP%]{margin-top:20px}.images-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 10px;color:#555}.images-section[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;border-radius:8px;margin:5px;box-shadow:0 2px 4px #0000001a}.imagen-container[_ngcontent-%COMP%]{display:inline-block;margin:10px}.availability-section[_ngcontent-%COMP%]{margin-top:20px}.dia-container[_ngcontent-%COMP%]{margin-bottom:10px}.horario-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:5px}.time-input[_ngcontent-%COMP%]{flex:1}.guardar-btn[_ngcontent-%COMP%]{display:block;width:100%;margin-top:20px;font-size:16px}button[_ngcontent-%COMP%]{padding:5px 10px;font-size:14px}button.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;border-radius:4px}button.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;border:none;border-radius:4px}button.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;border-radius:4px}.historias-clinicas[_ngcontent-%COMP%]{margin-top:20px}.historia-clinica[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:15px;background-color:#fff;box-shadow:0 2px 4px #0000001a}.historia-clinica[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:5px;color:#555}.historia-clinica[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700;color:#333}.datos-dinamicos[_ngcontent-%COMP%]{margin-top:10px}.datos-dinamicos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.agregarHorario[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#099fa7;border:1px solid #8eaaaa77;border-radius:5px;padding:5px 10px;cursor:pointer}"]});let r=s;return r})();export{Li as a};
