import{a as R}from"./chunk-KWKJG6CW.js";import{b as A,d as N,g as $,s as G}from"./chunk-NY2CMLFD.js";import{d as z}from"./chunk-BRXFPUIU.js";import{h as I,i as V,k as L}from"./chunk-AZLH7A3O.js";import{$a as v,Ga as a,Ha as T,Ua as g,Wa as u,Xa as E,Ya as s,Za as r,cb as C,db as l,fa as w,fb as d,hb as m,jb as b,kb as M,lb as S,nb as P,ob as O,pa as _,pb as F,qa as f,rb as k}from"./chunk-QPVJROBB.js";import{h}from"./chunk-DEPBX7UX.js";var D=()=>[1,2,3,4,5];function H(n,c){if(n&1&&(s(0,"p"),d(1),r()),n&2){let i=l().$implicit;a(),m("Comentario: ",i.comentario,"")}}function j(n,c){if(n&1&&(s(0,"p"),d(1),r()),n&2){let i=l().$implicit;a(),m("Calificaci\xF3n: ",i.calificacion,"")}}function Y(n,c){if(n&1){let i=v();s(0,"div")(1,"textarea",8),S("ngModelChange",function(t){_(i);let o=l(2).$implicit;return M(o.comentario,t)||(o.comentario=t),f(t)}),r(),s(2,"button",6),C("click",function(){_(i);let t=l(2).$implicit,o=l();return f(o.cancelarTurno(t))}),d(3,"Confirmar Cancelaci\xF3n"),r()()}if(n&2){let i=l(2).$implicit;a(),b("ngModel",i.comentario)}}function U(n,c){if(n&1){let i=v();s(0,"div")(1,"button",6),C("click",function(){_(i);let t=l().$implicit,o=l();return f(o.toggleCancelarTurno(t))}),d(2),r(),g(3,Y,4,1,"div",5),r()}if(n&2){let i=l().$implicit;a(2),m(" ",i.mostrarcomentario?"No Cancelar":"Cancelar Turno"," "),a(),u("ngIf",i.mostrarcomentario)}}function q(n,c){if(n&1){let i=v();s(0,"span",11),C("click",function(){let t=_(i).$implicit,o=l(2).$implicit,p=l();return f(p.calificarAtencion(o,t))}),d(1,"\u2606"),r()}if(n&2){let i=c.$implicit,e=l(2).$implicit;E("seleccionada",e.calificacion>=i)}}function J(n,c){n&1&&(s(0,"div",9)(1,"p"),d(2,"Calificar Atenci\xF3n:"),r(),g(3,q,2,2,"span",10),r()),n&2&&(a(3),u("ngForOf",O(1,D)))}function K(n,c){if(n&1){let i=v();s(0,"div",4)(1,"p"),d(2),r(),s(3,"p"),d(4),r(),s(5,"p"),d(6),F(7,"date"),r(),s(8,"p"),d(9),r(),g(10,H,2,1,"p",5)(11,j,2,1,"p",5),s(12,"button",6),C("click",function(){let t=_(i).$implicit,o=l();return f(o.eliminarTurno(t.id))}),d(13,"\u2716"),r(),g(14,U,4,2,"div",5)(15,J,4,2,"div",7),r()}if(n&2){let i=c.$implicit;a(2),m("Especialidad: ",i.especialidad,""),a(2),m("Especialista: ",i.especialistaNombre,""),a(2),m("Fecha y Hora: ",k(7,8,i.fechaHora,"dd/MM/yyyy HH:mm"),""),a(3),m("Estado: ",i.estado,""),a(),u("ngIf",i.comentario),a(),u("ngIf",i.calificacion),a(3),u("ngIf",i.estado!=="realizado"),a(),u("ngIf",i.estado==="realizado")}}var re=(()=>{let c=class c{constructor(e,t){this.authService=e,this.turnoService=t,this.turnos=[],this.turnosFiltrados=[],this.especialidades=[],this.especialistas=[],this.filtroGeneral=""}ngOnInit(){return h(this,null,function*(){let e=yield this.authService.usuarioActual();this.turnoService.getTurnosByPaciente(e.uid).subscribe(t=>{this.turnos=t,this.turnosFiltrados=t,this.obtenerEspecialidadesYEspecialistas(t)})})}obtenerEspecialidadesYEspecialistas(e){let t=new Set,o=new Set;e.forEach(p=>{t.add(p.especialidad),o.add({id:p.especialistaId,nombre:p.especialistaNombre})}),this.especialidades=Array.from(t),this.especialistas=Array.from(o)}aplicarFiltro(){this.turnosFiltrados=this.turnos.filter(e=>this.buscarEnTurno(e,this.filtroGeneral))}buscarEnTurno(e,t){if(!t||(t=t.toLowerCase(),e.especialidad.toLowerCase().includes(t)||e.especialistaNombre.toLowerCase().includes(t)||e.estado.toLowerCase().includes(t)||e.fechaHora.toString().toLowerCase().includes(t)))return!0;if(e.historiaClinica){let{altura:o,peso:p,temperatura:x,presion:W,datosDinamicos:B}=e.historiaClinica;if(o.toString().includes(t)||p.toString().includes(t)||x.toString().includes(t)||W.toLowerCase().includes(t)||B.some(y=>y.clave.toLowerCase().includes(t)||y.valor.toLowerCase().includes(t)))return!0}return!1}cancelarTurno(e){return h(this,null,function*(){e.estado!=="realizado"&&(e.estado="cancelado",e.comentario=e.comentario?e.comentario:"Turno cancelado por el paciente",yield this.turnoService.actualizarTurno(e))})}completarEncuesta(e){e.estado==="realizado"&&this.turnoService.obtenerEncuesta(e.id).subscribe(t=>{console.log(t?"La encuesta ya fue completada":"Redirigir al formulario de encuesta")})}verResenia(e){e.estado==="realizado"&&(e.mostrarresenia=!e.mostrarresenia,e.mostrarresenia&&this.turnoService.obtenerRese\u00F1a(e.id).subscribe(t=>{e.comentario=t||"No hay rese\xF1a"}))}calificarAtencion(e,t){e.estado==="realizado"&&(e.calificacion=t,this.turnoService.actualizarTurno(e))}toggleCancelarTurno(e){e.mostrarcomentario&&(e.comentarioGuardado=e.comentario),e.mostrarcomentario=!e.mostrarcomentario}eliminarTurno(e){this.turnoService.eliminarTurno(e).then(()=>{this.turnos=this.turnos.filter(t=>t.id!==e),this.turnosFiltrados=this.turnosFiltrados.filter(t=>t.id!==e)})}};c.\u0275fac=function(t){return new(t||c)(T(z),T(R))},c.\u0275cmp=w({type:c,selectors:[["app-turnos"]],standalone:!0,features:[P],decls:4,vars:2,consts:[[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],[1,"turnos"],["class","turno",4,"ngFor","ngForOf"],[1,"turno"],[4,"ngIf"],[3,"click"],["class","calificacion",4,"ngIf"],["placeholder","Raz\xF3n de cancelaci\xF3n",3,"ngModelChange","ngModel"],[1,"calificacion"],["class","estrella",3,"seleccionada","click",4,"ngFor","ngForOf"],[1,"estrella",3,"click"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"input",1),S("ngModelChange",function(x){return M(o.filtroGeneral,x)||(o.filtroGeneral=x),x}),C("input",function(){return o.aplicarFiltro()}),r()(),s(2,"div",2),g(3,K,16,11,"div",3),r()),t&2&&(a(),b("ngModel",o.filtroGeneral),a(2),u("ngForOf",o.turnosFiltrados))},dependencies:[I,V,G,A,N,$,L],styles:[".filtros[_ngcontent-%COMP%]{margin-bottom:20px}.turnos[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.turno[_ngcontent-%COMP%]{border:1px solid #ccc;padding:20px;background-color:#f9f9f9;border-radius:5px}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px}.turno[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.turno[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px}.turno[_ngcontent-%COMP%]   .mostrarresenia[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-style:italic}.btn-eliminar[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:20px;cursor:pointer;color:red}.btn-eliminar[_ngcontent-%COMP%]:hover{color:#8b0000}textarea[_ngcontent-%COMP%]{width:100%;margin-top:5px}.calificacion[_ngcontent-%COMP%]{display:flex;align-items:center}.calificacion[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 10px 0 0}.estrella[_ngcontent-%COMP%]{font-size:24px;cursor:pointer;color:#ccc}.estrella.seleccionada[_ngcontent-%COMP%]{color:gold}"]});let n=c;return n})();export{re as a};
