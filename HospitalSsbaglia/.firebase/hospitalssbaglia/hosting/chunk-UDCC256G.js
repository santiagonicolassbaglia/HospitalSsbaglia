import{a as z}from"./chunk-UXX4BWXT.js";import{b as L,d as A,g as N,s as R}from"./chunk-QWB637DO.js";import{d as O}from"./chunk-J4KM255L.js";import{h as k,i as I,k as P}from"./chunk-NCUWAZGR.js";import{$a as g,Ga as a,Ha as h,Ua as v,Wa as m,Ya as s,Za as r,cb as _,db as c,fa as E,fb as d,hb as C,jb as T,kb as w,lb as y,nb as M,ob as F,pa as u,qa as p,qb as V}from"./chunk-GBDBB4LJ.js";import{h as b}from"./chunk-DEPBX7UX.js";function W(o,l){if(o&1){let i=g();s(0,"div")(1,"textarea",8),y("ngModelChange",function(e){u(i);let n=c(2).$implicit;return w(n.comentario,e)||(n.comentario=e),p(e)}),r(),s(2,"button",7),_("click",function(){u(i);let e=c(2).$implicit,n=c();return p(n.cancelarTurno(e))}),d(3,"Confirmar Cancelaci\xF3n"),r()()}if(o&2){let i=c(2).$implicit;a(),T("ngModel",i.comentario)}}function B(o,l){if(o&1){let i=g();s(0,"div")(1,"button",7),_("click",function(){u(i);let e=c().$implicit,n=c();return p(n.toggleCancelarTurno(e))}),d(2),r(),v(3,W,4,1,"div",5),r()}if(o&2){let i=c().$implicit;a(2),C(" ",i.mostrarcomentario?"No Cancelar":"Cancelar Turno"," "),a(),m("ngIf",i.mostrarcomentario)}}function D(o,l){if(o&1){let i=g();s(0,"button",7),_("click",function(){u(i);let e=c().$implicit,n=c();return p(n.verResenia(e))}),d(1,"Ver Rese\xF1a"),r()}}function H(o,l){if(o&1){let i=g();s(0,"div")(1,"p"),d(2),r(),s(3,"button",7),_("click",function(){u(i);let e=c().$implicit;return p(e.mostrarresenia=!1)}),d(4,"Ocultar Rese\xF1a"),r()()}if(o&2){let i=c().$implicit;a(2),C("Rese\xF1a: ",i.comentario,"")}}function j(o,l){if(o&1){let i=g();s(0,"button",7),_("click",function(){u(i);let e=c().$implicit,n=c();return p(n.completarEncuesta(e))}),d(1,"Completar Encuesta"),r()}}function Y(o,l){if(o&1){let i=g();s(0,"button",7),_("click",function(){u(i);let e=c().$implicit,n=c();return p(n.calificarAtencion(e,"Comentario de la atenci\xF3n"))}),d(1,"Calificar Atenci\xF3n"),r()}}function U(o,l){if(o&1&&(s(0,"div",4)(1,"p"),d(2),r(),s(3,"p"),d(4),r(),s(5,"p"),d(6),F(7,"date"),r(),s(8,"p"),d(9),r(),v(10,B,4,2,"div",5)(11,D,2,0,"button",6)(12,H,5,1,"div",5)(13,j,2,0,"button",6)(14,Y,2,0,"button",6),r()),o&2){let i=l.$implicit;a(2),C("Especialidad: ",i.especialidad,""),a(2),C("Especialista: ",i.especialistaNombre,""),a(2),C("Fecha y Hora: ",V(7,9,i.fechaHora,"dd/MM/yyyy HH:mm"),""),a(3),C("Estado: ",i.estado,""),a(),m("ngIf",i.estado!=="realizado"),a(),m("ngIf",i.comentario&&!i.mostrarresenia),a(),m("ngIf",i.mostrarresenia),a(),m("ngIf",i.estado==="realizado"),a(),m("ngIf",i.estado==="realizado")}}var ie=(()=>{let l=class l{constructor(t,e){this.authService=t,this.turnoService=e,this.turnos=[],this.turnosFiltrados=[],this.especialidades=[],this.especialistas=[],this.filtroGeneral=""}ngOnInit(){return b(this,null,function*(){let t=yield this.authService.usuarioActual();this.turnoService.getTurnosByPaciente(t.uid).subscribe(e=>{this.turnos=e,this.turnosFiltrados=e,this.obtenerEspecialidadesYEspecialistas(e)})})}obtenerEspecialidadesYEspecialistas(t){let e=new Set,n=new Set;t.forEach(f=>{e.add(f.especialidad),n.add({id:f.especialistaId,nombre:f.especialistaNombre})}),this.especialidades=Array.from(e),this.especialistas=Array.from(n)}aplicarFiltro(){this.turnosFiltrados=this.turnos.filter(t=>this.buscarEnTurno(t,this.filtroGeneral))}buscarEnTurno(t,e){if(!e||(e=e.toLowerCase(),t.especialidad.toLowerCase().includes(e)||t.especialistaNombre.toLowerCase().includes(e)||t.estado.toLowerCase().includes(e)||t.fechaHora.toString().toLowerCase().includes(e)))return!0;if(t.historiaClinica){let{altura:n,peso:f,temperatura:x,presion:$,datosDinamicos:G}=t.historiaClinica;if(n.toString().includes(e)||f.toString().includes(e)||x.toString().includes(e)||$.toLowerCase().includes(e)||G.some(S=>S.clave.toLowerCase().includes(e)||S.valor.toLowerCase().includes(e)))return!0}return!1}cancelarTurno(t){return b(this,null,function*(){t.estado!=="realizado"&&(t.estado="cancelado",t.comentario=t.comentario?t.comentario:"Turno cancelado por el paciente",yield this.turnoService.actualizarTurno(t))})}completarEncuesta(t){t.estado==="realizado"&&this.turnoService.obtenerEncuesta(t.id).subscribe(e=>{console.log(e?"La encuesta ya fue completada":"Redirigir al formulario de encuesta")})}verResenia(t){t.estado==="realizado"&&(t.mostrarresenia=!t.mostrarresenia,t.mostrarresenia&&this.turnoService.obtenerRese\u00F1a(t.id).subscribe(e=>{t.comentario=e||"No hay rese\xF1a"}))}calificarAtencion(t,e){t.estado==="realizado"&&(t.comentario=e)}toggleCancelarTurno(t){t.mostrarcomentario&&(t.comentarioGuardado=t.comentario),t.mostrarcomentario=!t.mostrarcomentario}};l.\u0275fac=function(e){return new(e||l)(h(O),h(z))},l.\u0275cmp=E({type:l,selectors:[["app-turnos"]],standalone:!0,features:[M],decls:4,vars:2,consts:[[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],[1,"turnos"],["class","turno",4,"ngFor","ngForOf"],[1,"turno"],[4,"ngIf"],[3,"click",4,"ngIf"],[3,"click"],["placeholder","Raz\xF3n de cancelaci\xF3n",3,"ngModelChange","ngModel"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"input",1),y("ngModelChange",function(x){return w(n.filtroGeneral,x)||(n.filtroGeneral=x),x}),_("input",function(){return n.aplicarFiltro()}),r()(),s(2,"div",2),v(3,U,15,12,"div",3),r()),e&2&&(a(),T("ngModel",n.filtroGeneral),a(2),m("ngForOf",n.turnosFiltrados))},dependencies:[k,I,R,L,A,N,P],styles:[".filtros[_ngcontent-%COMP%]{margin-bottom:20px}.turnos[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.turno[_ngcontent-%COMP%]{border:1px solid #ccc;padding:20px;background-color:#f9f9f9;border-radius:5px}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px}.turno[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.turno[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px}.turno[_ngcontent-%COMP%]   .mostrarresenia[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-style:italic}"]});let o=l;return o})();export{ie as a};
