import{a as zf,b as iT,c as sT,d as Gt,e as Gf,f as Gl,g as Wl,m as oT,n as mr,o as Kl}from"./chunk-A5VDV6B4.js";import{A as pT,B as J,C as Pt,D as Ze,E as Qf,F as gT,G as ua,H as ee,I as ct,J as Zl,K as Yf,L as Kt,M as yr,N as Wn,O as hi,P as fs,R as Kn,S as eu,T as nt,U as Ce,a as V,b as us,c as Hl,d as aT,e as cT,f as hs,g as tt,h as ds,i as ca,j as Wf,k as lT,l as wn,m as Kf,n as Ql,o as Yl,p as uT,q as Xl,r as We,s as hT,t as dT,u as Wt,v as _r,w as Jl,x as la,y as Hf,z as fT}from"./chunk-QTQ5WYAN.js";import{$ as te,A as ai,Aa as Je,B as NE,Bb as rT,C as Df,Ca as jf,Cb as zl,D as os,Da as GE,E as kE,Ea as aa,F as Ml,G as as,Ga as ui,H as _n,I as Nf,Ia as WE,J as xE,Ja as KE,K as Ll,L as Gn,La as Ve,M as OE,Ma as HE,N as kf,O as ME,Oa as QE,P as cs,Pa as YE,Q as we,Qa as XE,R as xf,Ra as Vl,S as LE,T as ze,Ta as JE,U as FE,V as Ge,Y as oe,Ya as ZE,Z as yn,_ as VE,a as AE,aa as Of,ab as eT,b as RE,ba as F,c as kt,ca as Z,d as Rf,da as ci,e as Sf,ea as sa,f as mn,fa as UE,g as $t,ga as vn,h as rs,ha as Mf,i as SE,j as pr,ja as li,k as gr,kb as tT,l as is,la as jE,m as Ie,ma as ls,n as W,na as rn,o as ra,oa as Lf,ob as Ul,p as CE,pb as jl,q as PE,qb as Bl,r as Q,ra as Ff,rb as nT,s as Cf,sa as BE,t as zt,ta as Fl,tb as Bf,u as DE,ua as Vf,ub as ql,v as Pf,va as qE,vb as qf,wa as oa,x as ia,xa as $E,y as xt,ya as Uf,yb as $f,z as ss,za as zE,zb as $l}from"./chunk-ILZYBNDK.js";import{a as G,b as Fe,e as Af,f as P}from"./chunk-RDYEX3OW.js";var da=class{},nu=class{},Hn=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Jf=class{encodeKey(e){return mT(e)}encodeValue(e){return mT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function ZP(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let s=i.indexOf("="),[o,a]=s==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],l=t.get(o)||[];l.push(a),t.set(o,l)}),t}var eD=/%(\d[a-f0-9])/gi,tD={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function mT(n){return encodeURIComponent(n).replace(eD,(e,t)=>tD[t]??e)}function tu(n){return`${n}`}var wr=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new Jf,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=ZP(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(tu):[tu(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(tu(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(tu(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Zf=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function nD(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function _T(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function yT(n){return typeof Blob<"u"&&n instanceof Blob}function vT(n){return typeof FormData<"u"&&n instanceof FormData}function rD(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var ha=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(nD(this.method)||i?(this.body=r!==void 0?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Hn,this.context??=new Zf,!this.params)this.params=new wr,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),l=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+l+o}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||_T(this.body)||yT(this.body)||vT(this.body)||rD(this.body)?this.body:this.body instanceof wr?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||vT(this.body)?null:yT(this.body)?this.body.type||null:_T(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof wr?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.transferCache??this.transferCache,o=e.body!==void 0?e.body:this.body,a=e.withCredentials??this.withCredentials,l=e.reportProgress??this.reportProgress,u=e.headers||this.headers,h=e.params||this.params,f=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((g,_)=>g.set(_,e.setHeaders[_]),u)),e.setParams&&(h=Object.keys(e.setParams).reduce((g,_)=>g.set(_,e.setParams[_]),h)),new n(t,r,o,{params:h,headers:u,context:f,reportProgress:l,responseType:i,withCredentials:a,transferCache:s})}},Er=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Er||{}),fa=class{constructor(e,t=200,r="OK"){this.headers=e.headers||new Hn,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},ru=class n extends fa{constructor(e={}){super(e),this.type=Er.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},pa=class n extends fa{constructor(e={}){super(e),this.type=Er.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},vr=class extends fa{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},IT=200,iD=204;function Xf(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var sD=(()=>{let e=class e{constructor(r){this.handler=r}request(r,i,s={}){let o;if(r instanceof ha)o=r;else{let u;s.headers instanceof Hn?u=s.headers:u=new Hn(s.headers);let h;s.params&&(s.params instanceof wr?h=s.params:h=new wr({fromObject:s.params})),o=new ha(r,i,s.body!==void 0?s.body:null,{headers:u,context:s.context,params:h,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let a=W(o).pipe(ai(u=>this.handler.handle(u)));if(r instanceof ha||s.observe==="events")return a;let l=a.pipe(xt(u=>u instanceof pa));switch(s.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return l.pipe(Q(u=>{if(u.body!==null&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return l.pipe(Q(u=>{if(u.body!==null&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return l.pipe(Q(u=>{if(u.body!==null&&typeof u.body!="string")throw new Error("Response is not a string.");return u.body}));case"json":default:return l.pipe(Q(u=>u.body))}case"response":return l;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(r,i={}){return this.request("DELETE",r,i)}get(r,i={}){return this.request("GET",r,i)}head(r,i={}){return this.request("HEAD",r,i)}jsonp(r,i){return this.request("JSONP",r,{params:new wr().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,i={}){return this.request("OPTIONS",r,i)}patch(r,i,s={}){return this.request("PATCH",r,Xf(s,i))}post(r,i,s={}){return this.request("POST",r,Xf(s,i))}put(r,i,s={}){return this.request("PUT",r,Xf(s,i))}};e.\u0275fac=function(i){return new(i||e)(F(da))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),oD=/^\)\]\}',?\n/,aD="X-Request-URL";function wT(n){if(n.url)return n.url;let e=aD.toLocaleLowerCase();return n.headers.get(e)}var cD=(()=>{let e=class e{constructor(){this.fetchImpl=Z(ep,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Z(Ve)}handle(r){return new kt(i=>{let s=new AbortController;return this.doRequest(r,s.signal,i).then(tp,o=>i.error(new vr({error:o}))),()=>s.abort()})}doRequest(r,i,s){return P(this,null,function*(){let o=this.createRequestInit(r),a;try{let E=this.fetchImpl(r.urlWithParams,G({signal:i},o));lD(E),s.next({type:Er.Sent}),a=yield E}catch(E){s.error(new vr({error:E,status:E.status??0,statusText:E.statusText,url:r.urlWithParams,headers:E.headers}));return}let l=new Hn(a.headers),u=a.statusText,h=wT(a)??r.urlWithParams,f=a.status,g=null;if(r.reportProgress&&s.next(new ru({headers:l,status:f,statusText:u,url:h})),a.body){let E=a.headers.get("content-length"),S=[],I=a.body.getReader(),O=0,j,x,U=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>P(this,null,function*(){for(;;){let{done:H,value:T}=yield I.read();if(H)break;if(S.push(T),O+=T.length,r.reportProgress){x=r.responseType==="text"?(x??"")+(j??=new TextDecoder).decode(T,{stream:!0}):void 0;let y=()=>s.next({type:Er.DownloadProgress,total:E?+E:void 0,loaded:O,partialText:x});U?U.run(y):y()}}}));let Y=this.concatChunks(S,O);try{let H=a.headers.get("Content-Type")??"";g=this.parseBody(r,Y,H)}catch(H){s.error(new vr({error:H,headers:new Hn(a.headers),status:a.status,statusText:a.statusText,url:wT(a)??r.urlWithParams}));return}}f===0&&(f=g?IT:0),f>=200&&f<300?(s.next(new pa({body:g,headers:l,status:f,statusText:u,url:h})),s.complete()):s.error(new vr({error:g,headers:l,status:f,statusText:u,url:h}))})}parseBody(r,i,s){switch(r.responseType){case"json":let o=new TextDecoder().decode(i).replace(oD,"");return o===""?null:JSON.parse(o);case"text":return new TextDecoder().decode(i);case"blob":return new Blob([i],{type:s});case"arraybuffer":return i.buffer}}createRequestInit(r){let i={},s=r.withCredentials?"include":void 0;if(r.headers.forEach((o,a)=>i[o]=a.join(",")),i.Accept??="application/json, text/plain, */*",!i["Content-Type"]){let o=r.detectContentTypeHeader();o!==null&&(i["Content-Type"]=o)}return{body:r.serializeBody(),method:r.method,headers:i,credentials:s}}concatChunks(r,i){let s=new Uint8Array(i),o=0;for(let a of r)s.set(a,o),o+=a.length;return s}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),ep=class{};function tp(){}function lD(n){n.then(tp,tp)}function uD(n,e){return e(n)}function hD(n,e,t){return(r,i)=>rn(t,()=>e(r,s=>n(s,i)))}var bT=new te(""),dD=new te(""),fD=new te("",{providedIn:"root",factory:()=>!0});var ET=(()=>{let e=class e extends da{constructor(r,i){super(),this.backend=r,this.injector=i,this.chain=null,this.pendingTasks=Z(Vl),this.contributeToStability=Z(fD)}handle(r){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(bT),...this.injector.get(dD,[])]));this.chain=i.reduceRight((s,o)=>hD(s,o,this.injector),uD)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(r,s=>this.backend.handle(s)).pipe(as(()=>this.pendingTasks.remove(i)))}else return this.chain(r,i=>this.backend.handle(i))}};e.\u0275fac=function(i){return new(i||e)(F(nu),F(ls))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})();var pD=/^\)\]\}',?\n/;function gD(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var TT=(()=>{let e=class e{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new Ge(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?Ie(i.\u0275loadImpl()):W(null)).pipe(we(()=>new kt(o=>{let a=i.build();if(a.open(r.method,r.urlWithParams),r.withCredentials&&(a.withCredentials=!0),r.headers.forEach((I,O)=>a.setRequestHeader(I,O.join(","))),r.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let I=r.detectContentTypeHeader();I!==null&&a.setRequestHeader("Content-Type",I)}if(r.responseType){let I=r.responseType.toLowerCase();a.responseType=I!=="json"?I:"text"}let l=r.serializeBody(),u=null,h=()=>{if(u!==null)return u;let I=a.statusText||"OK",O=new Hn(a.getAllResponseHeaders()),j=gD(a)||r.url;return u=new ru({headers:O,status:a.status,statusText:I,url:j}),u},f=()=>{let{headers:I,status:O,statusText:j,url:x}=h(),U=null;O!==iD&&(U=typeof a.response>"u"?a.responseText:a.response),O===0&&(O=U?IT:0);let Y=O>=200&&O<300;if(r.responseType==="json"&&typeof U=="string"){let H=U;U=U.replace(pD,"");try{U=U!==""?JSON.parse(U):null}catch(T){U=H,Y&&(Y=!1,U={error:T,text:U})}}Y?(o.next(new pa({body:U,headers:I,status:O,statusText:j,url:x||void 0})),o.complete()):o.error(new vr({error:U,headers:I,status:O,statusText:j,url:x||void 0}))},g=I=>{let{url:O}=h(),j=new vr({error:I,status:a.status||0,statusText:a.statusText||"Unknown Error",url:O||void 0});o.error(j)},_=!1,E=I=>{_||(o.next(h()),_=!0);let O={type:Er.DownloadProgress,loaded:I.loaded};I.lengthComputable&&(O.total=I.total),r.responseType==="text"&&a.responseText&&(O.partialText=a.responseText),o.next(O)},S=I=>{let O={type:Er.UploadProgress,loaded:I.loaded};I.lengthComputable&&(O.total=I.total),o.next(O)};return a.addEventListener("load",f),a.addEventListener("error",g),a.addEventListener("timeout",g),a.addEventListener("abort",g),r.reportProgress&&(a.addEventListener("progress",E),l!==null&&a.upload&&a.upload.addEventListener("progress",S)),a.send(l),o.next({type:Er.Sent}),()=>{a.removeEventListener("error",g),a.removeEventListener("abort",g),a.removeEventListener("load",f),a.removeEventListener("timeout",g),r.reportProgress&&(a.removeEventListener("progress",E),l!==null&&a.upload&&a.upload.removeEventListener("progress",S)),a.readyState!==a.DONE&&a.abort()}})))}};e.\u0275fac=function(i){return new(i||e)(F(Kl))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),AT=new te(""),mD="XSRF-TOKEN",_D=new te("",{providedIn:"root",factory:()=>mD}),yD="X-XSRF-TOKEN",vD=new te("",{providedIn:"root",factory:()=>yD}),iu=class{},wD=(()=>{let e=class e{constructor(r,i,s){this.doc=r,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=Wl(r,this.cookieName),this.lastCookieString=r),this.lastToken}};e.\u0275fac=function(i){return new(i||e)(F(Gt),F(Je),F(_D))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})();function ED(n,e){let t=n.url.toLowerCase();if(!Z(AT)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=Z(iu).getToken(),i=Z(vD);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}function dU(...n){let e=[sD,TT,ET,{provide:da,useExisting:ET},{provide:nu,useFactory:()=>Z(cD,{optional:!0})??Z(TT)},{provide:bT,useValue:ED,multi:!0},{provide:AT,useValue:!0},{provide:iu,useClass:wD}];for(let t of n)e.push(...t.\u0275providers);return li(e)}var ip=class extends sT{constructor(){super(...arguments),this.supportsDOMEvents=!0}},sp=class n extends ip{static makeCurrent(){iT(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=ID();return t==null?null:bD(t)}resetBaseElement(){ga=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Wl(document.cookie,e)}},ga=null;function ID(){return ga=ga||document.querySelector("base"),ga?ga.getAttribute("href"):null}function bD(n){return new URL(n,document.baseURI).pathname}var AD=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),op=new te(""),PT=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new Ge(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(F(op),F(Ve))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),su=class{constructor(e){this._doc=e}},np="ng-app-id",DT=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=mr(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${np}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(np),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(np,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(F(Gt),F(Uf),F(jf,8),F(Je))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),rp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},cp=/%COMP%/g,NT="%COMP%",RD=`_nghost-${NT}`,SD=`_ngcontent-${NT}`,CD=!0,PD=new te("",{providedIn:"root",factory:()=>CD});function DD(n){return SD.replace(cp,n)}function ND(n){return RD.replace(cp,n)}function kT(n,e){return e.map(t=>t.replace(cp,n))}var RT=(()=>{let e=class e{constructor(r,i,s,o,a,l,u,h=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=l,this.ngZone=u,this.nonce=h,this.rendererByCompId=new Map,this.platformIsServer=mr(l),this.defaultRenderer=new ma(r,a,u,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===sa.ShadowDom&&(i=Fe(G({},i),{encapsulation:sa.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof ou?s.applyToHost(r):s instanceof _a&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,l=this.ngZone,u=this.eventManager,h=this.sharedStylesHost,f=this.removeStylesOnCompDestroy,g=this.platformIsServer;switch(i.encapsulation){case sa.Emulated:o=new ou(u,h,i,this.appId,f,a,l,g);break;case sa.ShadowDom:return new ap(u,h,r,i,a,l,this.nonce,g);default:o=new _a(u,h,i,f,a,l,g);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(F(PT),F(DT),F(Uf),F(PD),F(Gt),F(Je),F(Ve),F(jf))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),ma=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(rp[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(ST(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(ST(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new Ge(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=rp[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=rp[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(aa.DashCase|aa.Important)?e.style.setProperty(t,r,i&aa.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&aa.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=zf().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function ST(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var ap=class extends ma{constructor(e,t,r,i,s,o,a,l){super(e,s,o,l),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=kT(i.id,i.styles);for(let h of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=h,this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},_a=class extends ma{constructor(e,t,r,i,s,o,a,l){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=l?kT(l,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ou=class extends _a{constructor(e,t,r,i,s,o,a,l){let u=i+"-"+r.id;super(e,t,r,s,o,a,l,u),this.contentAttr=DD(u),this.hostAttr=ND(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},kD=(()=>{let e=class e extends su{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(F(Gt))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})(),CT=["alt","control","meta","shift"],xD={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},OD={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},MD=(()=>{let e=class e extends su{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>zf().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",l=i.indexOf("code");if(l>-1&&(i.splice(l,1),a="code."),CT.forEach(h=>{let f=i.indexOf(h);f>-1&&(i.splice(f,1),a+=h+".")}),a+=o,i.length!=0||o.length===0)return null;let u={};return u.domEventName=s,u.fullKey=a,u}static matchEventFullKeyCode(r,i){let s=xD[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),CT.forEach(a=>{if(a!==s){let l=OD[a];l(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(F(Gt))},e.\u0275prov=oe({token:e,factory:e.\u0275fac});let n=e;return n})();function GU(n,e){return rT(G({rootComponent:n},LD(e)))}function LD(n){return{appProviders:[...BD,...n?.providers??[]],platformProviders:jD}}function FD(){sp.makeCurrent()}function VD(){return new Vf}function UD(){return $E(document),document}var jD=[{provide:Je,useValue:oT},{provide:zE,useValue:FD,multi:!0},{provide:Gt,useFactory:UD,deps:[]}];var BD=[{provide:jE,useValue:"root"},{provide:Vf,useFactory:VD,deps:[]},{provide:op,useClass:kD,multi:!0,deps:[Gt,Ve,Je]},{provide:op,useClass:MD,multi:!0,deps:[Gt]},RT,DT,PT,{provide:WE,useExisting:RT},{provide:Kl,useClass:AD,deps:[]},[]];var xT=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(F(Gt))},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var se="primary",Oa=Symbol("RouteTitle"),fp=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function vs(n){return new fp(n)}function $D(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o[0]===":")i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function zD(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!En(n[t],e[t]))return!1;return!0}function En(n,e){let t=n?pp(n):void 0,r=e?pp(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!BT(n[i],e[i]))return!1;return!0}function pp(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function BT(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function qT(n){return n.length>0?n[n.length-1]:null}function br(n){return CE(n)?n:nT(n)?Ie(Promise.resolve(n)):W(n)}var GD={exact:zT,subset:GT},$T={exact:WD,subset:KD,ignored:()=>!0};function OT(n,e,t){return GD[t.paths](n.root,e.root,t.matrixParams)&&$T[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function WD(n,e){return En(n,e)}function zT(n,e,t){if(!fi(n.segments,e.segments)||!lu(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!zT(n.children[r],e.children[r],t))return!1;return!0}function KD(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>BT(n[t],e[t]))}function GT(n,e,t){return WT(n,e,e.segments,t)}function WT(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!fi(i,t)||e.hasChildren()||!lu(i,t,r))}else if(n.segments.length===t.length){if(!fi(n.segments,t)||!lu(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!GT(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!fi(n.segments,i)||!lu(n.segments,i,r)||!n.children[se]?!1:WT(n.children[se],e,s,r)}}function lu(n,e,t){return e.every((r,i)=>$T[t](n[i].parameters,r.parameters))}var Tr=class{constructor(e=new _e([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=vs(this.queryParams),this._queryParamMap}toString(){return YD.serialize(this)}},_e=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return uu(this)}},di=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=vs(this.parameters),this._parameterMap}toString(){return HT(this)}};function HD(n,e){return fi(n,e)&&n.every((t,r)=>En(t.parameters,e[r].parameters))}function fi(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function QD(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===se&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==se&&(t=t.concat(e(i,r)))}),t}var jp=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:()=>new ba,providedIn:"root"});let n=e;return n})(),ba=class{parse(e){let t=new mp(e);return new Tr(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${ya(e.root,!0)}`,r=ZD(e.queryParams),i=typeof e.fragment=="string"?`#${XD(e.fragment)}`:"";return`${t}${r}${i}`}},YD=new ba;function uu(n){return n.segments.map(e=>HT(e)).join("/")}function ya(n,e){if(!n.hasChildren())return uu(n);if(e){let t=n.children[se]?ya(n.children[se],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==se&&r.push(`${i}:${ya(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=QD(n,(r,i)=>i===se?[ya(n.children[se],!1)]:[`${i}:${ya(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[se]!=null?`${uu(n)}/${t[0]}`:`${uu(n)}/(${t.join("//")})`}}function KT(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function au(n){return KT(n).replace(/%3B/gi,";")}function XD(n){return encodeURI(n)}function gp(n){return KT(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function hu(n){return decodeURIComponent(n)}function MT(n){return hu(n.replace(/\+/g,"%20"))}function HT(n){return`${gp(n.path)}${JD(n.parameters)}`}function JD(n){return Object.entries(n).map(([e,t])=>`;${gp(e)}=${gp(t)}`).join("")}function ZD(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${au(t)}=${au(i)}`).join("&"):`${au(t)}=${au(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var eN=/^[^\/()?;#]+/;function lp(n){let e=n.match(eN);return e?e[0]:""}var tN=/^[^\/()?;=#]+/;function nN(n){let e=n.match(tN);return e?e[0]:""}var rN=/^[^=?&#]+/;function iN(n){let e=n.match(rN);return e?e[0]:""}var sN=/^[^&#]+/;function oN(n){let e=n.match(sN);return e?e[0]:""}var mp=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new _e([],{}):new _e([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[se]=new _e(e,t)),r}parseSegment(){let e=lp(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Ge(4009,!1);return this.capture(e),new di(hu(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=nN(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=lp(this.remaining);i&&(r=i,this.capture(r))}e[hu(t)]=hu(r)}parseQueryParam(e){let t=iN(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=oN(this.remaining);o&&(r=o,this.capture(r))}let i=MT(t),s=MT(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=lp(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new Ge(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=se);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[se]:new _e([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Ge(4011,!1)}};function QT(n){return n.segments.length>0?new _e([],{[se]:n}):n}function YT(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=YT(i);if(r===se&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new _e(n.segments,e);return aN(t)}function aN(n){if(n.numberOfChildren===1&&n.children[se]){let e=n.children[se];return new _e(n.segments.concat(e.segments),e.children)}return n}function Aa(n){return n instanceof Tr}function cN(n,e,t=null,r=null){let i=XT(n);return JT(i,e,t,r)}function XT(n){let e;function t(s){let o={};for(let l of s.children){let u=t(l);o[l.outlet]=u}let a=new _e(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=QT(r);return e??i}function JT(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return up(i,i,i,t,r);let s=lN(e);if(s.toRoot())return up(i,i,new _e([],{}),t,r);let o=uN(s,i,n),a=o.processChildren?Ea(o.segmentGroup,o.index,s.commands):eI(o.segmentGroup,o.index,s.commands);return up(i,o.segmentGroup,a,t,r)}function du(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Ra(n){return typeof n=="object"&&n!=null&&n.outlets}function up(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([l,u])=>{s[l]=Array.isArray(u)?u.map(h=>`${h}`):`${u}`});let o;n===e?o=t:o=ZT(n,e,t);let a=QT(YT(o));return new Tr(a,s,i)}function ZT(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=ZT(s,e,t)}),new _e(n.segments,r)}var fu=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&du(r[0]))throw new Ge(4003,!1);let i=r.find(Ra);if(i&&i!==qT(r))throw new Ge(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function lN(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new fu(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([l,u])=>{a[l]=typeof u=="string"?u.split("/"):u}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new fu(t,e,r)}var ms=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function uN(n,e,t){if(n.isAbsolute)return new ms(e,!0,0);if(!t)return new ms(e,!1,NaN);if(t.parent===null)return new ms(t,!0,0);let r=du(n.commands[0])?0:1,i=t.segments.length-1+r;return hN(t,i,n.numberOfDoubleDots)}function hN(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Ge(4005,!1);i=r.segments.length}return new ms(r,!1,i-s)}function dN(n){return Ra(n[0])?n[0].outlets:{[se]:n}}function eI(n,e,t){if(n??=new _e([],{}),n.segments.length===0&&n.hasChildren())return Ea(n,e,t);let r=fN(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new _e(n.segments.slice(0,r.pathIndex),{});return s.children[se]=new _e(n.segments.slice(r.pathIndex),n.children),Ea(s,0,i)}else return r.match&&i.length===0?new _e(n.segments,{}):r.match&&!n.hasChildren()?_p(n,e,t):r.match?Ea(n,0,i):_p(n,e,t)}function Ea(n,e,t){if(t.length===0)return new _e(n.segments,{});{let r=dN(t),i={};if(Object.keys(r).some(s=>s!==se)&&n.children[se]&&n.numberOfChildren===1&&n.children[se].segments.length===0){let s=Ea(n.children[se],e,t);return new _e(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=eI(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new _e(n.segments,i)}}function fN(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Ra(a))break;let l=`${a}`,u=r<t.length-1?t[r+1]:null;if(i>0&&l===void 0)break;if(l&&u&&typeof u=="object"&&u.outlets===void 0){if(!FT(l,u,o))return s;r+=2}else{if(!FT(l,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function _p(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Ra(s)){let l=pN(s.outlets);return new _e(r,l)}if(i===0&&du(t[0])){let l=n.segments[e];r.push(new di(l.path,LT(t[0]))),i++;continue}let o=Ra(s)?s.outlets[se]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&du(a)?(r.push(new di(o,LT(a))),i+=2):(r.push(new di(o,{})),i++)}return new _e(r,{})}function pN(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=_p(new _e([],{}),0,r))}),e}function LT(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function FT(n,e,t){return n==t.path&&En(e,t.parameters)}var Ta="imperative",lt=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(lt||{}),Ht=class{constructor(e,t){this.id=e,this.url=t}},Sa=class extends Ht{constructor(e,t,r="imperative",i=null){super(e,t),this.type=lt.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ir=class extends Ht{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=lt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Mt=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Mt||{}),yp=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(yp||{}),Yn=class extends Ht{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=lt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},pi=class extends Ht{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=lt.NavigationSkipped}},Ca=class extends Ht{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=lt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},pu=class extends Ht{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=lt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vp=class extends Ht{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=lt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},wp=class extends Ht{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=lt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Ep=class extends Ht{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=lt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Tp=class extends Ht{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=lt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ip=class{constructor(e){this.route=e,this.type=lt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},bp=class{constructor(e){this.route=e,this.type=lt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ap=class{constructor(e){this.snapshot=e,this.type=lt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Rp=class{constructor(e){this.snapshot=e,this.type=lt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Sp=class{constructor(e){this.snapshot=e,this.type=lt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Cp=class{constructor(e){this.snapshot=e,this.type=lt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Pa=class{},ws=class{constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};var Pp=class{constructor(e){this.injector=e,this.outlet=null,this.route=null,this.children=new Eu(this.injector),this.attachRef=null}},Eu=(()=>{let e=class e{constructor(r){this.parentInjector=r,this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new Pp(this.parentInjector),this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)(F(ls))},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),gu=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Dp(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Dp(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Np(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Np(e,this._root).map(t=>t.value)}};function Dp(n,e){if(n===e.value)return e;for(let t of e.children){let r=Dp(n,t);if(r)return r}return null}function Np(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Np(n,t);if(r.length)return r.unshift(e),r}return[]}var Ot=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function gs(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var mu=class extends gu{constructor(e,t){super(e),this.snapshot=t,Bp(this,e)}toString(){return this.snapshot.toString()}};function tI(n){let e=gN(n),t=new $t([new di("",{})]),r=new $t({}),i=new $t({}),s=new $t({}),o=new $t(""),a=new gi(t,r,s,o,i,se,n,e.root);return a.snapshot=e.root,new mu(new Ot(a,[]),e)}function gN(n){let e={},t={},r={},i="",s=new _s([],e,r,i,t,se,n,null,{});return new yu("",new Ot(s,[]))}var gi=class{constructor(e,t,r,i,s,o,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Q(u=>u[Oa]))??W(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Q(e=>vs(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Q(e=>vs(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function _u(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:G(G({},e.params),n.params),data:G(G({},e.data),n.data),resolve:G(G(G(G({},n.data),e.data),i?.data),n._resolvedData)}:r={params:G({},n.params),data:G({},n.data),resolve:G(G({},n.data),n._resolvedData??{})},i&&rI(i)&&(r.resolve[Oa]=i.title),r}var _s=class{get title(){return this.data?.[Oa]}constructor(e,t,r,i,s,o,a,l,u){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=vs(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=vs(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},yu=class extends gu{constructor(e,t){super(t),this.url=e,Bp(this,t)}toString(){return nI(this._root)}};function Bp(n,e){e.value._routerState=n,e.children.forEach(t=>Bp(n,t))}function nI(n){let e=n.children.length>0?` { ${n.children.map(nI).join(", ")} } `:"";return`${n.value}${e}`}function hp(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,En(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),En(e.params,t.params)||n.paramsSubject.next(t.params),zD(e.url,t.url)||n.urlSubject.next(t.url),En(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function kp(n,e){let t=En(n.params,e.params)&&HD(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||kp(n.parent,e.parent))}function rI(n){return typeof n.title=="string"||n.title===null}var mN=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=se,this.activateEvents=new oa,this.deactivateEvents=new oa,this.attachEvents=new oa,this.detachEvents=new oa,this.parentContexts=Z(Eu),this.location=Z(HE),this.changeDetector=Z($l),this.inputBinder=Z(qp,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ge(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ge(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ge(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new Ge(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,l=this.parentContexts.getOrCreateContext(this.name).children,u=new xp(r,l,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:u,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Mf({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Lf]});let n=e;return n})(),xp=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===gi?this.route:e===Eu?this.childContexts:this.parent.get(e,t)}},qp=new te("");function _N(n,e,t){let r=Da(n,e._root,t?t._root:void 0);return new mu(r,e)}function Da(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=yN(n,e,t);return new Ot(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Da(n,a)),o}}let r=vN(e.value),i=e.children.map(s=>Da(n,s));return new Ot(r,i)}}function yN(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Da(n,r,i);return Da(n,r)})}function vN(n){return new gi(new $t(n.url),new $t(n.params),new $t(n.queryParams),new $t(n.fragment),new $t(n.data),n.outlet,n.component,n)}var Na=class{constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},iI="ngNavigationCancelingError";function vu(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Aa(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=sI(!1,Mt.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function sI(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[iI]=!0,t.cancellationCode=e,t}function wN(n){return oI(n)&&Aa(n.url)}function oI(n){return!!n&&n[iI]}var EN=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=UE({type:e,selectors:[["ng-component"]],standalone:!0,features:[tT],decls:1,vars:0,template:function(i,s){i&1&&ZE(0,"router-outlet")},dependencies:[mN],encapsulation:2});let n=e;return n})();function TN(n,e){return n.providers&&!n._injector&&(n._injector=XE(n.providers,e,`Route: ${n.path}`)),n._injector??e}function $p(n){let e=n.children&&n.children.map($p),t=e?Fe(G({},n),{children:e}):G({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==se&&(t.component=EN),t}function sn(n){return n.outlet||se}function IN(n,e){let t=n.filter(r=>sn(r)===e);return t.push(...n.filter(r=>sn(r)!==e)),t}function Ma(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var bN=(n,e,t,r)=>Q(i=>(new Op(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Op=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),hp(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=gs(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=gs(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=gs(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=gs(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Cp(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Rp(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(hp(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),hp(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Ma(i.snapshot);o.attachRef=null,o.route=i,o.injector=a??o.injector,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},wu=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},ys=class{constructor(e,t){this.component=e,this.route=t}};function AN(n,e,t){let r=n._root,i=e?e._root:null;return va(r,i,t,[r.value])}function RN(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Ts(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!VE(n)?n:e.get(n):r}function va(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=gs(e);return n.children.forEach(o=>{SN(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Ia(a,t.getContext(o),i)),i}function SN(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let l=CN(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new wu(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?va(n,e,a?a.children:null,r,i):va(n,e,t,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new ys(a.outlet.component,o))}else o&&Ia(e,a,i),i.canActivateChecks.push(new wu(r)),s.component?va(n,null,a?a.children:null,r,i):va(n,null,t,r,i);return i}function CN(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!fi(n.url,e.url);case"pathParamsOrQueryParamsChange":return!fi(n.url,e.url)||!En(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!kp(n,e)||!En(n.queryParams,e.queryParams);case"paramsChange":default:return!kp(n,e)}}function Ia(n,e,t){let r=gs(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?Ia(o,e.children.getContext(s),t):Ia(o,null,t):Ia(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new ys(e.outlet.component,i)):t.canDeactivateChecks.push(new ys(null,i)):t.canDeactivateChecks.push(new ys(null,i))}function La(n){return typeof n=="function"}function PN(n){return typeof n=="boolean"}function DN(n){return n&&La(n.canLoad)}function NN(n){return n&&La(n.canActivate)}function kN(n){return n&&La(n.canActivateChild)}function xN(n){return n&&La(n.canDeactivate)}function ON(n){return n&&La(n.canMatch)}function aI(n){return n instanceof PE||n?.name==="EmptyError"}var cu=Symbol("INITIAL_VALUE");function Es(){return we(n=>Cf(n.map(e=>e.pipe(os(1),cs(cu)))).pipe(Q(e=>{for(let t of e)if(t!==!0){if(t===cu)return cu;if(t===!1||MN(t))return t}return!0}),xt(e=>e!==cu),os(1)))}function MN(n){return Aa(n)||n instanceof Na}function LN(n,e){return zt(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?W(Fe(G({},t),{guardsResult:!0})):FN(o,r,i,n).pipe(zt(a=>a&&PN(a)?VN(r,s,n,e):W(a)),Q(a=>Fe(G({},t),{guardsResult:a})))})}function FN(n,e,t,r){return Ie(n).pipe(zt(i=>$N(i.component,i.route,t,e,r)),_n(i=>i!==!0,!0))}function VN(n,e,t,r){return Ie(e).pipe(ai(i=>DE(jN(i.route.parent,r),UN(i.route,r),qN(n,i.path,t),BN(n,i.route,t))),_n(i=>i!==!0,!0))}function UN(n,e){return n!==null&&e&&e(new Sp(n)),W(!0)}function jN(n,e){return n!==null&&e&&e(new Ap(n)),W(!0)}function BN(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return W(!0);let i=r.map(s=>Pf(()=>{let o=Ma(e)??t,a=Ts(s,o),l=NN(a)?a.canActivate(e,n):rn(o,()=>a(e,n));return br(l).pipe(_n())}));return W(i).pipe(Es())}function qN(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>RN(o)).filter(o=>o!==null).map(o=>Pf(()=>{let a=o.guards.map(l=>{let u=Ma(o.node)??t,h=Ts(l,u),f=kN(h)?h.canActivateChild(r,n):rn(u,()=>h(r,n));return br(f).pipe(_n())});return W(a).pipe(Es())}));return W(s).pipe(Es())}function $N(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return W(!0);let o=s.map(a=>{let l=Ma(e)??i,u=Ts(a,l),h=xN(u)?u.canDeactivate(n,e,t,r):rn(l,()=>u(n,e,t,r));return br(h).pipe(_n())});return W(o).pipe(Es())}function zN(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return W(!0);let s=i.map(o=>{let a=Ts(o,n),l=DN(a)?a.canLoad(e,t):rn(n,()=>a(e,t));return br(l)});return W(s).pipe(Es(),cI(r))}function cI(n){return RE(ze(e=>{if(typeof e!="boolean")throw vu(n,e)}),Q(e=>e===!0))}function GN(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return W(!0);let s=i.map(o=>{let a=Ts(o,n),l=ON(a)?a.canMatch(e,t):rn(n,()=>a(e,t));return br(l)});return W(s).pipe(Es(),cI(r))}var ka=class{constructor(e){this.segmentGroup=e||null}},xa=class extends Error{constructor(e){super(),this.urlTree=e}};function ps(n){return ra(new ka(n))}function WN(n){return ra(new Ge(4e3,!1))}function KN(n){return ra(sI(!1,Mt.GuardRejected))}var Mp=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return W(r);if(i.numberOfChildren>1||!i.children[se])return WN(`${e.redirectTo}`);i=i.children[se]}}applyRedirectCommands(e,t,r,i,s){if(typeof t!="string"){let a=t,{queryParams:l,fragment:u,routeConfig:h,url:f,outlet:g,params:_,data:E,title:S}=i,I=rn(s,()=>a({params:_,data:E,queryParams:l,fragment:u,routeConfig:h,url:f,outlet:g,title:S}));if(I instanceof Tr)throw new xa(I);t=I}let o=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t[0]==="/")throw new xa(o);return o}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new Tr(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(e,l,r,i)}),new _e(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new Ge(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Lp={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function HN(n,e,t,r,i){let s=zp(n,e,t);return s.matched?(r=TN(e,r),GN(r,e,t,i).pipe(Q(o=>o===!0?s:G({},Lp)))):W(s)}function zp(n,e,t){if(e.path==="**")return QN(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?G({},Lp):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||$D)(t,n,e);if(!i)return G({},Lp);let s={};Object.entries(i.posParams??{}).forEach(([a,l])=>{s[a]=l.path});let o=i.consumed.length>0?G(G({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function QN(n){return{matched:!0,parameters:n.length>0?qT(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function VT(n,e,t,r){return t.length>0&&JN(n,t,r)?{segmentGroup:new _e(e,XN(r,new _e(t,n.children))),slicedSegments:[]}:t.length===0&&ZN(n,t,r)?{segmentGroup:new _e(n.segments,YN(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new _e(n.segments,n.children),slicedSegments:t}}function YN(n,e,t,r){let i={};for(let s of t)if(Tu(n,e,s)&&!r[sn(s)]){let o=new _e([],{});i[sn(s)]=o}return G(G({},r),i)}function XN(n,e){let t={};t[se]=e;for(let r of n)if(r.path===""&&sn(r)!==se){let i=new _e([],{});t[sn(r)]=i}return t}function JN(n,e,t){return t.some(r=>Tu(n,e,r)&&sn(r)!==se)}function ZN(n,e,t){return t.some(r=>Tu(n,e,r))}function Tu(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function ek(n,e,t,r){return sn(n)!==r&&(r===se||!Tu(e,t,n))?!1:zp(e,n,t).matched}function tk(n,e,t){return e.length===0&&!n.children[t]}var Fp=class{};function nk(n,e,t,r,i,s,o="emptyOnly"){return new Vp(n,e,t,r,i,o,s).recognize()}var rk=31,Vp=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Mp(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new Ge(4002,`'${e.segmentGroup}'`)}recognize(){let e=VT(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Q(({children:t,rootSnapshot:r})=>{let i=new Ot(r,t),s=new yu("",i),o=cN(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}))}match(e){let t=new _s([],Object.freeze({}),Object.freeze(G({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),se,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,se,t).pipe(Q(r=>({children:r,rootSnapshot:t})),ss(r=>{if(r instanceof xa)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof ka?this.noMatchError(r):r}))}processSegmentGroup(e,t,r,i,s){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r,s):this.processSegment(e,t,r,r.segments,i,!0,s).pipe(Q(o=>o instanceof Ot?[o]:[]))}processChildren(e,t,r,i){let s=[];for(let o of Object.keys(r.children))o==="primary"?s.unshift(o):s.push(o);return Ie(s).pipe(ai(o=>{let a=r.children[o],l=IN(t,o);return this.processSegmentGroup(e,l,a,o,i)}),Gn((o,a)=>(o.push(...a),o)),Df(null),xE(),zt(o=>{if(o===null)return ps(r);let a=lI(o);return ik(a),W(a)}))}processSegment(e,t,r,i,s,o,a){return Ie(t).pipe(ai(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,r,i,s,o,a).pipe(ss(u=>{if(u instanceof ka)return W(null);throw u}))),_n(l=>!!l),ss(l=>{if(aI(l))return tk(r,i,s)?W(new Fp):ps(r);throw l}))}processSegmentAgainstRoute(e,t,r,i,s,o,a,l){return ek(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o,l):ps(i):ps(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o,a){let{matched:l,parameters:u,consumedSegments:h,positionalParamSegments:f,remainingSegments:g}=zp(t,i,s);if(!l)return ps(t);typeof i.redirectTo=="string"&&i.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>rk&&(this.allowRedirects=!1));let _=new _s(s,u,Object.freeze(G({},this.urlTree.queryParams)),this.urlTree.fragment,UT(i),sn(i),i.component??i._loadedComponent??null,i,jT(i)),E=_u(_,a,this.paramsInheritanceStrategy);_.params=Object.freeze(E.params),_.data=Object.freeze(E.data);let S=this.applyRedirects.applyRedirectCommands(h,i.redirectTo,f,_,e);return this.applyRedirects.lineralizeSegments(i,S).pipe(zt(I=>this.processSegment(e,r,t,I.concat(g),o,!1,a)))}matchSegmentAgainstRoute(e,t,r,i,s,o){let a=HN(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),a.pipe(we(l=>l.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(we(({routes:u})=>{let h=r._loadedInjector??e,{parameters:f,consumedSegments:g,remainingSegments:_}=l,E=new _s(g,f,Object.freeze(G({},this.urlTree.queryParams)),this.urlTree.fragment,UT(r),sn(r),r.component??r._loadedComponent??null,r,jT(r)),S=_u(E,o,this.paramsInheritanceStrategy);E.params=Object.freeze(S.params),E.data=Object.freeze(S.data);let{segmentGroup:I,slicedSegments:O}=VT(t,g,_,u);if(O.length===0&&I.hasChildren())return this.processChildren(h,u,I,E).pipe(Q(x=>new Ot(E,x)));if(u.length===0&&O.length===0)return W(new Ot(E,[]));let j=sn(r)===s;return this.processSegment(h,u,I,O,j?se:s,!0,E).pipe(Q(x=>new Ot(E,x instanceof Ot?[x]:[])))}))):ps(t)))}getChildConfig(e,t,r){return t.children?W({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?W({routes:t._loadedRoutes,injector:t._loadedInjector}):zN(e,t,r,this.urlSerializer).pipe(zt(i=>i?this.configLoader.loadChildren(e,t).pipe(ze(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):KN(t))):W({routes:[],injector:e})}};function ik(n){n.sort((e,t)=>e.value.outlet===se?-1:t.value.outlet===se?1:e.value.outlet.localeCompare(t.value.outlet))}function sk(n){let e=n.value.routeConfig;return e&&e.path===""}function lI(n){let e=[],t=new Set;for(let r of n){if(!sk(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=lI(r.children);e.push(new Ot(r.value,i))}return e.filter(r=>!t.has(r))}function UT(n){return n.data||{}}function jT(n){return n.resolve||{}}function ok(n,e,t,r,i,s){return zt(o=>nk(n,e,t,r,o.extractedUrl,i,s).pipe(Q(({state:a,tree:l})=>Fe(G({},o),{targetSnapshot:a,urlAfterRedirects:l}))))}function ak(n,e){return zt(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return W(t);let s=new Set(i.map(l=>l.route)),o=new Set;for(let l of s)if(!o.has(l))for(let u of uI(l))o.add(u);let a=0;return Ie(o).pipe(ai(l=>s.has(l)?ck(l,r,n,e):(l.data=_u(l,l.parent,n).resolve,W(void 0))),ze(()=>a++),Nf(1),zt(l=>a===o.size?W(t):pr))})}function uI(n){let e=n.children.map(t=>uI(t)).flat();return[n,...e]}function ck(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!rI(i)&&(s[Oa]=i.title),lk(s,n,e,r).pipe(Q(o=>(n._resolvedData=o,n.data=_u(n,n.parent,t).resolve,null)))}function lk(n,e,t,r){let i=pp(n);if(i.length===0)return W({});let s={};return Ie(i).pipe(zt(o=>uk(n[o],e,t,r).pipe(_n(),ze(a=>{if(a instanceof Na)throw vu(new ba,a);s[o]=a}))),Nf(1),kE(s),ss(o=>aI(o)?pr:ra(o)))}function uk(n,e,t,r){let i=Ma(e)??r,s=Ts(n,i),o=s.resolve?s.resolve(e,t):rn(i,()=>s(e,t));return br(o)}function dp(n){return we(e=>{let t=n(e);return t?Ie(t).pipe(Q(()=>e)):W(e)})}var hI=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===se);return i}getResolvedTitleForRoute(r){return r.data[Oa]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:()=>Z(hk),providedIn:"root"});let n=e;return n})(),hk=(()=>{let e=class e extends hI{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(F(xT))},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Gp=new te("",{providedIn:"root",factory:()=>({})}),Wp=new te(""),dk=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Z(qf)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return W(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=br(r.loadComponent()).pipe(Q(dI),ze(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),as(()=>{this.componentLoaders.delete(r)})),s=new Sf(i,()=>new mn).pipe(Rf());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return W({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=fk(i,this.compiler,r,this.onLoadEndListener).pipe(as(()=>{this.childrenLoaders.delete(i)})),a=new Sf(o,()=>new mn).pipe(Rf());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function fk(n,e,t,r){return br(n.loadChildren()).pipe(Q(dI),zt(i=>i instanceof YE||Array.isArray(i)?W(i):Ie(e.compileModuleAsync(i))),Q(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Wp,[],{optional:!0,self:!0}).flat()),{routes:o.map($p),injector:s}}))}function pk(n){return n&&typeof n=="object"&&"default"in n}function dI(n){return pk(n)?n.default:n}var Kp=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:()=>Z(gk),providedIn:"root"});let n=e;return n})(),gk=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),mk=new te("");var _k=new te(""),yk=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new mn,this.transitionAbortSubject=new mn,this.configLoader=Z(dk),this.environmentInjector=Z(ls),this.urlSerializer=Z(jp),this.rootContexts=Z(Eu),this.location=Z(Gl),this.inputBindingEnabled=Z(qp,{optional:!0})!==null,this.titleStrategy=Z(hI),this.options=Z(Gp,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Z(Kp),this.createViewTransition=Z(mk,{optional:!0}),this.navigationErrorHandler=Z(_k,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>W(void 0),this.rootComponentType=null;let r=s=>this.events.next(new Ip(s)),i=s=>this.events.next(new bp(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(Fe(G(G({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new $t({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Ta,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(xt(o=>o.id!==0),Q(o=>Fe(G({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),we(o=>{let a=!1,l=!1;return W(o).pipe(we(u=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",Mt.SupersededByNewNavigation),pr;this.currentTransition=o,this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?Fe(G({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let h=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),f=u.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!h&&f!=="reload"){let g="";return this.events.next(new pi(u.id,this.urlSerializer.serialize(u.rawUrl),g,yp.IgnoredSameUrlNavigation)),u.resolve(!1),pr}if(this.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return W(u).pipe(we(g=>{let _=this.transitions?.getValue();return this.events.next(new Sa(g.id,this.urlSerializer.serialize(g.extractedUrl),g.source,g.restoredState)),_!==this.transitions?.getValue()?pr:Promise.resolve(g)}),ok(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),ze(g=>{o.targetSnapshot=g.targetSnapshot,o.urlAfterRedirects=g.urlAfterRedirects,this.currentNavigation=Fe(G({},this.currentNavigation),{finalUrl:g.urlAfterRedirects});let _=new pu(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(_)}));if(h&&this.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){let{id:g,extractedUrl:_,source:E,restoredState:S,extras:I}=u,O=new Sa(g,this.urlSerializer.serialize(_),E,S);this.events.next(O);let j=tI(this.rootComponentType).snapshot;return this.currentTransition=o=Fe(G({},u),{targetSnapshot:j,urlAfterRedirects:_,extras:Fe(G({},I),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=_,W(o)}else{let g="";return this.events.next(new pi(u.id,this.urlSerializer.serialize(u.extractedUrl),g,yp.IgnoredByUrlHandlingStrategy)),u.resolve(!1),pr}}),ze(u=>{let h=new vp(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(h)}),Q(u=>(this.currentTransition=o=Fe(G({},u),{guards:AN(u.targetSnapshot,u.currentSnapshot,this.rootContexts)}),o)),LN(this.environmentInjector,u=>this.events.next(u)),ze(u=>{if(o.guardsResult=u.guardsResult,u.guardsResult&&typeof u.guardsResult!="boolean")throw vu(this.urlSerializer,u.guardsResult);let h=new wp(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(h)}),xt(u=>u.guardsResult?!0:(this.cancelNavigationTransition(u,"",Mt.GuardRejected),!1)),dp(u=>{if(u.guards.canActivateChecks.length)return W(u).pipe(ze(h=>{let f=new Ep(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}),we(h=>{let f=!1;return W(h).pipe(ak(this.paramsInheritanceStrategy,this.environmentInjector),ze({next:()=>f=!0,complete:()=>{f||this.cancelNavigationTransition(h,"",Mt.NoDataFromResolver)}}))}),ze(h=>{let f=new Tp(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}))}),dp(u=>{let h=f=>{let g=[];f.routeConfig?.loadComponent&&!f.routeConfig._loadedComponent&&g.push(this.configLoader.loadComponent(f.routeConfig).pipe(ze(_=>{f.component=_}),Q(()=>{})));for(let _ of f.children)g.push(...h(_));return g};return Cf(h(u.targetSnapshot.root)).pipe(Df(null),os(1))}),dp(()=>this.afterPreactivation()),we(()=>{let{currentSnapshot:u,targetSnapshot:h}=o,f=this.createViewTransition?.(this.environmentInjector,u.root,h.root);return f?Ie(f).pipe(Q(()=>o)):W(o)}),Q(u=>{let h=_N(r.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=o=Fe(G({},u),{targetRouterState:h}),this.currentNavigation.targetRouterState=h,o}),ze(()=>{this.events.next(new Pa)}),bN(this.rootContexts,r.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),os(1),ze({next:u=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ir(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),this.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{a=!0}}),LE(this.transitionAbortSubject.pipe(ze(u=>{throw u}))),as(()=>{!a&&!l&&this.cancelNavigationTransition(o,"",Mt.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),ss(u=>{if(l=!0,oI(u))this.events.next(new Yn(o.id,this.urlSerializer.serialize(o.extractedUrl),u.message,u.cancellationCode)),wN(u)?this.events.next(new ws(u.url,u.navigationBehaviorOptions)):o.resolve(!1);else{let h=new Ca(o.id,this.urlSerializer.serialize(o.extractedUrl),u,o.targetSnapshot??void 0);try{let f=rn(this.environmentInjector,()=>this.navigationErrorHandler?.(h));if(f instanceof Na){let{message:g,cancellationCode:_}=vu(this.urlSerializer,f);this.events.next(new Yn(o.id,this.urlSerializer.serialize(o.extractedUrl),g,_)),this.events.next(new ws(f.redirectTo,f.navigationBehaviorOptions))}else{this.events.next(h);let g=r.errorHandler(u);o.resolve(!!g)}}catch(f){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(f)}}return pr}))}))}cancelNavigationTransition(r,i,s){let o=new Yn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function vk(n){return n!==Ta}var wk=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:()=>Z(Ek),providedIn:"root"});let n=e;return n})(),Up=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},Ek=(()=>{let e=class e extends Up{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ff(e)))(s||e)}})(),e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),fI=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:()=>Z(Tk),providedIn:"root"});let n=e;return n})(),Tk=(()=>{let e=class e extends fI{constructor(){super(...arguments),this.location=Z(Gl),this.urlSerializer=Z(jp),this.options=Z(Gp,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Z(Kp),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Tr,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=tI(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof Sa)this.stateMemento=this.createStateMemento();else if(r instanceof pi)this.rawUrlTree=i.initialUrl;else if(r instanceof pu){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Pa?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Yn&&(r.code===Mt.GuardRejected||r.code===Mt.NoDataFromResolver)?this.restoreHistory(i):r instanceof Ca?this.restoreHistory(i,!0):r instanceof Ir&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=G(G({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=G(G({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ff(e)))(s||e)}})(),e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),wa=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(wa||{});function Ik(n,e){n.events.pipe(xt(t=>t instanceof Ir||t instanceof Yn||t instanceof Ca||t instanceof pi),Q(t=>t instanceof Ir||t instanceof pi?wa.COMPLETE:(t instanceof Yn?t.code===Mt.Redirect||t.code===Mt.SupersededByNewNavigation:!1)?wa.REDIRECTING:wa.FAILED),xt(t=>t!==wa.REDIRECTING),os(1)).subscribe(()=>{e()})}function bk(n){throw n}var Ak={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Rk={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Hp=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Z(Bl),this.stateManager=Z(fI),this.options=Z(Gp,{optional:!0})||{},this.pendingTasks=Z(Vl),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Z(yk),this.urlSerializer=Z(jp),this.location=Z(Gl),this.urlHandlingStrategy=Z(Kp),this._events=new mn,this.errorHandler=this.options.errorHandler||bk,this.navigated=!1,this.routeReuseStrategy=Z(wk),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Z(Wp,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Z(qp,{optional:!0}),this.eventsSubscription=new AE,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Yn&&i.code!==Mt.Redirect&&i.code!==Mt.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Ir)this.navigated=!0;else if(i instanceof ws){let a=i.navigationBehaviorOptions,l=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u=G({info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:s.extras.replaceUrl||this.urlUpdateStrategy==="eager"||vk(s.source)},a);this.scheduleNavigation(l,Ta,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}Ck(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ta,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let u=G({},s);delete u.navigationId,delete u.\u0275routerPageId,Object.keys(u).length!==0&&(o.state=u)}let l=this.parseUrl(r);this.scheduleNavigation(l,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map($p),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:l,preserveFragment:u}=i,h=u?this.currentUrlTree.fragment:a,f=null;switch(l){case"merge":f=G(G({},this.currentUrlTree.queryParams),o);break;case"preserve":f=this.currentUrlTree.queryParams;break;default:f=o||null}f!==null&&(f=this.removeEmptyProps(f));let g;try{let _=s?s.snapshot:this.routerState.snapshot.root;g=XT(_)}catch{(typeof r[0]!="string"||r[0][0]!=="/")&&(r=[]),g=this.currentUrlTree.root}return JT(g,r,f,h??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Aa(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Ta,null,i)}navigate(r,i={skipLocationChange:!1}){return Sk(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=G({},Ak):i===!1?s=G({},Rk):s=i,Aa(r))return OT(this.currentUrlTree,r,s);let o=this.parseUrl(r);return OT(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let l,u,h;a?(l=a.resolve,u=a.reject,h=a.promise):h=new Promise((g,_)=>{l=g,u=_});let f=this.pendingTasks.add();return Ik(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(f))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:l,reject:u,promise:h,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),h.catch(g=>Promise.reject(g))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Sk(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new Ge(4008,!1)}function Ck(n){return!(n instanceof Pa)&&!(n instanceof ws)}var I2=(()=>{let e=class e{constructor(r,i,s,o,a,l){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=l,this.href=null,this.commands=null,this.onChanges=new mn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let u=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=u==="a"||u==="area",this.isAnchorElement?this.subscription=r.events.subscribe(h=>{h instanceof Ir&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let l=this.urlTree;if(l===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let u={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(l,u),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:GE(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(ui(Hp),ui(gi),BE("tabindex"),ui(KE),ui(qE),ui(Gf))},e.\u0275dir=Mf({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&eT("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&JE("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",zl],skipLocationChange:[2,"skipLocationChange","skipLocationChange",zl],replaceUrl:[2,"replaceUrl","replaceUrl",zl],routerLink:"routerLink"},standalone:!0,features:[QE,Lf]});let n=e;return n})();var Pk=new te("");function b2(n,...e){return li([{provide:Wp,multi:!0,useValue:n},[],{provide:gi,useFactory:Dk,deps:[Hp]},{provide:Bf,multi:!0,useFactory:Nk},e.map(t=>t.\u0275providers)])}function Dk(n){return n.routerState.root}function Nk(){let n=Z(Fl);return e=>{let t=n.get(ql);if(e!==t.components[0])return;let r=n.get(Hp),i=n.get(kk);n.get(xk)===1&&r.initialNavigation(),n.get(Ok,null,Of.Optional)?.setUpPreloading(),n.get(Pk,null,Of.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var kk=new te("",{factory:()=>new mn}),xk=new te("",{providedIn:"root",factory:()=>1});var Ok=new te("");var Is=class{constructor(e,t,r,i,s,o,a,l,u,h,f,g=null){this.obraSocial=null,this.especialidad=null,this.imagenes=[],this.aprobado=null,this.lastLogin=null,this.nombre=e,this.apellido=t,this.dni=r,this.edad=i,this.obraSocial=s,this.especialidad=o,this.contrase\u00F1a=a,this.mail=l,this.imagenes=u,this.code=h,this.lastLogin=f,this.aprobado=g}};var Mk="firebase",Lk="10.12.2";Ce.registerVersion(Mk,Lk,"app-compat");var Fk="firebase",Vk="10.12.2";nt(Fk,Vk,"app");var an=new Ul("ANGULARFIRE2_VERSION");function U2(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Uk=(n,e)=>{let t=e?[e]:eu(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},on=class{constructor(){return Uk(jk)}},jk="app-check";function Qp(){}var Iu=class{zone;delegate;constructor(e,t=SE){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Yp=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Qp,{},Qp,Qp)),t.pipe(ze({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Tn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Iu(Zone.current)),this.insideAngular=t.run(()=>new Iu(Zone.current,rs)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(F(Ve))};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function pI(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Xp(n){return n.pipe(gr(pI().outsideAngular))}function Pe(n){return Bk(pI())(n)}function Bk(n){return function(t){return t=t.lift(new Yp(n.ngZone)),t.pipe(is(n.outsideAngular),gr(n.insideAngular))}}var Fa=class{constructor(e){return e}},Jp=class{constructor(){return eu()}};function qk(n){return n&&n.length===1?n[0]:new Fa(Kn())}var Zp=new te("angularfire2._apps"),$k={provide:Fa,useFactory:qk,deps:[[new ci,Zp]]},zk={provide:Jp,deps:[[new ci,Zp]]};function Gk(n){return(e,t)=>{let r=t.get(Je);nt("angularfire",an.full,"core"),nt("angularfire",an.full,"app"),nt("angular",jl.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Fa(i)}}function X2(n,...e){return li([$k,zk,{provide:Zp,useFactory:Gk(n),multi:!0,deps:[Ve,Fl,Tn,...e]}])}var Wk=new Map,Kk={activated:!1,tokenObservers:[]},Hk={initialized:!1,enabled:!1};function cn(n){return Wk.get(n)||Object.assign({},Kk)}function vI(){return Hk}var Qk="https://content-firebaseappcheck.googleapis.com/v1";var Yk="exchangeDebugToken",gI={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},cj=24*60*60*1e3;var tg=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return P(this,null,function*(){this.stop();try{this.pending=new tt,this.pending.promise.catch(t=>{}),yield Xk(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new tt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Xk(n){return new Promise(e=>{setTimeout(e,n)})}var Jk={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ar=new uT("appCheck","AppCheck",Jk);function wI(n){if(!cn(n).activated)throw Ar.create("use-before-activation",{appName:n.name})}function EI(r,i){return P(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let _=yield o.getHeartbeatsHeader();_&&(s["X-Firebase-Client"]=_)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(_){throw Ar.create("fetch-network-error",{originalErrorMessage:_?.message})}if(l.status!==200)throw Ar.create("fetch-status-error",{httpStatus:l.status});let u;try{u=yield l.json()}catch(_){throw Ar.create("fetch-parse-error",{originalErrorMessage:_?.message})}let h=u.ttl.match(/^([\d.]+)(s)$/);if(!h||!h[2]||isNaN(Number(h[1])))throw Ar.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${u.ttl}`});let f=Number(h[1])*1e3,g=Date.now();return{token:u.token,expireTimeMillis:g+f,issuedAtTimeMillis:g}})}function TI(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${Qk}/projects/${t}/apps/${r}:${Yk}?key=${i}`,body:{debug_token:e}}}var Zk="firebase-app-check-database",ex=1,ng="firebase-app-check-store";var Au=null;function tx(){return Au||(Au=new Promise((n,e)=>{try{let t=indexedDB.open(Zk,ex);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Ar.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(ng,{keyPath:"compositeKey"})}}}catch(t){e(Ar.create("storage-open",{originalErrorMessage:t?.message}))}}),Au)}function nx(n,e){return rx(ix(n),e)}function rx(n,e){return P(this,null,function*(){let r=(yield tx()).transaction(ng,"readwrite"),s=r.objectStore(ng).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var u;a(Ar.create("storage-set",{originalErrorMessage:(u=l.target.error)===null||u===void 0?void 0:u.message}))}})})}function ix(n){return`${n.options.appId}-${n.name}`}var rg=new yr("@firebase/app-check");function eg(n,e){return Ql()?nx(n,e).catch(t=>{rg.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function II(){return vI().enabled}function bI(){return P(this,null,function*(){let n=vI();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var sx={error:"UNKNOWN_ERROR"};function ox(n){return Hl.encodeString(JSON.stringify(n),!1)}function ig(n,e=!1){return P(this,null,function*(){let t=n.app;wI(t);let r=cn(t),i=r.token,s;if(i&&!Va(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Va(l)?i=l:yield eg(t,void 0))}if(!e&&i&&Va(i))return{token:i.token};let o=!1;if(II()){r.exchangeTokenPromise||(r.exchangeTokenPromise=EI(TI(t,yield bI()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield eg(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield cn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?rg.warn(l.message):rg.error(l),s=l}let a;return i?s?Va(i)?a={token:i.token,internalError:s}:a=_I(s):(a={token:i.token},r.token=i,yield eg(t,i)):a=_I(s),o&&ux(t,a),a})}function ax(n){return P(this,null,function*(){let e=n.app;wI(e);let{provider:t}=cn(e);if(II()){let r=yield bI(),{token:i}=yield EI(TI(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function cx(n,e,t,r){let{app:i}=n,s=cn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Va(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),mI(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>mI(n))}function AI(n,e){let t=cn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function mI(n){let{app:e}=n,t=cn(e),r=t.tokenRefresher;r||(r=lx(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function lx(n){let{app:e}=n;return new tg(()=>P(this,null,function*(){let t=cn(e),r;if(t.token?r=yield ig(n,!0):r=yield ig(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=cn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},gI.RETRIAL_MIN_WAIT,gI.RETRIAL_MAX_WAIT)}function ux(n,e){let t=cn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Va(n){return n.expireTimeMillis-Date.now()>0}function _I(n){return{token:ox(sx),error:n}}var sg=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=cn(this.app);for(let t of e)AI(this.app,t.next);return Promise.resolve()}};function hx(n,e){return new sg(n,e)}function dx(n){return{getToken:e=>ig(n,e),getLimitedUseToken:()=>ax(n),addTokenListener:e=>cx(n,"INTERNAL",e),removeTokenListener:e=>AI(n.app,e)}}var fx="@firebase/app-check",px="0.8.4";var gx="app-check",yI="app-check-internal";function mx(){Wn(new ct(gx,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return hx(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(yI).initialize()})),Wn(new ct(yI,n=>{let e=n.getProvider("app-check").getImmediate();return dx(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),nt(fx,px)}mx();var _x=["localhost","0.0.0.0","127.0.0.1"],wj=typeof window<"u"&&_x.includes(window.location.hostname);var yx=["ngOnDestroy"],SI=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(yx.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(u=>t.run(()=>u)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,u)=>o.then(h=>{let f=h?.(...u);return r?.spy?.apply&&r.spy.apply(s,u,f),f})})})});var Su=class{constructor(e){return e}},In=new te("angularfire2.app.options"),bn=new te("angularfire2.app.name");function Xn(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Ce.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Ce.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;vx("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Su(o)}var vx=(n,...e)=>{$f()&&typeof console<"u"&&console[n](...e)},wx={provide:Su,useFactory:Xn,deps:[In,Ve,[new ci,bn]]},Cj=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:In,useValue:t},{provide:bn,useValue:r}]}}constructor(t){Ce.registerVersion("angularfire",an.full,"core"),Ce.registerVersion("angularfire",an.full,"app-compat"),Ce.registerVersion("angular",jl.full,t.toString())}static \u0275fac=function(r){return new(r||n)(F(Je))};static \u0275mod=vn({type:n});static \u0275inj=yn({providers:[wx]})}return n})();function Rr(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return Ex(i,o)||(RI("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Tx?" You may need to reload as Firebase is not HMR aware.":""}`),RI("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function Ex(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Tx=typeof module<"u"&&!!module.hot,RI=(n,...e)=>{$f()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Ua=new te("angularfire2.auth.use-emulator"),ja=new te("angularfire2.auth.settings"),Ba=new te("angularfire2.auth.tenant-id"),qa=new te("angularfire2.auth.langugage-code"),$a=new te("angularfire2.auth.use-device-language"),za=new te("angularfire.auth.persistence"),Ga=(n,e,t,r,i,s,o,a)=>Rr(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[u,h]of Object.entries(o))l.settings[u]=h;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),bs=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,u,h,f,g,_){let E=new mn,S=W(void 0).pipe(gr(o.outsideAngular),we(()=>s.runOutsideAngular(()=>import("./chunk-LCZMND5X.js"))),Q(()=>Xn(t,s,r)),Q(I=>Ga(I,s,a,u,h,f,l,g)),kf({bufferSize:1,refCount:!1}));if(mr(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=W(null);else{S.pipe(_n()).subscribe();let I=S.pipe(we(x=>x.getRedirectResult().then(U=>U,()=>null)),Pe,kf({bufferSize:1,refCount:!1})),O=S.pipe(we(x=>new kt(U=>({unsubscribe:s.runOutsideAngular(()=>x.onAuthStateChanged(Y=>U.next(Y),Y=>U.error(Y),()=>U.complete()))})))),j=S.pipe(we(x=>new kt(U=>({unsubscribe:s.runOutsideAngular(()=>x.onIdTokenChanged(Y=>U.next(Y),Y=>U.error(Y),()=>U.complete()))}))));this.authState=I.pipe(xf(O),is(o.outsideAngular),gr(o.insideAngular)),this.user=I.pipe(xf(j),is(o.outsideAngular),gr(o.insideAngular)),this.idToken=this.user.pipe(we(x=>x?Ie(x.getIdToken()):W(null))),this.idTokenResult=this.user.pipe(we(x=>x?Ie(x.getIdTokenResult()):W(null))),this.credential=ia(I,E,this.authState.pipe(xt(x=>!x))).pipe(Q(x=>x?.user?x:null),is(o.outsideAngular),gr(o.insideAngular))}return SI(this,S,s,{spy:{apply:(I,O,j)=>{(I.startsWith("signIn")||I.startsWith("createUser"))&&j.then(x=>E.next(x))}}})}static \u0275fac=function(r){return new(r||n)(F(In),F(bn,8),F(Je),F(Ve),F(Tn),F(Ua,8),F(ja,8),F(Ba,8),F(qa,8),F($a,8),F(za,8),F(on,8))};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var CI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},PI={};var Sr,ag;(function(){var n;function e(T,y){function w(){}w.prototype=y.prototype,T.D=y.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(b,A,C){for(var v=Array(arguments.length-2),qn=2;qn<arguments.length;qn++)v[qn-2]=arguments[qn];return y.prototype[A].apply(b,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,y,w){w||(w=0);var b=Array(16);if(typeof y=="string")for(var A=0;16>A;++A)b[A]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(A=0;16>A;++A)b[A]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=T.g[0],w=T.g[1],A=T.g[2];var C=T.g[3],v=y+(C^w&(A^C))+b[0]+3614090360&4294967295;y=w+(v<<7&4294967295|v>>>25),v=C+(A^y&(w^A))+b[1]+3905402710&4294967295,C=y+(v<<12&4294967295|v>>>20),v=A+(w^C&(y^w))+b[2]+606105819&4294967295,A=C+(v<<17&4294967295|v>>>15),v=w+(y^A&(C^y))+b[3]+3250441966&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(C^w&(A^C))+b[4]+4118548399&4294967295,y=w+(v<<7&4294967295|v>>>25),v=C+(A^y&(w^A))+b[5]+1200080426&4294967295,C=y+(v<<12&4294967295|v>>>20),v=A+(w^C&(y^w))+b[6]+2821735955&4294967295,A=C+(v<<17&4294967295|v>>>15),v=w+(y^A&(C^y))+b[7]+4249261313&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(C^w&(A^C))+b[8]+1770035416&4294967295,y=w+(v<<7&4294967295|v>>>25),v=C+(A^y&(w^A))+b[9]+2336552879&4294967295,C=y+(v<<12&4294967295|v>>>20),v=A+(w^C&(y^w))+b[10]+4294925233&4294967295,A=C+(v<<17&4294967295|v>>>15),v=w+(y^A&(C^y))+b[11]+2304563134&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(C^w&(A^C))+b[12]+1804603682&4294967295,y=w+(v<<7&4294967295|v>>>25),v=C+(A^y&(w^A))+b[13]+4254626195&4294967295,C=y+(v<<12&4294967295|v>>>20),v=A+(w^C&(y^w))+b[14]+2792965006&4294967295,A=C+(v<<17&4294967295|v>>>15),v=w+(y^A&(C^y))+b[15]+1236535329&4294967295,w=A+(v<<22&4294967295|v>>>10),v=y+(A^C&(w^A))+b[1]+4129170786&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^A&(y^w))+b[6]+3225465664&4294967295,C=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(C^y))+b[11]+643717713&4294967295,A=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(A^C))+b[0]+3921069994&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(A^C&(w^A))+b[5]+3593408605&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^A&(y^w))+b[10]+38016083&4294967295,C=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(C^y))+b[15]+3634488961&4294967295,A=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(A^C))+b[4]+3889429448&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(A^C&(w^A))+b[9]+568446438&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^A&(y^w))+b[14]+3275163606&4294967295,C=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(C^y))+b[3]+4107603335&4294967295,A=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(A^C))+b[8]+1163531501&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(A^C&(w^A))+b[13]+2850285829&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^A&(y^w))+b[2]+4243563512&4294967295,C=y+(v<<9&4294967295|v>>>23),v=A+(y^w&(C^y))+b[7]+1735328473&4294967295,A=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(A^C))+b[12]+2368359562&4294967295,w=A+(v<<20&4294967295|v>>>12),v=y+(w^A^C)+b[5]+4294588738&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^A)+b[8]+2272392833&4294967295,C=y+(v<<11&4294967295|v>>>21),v=A+(C^y^w)+b[11]+1839030562&4294967295,A=C+(v<<16&4294967295|v>>>16),v=w+(A^C^y)+b[14]+4259657740&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(w^A^C)+b[1]+2763975236&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^A)+b[4]+1272893353&4294967295,C=y+(v<<11&4294967295|v>>>21),v=A+(C^y^w)+b[7]+4139469664&4294967295,A=C+(v<<16&4294967295|v>>>16),v=w+(A^C^y)+b[10]+3200236656&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(w^A^C)+b[13]+681279174&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^A)+b[0]+3936430074&4294967295,C=y+(v<<11&4294967295|v>>>21),v=A+(C^y^w)+b[3]+3572445317&4294967295,A=C+(v<<16&4294967295|v>>>16),v=w+(A^C^y)+b[6]+76029189&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(w^A^C)+b[9]+3654602809&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^A)+b[12]+3873151461&4294967295,C=y+(v<<11&4294967295|v>>>21),v=A+(C^y^w)+b[15]+530742520&4294967295,A=C+(v<<16&4294967295|v>>>16),v=w+(A^C^y)+b[2]+3299628645&4294967295,w=A+(v<<23&4294967295|v>>>9),v=y+(A^(w|~C))+b[0]+4096336452&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~A))+b[7]+1126891415&4294967295,C=y+(v<<10&4294967295|v>>>22),v=A+(y^(C|~w))+b[14]+2878612391&4294967295,A=C+(v<<15&4294967295|v>>>17),v=w+(C^(A|~y))+b[5]+4237533241&4294967295,w=A+(v<<21&4294967295|v>>>11),v=y+(A^(w|~C))+b[12]+1700485571&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~A))+b[3]+2399980690&4294967295,C=y+(v<<10&4294967295|v>>>22),v=A+(y^(C|~w))+b[10]+4293915773&4294967295,A=C+(v<<15&4294967295|v>>>17),v=w+(C^(A|~y))+b[1]+2240044497&4294967295,w=A+(v<<21&4294967295|v>>>11),v=y+(A^(w|~C))+b[8]+1873313359&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~A))+b[15]+4264355552&4294967295,C=y+(v<<10&4294967295|v>>>22),v=A+(y^(C|~w))+b[6]+2734768916&4294967295,A=C+(v<<15&4294967295|v>>>17),v=w+(C^(A|~y))+b[13]+1309151649&4294967295,w=A+(v<<21&4294967295|v>>>11),v=y+(A^(w|~C))+b[4]+4149444226&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~A))+b[11]+3174756917&4294967295,C=y+(v<<10&4294967295|v>>>22),v=A+(y^(C|~w))+b[2]+718787259&4294967295,A=C+(v<<15&4294967295|v>>>17),v=w+(C^(A|~y))+b[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(A+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+C&4294967295}r.prototype.u=function(T,y){y===void 0&&(y=T.length);for(var w=y-this.blockSize,b=this.B,A=this.h,C=0;C<y;){if(A==0)for(;C<=w;)i(this,T,C),C+=this.blockSize;if(typeof T=="string"){for(;C<y;)if(b[A++]=T.charCodeAt(C++),A==this.blockSize){i(this,b),A=0;break}}else for(;C<y;)if(b[A++]=T[C++],A==this.blockSize){i(this,b),A=0;break}}this.h=A,this.o+=y},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;var w=8*this.o;for(y=T.length-8;y<T.length;++y)T[y]=w&255,w/=256;for(this.u(T),T=Array(16),y=w=0;4>y;++y)for(var b=0;32>b;b+=8)T[w++]=this.g[y]>>>b&255;return T};function s(T,y){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=y(T)}function o(T,y){this.h=y;for(var w=[],b=!0,A=T.length-1;0<=A;A--){var C=T[A]|0;b&&C==y||(w[A]=C,b=!1)}this.g=w}var a={};function l(T){return-128<=T&&128>T?s(T,function(y){return new o([y|0],0>y?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return I(u(-T));for(var y=[],w=1,b=0;T>=w;b++)y[b]=T/w|0,w*=4294967296;return new o(y,0)}function h(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return I(h(T.substring(1),y));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(y,8)),b=f,A=0;A<T.length;A+=8){var C=Math.min(8,T.length-A),v=parseInt(T.substring(A,A+C),y);8>C?(C=u(Math.pow(y,C)),b=b.j(C).add(u(v))):(b=b.j(w),b=b.add(u(v)))}return b}var f=l(0),g=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(S(this))return-I(this).m();for(var T=0,y=1,w=0;w<this.g.length;w++){var b=this.i(w);T+=(0<=b?b:4294967296+b)*y,y*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(E(this))return"0";if(S(this))return"-"+I(this).toString(T);for(var y=u(Math.pow(T,6)),w=this,b="";;){var A=U(w,y).g;w=O(w,A.j(y));var C=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=A,E(w))return C+b;for(;6>C.length;)C="0"+C;b=C+b}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function E(T){if(T.h!=0)return!1;for(var y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function S(T){return T.h==-1}n.l=function(T){return T=O(this,T),S(T)?-1:E(T)?0:1};function I(T){for(var y=T.g.length,w=[],b=0;b<y;b++)w[b]=~T.g[b];return new o(w,~T.h).add(g)}n.abs=function(){return S(this)?I(this):this},n.add=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],b=0,A=0;A<=y;A++){var C=b+(this.i(A)&65535)+(T.i(A)&65535),v=(C>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);b=v>>>16,C&=65535,v&=65535,w[A]=v<<16|C}return new o(w,w[w.length-1]&-2147483648?-1:0)};function O(T,y){return T.add(I(y))}n.j=function(T){if(E(this)||E(T))return f;if(S(this))return S(T)?I(this).j(I(T)):I(I(this).j(T));if(S(T))return I(this.j(I(T)));if(0>this.l(_)&&0>T.l(_))return u(this.m()*T.m());for(var y=this.g.length+T.g.length,w=[],b=0;b<2*y;b++)w[b]=0;for(b=0;b<this.g.length;b++)for(var A=0;A<T.g.length;A++){var C=this.i(b)>>>16,v=this.i(b)&65535,qn=T.i(A)>>>16,Vo=T.i(A)&65535;w[2*b+2*A]+=v*Vo,j(w,2*b+2*A),w[2*b+2*A+1]+=C*Vo,j(w,2*b+2*A+1),w[2*b+2*A+1]+=v*qn,j(w,2*b+2*A+1),w[2*b+2*A+2]+=C*qn,j(w,2*b+2*A+2)}for(b=0;b<y;b++)w[b]=w[2*b+1]<<16|w[2*b];for(b=y;b<2*y;b++)w[b]=0;return new o(w,0)};function j(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function x(T,y){this.g=T,this.h=y}function U(T,y){if(E(y))throw Error("division by zero");if(E(T))return new x(f,f);if(S(T))return y=U(I(T),y),new x(I(y.g),I(y.h));if(S(y))return y=U(T,I(y)),new x(I(y.g),y.h);if(30<T.g.length){if(S(T)||S(y))throw Error("slowDivide_ only works with positive integers.");for(var w=g,b=y;0>=b.l(T);)w=Y(w),b=Y(b);var A=H(w,1),C=H(b,1);for(b=H(b,2),w=H(w,2);!E(b);){var v=C.add(b);0>=v.l(T)&&(A=A.add(w),C=v),b=H(b,1),w=H(w,1)}return y=O(T,A.j(y)),new x(A,y)}for(A=f;0<=T.l(y);){for(w=Math.max(1,Math.floor(T.m()/y.m())),b=Math.ceil(Math.log(w)/Math.LN2),b=48>=b?1:Math.pow(2,b-48),C=u(w),v=C.j(y);S(v)||0<v.l(T);)w-=b,C=u(w),v=C.j(y);E(C)&&(C=g),A=A.add(C),T=O(T,v)}return new x(A,T)}n.A=function(T){return U(this,T).h},n.and=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],b=0;b<y;b++)w[b]=this.i(b)&T.i(b);return new o(w,this.h&T.h)},n.or=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],b=0;b<y;b++)w[b]=this.i(b)|T.i(b);return new o(w,this.h|T.h)},n.xor=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],b=0;b<y;b++)w[b]=this.i(b)^T.i(b);return new o(w,this.h^T.h)};function Y(T){for(var y=T.g.length+1,w=[],b=0;b<y;b++)w[b]=T.i(b)<<1|T.i(b-1)>>>31;return new o(w,T.h)}function H(T,y){var w=y>>5;y%=32;for(var b=T.g.length-w,A=[],C=0;C<b;C++)A[C]=0<y?T.i(C+w)>>>y|T.i(C+w+1)<<32-y:T.i(C+w);return new o(A,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ag=PI.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Sr=PI.Integer=o}).apply(typeof CI<"u"?CI:typeof self<"u"?self:typeof window<"u"?window:{});var Cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Jn={};var cg,lg,As,ug,Wa,Pu,hg,dg,fg;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,d,p){return c==Array.prototype||c==Object.prototype||(c[d]=p.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Cu=="object"&&Cu];for(var d=0;d<c.length;++d){var p=c[d];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function i(c,d){if(d)e:{var p=r;c=c.split(".");for(var m=0;m<c.length-1;m++){var R=c[m];if(!(R in p))break e;p=p[R]}c=c[c.length-1],m=p[c],d=d(m),d!=m&&d!=null&&e(p,c,{configurable:!0,writable:!0,value:d})}}function s(c,d){c instanceof String&&(c+="");var p=0,m=!1,R={next:function(){if(!m&&p<c.length){var N=p++;return{value:d(N,c[N]),done:!1}}return m=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}i("Array.prototype.values",function(c){return c||function(){return s(this,function(d,p){return p})}});var o=o||{},a=this||self;function l(c){var d=typeof c;return d=d!="object"?d:c?Array.isArray(c)?"array":d:"null",d=="array"||d=="object"&&typeof c.length=="number"}function u(c){var d=typeof c;return d=="object"&&c!=null||d=="function"}function h(c,d,p){return c.call.apply(c.bind,arguments)}function f(c,d,p){if(!c)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var R=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(R,m),c.apply(d,R)}}return function(){return c.apply(d,arguments)}}function g(c,d,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function _(c,d){var p=Array.prototype.slice.call(arguments,1);return function(){var m=p.slice();return m.push.apply(m,arguments),c.apply(this,m)}}function E(c,d){function p(){}p.prototype=d.prototype,c.aa=d.prototype,c.prototype=new p,c.prototype.constructor=c,c.Qb=function(m,R,N){for(var B=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)B[ve-2]=arguments[ve];return d.prototype[R].apply(m,B)}}function S(c){let d=c.length;if(0<d){let p=Array(d);for(let m=0;m<d;m++)p[m]=c[m];return p}return[]}function I(c,d){for(let p=1;p<arguments.length;p++){let m=arguments[p];if(l(m)){let R=c.length||0,N=m.length||0;c.length=R+N;for(let B=0;B<N;B++)c[R+B]=m[B]}else c.push(m)}}class O{constructor(d,p){this.i=d,this.j=p,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function j(c){return/^[\s\xa0]*$/.test(c)}function x(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function U(c){return U[" "](c),c}U[" "]=function(){};var Y=x().indexOf("Gecko")!=-1&&!(x().toLowerCase().indexOf("webkit")!=-1&&x().indexOf("Edge")==-1)&&!(x().indexOf("Trident")!=-1||x().indexOf("MSIE")!=-1)&&x().indexOf("Edge")==-1;function H(c,d,p){for(let m in c)d.call(p,c[m],m,c)}function T(c,d){for(let p in c)d.call(void 0,c[p],p,c)}function y(c){let d={};for(let p in c)d[p]=c[p];return d}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(c,d){let p,m;for(let R=1;R<arguments.length;R++){m=arguments[R];for(p in m)c[p]=m[p];for(let N=0;N<w.length;N++)p=w[N],Object.prototype.hasOwnProperty.call(m,p)&&(c[p]=m[p])}}function A(c){var d=1;c=c.split(":");let p=[];for(;0<d&&c.length;)p.push(c.shift()),d--;return c.length&&p.push(c.join(":")),p}function C(c){a.setTimeout(()=>{throw c},0)}function v(){var c=Zd;let d=null;return c.g&&(d=c.g,c.g=c.g.next,c.g||(c.h=null),d.next=null),d}class qn{constructor(){this.h=this.g=null}add(d,p){let m=Vo.get();m.set(d,p),this.h?this.h.next=m:this.g=m,this.h=m}}var Vo=new O(()=>new gP,c=>c.reset());class gP{constructor(){this.next=this.g=this.h=null}set(d,p){this.h=d,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Uo,jo=!1,Zd=new qn,bw=()=>{let c=a.Promise.resolve(void 0);Uo=()=>{c.then(mP)}};var mP=()=>{for(var c;c=v();){try{c.h.call(c.g)}catch(p){C(p)}var d=Vo;d.j(c),100>d.h&&(d.h++,c.next=d.g,d.g=c)}jo=!1};function ur(){this.s=this.s,this.C=this.C}ur.prototype.s=!1,ur.prototype.ma=function(){this.s||(this.s=!0,this.N())},ur.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function dt(c,d){this.type=c,this.g=this.target=d,this.defaultPrevented=!1}dt.prototype.h=function(){this.defaultPrevented=!0};var _P=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,d=Object.defineProperty({},"passive",{get:function(){c=!0}});try{let p=()=>{};a.addEventListener("test",p,d),a.removeEventListener("test",p,d)}catch{}return c}();function Bo(c,d){if(dt.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var p=this.type=c.type,m=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=d,d=c.relatedTarget){if(Y){e:{try{U(d.nodeName);var R=!0;break e}catch{}R=!1}R||(d=null)}}else p=="mouseover"?d=c.fromElement:p=="mouseout"&&(d=c.toElement);this.relatedTarget=d,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:yP[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&Bo.aa.h.call(this)}}E(Bo,dt);var yP={2:"touch",3:"pen",4:"mouse"};Bo.prototype.h=function(){Bo.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var qo="closure_listenable_"+(1e6*Math.random()|0),vP=0;function wP(c,d,p,m,R){this.listener=c,this.proxy=null,this.src=d,this.type=p,this.capture=!!m,this.ha=R,this.key=++vP,this.da=this.fa=!1}function yl(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function vl(c){this.src=c,this.g={},this.h=0}vl.prototype.add=function(c,d,p,m,R){var N=c.toString();c=this.g[N],c||(c=this.g[N]=[],this.h++);var B=tf(c,d,m,R);return-1<B?(d=c[B],p||(d.fa=!1)):(d=new wP(d,this.src,N,!!m,R),d.fa=p,c.push(d)),d};function ef(c,d){var p=d.type;if(p in c.g){var m=c.g[p],R=Array.prototype.indexOf.call(m,d,void 0),N;(N=0<=R)&&Array.prototype.splice.call(m,R,1),N&&(yl(d),c.g[p].length==0&&(delete c.g[p],c.h--))}}function tf(c,d,p,m){for(var R=0;R<c.length;++R){var N=c[R];if(!N.da&&N.listener==d&&N.capture==!!p&&N.ha==m)return R}return-1}var nf="closure_lm_"+(1e6*Math.random()|0),rf={};function Aw(c,d,p,m,R){if(m&&m.once)return Sw(c,d,p,m,R);if(Array.isArray(d)){for(var N=0;N<d.length;N++)Aw(c,d[N],p,m,R);return null}return p=cf(p),c&&c[qo]?c.K(d,p,u(m)?!!m.capture:!!m,R):Rw(c,d,p,!1,m,R)}function Rw(c,d,p,m,R,N){if(!d)throw Error("Invalid event type");var B=u(R)?!!R.capture:!!R,ve=of(c);if(ve||(c[nf]=ve=new vl(c)),p=ve.add(d,p,m,B,N),p.proxy)return p;if(m=EP(),p.proxy=m,m.src=c,m.listener=p,c.addEventListener)_P||(R=B),R===void 0&&(R=!1),c.addEventListener(d.toString(),m,R);else if(c.attachEvent)c.attachEvent(Pw(d.toString()),m);else if(c.addListener&&c.removeListener)c.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return p}function EP(){function c(p){return d.call(c.src,c.listener,p)}let d=TP;return c}function Sw(c,d,p,m,R){if(Array.isArray(d)){for(var N=0;N<d.length;N++)Sw(c,d[N],p,m,R);return null}return p=cf(p),c&&c[qo]?c.L(d,p,u(m)?!!m.capture:!!m,R):Rw(c,d,p,!0,m,R)}function Cw(c,d,p,m,R){if(Array.isArray(d))for(var N=0;N<d.length;N++)Cw(c,d[N],p,m,R);else m=u(m)?!!m.capture:!!m,p=cf(p),c&&c[qo]?(c=c.i,d=String(d).toString(),d in c.g&&(N=c.g[d],p=tf(N,p,m,R),-1<p&&(yl(N[p]),Array.prototype.splice.call(N,p,1),N.length==0&&(delete c.g[d],c.h--)))):c&&(c=of(c))&&(d=c.g[d.toString()],c=-1,d&&(c=tf(d,p,m,R)),(p=-1<c?d[c]:null)&&sf(p))}function sf(c){if(typeof c!="number"&&c&&!c.da){var d=c.src;if(d&&d[qo])ef(d.i,c);else{var p=c.type,m=c.proxy;d.removeEventListener?d.removeEventListener(p,m,c.capture):d.detachEvent?d.detachEvent(Pw(p),m):d.addListener&&d.removeListener&&d.removeListener(m),(p=of(d))?(ef(p,c),p.h==0&&(p.src=null,d[nf]=null)):yl(c)}}}function Pw(c){return c in rf?rf[c]:rf[c]="on"+c}function TP(c,d){if(c.da)c=!0;else{d=new Bo(d,this);var p=c.listener,m=c.ha||c.src;c.fa&&sf(c),c=p.call(m,d)}return c}function of(c){return c=c[nf],c instanceof vl?c:null}var af="__closure_events_fn_"+(1e9*Math.random()>>>0);function cf(c){return typeof c=="function"?c:(c[af]||(c[af]=function(d){return c.handleEvent(d)}),c[af])}function ft(){ur.call(this),this.i=new vl(this),this.M=this,this.F=null}E(ft,ur),ft.prototype[qo]=!0,ft.prototype.removeEventListener=function(c,d,p,m){Cw(this,c,d,p,m)};function wt(c,d){var p,m=c.F;if(m)for(p=[];m;m=m.F)p.push(m);if(c=c.M,m=d.type||d,typeof d=="string")d=new dt(d,c);else if(d instanceof dt)d.target=d.target||c;else{var R=d;d=new dt(m,c),b(d,R)}if(R=!0,p)for(var N=p.length-1;0<=N;N--){var B=d.g=p[N];R=wl(B,m,!0,d)&&R}if(B=d.g=c,R=wl(B,m,!0,d)&&R,R=wl(B,m,!1,d)&&R,p)for(N=0;N<p.length;N++)B=d.g=p[N],R=wl(B,m,!1,d)&&R}ft.prototype.N=function(){if(ft.aa.N.call(this),this.i){var c=this.i,d;for(d in c.g){for(var p=c.g[d],m=0;m<p.length;m++)yl(p[m]);delete c.g[d],c.h--}}this.F=null},ft.prototype.K=function(c,d,p,m){return this.i.add(String(c),d,!1,p,m)},ft.prototype.L=function(c,d,p,m){return this.i.add(String(c),d,!0,p,m)};function wl(c,d,p,m){if(d=c.i.g[String(d)],!d)return!0;d=d.concat();for(var R=!0,N=0;N<d.length;++N){var B=d[N];if(B&&!B.da&&B.capture==p){var ve=B.listener,at=B.ha||B.src;B.fa&&ef(c.i,B),R=ve.call(at,m)!==!1&&R}}return R&&!m.defaultPrevented}function Dw(c,d,p){if(typeof c=="function")p&&(c=g(c,p));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:a.setTimeout(c,d||0)}function Nw(c){c.g=Dw(()=>{c.g=null,c.i&&(c.i=!1,Nw(c))},c.l);let d=c.h;c.h=null,c.m.apply(null,d)}class IP extends ur{constructor(d,p){super(),this.m=d,this.l=p,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:Nw(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $o(c){ur.call(this),this.h=c,this.g={}}E($o,ur);var kw=[];function xw(c){H(c.g,function(d,p){this.g.hasOwnProperty(p)&&sf(d)},c),c.g={}}$o.prototype.N=function(){$o.aa.N.call(this),xw(this)},$o.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lf=a.JSON.stringify,bP=a.JSON.parse,AP=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function uf(){}uf.prototype.h=null;function Ow(c){return c.h||(c.h=c.i())}function Mw(){}var zo={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function hf(){dt.call(this,"d")}E(hf,dt);function df(){dt.call(this,"c")}E(df,dt);var ri={},Lw=null;function El(){return Lw=Lw||new ft}ri.La="serverreachability";function Fw(c){dt.call(this,ri.La,c)}E(Fw,dt);function Go(c){let d=El();wt(d,new Fw(d))}ri.STAT_EVENT="statevent";function Vw(c,d){dt.call(this,ri.STAT_EVENT,c),this.stat=d}E(Vw,dt);function Et(c){let d=El();wt(d,new Vw(d,c))}ri.Ma="timingevent";function Uw(c,d){dt.call(this,ri.Ma,c),this.size=d}E(Uw,dt);function Wo(c,d){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},d)}function Ko(){this.g=!0}Ko.prototype.xa=function(){this.g=!1};function RP(c,d,p,m,R,N){c.info(function(){if(c.g)if(N)for(var B="",ve=N.split("&"),at=0;at<ve.length;at++){var pe=ve[at].split("=");if(1<pe.length){var pt=pe[0];pe=pe[1];var gt=pt.split("_");B=2<=gt.length&&gt[1]=="type"?B+(pt+"="+pe+"&"):B+(pt+"=redacted&")}}else B=null;else B=N;return"XMLHTTP REQ ("+m+") [attempt "+R+"]: "+d+`
`+p+`
`+B})}function SP(c,d,p,m,R,N,B){c.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+R+"]: "+d+`
`+p+`
`+N+" "+B})}function Zi(c,d,p,m){c.info(function(){return"XMLHTTP TEXT ("+d+"): "+PP(c,p)+(m?" "+m:"")})}function CP(c,d){c.info(function(){return"TIMEOUT: "+d})}Ko.prototype.info=function(){};function PP(c,d){if(!c.g)return d;if(!d)return null;try{var p=JSON.parse(d);if(p){for(c=0;c<p.length;c++)if(Array.isArray(p[c])){var m=p[c];if(!(2>m.length)){var R=m[1];if(Array.isArray(R)&&!(1>R.length)){var N=R[0];if(N!="noop"&&N!="stop"&&N!="close")for(var B=1;B<R.length;B++)R[B]=""}}}}return lf(p)}catch{return d}}var Tl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},jw={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ff;function Il(){}E(Il,uf),Il.prototype.g=function(){return new XMLHttpRequest},Il.prototype.i=function(){return{}},ff=new Il;function hr(c,d,p,m){this.j=c,this.i=d,this.l=p,this.R=m||1,this.U=new $o(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Bw}function Bw(){this.i=null,this.g="",this.h=!1}var qw={},pf={};function gf(c,d,p){c.L=1,c.v=Sl($n(d)),c.m=p,c.P=!0,$w(c,null)}function $w(c,d){c.F=Date.now(),bl(c),c.A=$n(c.v);var p=c.A,m=c.R;Array.isArray(m)||(m=[String(m)]),rE(p.i,"t",m),c.C=0,p=c.j.J,c.h=new Bw,c.g=EE(c.j,p?d:null,!c.m),0<c.O&&(c.M=new IP(g(c.Y,c,c.g),c.O)),d=c.U,p=c.g,m=c.ca;var R="readystatechange";Array.isArray(R)||(R&&(kw[0]=R.toString()),R=kw);for(var N=0;N<R.length;N++){var B=Aw(p,R[N],m||d.handleEvent,!1,d.h||d);if(!B)break;d.g[B.key]=B}d=c.H?y(c.H):{},c.m?(c.u||(c.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,d)):(c.u="GET",c.g.ea(c.A,c.u,null,d)),Go(),RP(c.i,c.u,c.A,c.l,c.R,c.m)}hr.prototype.ca=function(c){c=c.target;let d=this.M;d&&zn(c)==3?d.j():this.Y(c)},hr.prototype.Y=function(c){try{if(c==this.g)e:{let gt=zn(this.g);var d=this.g.Ba();let ns=this.g.Z();if(!(3>gt)&&(gt!=3||this.g&&(this.h.h||this.g.oa()||uE(this.g)))){this.J||gt!=4||d==7||(d==8||0>=ns?Go(3):Go(2)),mf(this);var p=this.g.Z();this.X=p;t:if(zw(this)){var m=uE(this.g);c="";var R=m.length,N=zn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ii(this),Ho(this);var B="";break t}this.h.i=new a.TextDecoder}for(d=0;d<R;d++)this.h.h=!0,c+=this.h.i.decode(m[d],{stream:!(N&&d==R-1)});m.length=0,this.h.g+=c,this.C=0,B=this.h.g}else B=this.g.oa();if(this.o=p==200,SP(this.i,this.u,this.A,this.l,this.R,gt,p),this.o){if(this.T&&!this.K){t:{if(this.g){var ve,at=this.g;if((ve=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(ve)){var pe=ve;break t}}pe=null}if(p=pe)Zi(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,_f(this,p);else{this.o=!1,this.s=3,Et(12),ii(this),Ho(this);break e}}if(this.P){p=!0;let nn;for(;!this.J&&this.C<B.length;)if(nn=DP(this,B),nn==pf){gt==4&&(this.s=4,Et(14),p=!1),Zi(this.i,this.l,null,"[Incomplete Response]");break}else if(nn==qw){this.s=4,Et(15),Zi(this.i,this.l,B,"[Invalid Chunk]"),p=!1;break}else Zi(this.i,this.l,nn,null),_f(this,nn);if(zw(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),gt!=4||B.length!=0||this.h.h||(this.s=1,Et(16),p=!1),this.o=this.o&&p,!p)Zi(this.i,this.l,B,"[Invalid Chunked Response]"),ii(this),Ho(this);else if(0<B.length&&!this.W){this.W=!0;var pt=this.j;pt.g==this&&pt.ba&&!pt.M&&(pt.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),If(pt),pt.M=!0,Et(11))}}else Zi(this.i,this.l,B,null),_f(this,B);gt==4&&ii(this),this.o&&!this.J&&(gt==4?_E(this.j,this):(this.o=!1,bl(this)))}else KP(this.g),p==400&&0<B.indexOf("Unknown SID")?(this.s=3,Et(12)):(this.s=0,Et(13)),ii(this),Ho(this)}}}catch{}finally{}};function zw(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function DP(c,d){var p=c.C,m=d.indexOf(`
`,p);return m==-1?pf:(p=Number(d.substring(p,m)),isNaN(p)?qw:(m+=1,m+p>d.length?pf:(d=d.slice(m,m+p),c.C=m+p,d)))}hr.prototype.cancel=function(){this.J=!0,ii(this)};function bl(c){c.S=Date.now()+c.I,Gw(c,c.I)}function Gw(c,d){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Wo(g(c.ba,c),d)}function mf(c){c.B&&(a.clearTimeout(c.B),c.B=null)}hr.prototype.ba=function(){this.B=null;let c=Date.now();0<=c-this.S?(CP(this.i,this.A),this.L!=2&&(Go(),Et(17)),ii(this),this.s=2,Ho(this)):Gw(this,this.S-c)};function Ho(c){c.j.G==0||c.J||_E(c.j,c)}function ii(c){mf(c);var d=c.M;d&&typeof d.ma=="function"&&d.ma(),c.M=null,xw(c.U),c.g&&(d=c.g,c.g=null,d.abort(),d.ma())}function _f(c,d){try{var p=c.j;if(p.G!=0&&(p.g==c||yf(p.h,c))){if(!c.K&&yf(p.h,c)&&p.G==3){try{var m=p.Da.g.parse(d)}catch{m=null}if(Array.isArray(m)&&m.length==3){var R=m;if(R[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<c.F)kl(p),Dl(p);else break e;Tf(p),Et(18)}}else p.za=R[1],0<p.za-p.T&&37500>R[2]&&p.F&&p.v==0&&!p.C&&(p.C=Wo(g(p.Za,p),6e3));if(1>=Hw(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else oi(p,11)}else if((c.K||p.g==c)&&kl(p),!j(d))for(R=p.Da.g.parse(d),d=0;d<R.length;d++){let pe=R[d];if(p.T=pe[0],pe=pe[1],p.G==2)if(pe[0]=="c"){p.K=pe[1],p.ia=pe[2];let pt=pe[3];pt!=null&&(p.la=pt,p.j.info("VER="+p.la));let gt=pe[4];gt!=null&&(p.Aa=gt,p.j.info("SVER="+p.Aa));let ns=pe[5];ns!=null&&typeof ns=="number"&&0<ns&&(m=1.5*ns,p.L=m,p.j.info("backChannelRequestTimeoutMs_="+m)),m=p;let nn=c.g;if(nn){let Ol=nn.g?nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ol){var N=m.h;N.g||Ol.indexOf("spdy")==-1&&Ol.indexOf("quic")==-1&&Ol.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(vf(N,N.h),N.h=null))}if(m.D){let bf=nn.g?nn.g.getResponseHeader("X-HTTP-Session-Id"):null;bf&&(m.ya=bf,Re(m.I,m.D,bf))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-c.F,p.j.info("Handshake RTT: "+p.R+"ms")),m=p;var B=c;if(m.qa=wE(m,m.J?m.ia:null,m.W),B.K){Qw(m.h,B);var ve=B,at=m.L;at&&(ve.I=at),ve.B&&(mf(ve),bl(ve)),m.g=B}else gE(m);0<p.i.length&&Nl(p)}else pe[0]!="stop"&&pe[0]!="close"||oi(p,7);else p.G==3&&(pe[0]=="stop"||pe[0]=="close"?pe[0]=="stop"?oi(p,7):Ef(p):pe[0]!="noop"&&p.l&&p.l.ta(pe),p.v=0)}}Go(4)}catch{}}var NP=class{constructor(c,d){this.g=c,this.map=d}};function Ww(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Kw(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Hw(c){return c.h?1:c.g?c.g.size:0}function yf(c,d){return c.h?c.h==d:c.g?c.g.has(d):!1}function vf(c,d){c.g?c.g.add(d):c.h=d}function Qw(c,d){c.h&&c.h==d?c.h=null:c.g&&c.g.has(d)&&c.g.delete(d)}Ww.prototype.cancel=function(){if(this.i=Yw(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let c of this.g.values())c.cancel();this.g.clear()}};function Yw(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let d=c.i;for(let p of c.g.values())d=d.concat(p.D);return d}return S(c.i)}function kP(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var d=[],p=c.length,m=0;m<p;m++)d.push(c[m]);return d}d=[],p=0;for(m in c)d[p++]=c[m];return d}function xP(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var d=[];c=c.length;for(var p=0;p<c;p++)d.push(p);return d}d=[],p=0;for(let m in c)d[p++]=m;return d}}}function Xw(c,d){if(c.forEach&&typeof c.forEach=="function")c.forEach(d,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,d,void 0);else for(var p=xP(c),m=kP(c),R=m.length,N=0;N<R;N++)d.call(void 0,m[N],p&&p[N],c)}var Jw=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function OP(c,d){if(c){c=c.split("&");for(var p=0;p<c.length;p++){var m=c[p].indexOf("="),R=null;if(0<=m){var N=c[p].substring(0,m);R=c[p].substring(m+1)}else N=c[p];d(N,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function si(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof si){this.h=c.h,Al(this,c.j),this.o=c.o,this.g=c.g,Rl(this,c.s),this.l=c.l;var d=c.i,p=new Xo;p.i=d.i,d.g&&(p.g=new Map(d.g),p.h=d.h),Zw(this,p),this.m=c.m}else c&&(d=String(c).match(Jw))?(this.h=!1,Al(this,d[1]||"",!0),this.o=Qo(d[2]||""),this.g=Qo(d[3]||"",!0),Rl(this,d[4]),this.l=Qo(d[5]||"",!0),Zw(this,d[6]||"",!0),this.m=Qo(d[7]||"")):(this.h=!1,this.i=new Xo(null,this.h))}si.prototype.toString=function(){var c=[],d=this.j;d&&c.push(Yo(d,eE,!0),":");var p=this.g;return(p||d=="file")&&(c.push("//"),(d=this.o)&&c.push(Yo(d,eE,!0),"@"),c.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&c.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&c.push("/"),c.push(Yo(p,p.charAt(0)=="/"?FP:LP,!0))),(p=this.i.toString())&&c.push("?",p),(p=this.m)&&c.push("#",Yo(p,UP)),c.join("")};function $n(c){return new si(c)}function Al(c,d,p){c.j=p?Qo(d,!0):d,c.j&&(c.j=c.j.replace(/:$/,""))}function Rl(c,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);c.s=d}else c.s=null}function Zw(c,d,p){d instanceof Xo?(c.i=d,jP(c.i,c.h)):(p||(d=Yo(d,VP)),c.i=new Xo(d,c.h))}function Re(c,d,p){c.i.set(d,p)}function Sl(c){return Re(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Qo(c,d){return c?d?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Yo(c,d,p){return typeof c=="string"?(c=encodeURI(c).replace(d,MP),p&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function MP(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var eE=/[#\/\?@]/g,LP=/[#\?:]/g,FP=/[#\?]/g,VP=/[#\?@]/g,UP=/#/g;function Xo(c,d){this.h=this.g=null,this.i=c||null,this.j=!!d}function dr(c){c.g||(c.g=new Map,c.h=0,c.i&&OP(c.i,function(d,p){c.add(decodeURIComponent(d.replace(/\+/g," ")),p)}))}n=Xo.prototype,n.add=function(c,d){dr(this),this.i=null,c=es(this,c);var p=this.g.get(c);return p||this.g.set(c,p=[]),p.push(d),this.h+=1,this};function tE(c,d){dr(c),d=es(c,d),c.g.has(d)&&(c.i=null,c.h-=c.g.get(d).length,c.g.delete(d))}function nE(c,d){return dr(c),d=es(c,d),c.g.has(d)}n.forEach=function(c,d){dr(this),this.g.forEach(function(p,m){p.forEach(function(R){c.call(d,R,m,this)},this)},this)},n.na=function(){dr(this);let c=Array.from(this.g.values()),d=Array.from(this.g.keys()),p=[];for(let m=0;m<d.length;m++){let R=c[m];for(let N=0;N<R.length;N++)p.push(d[m])}return p},n.V=function(c){dr(this);let d=[];if(typeof c=="string")nE(this,c)&&(d=d.concat(this.g.get(es(this,c))));else{c=Array.from(this.g.values());for(let p=0;p<c.length;p++)d=d.concat(c[p])}return d},n.set=function(c,d){return dr(this),this.i=null,c=es(this,c),nE(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[d]),this.h+=1,this},n.get=function(c,d){return c?(c=this.V(c),0<c.length?String(c[0]):d):d};function rE(c,d,p){tE(c,d),0<p.length&&(c.i=null,c.g.set(es(c,d),S(p)),c.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let c=[],d=Array.from(this.g.keys());for(var p=0;p<d.length;p++){var m=d[p];let N=encodeURIComponent(String(m)),B=this.V(m);for(m=0;m<B.length;m++){var R=N;B[m]!==""&&(R+="="+encodeURIComponent(String(B[m]))),c.push(R)}}return this.i=c.join("&")};function es(c,d){return d=String(d),c.j&&(d=d.toLowerCase()),d}function jP(c,d){d&&!c.j&&(dr(c),c.i=null,c.g.forEach(function(p,m){var R=m.toLowerCase();m!=R&&(tE(this,m),rE(this,R,p))},c)),c.j=d}function BP(c,d){let p=new Ko;if(a.Image){let m=new Image;m.onload=_(fr,p,"TestLoadImage: loaded",!0,d,m),m.onerror=_(fr,p,"TestLoadImage: error",!1,d,m),m.onabort=_(fr,p,"TestLoadImage: abort",!1,d,m),m.ontimeout=_(fr,p,"TestLoadImage: timeout",!1,d,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=c}else d(!1)}function qP(c,d){let p=new Ko,m=new AbortController,R=setTimeout(()=>{m.abort(),fr(p,"TestPingServer: timeout",!1,d)},1e4);fetch(c,{signal:m.signal}).then(N=>{clearTimeout(R),N.ok?fr(p,"TestPingServer: ok",!0,d):fr(p,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(R),fr(p,"TestPingServer: error",!1,d)})}function fr(c,d,p,m,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),m(p)}catch{}}function $P(){this.g=new AP}function zP(c,d,p){let m=p||"";try{Xw(c,function(R,N){let B=R;u(R)&&(B=lf(R)),d.push(m+N+"="+encodeURIComponent(B))})}catch(R){throw d.push(m+"type="+encodeURIComponent("_badmap")),R}}function Jo(c){this.l=c.Ub||null,this.j=c.eb||!1}E(Jo,uf),Jo.prototype.g=function(){return new Cl(this.l,this.j)},Jo.prototype.i=function(c){return function(){return c}}({});function Cl(c,d){ft.call(this),this.D=c,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(Cl,ft),n=Cl.prototype,n.open=function(c,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=d,this.readyState=1,ea(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(d.body=c),(this.D||a).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Zo(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ea(this)),this.g&&(this.readyState=3,ea(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;iE(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function iE(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var d=c.value?c.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!c.done}))&&(this.response=this.responseText+=d)}c.done?Zo(this):ea(this),this.readyState==3&&iE(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Zo(this))},n.Qa=function(c){this.g&&(this.response=c,Zo(this))},n.ga=function(){this.g&&Zo(this)};function Zo(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ea(c)}n.setRequestHeader=function(c,d){this.u.append(c,d)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let c=[],d=this.h.entries();for(var p=d.next();!p.done;)p=p.value,c.push(p[0]+": "+p[1]),p=d.next();return c.join(`\r
`)};function ea(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Cl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function sE(c){let d="";return H(c,function(p,m){d+=m,d+=":",d+=p,d+=`\r
`}),d}function wf(c,d,p){e:{for(m in p){var m=!1;break e}m=!0}m||(p=sE(p),typeof c=="string"?p!=null&&encodeURIComponent(String(p)):Re(c,d,p))}function Le(c){ft.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(Le,ft);var GP=/^https?$/i,WP=["POST","PUT"];n=Le.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,d,p,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);d=d?d.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ff.g(),this.v=this.o?Ow(this.o):Ow(ff),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(d,String(c),!0),this.B=!1}catch(N){oE(this,N);return}if(c=p||"",p=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var R in m)p.set(R,m[R]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let N of m.keys())p.set(N,m.get(N));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(p.keys()).find(N=>N.toLowerCase()=="content-type"),R=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(WP,d,void 0))||m||R||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[N,B]of p)this.g.setRequestHeader(N,B);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{lE(this),this.u=!0,this.g.send(c),this.u=!1}catch(N){oE(this,N)}};function oE(c,d){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=d,c.m=5,aE(c),Pl(c)}function aE(c){c.A||(c.A=!0,wt(c,"complete"),wt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,wt(this,"complete"),wt(this,"abort"),Pl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Pl(this,!0)),Le.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?cE(this):this.bb())},n.bb=function(){cE(this)};function cE(c){if(c.h&&typeof o<"u"&&(!c.v[1]||zn(c)!=4||c.Z()!=2)){if(c.u&&zn(c)==4)Dw(c.Ea,0,c);else if(wt(c,"readystatechange"),zn(c)==4){c.h=!1;try{let B=c.Z();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var p;if(!(p=d)){var m;if(m=B===0){var R=String(c.D).match(Jw)[1]||null;!R&&a.self&&a.self.location&&(R=a.self.location.protocol.slice(0,-1)),m=!GP.test(R?R.toLowerCase():"")}p=m}if(p)wt(c,"complete"),wt(c,"success");else{c.m=6;try{var N=2<zn(c)?c.g.statusText:""}catch{N=""}c.l=N+" ["+c.Z()+"]",aE(c)}}finally{Pl(c)}}}}function Pl(c,d){if(c.g){lE(c);let p=c.g,m=c.v[0]?()=>{}:null;c.g=null,c.v=null,d||wt(c,"ready");try{p.onreadystatechange=m}catch{}}}function lE(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function zn(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<zn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var d=this.g.responseText;return c&&d.indexOf(c)==0&&(d=d.substring(c.length)),bP(d)}};function uE(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function KP(c){let d={};c=(c.g&&2<=zn(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<c.length;m++){if(j(c[m]))continue;var p=A(c[m]);let R=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let N=d[R]||[];d[R]=N,N.push(p)}T(d,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ta(c,d,p){return p&&p.internalChannelParams&&p.internalChannelParams[c]||d}function hE(c){this.Aa=0,this.i=[],this.j=new Ko,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ta("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ta("baseRetryDelayMs",5e3,c),this.cb=ta("retryDelaySeedMs",1e4,c),this.Wa=ta("forwardChannelMaxRetries",2,c),this.wa=ta("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new Ww(c&&c.concurrentRequestLimit),this.Da=new $P,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=hE.prototype,n.la=8,n.G=1,n.connect=function(c,d,p,m){Et(0),this.W=c,this.H=d||{},p&&m!==void 0&&(this.H.OSID=p,this.H.OAID=m),this.F=this.X,this.I=wE(this,null,this.W),Nl(this)};function Ef(c){if(dE(c),c.G==3){var d=c.U++,p=$n(c.I);if(Re(p,"SID",c.K),Re(p,"RID",d),Re(p,"TYPE","terminate"),na(c,p),d=new hr(c,c.j,d),d.L=2,d.v=Sl($n(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(d.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=d.v,p=!0),p||(d.g=EE(d.j,null),d.g.ea(d.v)),d.F=Date.now(),bl(d)}vE(c)}function Dl(c){c.g&&(If(c),c.g.cancel(),c.g=null)}function dE(c){Dl(c),c.u&&(a.clearTimeout(c.u),c.u=null),kl(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function Nl(c){if(!Kw(c.h)&&!c.s){c.s=!0;var d=c.Ga;Uo||bw(),jo||(Uo(),jo=!0),Zd.add(d,c),c.B=0}}function HP(c,d){return Hw(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=d.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Wo(g(c.Ga,c,d),yE(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;let R=new hr(this,this.j,c),N=this.o;if(this.S&&(N?(N=y(N),b(N,this.S)):N=this.S),this.m!==null||this.O||(R.H=N,N=null),this.P)e:{for(var d=0,p=0;p<this.i.length;p++){t:{var m=this.i[p];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(d+=m,4096<d){d=p;break e}if(d===4096||p===this.i.length-1){d=p+1;break e}}d=1e3}else d=1e3;d=pE(this,R,d),p=$n(this.I),Re(p,"RID",c),Re(p,"CVER",22),this.D&&Re(p,"X-HTTP-Session-Id",this.D),na(this,p),N&&(this.O?d="headers="+encodeURIComponent(String(sE(N)))+"&"+d:this.m&&wf(p,this.m,N)),vf(this.h,R),this.Ua&&Re(p,"TYPE","init"),this.P?(Re(p,"$req",d),Re(p,"SID","null"),R.T=!0,gf(R,p,null)):gf(R,p,d),this.G=2}}else this.G==3&&(c?fE(this,c):this.i.length==0||Kw(this.h)||fE(this))};function fE(c,d){var p;d?p=d.l:p=c.U++;let m=$n(c.I);Re(m,"SID",c.K),Re(m,"RID",p),Re(m,"AID",c.T),na(c,m),c.m&&c.o&&wf(m,c.m,c.o),p=new hr(c,c.j,p,c.B+1),c.m===null&&(p.H=c.o),d&&(c.i=d.D.concat(c.i)),d=pE(c,p,1e3),p.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),vf(c.h,p),gf(p,m,d)}function na(c,d){c.H&&H(c.H,function(p,m){Re(d,m,p)}),c.l&&Xw({},function(p,m){Re(d,m,p)})}function pE(c,d,p){p=Math.min(c.i.length,p);var m=c.l?g(c.l.Na,c.l,c):null;e:{var R=c.i;let N=-1;for(;;){let B=["count="+p];N==-1?0<p?(N=R[0].g,B.push("ofs="+N)):N=0:B.push("ofs="+N);let ve=!0;for(let at=0;at<p;at++){let pe=R[at].g,pt=R[at].map;if(pe-=N,0>pe)N=Math.max(0,R[at].g-100),ve=!1;else try{zP(pt,B,"req"+pe+"_")}catch{m&&m(pt)}}if(ve){m=B.join("&");break e}}}return c=c.i.splice(0,p),d.D=c,m}function gE(c){if(!c.g&&!c.u){c.Y=1;var d=c.Fa;Uo||bw(),jo||(Uo(),jo=!0),Zd.add(d,c),c.v=0}}function Tf(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Wo(g(c.Fa,c),yE(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,mE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Wo(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Et(10),Dl(this),mE(this))};function If(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function mE(c){c.g=new hr(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var d=$n(c.qa);Re(d,"RID","rpc"),Re(d,"SID",c.K),Re(d,"AID",c.T),Re(d,"CI",c.F?"0":"1"),!c.F&&c.ja&&Re(d,"TO",c.ja),Re(d,"TYPE","xmlhttp"),na(c,d),c.m&&c.o&&wf(d,c.m,c.o),c.L&&(c.g.I=c.L);var p=c.g;c=c.ia,p.L=1,p.v=Sl($n(d)),p.m=null,p.P=!0,$w(p,c)}n.Za=function(){this.C!=null&&(this.C=null,Dl(this),Tf(this),Et(19))};function kl(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function _E(c,d){var p=null;if(c.g==d){kl(c),If(c),c.g=null;var m=2}else if(yf(c.h,d))p=d.D,Qw(c.h,d),m=1;else return;if(c.G!=0){if(d.o)if(m==1){p=d.m?d.m.length:0,d=Date.now()-d.F;var R=c.B;m=El(),wt(m,new Uw(m,p)),Nl(c)}else gE(c);else if(R=d.s,R==3||R==0&&0<d.X||!(m==1&&HP(c,d)||m==2&&Tf(c)))switch(p&&0<p.length&&(d=c.h,d.i=d.i.concat(p)),R){case 1:oi(c,5);break;case 4:oi(c,10);break;case 3:oi(c,6);break;default:oi(c,2)}}}function yE(c,d){let p=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(p*=2),p*d}function oi(c,d){if(c.j.info("Error code "+d),d==2){var p=g(c.fb,c),m=c.Xa;let R=!m;m=new si(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Al(m,"https"),Sl(m),R?BP(m.toString(),p):qP(m.toString(),p)}else Et(2);c.G=0,c.l&&c.l.sa(d),vE(c),dE(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),Et(2)):(this.j.info("Failed to ping google.com"),Et(1))};function vE(c){if(c.G=0,c.ka=[],c.l){let d=Yw(c.h);(d.length!=0||c.i.length!=0)&&(I(c.ka,d),I(c.ka,c.i),c.h.i.length=0,S(c.i),c.i.length=0),c.l.ra()}}function wE(c,d,p){var m=p instanceof si?$n(p):new si(p);if(m.g!="")d&&(m.g=d+"."+m.g),Rl(m,m.s);else{var R=a.location;m=R.protocol,d=d?d+"."+R.hostname:R.hostname,R=+R.port;var N=new si(null);m&&Al(N,m),d&&(N.g=d),R&&Rl(N,R),p&&(N.l=p),m=N}return p=c.D,d=c.ya,p&&d&&Re(m,p,d),Re(m,"VER",c.la),na(c,m),m}function EE(c,d,p){if(d&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return d=c.Ca&&!c.pa?new Le(new Jo({eb:p})):new Le(c.pa),d.Ha(c.J),d}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function TE(){}n=TE.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function xl(){}xl.prototype.g=function(c,d){return new Nt(c,d)};function Nt(c,d){ft.call(this),this.g=new hE(d),this.l=c,this.h=d&&d.messageUrlParams||null,c=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(c?c["X-WebChannel-Content-Type"]=d.messageContentType:c={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(c?c["X-WebChannel-Client-Profile"]=d.va:c={"X-WebChannel-Client-Profile":d.va}),this.g.S=c,(c=d&&d.Sb)&&!j(c)&&(this.g.m=c),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!j(d)&&(this.g.D=d,c=this.h,c!==null&&d in c&&(c=this.h,d in c&&delete c[d])),this.j=new ts(this)}E(Nt,ft),Nt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Nt.prototype.close=function(){Ef(this.g)},Nt.prototype.o=function(c){var d=this.g;if(typeof c=="string"){var p={};p.__data__=c,c=p}else this.u&&(p={},p.__data__=lf(c),c=p);d.i.push(new NP(d.Ya++,c)),d.G==3&&Nl(d)},Nt.prototype.N=function(){this.g.l=null,delete this.j,Ef(this.g),delete this.g,Nt.aa.N.call(this)};function IE(c){hf.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var d=c.__sm__;if(d){e:{for(let p in d){c=p;break e}c=void 0}(this.i=c)&&(c=this.i,d=d!==null&&c in d?d[c]:void 0),this.data=d}else this.data=c}E(IE,hf);function bE(){df.call(this),this.status=1}E(bE,df);function ts(c){this.g=c}E(ts,TE),ts.prototype.ua=function(){wt(this.g,"a")},ts.prototype.ta=function(c){wt(this.g,new IE(c))},ts.prototype.sa=function(c){wt(this.g,new bE)},ts.prototype.ra=function(){wt(this.g,"b")},xl.prototype.createWebChannel=xl.prototype.g,Nt.prototype.send=Nt.prototype.o,Nt.prototype.open=Nt.prototype.m,Nt.prototype.close=Nt.prototype.close,fg=Jn.createWebChannelTransport=function(){return new xl},dg=Jn.getStatEventTarget=function(){return El()},hg=Jn.Event=ri,Pu=Jn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Tl.NO_ERROR=0,Tl.TIMEOUT=8,Tl.HTTP_ERROR=6,Wa=Jn.ErrorCode=Tl,jw.COMPLETE="complete",ug=Jn.EventType=jw,Mw.EventType=zo,zo.OPEN="a",zo.CLOSE="b",zo.ERROR="c",zo.MESSAGE="d",ft.prototype.listen=ft.prototype.K,As=Jn.WebChannel=Mw,lg=Jn.FetchXmlHttpFactory=Jo,Le.prototype.listenOnce=Le.prototype.L,Le.prototype.getLastError=Le.prototype.Ka,Le.prototype.getLastErrorCode=Le.prototype.Ba,Le.prototype.getStatus=Le.prototype.Z,Le.prototype.getResponseJson=Le.prototype.Oa,Le.prototype.getResponseText=Le.prototype.oa,Le.prototype.send=Le.prototype.ea,Le.prototype.setWithCredentials=Le.prototype.Ha,cg=Jn.XhrIo=Le}).apply(typeof Cu<"u"?Cu:typeof self<"u"?self:typeof window<"u"?window:{});var DI="@firebase/firestore";var Qe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");var no="10.12.1";var Or=new yr("@firebase/firestore");function Ds(){return Or.logLevel}function Db(n){Or.setLogLevel(n)}function L(n,...e){if(Or.logLevel<=Kt.DEBUG){let t=e.map(m_);Or.debug(`Firestore (${no}): ${n}`,...t)}}function Be(n,...e){if(Or.logLevel<=Kt.ERROR){let t=e.map(m_);Or.error(`Firestore (${no}): ${n}`,...t)}}function Yt(n,...e){if(Or.logLevel<=Kt.WARN){let t=e.map(m_);Or.warn(`Firestore (${no}): ${n}`,...t)}}function m_(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function z(n="Unexpected state"){let e=`FIRESTORE (${no}) INTERNAL ASSERTION FAILED: `+n;throw Be(e),new Error(e)}function K(n,e){n||z()}function Nb(n,e){n||z()}function $(n,e){return n}var k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},M=class extends Yl{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ye=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ju=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},yg=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qe.UNAUTHENTICATED))}shutdown(){}},vg=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},wg=class{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new Ye;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ye,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>P(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?a(l):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ye)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(K(typeof r.accessToken=="string"),new ju(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return K(e===null||typeof e=="string"),new Qe(e)}},Eg=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Tg=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Eg(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Qe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ig=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},bg=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(K(typeof t.token=="string"),this.R=t.token,new Ig(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Ix(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Bu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=Ix(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function ne(n,e){return n<e?-1:n>e?1:0}function Us(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function kb(n){return n+"\0"}var xe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new M(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var X=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new xe(0,0))}static max(){return new n(new xe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var qu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&z(),r===void 0?r=e.length-t:r>e.length-t&&z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},de=class n extends qu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new M(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},bx=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qe=class n extends qu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return bx.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new M(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new M(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new M(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new M(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var q=class n{constructor(e){this.path=e}static fromPath(e){return new n(de.fromString(e))}static fromName(e){return new n(de.fromString(e).popFirst(5))}static empty(){return new n(de.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&de.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return de.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new de(e.slice()))}};var js=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Ag(n){return n.fields.find(e=>e.kind===2)}function _i(n){return n.fields.filter(e=>e.kind!==2)}js.UNKNOWN_ID=-1;var Ls=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ic=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Xt.min())}};function xb(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new xe(t+1,0):new xe(t,r));return new Xt(i,q.empty(),e)}function Ob(n){return new Xt(n.readTime,n.key,-1)}var Xt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(X.min(),q.empty(),-1)}static max(){return new n(X.max(),q.empty(),-1)}};function __(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=q.comparator(n.documentKey,e.documentKey),t!==0?t:ne(n.largestBatchId,e.largestBatchId))}var Mb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$u=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function zr(n){return P(this,null,function*(){if(n.code!==k.FAILED_PRECONDITION||n.message!==Mb)throw n;L("LocalStore","Unexpectedly lost primary lease")})}var D=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let u=l;t(e[u]).next(h=>{o[u]=h,++a,a===s&&r(o)},h=>i(h))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var zu=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ye,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ii(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=y_(r.target.error);this.V.reject(new Ii(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Ii(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(L("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Sg(t)}},Mr=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(ca())===12.2&&Be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return L("SimpleDb","Removing database:",e),yi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Ql())return!1;if(n.C())return!0;let e=ca(),t=n.S(e),r=0<t&&t<10,i=Lb(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return P(this,null,function*(){return this.db||(L("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Ii(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new M(k.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new M(k.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ii(e,o))},i.onupgradeneeded=s=>{L("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{L("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return P(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=zu.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),D.reject(u))).toPromise();return l.catch(()=>{}),yield a.m,l}catch(a){let l=a,u=l.name!=="FirebaseError"&&o<3;if(L("SimpleDb","Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Lb(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Rg=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return yi(this.B.delete())}},Ii=class extends M{constructor(e,t){super(k.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Gr(n){return n.name==="IndexedDbTransactionError"}var Sg=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(L("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(L("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),yi(r)}add(e){return L("SimpleDb","ADD",this.store.name,e,e),yi(this.store.add(e))}get(e){return yi(this.store.get(e)).next(t=>(t===void 0&&(t=null),L("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return L("SimpleDb","DELETE",this.store.name,e),yi(this.store.delete(e))}count(){return L("SimpleDb","COUNT",this.store.name),yi(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new D((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new D((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){L("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new D((r,i)=>{t.onerror=s=>{let o=y_(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new D((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let l=new Rg(a),u=t(a.primaryKey,a.value,l);if(u instanceof D){let h=u.catch(f=>(l.done(),D.reject(f)));r.push(h)}l.isDone?i():l.K===null?a.continue():a.continue(l.K)}}).next(()=>D.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function yi(n){return new D((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=y_(r.target.error);t(i)}})}var NI=!1;function y_(n){let e=Mr.S(ca());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new M("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return NI||(NI=!0,setTimeout(()=>{throw r},0)),r}}return n}var Cg=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){L("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>P(this,null,function*(){this.task=null;try{L("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Gr(t)?L("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield zr(t)}yield this.X(6e4)}))}},Pg=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return P(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return D.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return L("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(L("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=Ob(s);__(o,r)>0&&(r=o)}),new Xt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Lt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Rc(n){return n==null}function sc(n){return n===0&&1/n==-1/0}function Fb(n){return typeof n=="number"&&Number.isInteger(n)&&!sc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Tt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=kI(e)),e=Ax(n.get(t),e);return kI(e)}function Ax(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function kI(n){return n+""}function An(n){let e=n.length;if(K(e>=2),e===2)return K(n.charAt(0)===""&&n.charAt(1)===""),de.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&z(),n.charAt(o+1)){case"":let a=n.substring(s,o),l;i.length===0?l=a:(i+=a,l=i,i=""),r.push(l);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:z()}s=o+2}return new de(r)}var xI=["userId","batchId"];function Ou(n,e){return[n,Tt(e)]}function Vb(n,e,t){return[n,Tt(e),t]}var Rx={},Sx=["prefixPath","collectionGroup","readTime","documentId"],Cx=["prefixPath","collectionGroup","documentId"],Px=["collectionGroup","readTime","prefixPath","documentId"],Dx=["canonicalId","targetId"],Nx=["targetId","path"],kx=["path","targetId"],xx=["collectionId","parent"],Ox=["indexId","uid"],Mx=["uid","sequenceNumber"],Lx=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Fx=["indexId","uid","orderedDocumentKey"],Vx=["userId","collectionPath","documentId"],Ux=["userId","collectionPath","largestBatchId"],jx=["userId","collectionGroup","largestBatchId"],Ub=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Bx=[...Ub,"documentOverlays"],jb=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Bb=jb,qb=[...Bb,"indexConfiguration","indexState","indexEntries"],qx=qb;var oc=class extends $u{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function it(n,e){let t=$(n);return Mr.F(t._e,e)}function OI(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $b(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Se=class n{constructor(e,t){this.comparator=e,this.root=t||Sn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Sn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Sn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ms(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ms(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ms(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ms(this.root,e,this.comparator,!0)}},Ms=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Sn=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();let e=this.left.check();if(e!==this.right.check())throw z();return e+(this.isRed()?0:1)}};Sn.EMPTY=null,Sn.RED=!0,Sn.BLACK=!1;Sn.EMPTY=new class{constructor(){this.size=0}get key(){throw z()}get value(){throw z()}get color(){throw z()}get left(){throw z()}get right(){throw z()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Sn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ee=class n{constructor(e){this.comparator=e,this.data=new Se(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Gu(this.data.getIterator())}getIteratorFrom(e){return new Gu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Gu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Rs(n){return n.hasNext()?n.getNext():void 0}var Ft=class n{constructor(e){this.fields=e,e.sort(qe.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ee(qe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Us(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Wu=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function zb(){return typeof atob<"u"}var rt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Wu("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};rt.EMPTY_BYTE_STRING=new rt("");var $x=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tr(n){if(K(!!n),typeof n=="string"){let e=0,t=$x.exec(n);if(K(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ue(n.seconds),nanos:Ue(n.nanos)}}function Ue(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Lr(n){return typeof n=="string"?rt.fromBase64String(n):rt.fromUint8Array(n)}function Lh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function v_(n){let e=n.mapValue.fields.__previous_value__;return Lh(e)?v_(e):e}function ac(n){let e=tr(n.mapValue.fields.__local_write_time__.timestampValue);return new xe(e.seconds,e.nanos)}var Dg=class{constructor(e,t,r,i,s,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}},Fr=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var kr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Mu={nullValue:"NULL_VALUE"};function bi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Lh(n)?4:Gb(n)?9007199254740991:10:z()}function Dn(n,e){if(n===e)return!0;let t=bi(n);if(t!==bi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ac(n).isEqual(ac(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=tr(i.timestampValue),a=tr(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Lr(i.bytesValue).isEqual(Lr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Ue(i.geoPointValue.latitude)===Ue(s.geoPointValue.latitude)&&Ue(i.geoPointValue.longitude)===Ue(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ue(i.integerValue)===Ue(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Ue(i.doubleValue),a=Ue(s.doubleValue);return o===a?sc(o)===sc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Us(n.arrayValue.values||[],e.arrayValue.values||[],Dn);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(OI(o)!==OI(a))return!1;for(let l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Dn(o[l],a[l])))return!1;return!0}(n,e);default:return z()}}function cc(n,e){return(n.values||[]).find(t=>Dn(t,e))!==void 0}function Vr(n,e){if(n===e)return 0;let t=bi(n),r=bi(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=Ue(s.integerValue||s.doubleValue),l=Ue(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return MI(n.timestampValue,e.timestampValue);case 4:return MI(ac(n),ac(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Lr(s),l=Lr(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){let h=ne(a[u],l[u]);if(h!==0)return h}return ne(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=ne(Ue(s.latitude),Ue(o.latitude));return a!==0?a:ne(Ue(s.longitude),Ue(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],l=o.values||[];for(let u=0;u<a.length&&u<l.length;++u){let h=Vr(a[u],l[u]);if(h)return h}return ne(a.length,l.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===kr.mapValue&&o===kr.mapValue)return 0;if(s===kr.mapValue)return 1;if(o===kr.mapValue)return-1;let a=s.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){let g=ne(l[f],h[f]);if(g!==0)return g;let _=Vr(a[l[f]],u[h[f]]);if(_!==0)return _}return ne(l.length,h.length)}(n.mapValue,e.mapValue);default:throw z()}}function MI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);let t=tr(n),r=tr(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function Bs(n){return Ng(n)}function Ng(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=tr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Lr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Ng(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Ng(t.fields[o])}`;return i+"}"}(n.mapValue):z()}function Ai(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function kg(n){return!!n&&"integerValue"in n}function lc(n){return!!n&&"arrayValue"in n}function LI(n){return!!n&&"nullValue"in n}function FI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Lu(n){return!!n&&"mapValue"in n}function Za(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Mi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Za(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Za(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Gb(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function zx(n){return"nullValue"in n?Mu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ai(Fr.empty(),q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:z()}function Gx(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ai(Fr.empty(),q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?kr:z()}function VI(n,e){let t=Vr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function UI(n,e){let t=Vr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var _t=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Lu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Za(t)}setAll(e){let t=qe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Za(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Lu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Dn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Lu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Mi(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Za(this.value))}};function Wb(n){let e=[];return Mi(n.fields,(t,r)=>{let i=new qe([t]);if(Lu(r)){let s=Wb(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Ft(e)}var Xe=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,X.min(),X.min(),X.min(),_t.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,X.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,X.min(),X.min(),_t.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,X.min(),X.min(),_t.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(X.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Nn=class{constructor(e,t){this.position=e,this.inclusive=t}};function jI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=q.comparator(q.fromName(o.referenceValue),t.key):r=Vr(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function BI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Dn(n.position[t],e.position[t]))return!1;return!0}var Ri=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Wx(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ku=class{},ue=class n extends Ku{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Mg(e,t,r):t==="array-contains"?new Vg(e,r):t==="in"?new Hu(e,r):t==="not-in"?new Ug(e,r):t==="array-contains-any"?new jg(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Lg(e,r):new Fg(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Vr(t,this.value)):t!==null&&bi(this.value)===bi(t)&&this.matchesComparison(Vr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ye=class n extends Ku{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return qs(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function qs(n){return n.op==="and"}function xg(n){return n.op==="or"}function w_(n){return Kb(n)&&qs(n)}function Kb(n){for(let e of n.filters)if(e instanceof ye)return!1;return!0}function Og(n){if(n instanceof ue)return n.field.canonicalString()+n.op.toString()+Bs(n.value);if(w_(n))return n.filters.map(e=>Og(e)).join(",");{let e=n.filters.map(t=>Og(t)).join(",");return`${n.op}(${e})`}}function Hb(n,e){return n instanceof ue?function(r,i){return i instanceof ue&&r.op===i.op&&r.field.isEqual(i.field)&&Dn(r.value,i.value)}(n,e):n instanceof ye?function(r,i){return i instanceof ye&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Hb(o,i.filters[a]),!0):!1}(n,e):void z()}function Qb(n,e){let t=n.filters.concat(e);return ye.create(t,n.op)}function Yb(n){return n instanceof ue?function(t){return`${t.field.canonicalString()} ${t.op} ${Bs(t.value)}`}(n):n instanceof ye?function(t){return t.op.toString()+" {"+t.getFilters().map(Yb).join(" ,")+"}"}(n):"Filter"}var Mg=class extends ue{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},Lg=class extends ue{constructor(e,t){super(e,"in",t),this.keys=Xb("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Fg=class extends ue{constructor(e,t){super(e,"not-in",t),this.keys=Xb("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Xb(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>q.fromName(r.referenceValue))}var Vg=class extends ue{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return lc(t)&&cc(t.arrayValue,this.value)}},Hu=class extends ue{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&cc(this.value.arrayValue,t)}},Ug=class extends ue{constructor(e,t){super(e,"not-in",t)}matches(e){if(cc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!cc(this.value.arrayValue,t)}},jg=class extends ue{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!lc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>cc(this.value.arrayValue,r))}};var Bg=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function qg(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Bg(n,e,t,r,i,s,o)}function Si(n){let e=$(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Og(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Rc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Bs(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Bs(r)).join(",")),e.ue=t}return e.ue}function Sc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Wx(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Hb(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!BI(n.startAt,e.startAt)&&BI(n.endAt,e.endAt)}function Qu(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Yu(n,e){return n.filters.filter(t=>t instanceof ue&&t.field.isEqual(e))}function qI(n,e,t){let r=Mu,i=!0;for(let s of Yu(n,e)){let o=Mu,a=!0;switch(s.op){case"<":case"<=":o=zx(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Mu}VI({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];VI({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function $I(n,e,t){let r=kr,i=!0;for(let s of Yu(n,e)){let o=kr,a=!0;switch(s.op){case">=":case">":o=Gx(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=kr}UI({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];UI({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var ln=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Jb(n,e,t,r,i,s,o,a){return new ln(n,e,t,r,i,s,o,a)}function ro(n){return new ln(n)}function zI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function E_(n){return n.collectionGroup!==null}function Fs(n){let e=$(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ee(qe.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Ri(s,r))}),t.has(qe.keyField().canonicalString())||e.ce.push(new Ri(qe.keyField(),r))}return e.ce}function It(n){let e=$(n);return e.le||(e.le=Kx(e,Fs(n))),e.le}function Kx(n,e){if(n.limitType==="F")return qg(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ri(i.field,s)});let t=n.endAt?new Nn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Nn(n.startAt.position,n.startAt.inclusive):null;return qg(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function $g(n,e){let t=n.filters.concat([e]);return new ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Xu(n,e,t){return new ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Cc(n,e){return Sc(It(n),It(e))&&n.limitType===e.limitType}function Zb(n){return`${Si(It(n))}|lt:${n.limitType}`}function Ns(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Yb(i)).join(", ")}]`),Rc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Bs(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Bs(i)).join(",")),`Target(${r})`}(It(n))}; limitType=${n.limitType})`}function Pc(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):q.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Fs(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,l){let u=jI(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Fs(r),i)||r.endAt&&!function(o,a,l){let u=jI(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Fs(r),i))}(n,e)}function eA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function tA(n){return(e,t)=>{let r=!1;for(let i of Fs(n)){let s=Hx(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Hx(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):function(s,o,a){let l=o.data.field(s),u=a.data.field(s);return l!==null&&u!==null?Vr(l,u):z()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return z()}}var kn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Mi(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return $b(this.inner)}size(){return this.innerSize}};var Qx=new Se(q.comparator);function Dt(){return Qx}var nA=new Se(q.comparator);function Xa(...n){let e=nA;for(let t of n)e=e.insert(t.key,t);return e}function rA(n){let e=nA;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Rn(){return ec()}function iA(){return ec()}function ec(){return new kn(n=>n.toString(),(n,e)=>n.isEqual(e))}var Yx=new Se(q.comparator),Xx=new Ee(q.comparator);function ie(...n){let e=Xx;for(let t of n)e=e.add(t);return e}var Jx=new Ee(ne);function T_(){return Jx}function sA(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sc(e)?"-0":e}}function oA(n){return{integerValue:""+n}}function aA(n,e){return Fb(e)?oA(e):sA(n,e)}var $s=class{constructor(){this._=void 0}};function Zx(n,e,t){return n instanceof Ur?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Lh(s)&&(s=v_(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof nr?lA(n,e):n instanceof rr?uA(n,e):function(i,s){let o=cA(i,s),a=GI(o)+GI(i.Pe);return kg(o)&&kg(i.Pe)?oA(a):sA(i.serializer,a)}(n,e)}function eO(n,e,t){return n instanceof nr?lA(n,e):n instanceof rr?uA(n,e):t}function cA(n,e){return n instanceof jr?function(r){return kg(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Ur=class extends $s{},nr=class extends $s{constructor(e){super(),this.elements=e}};function lA(n,e){let t=hA(e);for(let r of n.elements)t.some(i=>Dn(i,r))||t.push(r);return{arrayValue:{values:t}}}var rr=class extends $s{constructor(e){super(),this.elements=e}};function uA(n,e){let t=hA(e);for(let r of n.elements)t=t.filter(i=>!Dn(i,r));return{arrayValue:{values:t}}}var jr=class extends $s{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function GI(n){return Ue(n.integerValue||n.doubleValue)}function hA(n){return lc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Ci=class{constructor(e,t){this.field=e,this.transform=t}};function tO(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof nr&&i instanceof nr||r instanceof rr&&i instanceof rr?Us(r.elements,i.elements,Dn):r instanceof jr&&i instanceof jr?Dn(r.Pe,i.Pe):r instanceof Ur&&i instanceof Ur}(n.transform,e.transform)}var zg=class{constructor(e,t){this.version=e,this.transformResults=t}},je=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Fu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var zs=class{};function dA(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new qr(n.key,je.none()):new Br(n.key,n.data,je.none());{let t=n.data,r=_t.empty(),i=new Ee(qe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new un(n.key,r,new Ft(i.toArray()),je.none())}}function nO(n,e,t){n instanceof Br?function(i,s,o){let a=i.value.clone(),l=KI(i.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof un?function(i,s,o){if(!Fu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=KI(i.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(fA(i)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function tc(n,e,t,r){return n instanceof Br?function(s,o,a,l){if(!Fu(s.precondition,o))return a;let u=s.value.clone(),h=HI(s.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof un?function(s,o,a,l){if(!Fu(s.precondition,o))return a;let u=HI(s.fieldTransforms,l,o),h=o.data;return h.setAll(fA(s)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(s,o,a){return Fu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function rO(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=cA(r.transform,i||null);s!=null&&(t===null&&(t=_t.empty()),t.set(r.field,s))}return t||null}function WI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Us(r,i,(s,o)=>tO(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Br=class extends zs{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},un=class extends zs{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function fA(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function KI(n,e,t){let r=new Map;K(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,eO(o,a,t[i]))}return r}function HI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Zx(s,o,e))}return r}var qr=class extends zs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},uc=class extends zs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var hc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&nO(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=tc(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=tc(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=iA();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=dA(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(X.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&Us(this.mutations,e.mutations,(t,r)=>WI(t,r))&&Us(this.baseMutations,e.baseMutations,(t,r)=>WI(t,r))}},Gg=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){K(e.mutations.length===r.length);let i=function(){return Yx}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var dc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Wg=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ke,he;function pA(n){switch(n){default:return z();case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0}}function gA(n){if(n===void 0)return Be("GRPC error has no .code"),k.UNKNOWN;switch(n){case Ke.OK:return k.OK;case Ke.CANCELLED:return k.CANCELLED;case Ke.UNKNOWN:return k.UNKNOWN;case Ke.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case Ke.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case Ke.INTERNAL:return k.INTERNAL;case Ke.UNAVAILABLE:return k.UNAVAILABLE;case Ke.UNAUTHENTICATED:return k.UNAUTHENTICATED;case Ke.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case Ke.NOT_FOUND:return k.NOT_FOUND;case Ke.ALREADY_EXISTS:return k.ALREADY_EXISTS;case Ke.PERMISSION_DENIED:return k.PERMISSION_DENIED;case Ke.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case Ke.ABORTED:return k.ABORTED;case Ke.OUT_OF_RANGE:return k.OUT_OF_RANGE;case Ke.UNIMPLEMENTED:return k.UNIMPLEMENTED;case Ke.DATA_LOSS:return k.DATA_LOSS;default:return z()}}(he=Ke||(Ke={}))[he.OK=0]="OK",he[he.CANCELLED=1]="CANCELLED",he[he.UNKNOWN=2]="UNKNOWN",he[he.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",he[he.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",he[he.NOT_FOUND=5]="NOT_FOUND",he[he.ALREADY_EXISTS=6]="ALREADY_EXISTS",he[he.PERMISSION_DENIED=7]="PERMISSION_DENIED",he[he.UNAUTHENTICATED=16]="UNAUTHENTICATED",he[he.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",he[he.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",he[he.ABORTED=10]="ABORTED",he[he.OUT_OF_RANGE=11]="OUT_OF_RANGE",he[he.UNIMPLEMENTED=12]="UNIMPLEMENTED",he[he.INTERNAL=13]="INTERNAL",he[he.UNAVAILABLE=14]="UNAVAILABLE",he[he.DATA_LOSS=15]="DATA_LOSS";var QI=null;function mA(){return new TextEncoder}var iO=new Sr([4294967295,4294967295],0);function YI(n){let e=mA().encode(n),t=new ag;return t.update(e),new Uint8Array(t.digest())}function XI(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Sr([t,r],0),new Sr([i,s],0)]}var Kg=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ti(`Invalid padding: ${t}`);if(r<0)throw new Ti(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ti(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ti(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Sr.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Sr.fromNumber(r)));return i.compare(iO)===1&&(i=new Sr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=YI(e),[r,i]=XI(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=YI(e),[r,i]=XI(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ti=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var fc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,pc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(X.min(),i,new Se(ne),Dt(),ie())}},pc=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ie(),ie(),ie())}};var Vs=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Ju=class{constructor(e,t){this.targetId=e,this.me=t}},Zu=class{constructor(e,t,r=rt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},eh=class{constructor(){this.fe=0,this.ge=ZI(),this.pe=rt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=ie(),t=ie(),r=ie();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:z()}}),new pc(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=ZI()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,K(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Hg=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Dt(),this.qe=JI(),this.Qe=new Se(ne)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Qu(s))if(r===0){let o=new q(s.path);this.Ue(t,o,Xe.newNoDocument(o,X.min()))}else K(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);let u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}QI?.et(function(h,f,g,_,E){var S,I,O,j,x,U;let Y={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},H=f.unchangedNames;return H&&(Y.bloomFilter={applied:E===0,hashCount:(S=H?.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(j=(O=(I=H?.bits)===null||I===void 0?void 0:I.bitmap)===null||O===void 0?void 0:O.length)!==null&&j!==void 0?j:0,padding:(U=(x=H?.bits)===null||x===void 0?void 0:x.padding)!==null&&U!==void 0?U:0,mightContain:T=>{var y;return(y=_?.mightContain(T))!==null&&y!==void 0&&y}}),Y}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Lr(r).toUint8Array()}catch(l){if(l instanceof Wu)return Yt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Kg(o,i,s)}catch(l){return Yt(l instanceof Ti?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Qu(a.target)){let l=new q(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Xe.newNoDocument(l,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=ie();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new fc(e,t,this.Qe,this.ke,r);return this.ke=Dt(),this.qe=JI(),this.Qe=new Se(ne),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new eh,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ee(ne),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new eh),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function JI(){return new Se(q.comparator)}function ZI(){return new Se(q.comparator)}var sO={asc:"ASCENDING",desc:"DESCENDING"},oO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aO={and:"AND",or:"OR"},Qg=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Yg(n,e){return n.useProto3Json||Rc(e)?e:{value:e}}function Gs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _A(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function cO(n,e){return Gs(n,e.toTimestamp())}function $e(n){return K(!!n),X.fromTimestamp(function(t){let r=tr(t);return new xe(r.seconds,r.nanos)}(n))}function I_(n,e){return Xg(n,e).canonicalString()}function Xg(n,e){let t=function(i){return new de(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function yA(n){let e=de.fromString(n);return K(CA(e)),e}function gc(n,e){return I_(n.databaseId,e.path)}function Cn(n,e){let t=yA(e);if(t.get(1)!==n.databaseId.projectId)throw new M(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new M(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(EA(t))}function vA(n,e){return I_(n.databaseId,e)}function wA(n){let e=yA(n);return e.length===4?de.emptyPath():EA(e)}function Jg(n){return new de(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function EA(n){return K(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function eb(n,e,t){return{name:gc(n,e),fields:t.value.mapValue.fields}}function TA(n,e,t){let r=Cn(n,e.name),i=$e(e.updateTime),s=e.createTime?$e(e.createTime):X.min(),o=new _t({mapValue:{fields:e.fields}}),a=Xe.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function lO(n,e){return"found"in e?function(r,i){K(!!i.found),i.found.name,i.found.updateTime;let s=Cn(r,i.found.name),o=$e(i.found.updateTime),a=i.found.createTime?$e(i.found.createTime):X.min(),l=new _t({mapValue:{fields:i.found.fields}});return Xe.newFoundDocument(s,o,a,l)}(n,e):"missing"in e?function(r,i){K(!!i.missing),K(!!i.readTime);let s=Cn(r,i.missing),o=$e(i.readTime);return Xe.newNoDocument(s,o)}(n,e):z()}function uO(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:z()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,h){return u.useProto3Json?(K(h===void 0||typeof h=="string"),rt.fromBase64String(h||"")):(K(h===void 0||h instanceof Buffer||h instanceof Uint8Array),rt.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let h=u.code===void 0?k.UNKNOWN:gA(u.code);return new M(h,u.message||"")}(o);t=new Zu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Cn(n,r.document.name),s=$e(r.document.updateTime),o=r.document.createTime?$e(r.document.createTime):X.min(),a=new _t({mapValue:{fields:r.document.fields}}),l=Xe.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Vs(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Cn(n,r.document),s=r.readTime?$e(r.readTime):X.min(),o=Xe.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Vs([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Cn(n,r.document),s=r.removedTargetIds||[];t=new Vs([],s,i,null)}else{if(!("filter"in e))return z();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Wg(i,s),a=r.targetId;t=new Ju(a,o)}}return t}function mc(n,e){let t;if(e instanceof Br)t={update:eb(n,e.key,e.value)};else if(e instanceof qr)t={delete:gc(n,e.key)};else if(e instanceof un)t={update:eb(n,e.key,e.data),updateMask:mO(e.fieldMask)};else{if(!(e instanceof uc))return z();t={verify:gc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Ur)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof nr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof rr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof jr)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw z()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:cO(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:z()}(n,e.precondition)),t}function Zg(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?je.updateTime($e(s.updateTime)):s.exists!==void 0?je.exists(s.exists):je.none()}(e.currentDocument):je.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let l=null;if("setToServerValue"in a)K(a.setToServerValue==="REQUEST_TIME"),l=new Ur;else if("appendMissingElements"in a){let h=a.appendMissingElements.values||[];l=new nr(h)}else if("removeAllFromArray"in a){let h=a.removeAllFromArray.values||[];l=new rr(h)}else"increment"in a?l=new jr(o,a.increment):z();let u=qe.fromServerFormat(a.fieldPath);return new Ci(u,l)}(n,i)):[];if(e.update){e.update.name;let i=Cn(n,e.update.name),s=new _t({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(l){let u=l.fieldPaths||[];return new Ft(u.map(h=>qe.fromServerFormat(h)))}(e.updateMask);return new un(i,s,o,t,r)}return new Br(i,s,t,r)}if(e.delete){let i=Cn(n,e.delete);return new qr(i,t)}if(e.verify){let i=Cn(n,e.verify);return new uc(i,t)}return z()}function hO(n,e){return n&&n.length>0?(K(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?$e(i.updateTime):$e(s);return o.isEqual(X.min())&&(o=$e(s)),new zg(o,i.transformResults||[])}(t,e))):[]}function IA(n,e){return{documents:[vA(n,e.path)]}}function bA(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=vA(n,i);let s=function(u){if(u.length!==0)return SA(ye.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(h=>function(g){return{field:ks(g.field),direction:fO(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Yg(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:i}}function AA(n){let e=wA(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){K(r===1);let h=t.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=function(f){let g=RA(f);return g instanceof ye&&w_(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(E){return new Ri(xs(E.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Rc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){let g=!!f.before,_=f.values||[];return new Nn(_,g)}(t.startAt));let u=null;return t.endAt&&(u=function(f){let g=!f.before,_=f.values||[];return new Nn(_,g)}(t.endAt)),Jb(e,i,o,s,a,"F",l,u)}function dO(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function RA(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=xs(t.unaryFilter.field);return ue.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=xs(t.unaryFilter.field);return ue.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=xs(t.unaryFilter.field);return ue.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=xs(t.unaryFilter.field);return ue.create(o,"!=",{nullValue:"NULL_VALUE"});default:return z()}}(n):n.fieldFilter!==void 0?function(t){return ue.create(xs(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ye.create(t.compositeFilter.filters.map(r=>RA(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return z()}}(t.compositeFilter.op))}(n):z()}function fO(n){return sO[n]}function pO(n){return oO[n]}function gO(n){return aO[n]}function ks(n){return{fieldPath:n.canonicalString()}}function xs(n){return qe.fromServerFormat(n.fieldPath)}function SA(n){return n instanceof ue?function(t){if(t.op==="=="){if(FI(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NAN"}};if(LI(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(FI(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NOT_NAN"}};if(LI(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ks(t.field),op:pO(t.op),value:t.value}}}(n):n instanceof ye?function(t){let r=t.getFilters().map(i=>SA(i));return r.length===1?r[0]:{compositeFilter:{op:gO(t.op),filters:r}}}(n):z()}function mO(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function CA(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ws=class n{constructor(e,t,r,i,s=X.min(),o=X.min(),a=rt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var th=class{constructor(e){this.ct=e}};function _O(n,e){let t;if(e.document)t=TA(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=q.fromSegments(e.noDocument.path),i=Di(e.noDocument.readTime);t=Xe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return z();{let r=q.fromSegments(e.unknownDocument.path),i=Di(e.unknownDocument.version);t=Xe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new xe(i[0],i[1]);return X.fromTimestamp(s)}(e.readTime)),t}function tb(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:nh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:gc(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Gs(s,o.version.toTimestamp()),createTime:Gs(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Pi(e.version)};else{if(!e.isUnknownDocument())return z();r.unknownDocument={path:t.path.toArray(),version:Pi(e.version)}}return r}function nh(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Pi(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Di(n){let e=new xe(n.seconds,n.nanoseconds);return X.fromTimestamp(e)}function vi(n,e){let t=(e.baseMutations||[]).map(s=>Zg(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Zg(n.ct,s)),i=xe.fromMillis(e.localWriteTimeMs);return new hc(e.batchId,i,t,r)}function Ja(n){let e=Di(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Di(n.lastLimboFreeSnapshotVersion):X.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return K(s.documents.length===1),It(ro(wA(s.documents[0])))}(n.query):function(s){return It(AA(s))}(n.query),new Ws(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,rt.fromBase64String(n.resumeToken))}function PA(n,e){let t=Pi(e.snapshotVersion),r=Pi(e.lastLimboFreeSnapshotVersion),i;i=Qu(e.target)?IA(n.ct,e.target):bA(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Si(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function b_(n){let e=AA({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Xu(e,e.limit,"L"):e}function pg(n,e){return new dc(e.largestBatchId,Zg(n.ct,e.overlayMutation))}function nb(n,e){let t=e.path.lastSegment();return[n,Tt(e.path.popLast()),t]}function rb(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Pi(r.readTime),documentKey:Tt(r.documentKey.path),largestBatchId:r.largestBatchId}}var em=class{getBundleMetadata(e,t){return ib(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Di(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return ib(e).put(function(i){return{bundleId:i.id,createTime:Pi($e(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return sb(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:b_(s.bundledQuery),readTime:Di(s.readTime)}}(r)})}saveNamedQuery(e,t){return sb(e).put(function(i){return{name:i.name,readTime:Pi($e(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function ib(n){return it(n,"bundles")}function sb(n){return it(n,"namedQueries")}var rh=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Ka(e).get(nb(this.userId,t)).next(r=>r?pg(this.serializer,r):null)}getOverlays(e,t){let r=Rn();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new dc(t,o);i.push(this.ht(e,a))}),D.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Tt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Ka(e).j("collectionPathOverlayIndex",a))}),D.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Rn(),s=Tt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ka(e).U("collectionPathOverlayIndex",o).next(a=>{for(let l of a){let u=pg(this.serializer,l);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Rn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ka(e).J({index:"collectionGroupOverlayIndex",range:a},(l,u,h)=>{let f=pg(this.serializer,u);s.size()<i||f.largestBatchId===o?(s.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>s)}ht(e,t){return Ka(e).put(function(i,s,o){let[a,l,u]=nb(s,o.mutation.key);return{userId:s,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:mc(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Ka(n){return it(n,"documentOverlays")}var Zn=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Ue(e.integerValue));else if("doubleValue"in e){let r=Ue(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),sc(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"&&(r=tr(r)),t.At(`${r.seconds||""}`),t.dt(r.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Lr(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Gb(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):z()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),q.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};Zn.bt=new Zn;function yO(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function ob(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=yO(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var tm=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),r=ob(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),r=ob(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},nm=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},rm=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},wi=class{constructor(){this.Gt=new tm,this.zt=new nm(this.Gt),this.jt=new rm(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var Ei=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Cr(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=ab(n.arrayValue,e.arrayValue),t!==0?t:(t=ab(n.directionalValue,e.directionalValue),t!==0?t:q.comparator(n.documentKey,e.documentKey)))}function ab(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var ih=class{constructor(e){this.Yt=new Ee((t,r)=>qe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(K(e.collectionGroup===this.collectionId),this.en)return!1;let t=Ag(e);if(t!==void 0&&!this.nn(t))return!1;let r=_i(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.rn(a,l)||!this.sn(this.Zt[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new Ee(qe.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ls(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ls(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ls(r.field,r.dir==="asc"?0:1)));return new js(js.UNKNOWN_ID,this.collectionId,t,ic.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function DA(n){var e,t;if(K(n instanceof ue||n instanceof ye),n instanceof ue){if(n instanceof Hu){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ue.create(n.field,"==",s)))||[];return ye.create(i,"or")}return n}let r=n.filters.map(i=>DA(i));return ye.create(r,n.op)}function vO(n){if(n.getFilters().length===0)return[];let e=om(DA(n));return K(NA(e)),im(e)||sm(e)?[e]:e.getFilters()}function im(n){return n instanceof ue}function sm(n){return n instanceof ye&&w_(n)}function NA(n){return im(n)||sm(n)||function(t){if(t instanceof ye&&xg(t)){for(let r of t.getFilters())if(!im(r)&&!sm(r))return!1;return!0}return!1}(n)}function om(n){if(K(n instanceof ue||n instanceof ye),n instanceof ue)return n;if(n.filters.length===1)return om(n.filters[0]);let e=n.filters.map(r=>om(r)),t=ye.create(e,n.op);return t=sh(t),NA(t)?t:(K(t instanceof ye),K(qs(t)),K(t.filters.length>1),t.filters.reduce((r,i)=>A_(r,i)))}function A_(n,e){let t;return K(n instanceof ue||n instanceof ye),K(e instanceof ue||e instanceof ye),t=n instanceof ue?e instanceof ue?function(i,s){return ye.create([i,s],"and")}(n,e):cb(n,e):e instanceof ue?cb(e,n):function(i,s){if(K(i.filters.length>0&&s.filters.length>0),qs(i)&&qs(s))return Qb(i,s.getFilters());let o=xg(i)?i:s,a=xg(i)?s:i,l=o.filters.map(u=>A_(u,a));return ye.create(l,"or")}(n,e),sh(t)}function cb(n,e){if(qs(e))return Qb(e,n.getFilters());{let t=e.filters.map(r=>A_(n,r));return ye.create(t,"or")}}function sh(n){if(K(n instanceof ue||n instanceof ye),n instanceof ue)return n;let e=n.getFilters();if(e.length===1)return sh(e[0]);if(Kb(n))return n;let t=e.map(i=>sh(i)),r=[];return t.forEach(i=>{i instanceof ue?r.push(i):i instanceof ye&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ye.create(r,n.op)}var am=class{constructor(){this._n=new _c}addToCollectionParentIndex(e,t){return this._n.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(Xt.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(Xt.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}},_c=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ee(de.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ee(de.comparator)).toArray()}};var Du=new Uint8Array(0),cm=class{constructor(e,t){this.databaseId=t,this.an=new _c,this.un=new kn(r=>Si(r),(r,i)=>Sc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:Tt(i)};return lb(e).put(s)}return D.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[kb(t),""],!1,!0);return lb(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(An(o.parent))}return r})}addFieldIndex(e,t){let r=Ha(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Cs(e);return s.next(a=>{o.put(rb(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Ha(e),i=Cs(e),s=Ss(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ha(e),r=Ss(e),i=Cs(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return D.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new ih(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Ss(e),i=!0,s=new Map;return D.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ie(),a=[];return D.forEach(s,(l,u)=>{L("IndexedDbIndexManager",`Using index ${function(x){return`id=${x.indexId}|cg=${x.collectionGroup}|f=${x.fields.map(U=>`${U.fieldPath}:${U.kind}`).join(",")}`}(l)} to execute ${Si(t)}`);let h=function(x,U){let Y=Ag(U);if(Y===void 0)return null;for(let H of Yu(x,Y.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(u,l),f=function(x,U){let Y=new Map;for(let H of _i(U))for(let T of Yu(x,H.fieldPath))switch(T.op){case"==":case"in":Y.set(H.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return Y.set(H.fieldPath.canonicalString(),T.value),Array.from(Y.values())}return null}(u,l),g=function(x,U){let Y=[],H=!0;for(let T of _i(U)){let y=T.kind===0?qI(x,T.fieldPath,x.startAt):$I(x,T.fieldPath,x.startAt);Y.push(y.value),H&&(H=y.inclusive)}return new Nn(Y,H)}(u,l),_=function(x,U){let Y=[],H=!0;for(let T of _i(U)){let y=T.kind===0?$I(x,T.fieldPath,x.endAt):qI(x,T.fieldPath,x.endAt);Y.push(y.value),H&&(H=y.inclusive)}return new Nn(Y,H)}(u,l),E=this.hn(l,u,g),S=this.hn(l,u,_),I=this.Pn(l,u,f),O=this.In(l.indexId,h,E,g.inclusive,S,_.inclusive,I);return D.forEach(O,j=>r.G(j,t.limit).next(x=>{x.forEach(U=>{let Y=q.fromSegments(U.documentKey);o.has(Y)||(o=o.add(Y),a.push(Y))})}))}).next(()=>a)}return D.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=vO(ye.create(e.filters,"and")).map(r=>qg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){let g=t?this.Tn(t[f/u]):Du,_=this.En(e,g,r[f%u],i),E=this.dn(e,g,s[f%u],o),S=a.map(I=>this.En(e,g,I,!0));h.push(...this.createRange(_,E,S))}return h}En(e,t,r,i){let s=new Ei(e,q.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new Ei(e,q.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new ih(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return D.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new Ee(qe.comparator),h=!1;for(let f of l.filters)for(let g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:u=u.add(g.field));for(let f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new wi;for(let i of _i(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);Zn.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new wi;return Zn.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new wi;return Zn.bt.Pt(Ai(this.databaseId,t),r.Ht(function(s){let o=_i(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new wi);let s=0;for(let o of _i(e)){let a=r[s++];for(let l of i)if(this.Vn(t,o.fieldPath)&&lc(a))i=this.mn(i,o,a);else{let u=l.Ht(o.kind);Zn.bt.Pt(a,u)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new wi;l.seed(a.Wt()),Zn.bt.Pt(o,l.Ht(t.kind)),s.push(l)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof ue&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ha(e),i=Cs(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return D.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){let g=f?new ic(f.sequenceNumber,new Xt(Di(f.readTime),new q(An(f.documentKey)),f.largestBatchId)):ic.empty(),_=h.fields.map(([E,S])=>new Ls(qe.fromServerFormat(E),S));return new js(h.indexId,h.collectionGroup,_,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ne(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ha(e),s=Cs(e);return this.gn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>D.forEach(a,l=>s.put(rb(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return D.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?D.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),D.forEach(a,l=>this.pn(e,i,l).next(u=>{let h=this.yn(s,l);return u.isEqual(h)?D.resolve():this.wn(e,s,l,u,h)}))))})}Sn(e,t,r,i){return Ss(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return Ss(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=Ss(e),s=new Ee(Cr);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new Ei(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new Ee(Cr),i=this.An(t,e);if(i==null)return r;let s=Ag(t);if(s!=null){let o=e.data.field(s.fieldPath);if(lc(o))for(let a of o.arrayValue.values||[])r=r.add(new Ei(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new Ei(t.indexId,e.key,Du,i));return r}wn(e,t,r,i,s){L("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(l,u,h,f,g){let _=l.getIterator(),E=u.getIterator(),S=Rs(_),I=Rs(E);for(;S||I;){let O=!1,j=!1;if(S&&I){let x=h(S,I);x<0?j=!0:x>0&&(O=!0)}else S!=null?j=!0:O=!0;O?(f(I),I=Rs(E)):j?(g(S),S=Rs(_)):(S=Rs(_),I=Rs(E))}}(i,s,Cr,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),D.waitFor(o)}gn(e){let t=1;return Cs(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Cr(o,a)).filter((o,a,l)=>!a||Cr(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Cr(o,e),l=Cr(o,t);if(a===0)i[0]=e.Jt();else if(a>0&&l<0)i.push(o),i.push(o.Jt());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Du,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Du,[]];s.push(IDBKeyRange.bound(a,l))}return s}Dn(e,t){return Cr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ub)}getMinOffset(e,t){return D.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||z())).next(ub)}};function lb(n){return it(n,"collectionParents")}function Ss(n){return it(n,"indexEntries")}function Ha(n){return it(n,"indexConfiguration")}function Cs(n){return it(n,"indexState")}function ub(n){K(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;__(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Xt(e.readTime,e.documentKey,t)}var hb={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Qt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function kA(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.J({range:o},(h,f,g)=>(a++,g.delete()));s.push(l.next(()=>{K(a===1)}));let u=[];for(let h of t.mutations){let f=Vb(e,h.key.path,t.batchId);s.push(i.delete(f)),u.push(h.key)}return D.waitFor(s).next(()=>u)}function oh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw z();e=n.noDocument}return JSON.stringify(e).length}Qt.DEFAULT_COLLECTION_PERCENTILE=10,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qt.DEFAULT=new Qt(41943040,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qt.DISABLED=new Qt(-1,0,0);var ah=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){K(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pr(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Os(e),o=Pr(e);return o.add({}).next(a=>{K(typeof a=="number");let l=new hc(a,t,r,i),u=function(_,E,S){let I=S.baseMutations.map(j=>mc(_.ct,j)),O=S.mutations.map(j=>mc(_.ct,j));return{userId:E,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:I,mutations:O}}(this.serializer,this.userId,l),h=[],f=new Ee((g,_)=>ne(g.canonicalString(),_.canonicalString()));for(let g of i){let _=Vb(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(u)),h.push(s.put(_,Rx))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Cn[a]=l.keys()}),D.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return Pr(e).get(t).next(r=>r?(K(r.userId===this.userId),vi(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?D.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Pr(e).J({index:"userMutationsIndex",range:i},(o,a,l)=>{a.userId===this.userId&&(K(a.batchId>=r),s=vi(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Pr(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Pr(e).U("userMutationsIndex",t).next(r=>r.map(i=>vi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ou(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Os(e).J({range:i},(o,a,l)=>{let[u,h,f]=o,g=An(h);if(u===this.userId&&t.path.isEqual(g))return Pr(e).get(f).next(_=>{if(!_)throw z();K(_.userId===this.userId),s.push(vi(this.serializer,_))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ee(ne),i=[];return t.forEach(s=>{let o=Ou(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Os(e).J({range:a},(u,h,f)=>{let[g,_,E]=u,S=An(_);g===this.userId&&s.path.isEqual(S)?r=r.add(E):f.done()});i.push(l)}),D.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ou(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ee(ne);return Os(e).J({range:o},(l,u,h)=>{let[f,g,_]=l,E=An(g);f===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(_)):h.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Pr(e).get(s).next(o=>{if(o===null)throw z();K(o.userId===this.userId),r.push(vi(this.serializer,o))}))}),D.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return kA(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),D.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return D.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Os(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let l=An(s[1]);i.push(l)}else a.done()}).next(()=>{K(i.length===0)})})}containsKey(e,t){return xA(e,this.userId,t)}xn(e){return OA(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function xA(n,e,t){let r=Ou(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Os(n).J({range:s,H:!0},(a,l,u)=>{let[h,f,g]=a;h===e&&f===i&&(o=!0),u.done()}).next(()=>o)}function Pr(n){return it(n,"mutations")}function Os(n){return it(n,"documentMutations")}function OA(n){return it(n,"mutationQueues")}var Ks=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var lm=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let r=new Ks(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>X.fromTimestamp(new xe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ps(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(K(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ps(e).J((o,a)=>{let l=Ja(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>D.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ps(e).J((r,i)=>{let s=Ja(i);t(s)})}Bn(e){return db(e).get("targetGlobalKey").next(t=>(K(t!==null),t))}kn(e,t){return db(e).put("targetGlobalKey",t)}qn(e,t){return Ps(e).put(PA(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Si(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ps(e).J({range:i,index:"queryTargetsIndex"},(o,a,l)=>{let u=Ja(a);Sc(t,u.target)&&(s=u,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Dr(e);return t.forEach(o=>{let a=Tt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),D.waitFor(i)}removeMatchingKeys(e,t,r){let i=Dr(e);return D.forEach(t,s=>{let o=Tt(s.path);return D.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Dr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Dr(e),s=ie();return i.J({range:r,H:!0},(o,a,l)=>{let u=An(o[1]),h=new q(u);s=s.add(h)}).next(()=>s)}containsKey(e,t){let r=Tt(t.path),i=IDBKeyRange.bound([r],[kb(r)],!1,!0),s=0;return Dr(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],l,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}ot(e,t){return Ps(e).get(t).next(r=>r?Ja(r):null)}};function Ps(n){return it(n,"targets")}function db(n){return it(n,"targetGlobal")}function Dr(n){return it(n,"targetDocuments")}function fb([n,e],[t,r]){let i=ne(n,t);return i===0?ne(e,r):i}var um=class{constructor(e){this.Kn=e,this.buffer=new Ee(fb),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();fb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},hm=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){L("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Gr(t)?L("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield zr(t)}yield this.zn(3e5)}))}},dm=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return D.resolve(Lt.oe);let r=new um(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(hb)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hb):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(s=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),Ds()<=Kt.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}};function wO(n,e){return new dm(n,e)}var fm=class{constructor(e,t){this.db=e,this.garbageCollector=wO(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return Nu(e,r)}removeReference(e,t,r){return Nu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Nu(e,t)}er(e,t){return function(i,s){let o=!1;return OA(i).Y(a=>xA(i,a,s).next(l=>(l&&(o=!0),D.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=t){let l=this.er(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,X.min()),Dr(e).delete(function(f){return[0,Tt(f.path)]}(o))))});i.push(l)}}).next(()=>D.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Nu(e,t)}Xn(e,t){let r=Dr(e),i,s=Lt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:u})=>{o===0?(s!==Lt.oe&&t(new q(An(i)),s),s=u,i=l):s=Lt.oe}).next(()=>{s!==Lt.oe&&t(new q(An(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Nu(n,e){return Dr(n).put(function(r,i){return{targetId:0,path:Tt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var ch=class{constructor(){this.changes=new kn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var pm=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return mi(e).put(r)}removeEntry(e,t,r){return mi(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],nh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=Xe.newInvalidDocument(t);return mi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Qa(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:Xe.newInvalidDocument(t)};return mi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Qa(t))},(i,s)=>{r={document:this.nr(t,s),size:oh(s)}}).next(()=>r)}getEntries(e,t){let r=Dt();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=Dt(),i=new Se(q.comparator);return this.ir(e,t,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,oh(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return D.resolve();let i=new Ee(mb);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Qa(i.first()),Qa(i.last())),o=i.getIterator(),a=o.getNext();return mi(e).J({index:"documentKeyIndex",range:s},(l,u,h)=>{let f=q.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&mb(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.$(Qa(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),nh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return mi(e).U(IDBKeyRange.bound(a,l,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let h=Dt();for(let f of u){let g=this.nr(q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Pc(t,g)||i.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,i){let s=Dt(),o=gb(t,r),a=gb(t,Xt.max());return mi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{let f=this.nr(q.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(f.key,f),s.size===i&&h.done()}).next(()=>s)}newChangeBuffer(e){return new gm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return pb(e).get("remoteDocumentGlobalKey").next(t=>(K(!!t),t))}tr(e,t){return pb(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=_O(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(X.min())))return r}return Xe.newInvalidDocument(e)}};function MA(n){return new pm(n)}var gm=class extends ch{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new kn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ee((s,o)=>ne(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=tb(this.ar.serializer,o);i=i.add(s.path.popLast());let u=oh(l);r+=u-a.size,t.push(this.ar.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=tb(this.ar.serializer,o.convertToNoDocument(X.min()));t.push(this.ar.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),D.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function pb(n){return it(n,"remoteDocumentGlobal")}function mi(n){return it(n,"remoteDocumentsV14")}function Qa(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function gb(n,e){let t=e.documentKey.path.toArray();return[n,nh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function mb(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ne(t[s],r[s]),i)return i;return i=ne(t.length,r.length),i||(i=ne(t[t.length-2],r[r.length-2]),i||ne(t[t.length-1],r[r.length-1]))}var mm=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var lh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&tc(r.mutation,i,Ft.empty(),xe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ie()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ie()){let i=Rn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Xa();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Rn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ie()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Dt(),o=ec(),a=function(){return ec()}();return t.forEach((l,u)=>{let h=r.get(u.key);i.has(u.key)&&(h===void 0||h.mutation instanceof un)?s=s.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),tc(h.mutation,u,h.mutation.getFieldMask(),xe.now())):o.set(u.key,Ft.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>{var f;return a.set(u,new mm(h,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let r=ec(),i=new Se((o,a)=>o-a),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let u=t.get(l);if(u===null)return;let h=r.get(l)||Ft.empty();h=a.applyToLocalView(u,h),r.set(l,h);let f=(i.get(a.batchId)||ie()).add(l);i=i.insert(a.batchId,f)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),u=l.key,h=l.value,f=iA();h.forEach(g=>{if(!s.has(g)){let _=dA(t.get(g),r.get(g));_!==null&&f.set(g,_),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return D.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):E_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):D.resolve(Rn()),a=-1,l=s;return o.next(u=>D.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(h)?D.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,ie())).next(h=>({batchId:a,changes:rA(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Xa();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Xa();return this.indexManager.getCollectionParents(e,s).next(a=>D.forEach(a,l=>{let u=function(f,g){return new ln(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,u)=>{let h=u.getKey();o.get(h)===null&&(o=o.insert(h,Xe.newInvalidDocument(h)))});let a=Xa();return o.forEach((l,u)=>{let h=s.get(l);h!==void 0&&tc(h.mutation,u,Ft.empty(),xe.now()),Pc(t,u)&&(a=a.insert(l,u))}),a})}};var _m=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return D.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:$e(i.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:b_(i.bundledQuery),readTime:$e(i.readTime)}}(t)),D.resolve()}};var ym=class{constructor(){this.overlays=new Se(q.comparator),this.hr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Rn();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){let i=Rn(),s=t.length+1,o=new q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Se((u,h)=>u-h),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=Rn(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=Rn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=i)););return D.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new dc(t,r));let s=this.hr.get(t);s===void 0&&(s=ie(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var yc=class{constructor(){this.Pr=new Ee(He.Ir),this.Tr=new Ee(He.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new He(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new He(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new q(new de([])),r=new He(t,e),i=new He(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new q(new de([])),r=new He(t,e),i=new He(t,e+1),s=ie();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new He(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},He=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return q.comparator(e.key,t.key)||ne(e.pr,t.pr)}static Er(e,t){return ne(e.pr,t.pr)||q.comparator(e.key,t.key)}};var vm=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Ee(He.Ir)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new hc(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new He(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return D.resolve(o)}lookupMutationBatch(e,t){return D.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new He(t,0),i=new He(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ee(ne);return t.forEach(i=>{let s=new He(i,0),o=new He(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),D.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;q.isDocumentKey(s)||(s=s.child(""));let o=new He(new q(s),0),a=new Ee(ne);return this.wr.forEachWhile(l=>{let u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(l.pr)),!0)},o),D.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){K(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return D.forEach(t.mutations,i=>{let s=new He(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new He(t,0),i=this.wr.firstAfterOrEqual(r);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var wm=class{constructor(e){this.vr=e,this.docs=function(){return new Se(q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():Xe.newInvalidDocument(t))}getEntries(e,t){let r=Dt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Xe.newInvalidDocument(i))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Dt(),o=t.path,a=new q(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||__(Ob(h),r)<=0||(i.has(h.key)||Pc(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(e,t,r,i){z()}Fr(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Em(this)}getSize(e){return D.resolve(this.size)}},Em=class extends ch{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var Tm=class{constructor(e){this.persistence=e,this.Mr=new kn(t=>Si(t),Sc),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.Or=0,this.Nr=new yc,this.targetCount=0,this.Lr=Ks.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),D.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new Ks(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.qn(t),D.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),D.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),D.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this.Nr.containsKey(t))}};var uh=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new Lt(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Tm(this),this.indexManager=new am,this.remoteDocumentCache=function(i){return new wm(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new th(t),this.$r=new _m(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ym,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new vm(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);let i=new Im(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return D.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},Im=class extends $u{constructor(e){super(),this.currentSequenceNumber=e}},hh=class n{constructor(e){this.persistence=e,this.zr=new yc,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw z()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),D.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.Jr,r=>{let i=q.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,X.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return D.or([()=>D.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var bm=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new zu("createOrUpgrade",t);r<1&&i>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xI,{unique:!0}),l.createObjectStore("documentMutations")}(e),_b(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=D.resolve();return r<3&&i>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),_b(e)),o=o.next(()=>function(l){let u=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",h)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xI,{unique:!0});let f=u.store("mutations"),g=h.map(_=>f.put(_));return D.waitFor(g)})}(e,s))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(l){let u=l.createObjectStore("documentOverlays",{keyPath:Vx});u.createIndex("collectionPathOverlayIndex",Ux,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",jx,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(l){let u=l.createObjectStore("remoteDocumentsV14",{keyPath:Sx});u.createIndex("documentKeyIndex",Cx),u.createIndex("collectionGroupIndex",Px)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:Ox}).createIndex("sequenceNumberIndex",Mx,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:Lx}).createIndex("documentKeyIndex",Fx,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}ei(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=oh(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>D.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>D.forEach(a,l=>{K(l.userId===s.userId);let u=vi(this.serializer,l);return kA(e,s.userId,u).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let l=new de(o),u=function(f){return[0,Tt(f)]}(l);s.push(t.get(u).next(h=>h?D.resolve():(f=>t.put({targetId:0,path:Tt(f),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>D.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:xx});let r=t.store("collectionParents"),i=new _c,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Tt(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let l=new de(o);return s(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],u)=>{let h=An(a);return s(h.popLast())}))}ri(e){let t=e.store("targets");return t.J((r,i)=>{let s=Ja(i),o=PA(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new q(de.fromString(f.document.name).popFirst(5)):f.noDocument?q.fromSegments(f.noDocument.path):f.unknownDocument?q.fromSegments(f.unknownDocument.path):z()}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>D.waitFor(i))}si(e,t){let r=t.store("mutations"),i=MA(this.serializer),s=new uh(hh.Hr,this.serializer.ct);return r.U().next(o=>{let a=new Map;return o.forEach(l=>{var u;let h=(u=a.get(l.userId))!==null&&u!==void 0?u:ie();vi(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),D.forEach(a,(l,u)=>{let h=new Qe(u),f=rh.lt(this.serializer,h),g=s.getIndexManager(h),_=ah.lt(h,this.serializer,g,s.referenceDelegate);return new lh(i,_,f,g).recalculateAndSaveOverlaysForDocumentKeys(new oc(t,Lt.oe),l).next()})})}};function _b(n){n.createObjectStore("targetDocuments",{keyPath:Nx}).createIndex("documentTargetsIndex",kx,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Dx,{unique:!0}),n.createObjectStore("targetGlobal")}var gg="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Am=class n{constructor(e,t,r,i,s,o,a,l,u,h,f=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=u,this.ai=h,this.ui=f,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=g=>Promise.resolve(),!n.D())throw new M(k.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fm(this,i),this.Ti=t+"main",this.serializer=new th(l),this.Ei=new Mr(this.Ti,this.ui,new bm(this.serializer)),this.Qr=new lm(this.referenceDelegate,this.serializer),this.remoteDocumentCache=MA(this.serializer),this.$r=new em,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,h===!1&&Be("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new M(k.FAILED_PRECONDITION,gg);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Lt(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>P(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(t=>P(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>P(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ku(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Gr(e))return L("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return L("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Ya(e).get("owner").next(t=>D.resolve(this.Si(t)))}bi(e){return ku(e).delete(this.clientId)}Di(){return P(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=it(t,"clientMetadata");return r.U().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return D.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?D.resolve(!0):Ya(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new M(k.FAILED_PRECONDITION,gg);return!1}}return!(!this.networkEnabled||!this.inForeground)||ku(e).U().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&L("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return P(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new oc(e,Lt.oe);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>ku(e).U().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return ah.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new cm(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return rh.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){L("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(l){return l===16?qx:l===15?qb:l===14?Bb:l===13?jb:l===12?Bx:l===11?Ub:void z()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new oc(a,this.kr?this.kr.next():Lt.oe),t==="readwrite-primary"?this.gi(o).next(l=>!!l||this.pi(o)).next(l=>{if(!l)throw Be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new M(k.FAILED_PRECONDITION,Mb);return r(o)}).next(l=>this.wi(o).next(()=>l)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return Ya(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new M(k.FAILED_PRECONDITION,gg)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ya(e).put("owner",t)}static D(){return Mr.D()}yi(e){let t=Ya(e);return t.get("owner").next(r=>this.Si(r)?(L("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):D.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Be(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;Kf()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return L("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Be("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Be("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ya(n){return it(n,"owner")}function ku(n){return it(n,"clientMetadata")}function R_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Rm=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=ie(),i=ie();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Sm=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var dh=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Kf()?8:Lb(ca())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Sm;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(Ds()<=Kt.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",Ns(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),D.resolve()):(Ds()<=Kt.DEBUG&&L("QueryEngine","Query:",Ns(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Ds()<=Kt.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",Ns(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,It(t))):D.resolve())}ji(e,t){if(zI(t))return D.resolve(null);let r=It(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Xu(t,null,"F"),r=It(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ie(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let u=this.Zi(t,a);return this.Xi(t,u,o,l.readTime)?this.ji(e,Xu(t,null,"F")):this.es(e,u,t,l)}))})))}Hi(e,t,r,i){return zI(t)||i.isEqual(X.min())?D.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?D.resolve(null):(Ds()<=Kt.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ns(t)),this.es(e,o,t,xb(i,-1)).next(a=>a))})}Zi(e,t){let r=new Ee(tA(e));return t.forEach((i,s)=>{Pc(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return Ds()<=Kt.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",Ns(t)),this.zi.getDocumentsMatchingQuery(e,t,Xt.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Cm=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new Se(ne),this.rs=new kn(s=>Si(s),Sc),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function LA(n,e,t,r){return new Cm(n,e,t,r)}function FA(n,e){return P(this,null,function*(){let t=$(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],l=ie();for(let u of i){o.push(u.batchId);for(let h of u.mutations)l=l.add(h.key)}for(let u of s){a.push(u.batchId);for(let h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function EO(n,e){let t=$(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){let f=u.batch,g=f.keys(),_=D.resolve();return g.forEach(E=>{_=_.next(()=>h.getEntry(l,E)).next(S=>{let I=u.docVersions.get(E);K(I!==null),S.version.compareTo(I)<0&&(f.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),h.addEntry(S)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ie();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function VA(n){let e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function TO(n,e){let t=$(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let a=[];e.targetChanges.forEach((h,f)=>{let g=i.get(f);if(!g)return;a.push(t.Qr.removeMatchingKeys(s,h.removedDocuments,f).next(()=>t.Qr.addMatchingKeys(s,h.addedDocuments,f)));let _=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(rt.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),i=i.insert(f,_),function(S,I,O){return S.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(g,_,h)&&a.push(t.Qr.updateTargetData(s,_))});let l=Dt(),u=ie();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))}),a.push(UA(s,o,e.documentUpdates).next(h=>{l=h.cs,u=h.ls})),!r.isEqual(X.min())){let h=t.Qr.getLastRemoteSnapshotVersion(s).next(f=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(h)}return D.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(t.ns=i,s))}function UA(n,e,t){let r=ie(),i=ie();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Dt();return t.forEach((a,l)=>{let u=s.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(X.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):L("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{cs:o,ls:i}})}function IO(n,e){let t=$(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Hs(n,e){let t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,D.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new Ws(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Qs(n,e,t){return P(this,null,function*(){let r=$(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Gr(o))throw o;L("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function fh(n,e,t){let r=$(n),i=X.min(),s=ie();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){let f=$(l),g=f.rs.get(h);return g!==void 0?D.resolve(f.ns.get(g)):f.Qr.getTargetData(u,h)}(r,o,It(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:X.min(),t?s:ie())).next(a=>(qA(r,eA(e),a),{documents:a,hs:s})))}function jA(n,e){let t=$(n),r=$(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function BA(n,e){let t=$(n),r=t.ss.get(e)||X.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,xb(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(qA(t,e,i),i))}function qA(n,e,t){let r=n.ss.get(e)||X.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function bO(n,e,t,r){return P(this,null,function*(){let i=$(n),s=ie(),o=Dt();for(let u of t){let h=e.Ps(u.metadata.name);u.document&&(s=s.add(h));let f=e.Is(u);f.setReadTime(e.Ts(u.metadata.readTime)),o=o.insert(h,f)}let a=i.os.newChangeBuffer({trackRemovals:!0}),l=yield Hs(i,function(h){return It(ro(de.fromString(`__bundle__/docs/${h}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",u=>UA(u,a,o).next(h=>(a.apply(u),h)).next(h=>i.Qr.removeMatchingKeysForTargetId(u,l.targetId).next(()=>i.Qr.addMatchingKeys(u,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,h.cs,h.ls)).next(()=>h.cs)))})}function AO(r,i){return P(this,arguments,function*(n,e,t=ie()){let s=yield Hs(n,It(b_(e.bundledQuery))),o=$(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=$e(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.$r.saveNamedQuery(a,e);let u=s.withResumeToken(rt.EMPTY_BYTE_STRING,l);return o.ns=o.ns.insert(u.targetId,u),o.Qr.updateTargetData(a,u).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function yb(n,e){return`firestore_clients_${n}_${e}`}function vb(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function mg(n,e){return`firestore_targets_${n}_${e}`}var ph=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new M(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Be("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},nc=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new M(r.error.code,r.error.message))),s?new n(e,r.state,i):(Be("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},gh=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=T_();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Fb(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Be("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Pm=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Be("SharedClientState",`Failed to parse online state: ${e}`),null)}},vc=class{constructor(){this.activeTargetIds=T_()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},rc=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Se(ne),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=yb(this.persistenceKey,this.Vs),this.Ss=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new vc),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Fs=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return P(this,null,function*(){let e=yield this.syncEngine.Bi();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(yb(this.persistenceKey,r));if(i){let s=gh.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(mg(this.persistenceKey,e));if(r){let i=nc.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(mg(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return L("SharedClientState","READ",e,t),t}setItem(e,t){L("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){L("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(L("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void Be("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>P(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=Lt.oe;if(s!=null)try{let a=JSON.parse(s);K(typeof a=="number"),o=a}catch(a){Be("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Lt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){let i=new ph(this.currentUser,e,t,r),s=vb(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=vb(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=mg(this.persistenceKey,e),s=new nc(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return gh.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return ph.Es(new Qe(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return nc.Es(i,t)}xs(e){return Pm.Es(e)}Js(e){return JSON.parse(e)}zs(e){return P(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);L("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=T_();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},mh=class{constructor(){this.no=new vc,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new vc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Dm=class{io(e){}shutdown(){}};var _h=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){L("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){L("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var xu=null;function _g(){return xu===null?xu=function(){return 268435456+Math.round(2147483648*Math.random())}():xu++,"0x"+xu.toString(16)}var RO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Nm=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}};var mt="WebChannelConnection",km=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=r+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,r,i,s,o){let a=_g(),l=this.vo(t,r.toUriEncodedString());L("RestConnection",`Sending RPC '${t}' ${a}:`,l,i);let u={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(u,s,o),this.Mo(t,l,u,i).then(h=>(L("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Yt("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",i),h})}xo(t,r,i,s,o,a){return this.Co(t,r,i,s,o)}Fo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+no}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}vo(t,r){let i=RO[t];return`${this.wo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,r,i){let s=_g();return new Promise((o,a)=>{let l=new cg;l.setWithCredentials(!0),l.listenOnce(ug.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Wa.NO_ERROR:let h=l.getResponseJson();L(mt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),o(h);break;case Wa.TIMEOUT:L(mt,`RPC '${e}' ${s} timed out`),a(new M(k.DEADLINE_EXCEEDED,"Request time out"));break;case Wa.HTTP_ERROR:let f=l.getStatus();if(L(mt,`RPC '${e}' ${s} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);let _=g?.error;if(_&&_.status&&_.message){let E=function(I){let O=I.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(O)>=0?O:k.UNKNOWN}(_.status);a(new M(E,_.message))}else a(new M(k.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new M(k.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{L(mt,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);L(mt,`RPC '${e}' ${s} sending request:`,i),l.send(t,"POST",u,r,15)})}Oo(e,t,r){let i=_g(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=fg(),a=dg(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.xmlHttpFactory=new lg({})),this.Fo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let h=s.join("");L(mt,`Creating RPC '${e}' stream ${i}: ${h}`,l);let f=o.createWebChannel(h,l),g=!1,_=!1,E=new Nm({lo:I=>{_?L(mt,`Not sending because RPC '${e}' stream ${i} is closed:`,I):(g||(L(mt,`Opening RPC '${e}' stream ${i} transport.`),f.open(),g=!0),L(mt,`RPC '${e}' stream ${i} sending:`,I),f.send(I))},ho:()=>f.close()}),S=(I,O,j)=>{I.listen(O,x=>{try{j(x)}catch(U){setTimeout(()=>{throw U},0)}})};return S(f,As.EventType.OPEN,()=>{_||(L(mt,`RPC '${e}' stream ${i} transport opened.`),E.mo())}),S(f,As.EventType.CLOSE,()=>{_||(_=!0,L(mt,`RPC '${e}' stream ${i} transport closed`),E.po())}),S(f,As.EventType.ERROR,I=>{_||(_=!0,Yt(mt,`RPC '${e}' stream ${i} transport errored:`,I),E.po(new M(k.UNAVAILABLE,"The operation could not be completed")))}),S(f,As.EventType.MESSAGE,I=>{var O;if(!_){let j=I.data[0];K(!!j);let x=j,U=x.error||((O=x[0])===null||O===void 0?void 0:O.error);if(U){L(mt,`RPC '${e}' stream ${i} received error:`,U);let Y=U.status,H=function(w){let b=Ke[w];if(b!==void 0)return gA(b)}(Y),T=U.message;H===void 0&&(H=k.INTERNAL,T="Unknown error status: "+Y+" with message "+U.message),_=!0,E.po(new M(H,T)),f.close()}else L(mt,`RPC '${e}' stream ${i} received:`,j),E.yo(j)}}),S(a,hg.STAT_EVENT,I=>{I.stat===Pu.PROXY?L(mt,`RPC '${e}' stream ${i} detected buffering proxy`):I.stat===Pu.NOPROXY&&L(mt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.fo()},0),E}};function $A(){return typeof window<"u"?window:null}function Vu(){return typeof document<"u"?document:null}function Dc(n){return new Qg(n,!0)}var wc=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=r,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),r=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-r);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var yh=class{constructor(e,t,r,i,s,o,a,l){this.oi=e,this.Go=r,this.zo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new wc(e,t)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return P(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){return P(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){return P(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(Be(t.toString()),Be("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Ao(t)})}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.jo===t&&this.u_(r,i)},r=>{e(()=>{let i=new M(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.c_(i)})})}u_(e,t){let r=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{r(()=>this.listener.Po())}),this.stream.To(()=>{r(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{r(()=>this.c_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>P(this,null,function*(){this.state=0,this.start()}))}c_(e){return L("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(L("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},xm=class extends yh{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=uO(this.serializer,e),r=function(s){if(!("targetChange"in s))return X.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?X.min():o.readTime?$e(o.readTime):X.min()}(e);return this.listener.h_(t,r)}P_(e){let t={};t.database=Jg(this.serializer),t.addTarget=function(s,o){let a,l=o.target;if(a=Qu(l)?{documents:IA(s,l)}:{query:bA(s,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=_A(s,o.resumeToken);let u=Yg(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(X.min())>0){a.readTime=Gs(s,o.snapshotVersion.toTimestamp());let u=Yg(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=dO(this.serializer,e);r&&(t.labels=r),this.i_(t)}I_(e){let t={};t.database=Jg(this.serializer),t.removeTarget=e,this.i_(t)}},Om=class extends yh{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(K(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let t=hO(e.writeResults,e.commitTime),r=$e(e.commitTime);return this.listener.A_(r,t)}return K(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=Jg(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>mc(this.serializer,r))};this.i_(t)}};var Mm=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new M(k.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,Xg(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new M(k.UNKNOWN,s.toString())})}xo(e,t,r,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.xo(e,Xg(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new M(k.UNKNOWN,o.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},Lm=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(Be(t),this.y_=!1):L("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var Fm=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(o=>{r.enqueueAndForget(()=>P(this,null,function*(){Wr(this)&&(L("RemoteStore","Restarting streams for network reachability change."),yield function(l){return P(this,null,function*(){let u=$(l);u.M_.add(4),yield io(u),u.N_.set("Unknown"),u.M_.delete(4),yield Nc(u)})}(this))}))}),this.N_=new Lm(r,i)}};function Nc(n){return P(this,null,function*(){if(Wr(n))for(let e of n.x_)yield e(!0)})}function io(n){return P(this,null,function*(){for(let e of n.x_)yield e(!1)})}function Fh(n,e){let t=$(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),P_(t)?C_(t):oo(t).Xo()&&S_(t,e))}function Ys(n,e){let t=$(n),r=oo(t);t.F_.delete(e),r.Xo()&&zA(t,e),t.F_.size===0&&(r.Xo()?r.n_():Wr(t)&&t.N_.set("Unknown"))}function S_(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}oo(n).P_(e)}function zA(n,e){n.L_.xe(e),oo(n).I_(e)}function C_(n){n.L_=new Hg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),oo(n).start(),n.N_.w_()}function P_(n){return Wr(n)&&!oo(n).Zo()&&n.F_.size>0}function Wr(n){return $(n).M_.size===0}function GA(n){n.L_=void 0}function SO(n){return P(this,null,function*(){n.N_.set("Online")})}function CO(n){return P(this,null,function*(){n.F_.forEach((e,t)=>{S_(n,e)})})}function PO(n,e){return P(this,null,function*(){GA(n),P_(n)?(n.N_.D_(e),C_(n)):n.N_.set("Unknown")})}function DO(n,e,t){return P(this,null,function*(){if(n.N_.set("Online"),e instanceof Zu&&e.state===2&&e.cause)try{yield function(i,s){return P(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,e)}catch(r){L("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield vh(n,r)}else if(e instanceof Vs?n.L_.Ke(e):e instanceof Ju?n.L_.He(e):n.L_.We(e),!t.isEqual(X.min()))try{let r=yield VA(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){let h=s.F_.get(u);h&&s.F_.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{let h=s.F_.get(l);if(!h)return;s.F_.set(l,h.withResumeToken(rt.EMPTY_BYTE_STRING,h.snapshotVersion)),zA(s,l);let f=new Ws(h.target,l,u,h.sequenceNumber);S_(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){L("RemoteStore","Failed to raise snapshot:",r),yield vh(n,r)}})}function vh(n,e,t){return P(this,null,function*(){if(!Gr(e))throw e;n.M_.add(1),yield io(n),n.N_.set("Offline"),t||(t=()=>VA(n.localStore)),n.asyncQueue.enqueueRetryable(()=>P(this,null,function*(){L("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield Nc(n)}))})}function WA(n,e){return e().catch(t=>vh(n,t,e))}function so(n){return P(this,null,function*(){let e=$(n),t=$r(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;NO(e);)try{let i=yield IO(e.localStore,r);if(i===null){e.v_.length===0&&t.n_();break}r=i.batchId,kO(e,i)}catch(i){yield vh(e,i)}KA(e)&&HA(e)})}function NO(n){return Wr(n)&&n.v_.length<10}function kO(n,e){n.v_.push(e);let t=$r(n);t.Xo()&&t.E_&&t.d_(e.mutations)}function KA(n){return Wr(n)&&!$r(n).Zo()&&n.v_.length>0}function HA(n){$r(n).start()}function xO(n){return P(this,null,function*(){$r(n).V_()})}function OO(n){return P(this,null,function*(){let e=$r(n);for(let t of n.v_)e.d_(t.mutations)})}function MO(n,e,t){return P(this,null,function*(){let r=n.v_.shift(),i=Gg.from(r,e,t);yield WA(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield so(n)})}function LO(n,e){return P(this,null,function*(){e&&$r(n).E_&&(yield function(r,i){return P(this,null,function*(){if(function(o){return pA(o)&&o!==k.ABORTED}(i.code)){let s=r.v_.shift();$r(r).t_(),yield WA(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield so(r)}})}(n,e)),KA(n)&&HA(n)})}function wb(n,e){return P(this,null,function*(){let t=$(n);t.asyncQueue.verifyOperationInProgress(),L("RemoteStore","RemoteStore received new credentials");let r=Wr(t);t.M_.add(3),yield io(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Nc(t)})}function Vm(n,e){return P(this,null,function*(){let t=$(n);e?(t.M_.delete(2),yield Nc(t)):e||(t.M_.add(2),yield io(t),t.N_.set("Unknown"))})}function oo(n){return n.B_||(n.B_=function(t,r,i){let s=$(t);return s.f_(),new xm(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:SO.bind(null,n),To:CO.bind(null,n),Ao:PO.bind(null,n),h_:DO.bind(null,n)}),n.x_.push(e=>P(this,null,function*(){e?(n.B_.t_(),P_(n)?C_(n):n.N_.set("Unknown")):(yield n.B_.stop(),GA(n))}))),n.B_}function $r(n){return n.k_||(n.k_=function(t,r,i){let s=$(t);return s.f_(),new Om(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:()=>Promise.resolve(),To:xO.bind(null,n),Ao:LO.bind(null,n),R_:OO.bind(null,n),A_:MO.bind(null,n)}),n.x_.push(e=>P(this,null,function*(){e?(n.k_.t_(),yield so(n)):(yield n.k_.stop(),n.v_.length>0&&(L("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var Um=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ye,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ao(n,e){if(Be("AsyncQueue",`${e}: ${n}`),Gr(n))return new M(k.UNAVAILABLE,`${e}: ${n}`);throw n}var wh=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||q.comparator(t.key,r.key):(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Xa(),this.sortedSet=new Se(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Eh=class{constructor(){this.q_=new Se(q.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):z():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},Xs=class n{constructor(e,t,r,i,s,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,wh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var jm=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},Bm=class{constructor(){this.queries=new kn(e=>Zb(e),Cc),this.onlineState="Unknown",this.z_=new Set}};function D_(n,e){return P(this,null,function*(){let t=$(n),r=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new jm,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=ao(o,`Initialization of query '${Ns(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&k_(t)})}function N_(n,e){return P(this,null,function*(){let t=$(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function FO(n,e){let t=$(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&k_(t)}function VO(n,e,t){let r=$(n),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(t);r.queries.delete(e)}function k_(n){n.z_.forEach(e=>{e.next()})}var qm,Eb;(Eb=qm||(qm={})).J_="default",Eb.Cache="cache";var Ec=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Xs(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Xs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==qm.Cache}};var $m=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var Th=class{constructor(e){this.serializer=e}Ps(e){return Cn(this.serializer,e)}Is(e){return e.metadata.exists?TA(this.serializer,e.document,!1):Xe.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return $e(e)}},zm=class{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=QA(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let r=de.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,r=new Th(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ie()).add(s);t.set(o,a)}}return t}complete(){return P(this,null,function*(){let e=yield bO(this.localStore,new Th(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let r of this.queries)yield AO(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function QA(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Ih=class{constructor(e){this.key=e}},bh=class{constructor(e){this.key=e}},Ah=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=ie(),this.mutatedKeys=ie(),this.Ia=tA(e),this.Ta=new wh(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new Eh,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,f)=>{let g=i.get(h),_=Pc(this.query,f)?f:null,E=!!g&&this.mutatedKeys.has(g.key),S=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),I=!1;g&&_?g.data.isEqual(_.data)?E!==S&&(r.track({type:3,doc:_}),I=!0):this.Ra(g,_)||(r.track({type:2,doc:_}),I=!0,(l&&this.Ia(_,l)>0||u&&this.Ia(_,u)<0)&&(a=!0)):!g&&_?(r.track({type:0,doc:_}),I=!0):g&&!_&&(r.track({type:1,doc:g}),I=!0,(l||u)&&(a=!0)),I&&(_?(o=o.add(_),s=S?s.add(h):s.delete(h)):(o=o.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{Ta:o,Aa:r,Xi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((h,f)=>function(_,E){let S=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}};return S(_)-S(E)}(h.type,f.type)||this.Ia(h.doc,f.doc)),this.Va(r),i=i!=null&&i;let a=t&&!i?this.ma():[],l=this.Pa.size===0&&this.current&&!i?1:0,u=l!==this.ha;return this.ha=l,o.length!==0||u?{snapshot:new Xs(this.query,e.Ta,s,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Eh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=ie(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new bh(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new Ih(r))}),t}pa(e){this.la=e.hs,this.Pa=ie();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Xs.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},Gm=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Wm=class{constructor(e){this.key=e,this.wa=!1}},Km=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new kn(a=>Zb(a),Cc),this.Da=new Map,this.Ca=new Set,this.va=new Se(q.comparator),this.Fa=new Map,this.Ma=new yc,this.xa={},this.Oa=new Map,this.Na=Ks.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function UO(n,e,t=!0){return P(this,null,function*(){let r=Vh(n),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield YA(r,e,t,!0),i})}function jO(n,e){return P(this,null,function*(){let t=Vh(n);yield YA(t,e,!0,!1)})}function YA(n,e,t,r){return P(this,null,function*(){let i=yield Hs(n.localStore,It(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield x_(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Fh(n.remoteStore,i),a})}function x_(n,e,t,r,i){return P(this,null,function*(){n.Ba=(f,g,_)=>function(S,I,O,j){return P(this,null,function*(){let x=I.view.da(O);x.Xi&&(x=yield fh(S.localStore,I.query,!1).then(({documents:T})=>I.view.da(T,x)));let U=j&&j.targetChanges.get(I.targetId),Y=j&&j.targetMismatches.get(I.targetId)!=null,H=I.view.applyChanges(x,S.isPrimaryClient,U,Y);return Hm(S,I.targetId,H.fa),H.snapshot})}(n,f,g,_);let s=yield fh(n.localStore,e,!0),o=new Ah(e,s.hs),a=o.da(s.documents),l=pc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,l);Hm(n,t,u.fa);let h=new Gm(e,t,o);return n.ba.set(e,h),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),u.snapshot})}function BO(n,e,t){return P(this,null,function*(){let r=$(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Cc(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Qs(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ys(r.remoteStore,i.targetId),Js(r,i.targetId)}).catch(zr))):(Js(r,i.targetId),yield Qs(r.localStore,i.targetId,!0))})}function qO(n,e){return P(this,null,function*(){let t=$(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ys(t.remoteStore,r.targetId))})}function $O(n,e,t){return P(this,null,function*(){let r=F_(n);try{let i=yield function(o,a){let l=$(o),u=xe.now(),h=a.reduce((_,E)=>_.add(E.key),ie()),f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",_=>{let E=Dt(),S=ie();return l.os.getEntries(_,h).next(I=>{E=I,E.forEach((O,j)=>{j.isValidDocument()||(S=S.add(O))})}).next(()=>l.localDocuments.getOverlayedDocuments(_,E)).next(I=>{f=I;let O=[];for(let j of a){let x=rO(j,f.get(j.key).overlayedDocument);x!=null&&O.push(new un(j.key,x,Wb(x.value.mapValue),je.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,O,a)}).next(I=>{g=I;let O=I.applyToLocalDocumentSet(f,S);return l.documentOverlayCache.saveOverlays(_,I.batchId,O)})}).then(()=>({batchId:g.batchId,changes:rA(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,l){let u=o.xa[o.currentUser.toKey()];u||(u=new Se(ne)),u=u.insert(a,l),o.xa[o.currentUser.toKey()]=u}(r,i.batchId,t),yield or(r,i.changes),yield so(r.remoteStore)}catch(i){let s=ao(i,"Failed to persist write");t.reject(s)}})}function XA(n,e){return P(this,null,function*(){let t=$(n);try{let r=yield TO(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(K(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?K(o.wa):i.removedDocuments.size>0&&(K(o.wa),o.wa=!1))}),yield or(t,r,e)}catch(r){yield zr(r)}})}function Tb(n,e,t){let r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let l=$(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(let g of f.U_)g.j_(a)&&(u=!0)}),u&&k_(l)}(r.eventManager,e),i.length&&r.Sa.h_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function zO(n,e,t){return P(this,null,function*(){let r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new Se(q.comparator);o=o.insert(s,Xe.newNoDocument(s,X.min()));let a=ie().add(s),l=new fc(X.min(),new Map,new Se(ne),o,a);yield XA(r,l),r.va=r.va.remove(s),r.Fa.delete(e),L_(r)}else yield Qs(r.localStore,e,!1).then(()=>Js(r,e,t)).catch(zr)})}function GO(n,e){return P(this,null,function*(){let t=$(n),r=e.batch.batchId;try{let i=yield EO(t.localStore,e);M_(t,r,null),O_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield or(t,i)}catch(i){yield zr(i)}})}function WO(n,e,t){return P(this,null,function*(){let r=$(n);try{let i=yield function(o,a){let l=$(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(K(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);M_(r,e,t),O_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield or(r,i)}catch(i){yield zr(i)}})}function KO(n,e){return P(this,null,function*(){let t=$(n);Wr(t.remoteStore)||L("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=$(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){let i=ao(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function O_(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function M_(n,e,t){let r=$(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Js(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Vr(e).forEach(r=>{n.Ma.containsKey(r)||JA(n,r)})}function JA(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(Ys(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),L_(n))}function Hm(n,e,t){for(let r of t)r instanceof Ih?(n.Ma.addReference(r.key,e),HO(n,r)):r instanceof bh?(L("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||JA(n,r.key)):z()}function HO(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(L("SyncEngine","New document in limbo: "+t),n.Ca.add(r),L_(n))}function L_(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new q(de.fromString(e)),r=n.Na.next();n.Fa.set(r,new Wm(t)),n.va=n.va.insert(t,r),Fh(n.remoteStore,new Ws(It(ro(t.path)),r,"TargetPurposeLimboResolution",Lt.oe))}}function or(n,e,t){return P(this,null,function*(){let r=$(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,l)=>{o.push(r.Ba(l,e,t).then(u=>{if((u||t)&&r.isPrimaryClient){let h=u&&!u.fromCache;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){i.push(u);let h=Rm.Ki(l.targetId,u);s.push(h)}}))}),yield Promise.all(o),r.Sa.h_(i),yield function(l,u){return P(this,null,function*(){let h=$(l);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>D.forEach(u,g=>D.forEach(g.qi,_=>h.persistence.referenceDelegate.addReference(f,g.targetId,_)).next(()=>D.forEach(g.Qi,_=>h.persistence.referenceDelegate.removeReference(f,g.targetId,_)))))}catch(f){if(!Gr(f))throw f;L("LocalStore","Failed to update sequence numbers: "+f)}for(let f of u){let g=f.targetId;if(!f.fromCache){let _=h.ns.get(g),E=_.snapshotVersion,S=_.withLastLimboFreeSnapshotVersion(E);h.ns=h.ns.insert(g,S)}}})}(r.localStore,s))})}function QO(n,e){return P(this,null,function*(){let t=$(n);if(!t.currentUser.isEqual(e)){L("SyncEngine","User change. New user:",e.toKey());let r=yield FA(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(a=>{a.forEach(l=>{l.reject(new M(k.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield or(t,r.us)}})}function YO(n,e){let t=$(n),r=t.Fa.get(e);if(r&&r.wa)return ie().add(r.key);{let i=ie(),s=t.Da.get(e);if(!s)return i;for(let o of s){let a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function XO(n,e){return P(this,null,function*(){let t=$(n),r=yield fh(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&Hm(t,e.targetId,i.fa),i})}function JO(n,e){return P(this,null,function*(){let t=$(n);return BA(t.localStore,e).then(r=>or(t,r))})}function ZO(n,e,t,r){return P(this,null,function*(){let i=$(n),s=yield function(a,l){let u=$(a),h=$(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.vn(f,l).next(g=>g?u.localDocuments.getDocuments(f,g):D.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield so(i.remoteStore):t==="acknowledged"||t==="rejected"?(M_(i,e,r||null),O_(i,e),function(a,l){$($(a).mutationQueue).Mn(l)}(i.localStore,e)):z(),yield or(i,s)):L("SyncEngine","Cannot apply mutation batch with id: "+e)})}function eM(n,e){return P(this,null,function*(){let t=$(n);if(Vh(t),F_(t),e===!0&&t.La!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Ib(t,r.toArray());t.La=!0,yield Vm(t.remoteStore,!0);for(let s of i)Fh(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let r=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Js(t,o),Qs(t.localStore,o,!0))),Ys(t.remoteStore,o)}),yield i,yield Ib(t,r),function(o){let a=$(o);a.Fa.forEach((l,u)=>{Ys(a.remoteStore,u)}),a.Ma.mr(),a.Fa=new Map,a.va=new Se(q.comparator)}(t),t.La=!1,yield Vm(t.remoteStore,!1)}})}function Ib(n,e,t){return P(this,null,function*(){let r=$(n),i=[],s=[];for(let o of e){let a,l=r.Da.get(o);if(l&&l.length!==0){a=yield Hs(r.localStore,It(l[0]));for(let u of l){let h=r.ba.get(u),f=yield XO(r,h);f.snapshot&&s.push(f.snapshot)}}else{let u=yield jA(r.localStore,o);a=yield Hs(r.localStore,u),yield x_(r,ZA(u),o,!1,a.resumeToken)}i.push(a)}return r.Sa.h_(s),i})}function ZA(n){return Jb(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function tM(n){return function(t){return $($(t).persistence).Bi()}($(n).localStore)}function nM(n,e,t,r){return P(this,null,function*(){let i=$(n);if(i.La)return void L("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield BA(i.localStore,eA(s[0])),a=fc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",rt.EMPTY_BYTE_STRING);yield or(i,o,a);break}case"rejected":yield Qs(i.localStore,e,!0),Js(i,e,r);break;default:z()}})}function rM(n,e,t){return P(this,null,function*(){let r=Vh(n);if(r.La){for(let i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){L("SyncEngine","Adding an already active target "+i);continue}let s=yield jA(r.localStore,i),o=yield Hs(r.localStore,s);yield x_(r,ZA(s),o.targetId,!1,o.resumeToken),Fh(r.remoteStore,o)}for(let i of t)r.Da.has(i)&&(yield Qs(r.localStore,i,!1).then(()=>{Ys(r.remoteStore,i),Js(r,i)}).catch(zr))}})}function Vh(n){let e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=XA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=YO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zO.bind(null,e),e.Sa.h_=FO.bind(null,e.eventManager),e.Sa.ka=VO.bind(null,e.eventManager),e}function F_(n){let e=$(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=GO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=WO.bind(null,e),e}function iM(n,e,t){let r=$(n);(function(s,o,a){return P(this,null,function*(){try{let l=yield o.getMetadata();if(yield function(_,E){let S=$(_),I=$e(E.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",O=>S.$r.getBundleMetadata(O,E.id)).then(O=>!!O&&O.createTime.compareTo(I)>=0)}(s.localStore,l))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(QA(l));let u=new zm(l,s.localStore,o.serializer),h=yield o.qa();for(;h;){let g=yield u._a(h);g&&a._updateProgress(g),h=yield o.qa()}let f=yield u.complete();return yield or(s,f.ca,void 0),yield function(_,E){let S=$(_);return S.persistence.runTransaction("Save bundle","readwrite",I=>S.$r.saveBundleMetadata(I,E))}(s.localStore,l),a._completeWith(f.progress),Promise.resolve(f.ua)}catch(l){return Yt("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Tc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){this.serializer=Dc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return LA(this.persistence,new dh,e.initialUser,this.serializer)}createPersistence(e){return new uh(hh.Hr,this.serializer)}createSharedClientState(e){return new mh}terminate(){return P(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Rh=class n extends Tc{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){yield Af(n.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield F_(this.Qa.syncEngine),yield so(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return LA(this.persistence,new dh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new hm(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Pg(t,this.persistence);return new Cg(e.asyncQueue,r)}createPersistence(e){let t=R_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new Am(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,$A(),Vu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new mh}},Qm=class n extends Rh{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return P(this,null,function*(){yield Af(n.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof rc&&(this.sharedClientState.syncEngine={Zs:ZO.bind(null,t),Xs:nM.bind(null,t),eo:rM.bind(null,t),Bi:tM.bind(null,t),Ys:JO.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>P(this,null,function*(){yield eM(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=$A();if(!rc.D(t))throw new M(k.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=R_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new rc(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Ic=class{initialize(e,t){return P(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Tb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=QO.bind(null,this.syncEngine),yield Vm(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Bm}()}createDatastore(e){let t=Dc(e.databaseInfo.databaseId),r=function(s){return new km(s)}(e.databaseInfo);return function(s,o,a,l){return new Mm(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Fm(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Tb(this.syncEngine,t,0),function(){return _h.D()?new _h:new Dm}())}createSyncEngine(e,t){return function(i,s,o,a,l,u,h){let f=new Km(i,s,o,a,l,u);return h&&(f.La=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return P(this,null,function*(){var e;yield function(r){return P(this,null,function*(){let i=$(r);L("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield io(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function bb(n,e=10240){let t=0;return{read(){return P(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return P(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Zs=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Be("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Ym=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Ye,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return P(this,null,function*(){return this.metadata.promise})}qa(){return P(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return P(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),r=Number(t);isNaN(r)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(r);return new $m(JSON.parse(i),e.length+r)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return P(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return P(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return P(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Xm=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new M(k.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return P(this,null,function*(){let o=$(i),a={documents:s.map(f=>gc(o.serializer,f))},l=yield o.xo("BatchGetDocuments",o.serializer.databaseId,de.emptyPath(),a,s.length),u=new Map;l.forEach(f=>{let g=lO(o.serializer,f);u.set(g.key.toString(),g)});let h=[];return s.forEach(f=>{let g=u.get(f.toString());K(!!g),h.push(g)}),h})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new qr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=q.fromPath(r);this.mutations.push(new uc(i,this.precondition(i)))}),yield function(r,i){return P(this,null,function*(){let s=$(r),o={writes:i.map(a=>mc(s.serializer,a))};yield s.Co("Commit",s.serializer.databaseId,de.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw z();t=X.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new M(k.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(X.min())?je.exists(!1):je.updateTime(t):je.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(X.min()))throw new M(k.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return je.updateTime(t)}return je.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Jm=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Yo=new wc(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>P(this,null,function*(){let e=new Xm(this.datastore),t=this.tu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(e){try{let t=this.updateFunction(e);return!Rc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!pA(t)}return!1}};var Zm=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Qe.UNAUTHENTICATED,this.clientId=Bu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>P(this,null,function*(){L("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(L("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new M(k.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ye;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ao(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Uu(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),L("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>P(this,null,function*(){r.isEqual(i)||(yield FA(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function e_(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield V_(n);L("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>wb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>wb(e.remoteStore,i)),n._onlineComponents=e})}function eR(n){return n.name==="FirebaseError"?n.code===k.FAILED_PRECONDITION||n.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function V_(n){return P(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Uu(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!eR(t))throw t;Yt("Error using user provided cache. Falling back to memory cache: "+t),yield Uu(n,new Tc)}}else L("FirestoreClient","Using default OfflineComponentProvider"),yield Uu(n,new Tc);return n._offlineComponents})}function Uh(n){return P(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(L("FirestoreClient","Using user provided OnlineComponentProvider"),yield e_(n,n._uninitializedComponentsProvider._online)):(L("FirestoreClient","Using default OnlineComponentProvider"),yield e_(n,new Ic))),n._onlineComponents})}function tR(n){return V_(n).then(e=>e.persistence)}function U_(n){return V_(n).then(e=>e.localStore)}function nR(n){return Uh(n).then(e=>e.remoteStore)}function j_(n){return Uh(n).then(e=>e.syncEngine)}function sM(n){return Uh(n).then(e=>e.datastore)}function eo(n){return P(this,null,function*(){let e=yield Uh(n),t=e.eventManager;return t.onListen=UO.bind(null,e.syncEngine),t.onUnlisten=BO.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=jO.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=qO.bind(null,e.syncEngine),t})}function oM(n){return n.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield tR(n),t=yield nR(n);return e.setNetworkEnabled(!0),function(i){let s=$(i);return s.M_.delete(0),Nc(s)}(t)}))}function aM(n){return n.asyncQueue.enqueue(()=>P(this,null,function*(){let e=yield tR(n),t=yield nR(n);return e.setNetworkEnabled(!1),function(i){return P(this,null,function*(){let s=$(i);s.M_.add(0),yield io(s),s.N_.set("Offline")})}(t)}))}function cM(n,e){let t=new Ye;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s,o){return P(this,null,function*(){try{let a=yield function(u,h){let f=$(u);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new M(k.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let l=ao(a,`Failed to get document '${s} from cache`);o.reject(l)}})}(yield U_(n),e,t)})),t.promise}function rR(n,e,t={}){let r=new Ye;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,a,l,u){let h=new Zs({next:g=>{o.enqueueAndForget(()=>N_(s,f));let _=g.docs.has(a);!_&&g.fromCache?u.reject(new M(k.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&l&&l.source==="server"?u.reject(new M(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new Ec(ro(a.path),h,{includeMetadataChanges:!0,ra:!0});return D_(s,f)}(yield eo(n),n.asyncQueue,e,t,r)})),r.promise}function lM(n,e){let t=new Ye;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s,o){return P(this,null,function*(){try{let a=yield fh(i,s,!0),l=new Ah(s,a.hs),u=l.da(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){let l=ao(a,`Failed to execute query '${s} against cache`);o.reject(l)}})}(yield U_(n),e,t)})),t.promise}function iR(n,e,t={}){let r=new Ye;return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(s,o,a,l,u){let h=new Zs({next:g=>{o.enqueueAndForget(()=>N_(s,f)),g.fromCache&&l.source==="server"?u.reject(new M(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new Ec(a,h,{includeMetadataChanges:!0,ra:!0});return D_(s,f)}(yield eo(n),n.asyncQueue,e,t,r)})),r.promise}function uM(n,e){let t=new Zs(e);return n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s){$(i).z_.add(s),s.next()}(yield eo(n),t)})),()=>{t.$a(),n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return function(i,s){$(i).z_.delete(s)}(yield eo(n),t)}))}}function hM(n,e,t,r){let i=function(o,a){let l;return l=typeof o=="string"?mA().encode(o):o,function(h,f){return new Ym(h,f)}(function(h,f){if(h instanceof Uint8Array)return bb(h,f);if(h instanceof ArrayBuffer)return bb(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Dc(e));n.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){iM(yield j_(n),i,r)}))}function dM(n,e){return n.asyncQueue.enqueue(()=>P(this,null,function*(){return function(r,i){let s=$(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield U_(n),e)}))}function sR(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Ab=new Map;function B_(n,e,t){if(!t)throw new M(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function q_(n,e,t,r){if(e===!0&&r===!0)throw new M(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Rb(n){if(!q.isDocumentKey(n))throw new M(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Sb(n){if(q.isDocumentKey(n))throw new M(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function jh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":z()}function fe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new M(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=jh(n);throw new M(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function oR(n,e){if(e<=0)throw new M(k.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Sh=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new M(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new M(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}q_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=sR((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new M(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new M(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new M(k.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Ni=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new M(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new M(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sh(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new yg;switch(r.type){case"firstParty":return new Tg(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new M(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Ab.get(t);r&&(L("ComponentProvider","Removing Datastore"),Ab.delete(t),r.terminate())}(this),Promise.resolve()}};function $_(n,e,t,r={}){var i;let s=(n=fe(n,Ni))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Yt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Qe.MOCK_USER;else{a=ds(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new M(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Qe(u)}n._authCredentials=new vg(new ju(a,l))}}var ut=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},be=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Pn=class n extends ut{constructor(e,t,r){super(e,t,ro(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new be(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function z_(n,e,...t){if(n=ee(n),B_("collection","path",e),n instanceof Ni){let r=de.fromString(e,...t);return Sb(r),new Pn(n,null,r)}{if(!(n instanceof be||n instanceof Pn))throw new M(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(de.fromString(e,...t));return Sb(r),new Pn(n.firestore,null,r)}}function aR(n,e){if(n=fe(n,Ni),B_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new M(k.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ut(n,null,function(r){return new ln(de.emptyPath(),r)}(e))}function kc(n,e,...t){if(n=ee(n),arguments.length===1&&(e=Bu.newId()),B_("doc","path",e),n instanceof Ni){let r=de.fromString(e,...t);return Rb(r),new be(n,null,new q(r))}{if(!(n instanceof be||n instanceof Pn))throw new M(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(de.fromString(e,...t));return Rb(r),new be(n.firestore,n instanceof Pn?n.converter:null,new q(r))}}function G_(n,e){return n=ee(n),e=ee(e),(n instanceof be||n instanceof Pn)&&(e instanceof be||e instanceof Pn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function W_(n,e){return n=ee(n),e=ee(e),n instanceof ut&&e instanceof ut&&n.firestore===e.firestore&&Cc(n._query,e._query)&&n.converter===e.converter}var t_=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new wc(this,"async_queue_retry"),this.hu=()=>{let t=Vu();t&&L("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};let e=Vu();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Vu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ye;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return P(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!Gr(e))throw e;L("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=Um.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&z()}verifyOperationInProgress(){}du(){return P(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function n_(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var r_=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ye,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var cR=-1,De=class extends Ni{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new t_}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||lR(this),this._firestoreClient.terminate()}};function rB(n,e){let t=typeof n=="object"?n:Kn(),r=typeof n=="string"?n:e||"(default)",i=hi(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=hs("firestore");s&&$_(i,...s)}return i}function et(n){return n._firestoreClient||lR(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function lR(n){var e,t,r;let i=n._freezeSettings(),s=function(a,l,u,h){return new Dg(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,sR(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Zm(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function uR(n,e){vR(n=fe(n,De));let t=et(n);if(t._uninitializedComponentsProvider)throw new M(k.FAILED_PRECONDITION,"SDK cache is already specified.");Yt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Ic;return dR(t,i,new Rh(i,r.cacheSizeBytes,e?.forceOwnership))}function hR(n){vR(n=fe(n,De));let e=et(n);if(e._uninitializedComponentsProvider)throw new M(k.FAILED_PRECONDITION,"SDK cache is already specified.");Yt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Ic;return dR(e,r,new Qm(r,t.cacheSizeBytes))}function dR(n,e,t){let r=new Ye;return n.asyncQueue.enqueue(()=>P(this,null,function*(){try{yield Uu(n,t),yield e_(n,e),r.resolve()}catch(i){let s=i;if(!eR(s))throw s;Yt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function fR(n){if(n._initialized&&!n._terminated)throw new M(k.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ye;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{yield function(r){return P(this,null,function*(){if(!Mr.D())return Promise.resolve();let i=r+"main";yield Mr.delete(i)})}(R_(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function pR(n){return function(t){let r=new Ye;return t.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return KO(yield j_(t),r)})),r.promise}(et(n=fe(n,De)))}function gR(n){return oM(et(n=fe(n,De)))}function mR(n){return aM(et(n=fe(n,De)))}function _R(n,e){let t=et(n=fe(n,De)),r=new r_;return hM(t,n._databaseId,e,r),r}function yR(n,e){return dM(et(n=fe(n,De)),e).then(t=>t?new ut(n,null,t.query):null)}function vR(n){if(n._initialized||n._terminated)throw new M(k.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var xn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(rt.fromBase64String(e))}catch(t){throw new M(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(rt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var hn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ir=class{constructor(e){this._methodName=e}};var ki=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}};var fM=/^__.*__$/,i_=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new un(e,this.data,this.fieldMask,t,this.fieldTransforms):new Br(e,this.data,t,this.fieldTransforms)}},Ch=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new un(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function wR(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}var Ph=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Dh(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(wR(this.fu)&&fM.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},s_=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Dc(e)}Fu(e,t,r,i=!1){return new Ph({fu:e,methodName:t,vu:r,path:qe.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Li(n){let e=n._freezeSettings(),t=Dc(n._databaseId);return new s_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Bh(n,e,t,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);Q_("Data must be an object, but it was:",o,r);let a=IR(r,o),l,u;if(s.merge)l=new Ft(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let h=[];for(let f of s.mergeFields){let g=u_(e,f,t);if(!o.contains(g))throw new M(k.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);AR(h,g)||h.push(g)}l=new Ft(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new i_(new _t(a),l,u)}var bc=class n extends ir{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function ER(n,e,t){return new Ph({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var o_=class n extends ir{_toFieldTransform(e){return new Ci(e.path,new Ur)}isEqual(e){return e instanceof n}},a_=class n extends ir{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=ER(this,e,!0),r=this.Mu.map(s=>Fi(s,t)),i=new nr(r);return new Ci(e.path,i)}isEqual(e){return e instanceof n&&Hf(this.Mu,e.Mu)}},c_=class n extends ir{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=ER(this,e,!0),r=this.Mu.map(s=>Fi(s,t)),i=new rr(r);return new Ci(e.path,i)}isEqual(e){return e instanceof n&&Hf(this.Mu,e.Mu)}},l_=class n extends ir{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new jr(e.serializer,aA(e.serializer,this.xu));return new Ci(e.path,t)}isEqual(e){return e instanceof n&&this.xu===e.xu}};function K_(n,e,t,r){let i=n.Fu(1,e,t);Q_("Data must be an object, but it was:",i,r);let s=[],o=_t.empty();Mi(r,(l,u)=>{let h=Y_(e,l,t);u=ee(u);let f=i.Su(h);if(u instanceof bc)s.push(h);else{let g=Fi(u,f);g!=null&&(s.push(h),o.set(h,g))}});let a=new Ft(s);return new Ch(o,a,i.fieldTransforms)}function H_(n,e,t,r,i,s){let o=n.Fu(1,e,t),a=[u_(e,r,t)],l=[i];if(s.length%2!=0)throw new M(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(u_(e,s[g])),l.push(s[g+1]);let u=[],h=_t.empty();for(let g=a.length-1;g>=0;--g)if(!AR(u,a[g])){let _=a[g],E=l[g];E=ee(E);let S=o.Su(_);if(E instanceof bc)u.push(_);else{let I=Fi(E,S);I!=null&&(u.push(_),h.set(_,I))}}let f=new Ft(u);return new Ch(h,f,o.fieldTransforms)}function TR(n,e,t,r=!1){return Fi(t,n.Fu(r?4:3,e))}function Fi(n,e){if(bR(n=ee(n)))return Q_("Unsupported field value:",e,n),IR(n,e);if(n instanceof ir)return function(r,i){if(!wR(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let l=Fi(a,i.bu(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ee(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return aA(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=xe.fromDate(r);return{timestampValue:Gs(i.serializer,s)}}if(r instanceof xe){let s=new xe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Gs(i.serializer,s)}}if(r instanceof ki)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof xn)return{bytesValue:_A(i.serializer,r._byteString)};if(r instanceof be){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:I_(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${jh(r)}`)}(n,e)}function IR(n,e){let t={};return $b(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mi(n,(r,i)=>{let s=Fi(i,e.pu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function bR(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof xe||n instanceof ki||n instanceof xn||n instanceof be||n instanceof ir)}function Q_(n,e,t){if(!bR(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=jh(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function u_(n,e,t){if((e=ee(e))instanceof hn)return e._internalPath;if(typeof e=="string")return Y_(n,e);throw Dh("Field path arguments must be of type string or ",n,!1,void 0,t)}var pM=new RegExp("[~\\*/\\[\\]]");function Y_(n,e,t){if(e.search(pM)>=0)throw Dh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new hn(...e.split("."))._internalPath}catch{throw Dh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Dh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new M(k.INVALID_ARGUMENT,a+n+l)}function AR(n,e){return n.some(t=>t.isEqual(e))}var xi=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new be(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new h_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(qh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},h_=class extends xi{data(){return super.data()}};function qh(n,e){return typeof e=="string"?Y_(n,e):e instanceof hn?e._internalPath:e._delegate._internalPath}function RR(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new M(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ac=class{},Oi=class extends Ac{};function ar(n,e,...t){let r=[];e instanceof Ac&&r.push(e),r=r.concat(t),function(s){let o=s.filter(l=>l instanceof d_).length,a=s.filter(l=>l instanceof Nh).length;if(o>1||o>0&&a>0)throw new M(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Nh=class n extends Oi{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return LR(e._query,t),new ut(e.firestore,e.converter,$g(e._query,t))}_parse(e){let t=Li(e.firestore);return function(s,o,a,l,u,h,f){let g;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new M(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Pb(f,h);let _=[];for(let E of f)_.push(Cb(l,s,E));g={arrayValue:{values:_}}}else g=Cb(l,s,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Pb(f,h),g=TR(a,o,f,h==="in"||h==="not-in");return ue.create(u,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function SR(n,e,t){let r=e,i=qh("where",n);return Nh._create(i,r,t)}var d_=class n extends Ac{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ye.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let l of a)LR(o,l),o=$g(o,l)}(e._query,t),new ut(e.firestore,e.converter,$g(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var f_=class n extends Oi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new M(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new M(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ri(s,o)}(e._query,this._field,this._direction);return new ut(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new ln(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function CR(n,e="asc"){let t=e,r=qh("orderBy",n);return f_._create(r,t)}var kh=class n extends Oi{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new ut(e.firestore,e.converter,Xu(e._query,this._limit,this._limitType))}};function PR(n){return oR("limit",n),kh._create("limit",n,"F")}function DR(n){return oR("limitToLast",n),kh._create("limitToLast",n,"L")}var xh=class n extends Oi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=MR(e,this.type,this._docOrFields,this._inclusive);return new ut(e.firestore,e.converter,function(i,s){return new ln(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function NR(...n){return xh._create("startAt",n,!0)}function kR(...n){return xh._create("startAfter",n,!1)}var Oh=class n extends Oi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=MR(e,this.type,this._docOrFields,this._inclusive);return new ut(e.firestore,e.converter,function(i,s){return new ln(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function xR(...n){return Oh._create("endBefore",n,!1)}function OR(...n){return Oh._create("endAt",n,!0)}function MR(n,e,t,r){if(t[0]=ee(t[0]),t[0]instanceof xi)return function(s,o,a,l,u){if(!l)throw new M(k.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let h=[];for(let f of Fs(s))if(f.field.isKeyField())h.push(Ai(o,l.key));else{let g=l.data.field(f.field);if(Lh(g))throw new M(k.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let _=f.field.canonicalString();throw new M(k.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(g)}return new Nn(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Li(n.firestore);return function(o,a,l,u,h,f){let g=o.explicitOrderBy;if(h.length>g.length)throw new M(k.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let E=0;E<h.length;E++){let S=h[E];if(g[E].field.isKeyField()){if(typeof S!="string")throw new M(k.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof S}`);if(!E_(o)&&S.indexOf("/")!==-1)throw new M(k.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${S}' contains a slash.`);let I=o.path.child(de.fromString(S));if(!q.isDocumentKey(I))throw new M(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);let O=new q(I);_.push(Ai(a,O))}else{let I=TR(l,u,S);_.push(I)}}return new Nn(_,f)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Cb(n,e,t){if(typeof(t=ee(t))=="string"){if(t==="")throw new M(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!E_(e)&&t.indexOf("/")!==-1)throw new M(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(de.fromString(t));if(!q.isDocumentKey(r))throw new M(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ai(n,new q(r))}if(t instanceof be)return Ai(n,t._key);throw new M(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jh(t)}.`)}function Pb(n,e){if(!Array.isArray(n)||n.length===0)throw new M(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function LR(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new M(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new M(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var to=class{convertValue(e,t="none"){switch(bi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Lr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Mi(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new ki(Ue(e.latitude),Ue(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=v_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ac(e));default:return null}}convertTimestamp(e){let t=tr(e);return new xe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=de.fromString(e);K(CA(r));let i=new Fr(r.get(1),r.get(3)),s=new q(r.popFirst(5));return i.isEqual(t)||Be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function $h(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var p_=class extends to{constructor(e){super(),this.firestore=e}convertBytes(e){return new xn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};var er=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Jt=class extends xi{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new xr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(qh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},xr=class extends Jt{data(e={}){return super.data(e)}},dn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new er(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new xr(this._firestore,this._userDataWriter,r.key,r,new er(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let l=new xr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new er(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let l=new xr(i._firestore,i._userDataWriter,a.doc.key,a.doc,new er(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:gM(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function gM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function X_(n,e){return n instanceof Jt&&e instanceof Jt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof dn&&e instanceof dn&&n._firestore===e._firestore&&W_(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function FR(n){n=fe(n,be);let e=fe(n.firestore,De);return rR(et(e),n._key).then(t=>ty(e,n,t))}var sr=class extends to{constructor(e){super(),this.firestore=e}convertBytes(e){return new xn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};function VR(n){n=fe(n,be);let e=fe(n.firestore,De),t=et(e),r=new sr(e);return cM(t,n._key).then(i=>new Jt(e,r,n._key,i,new er(i!==null&&i.hasLocalMutations,!0),n.converter))}function UR(n){n=fe(n,be);let e=fe(n.firestore,De);return rR(et(e),n._key,{source:"server"}).then(t=>ty(e,n,t))}function jR(n){n=fe(n,ut);let e=fe(n.firestore,De),t=et(e),r=new sr(e);return RR(n._query),iR(t,n._query).then(i=>new dn(e,r,n,i))}function BR(n){n=fe(n,ut);let e=fe(n.firestore,De),t=et(e),r=new sr(e);return lM(t,n._query).then(i=>new dn(e,r,n,i))}function qR(n){n=fe(n,ut);let e=fe(n.firestore,De),t=et(e),r=new sr(e);return iR(t,n._query,{source:"server"}).then(i=>new dn(e,r,n,i))}function J_(n,e,t){n=fe(n,be);let r=fe(n.firestore,De),i=$h(n.converter,e,t);return co(r,[Bh(Li(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,je.none())])}function Z_(n,e,t,...r){n=fe(n,be);let i=fe(n.firestore,De),s=Li(i),o;return o=typeof(e=ee(e))=="string"||e instanceof hn?H_(s,"updateDoc",n._key,e,t,r):K_(s,"updateDoc",n._key,e),co(i,[o.toMutation(n._key,je.exists(!0))])}function $R(n){return co(fe(n.firestore,De),[new qr(n._key,je.none())])}function zR(n,e){let t=fe(n.firestore,De),r=kc(n),i=$h(n.converter,e);return co(t,[Bh(Li(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,je.exists(!1))]).then(()=>r)}function ey(n,...e){var t,r,i;n=ee(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||n_(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(n_(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,u,h;if(n instanceof be)u=fe(n.firestore,De),h=ro(n._key.path),l={next:f=>{e[o]&&e[o](ty(u,n,f))},error:e[o+1],complete:e[o+2]};else{let f=fe(n,ut);u=fe(f.firestore,De),h=f._query;let g=new sr(u);l={next:_=>{e[o]&&e[o](new dn(u,g,f,_))},error:e[o+1],complete:e[o+2]},RR(n._query)}return function(g,_,E,S){let I=new Zs(S),O=new Ec(_,I,E);return g.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return D_(yield eo(g),O)})),()=>{I.$a(),g.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return N_(yield eo(g),O)}))}}(et(u),h,a,l)}function GR(n,e){return uM(et(n=fe(n,De)),n_(e)?e:{next:e})}function co(n,e){return function(r,i){let s=new Ye;return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return $O(yield j_(r),i,s)})),s.promise}(et(n),e)}function ty(n,e,t){let r=t.docs.get(e._key),i=new sr(n);return new Jt(n,i,e._key,r,new er(t.hasPendingWrites,t.fromCache),e.converter)}var mM={maxAttempts:5};var Mh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Li(e)}set(e,t,r){this._verifyNotCommitted();let i=Nr(e,this._firestore),s=$h(i.converter,t,r),o=Bh(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,je.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Nr(e,this._firestore),o;return o=typeof(t=ee(t))=="string"||t instanceof hn?H_(this._dataReader,"WriteBatch.update",s._key,t,r,i):K_(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,je.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Nr(e,this._firestore);return this._mutations=this._mutations.concat(new qr(t._key,je.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new M(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Nr(n,e){if((n=ee(n)).firestore!==e)throw new M(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var g_=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Li(t)}get(t){let r=Nr(t,this._firestore),i=new p_(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return z();let o=s[0];if(o.isFoundDocument())return new xi(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new xi(this._firestore,i,r._key,null,r.converter);throw z()})}set(t,r,i){let s=Nr(t,this._firestore),o=$h(s.converter,r,i),a=Bh(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Nr(t,this._firestore),a;return a=typeof(r=ee(r))=="string"||r instanceof hn?H_(this._dataReader,"Transaction.update",o._key,r,i,s):K_(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Nr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Nr(e,this._firestore),r=new sr(this._firestore);return super.get(e).then(i=>new Jt(this._firestore,r,t._key,i._document,new er(!1,!1),t.converter))}};function WR(n,e,t){n=fe(n,De);let r=Object.assign(Object.assign({},mM),t);return function(s){if(s.maxAttempts<1)throw new M(k.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let l=new Ye;return s.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){let u=yield sM(s);new Jm(s.asyncQueue,u,a,o,l).Xa()})),l.promise}(et(n),i=>e(new g_(n,i)),r)}function KR(){return new bc("deleteField")}function HR(){return new o_("serverTimestamp")}function QR(...n){return new a_("arrayUnion",n)}function YR(...n){return new c_("arrayRemove",n)}function XR(n){return new l_("increment",n)}(function(e,t=!0){(function(i){no=i})(fs),Wn(new ct("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new De(new wg(r.getProvider("auth-internal")),new bg(r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new M(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fr(u.options.projectId,h)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),nt(DI,"4.6.3",e),nt(DI,"4.6.3","esm2017")})();var _M="@firebase/firestore-compat",yM="0.3.32";function ay(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new M("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function JR(){if(typeof Uint8Array>"u")throw new M("unimplemented","Uint8Arrays are not available in this environment.")}function ZR(){if(!zb())throw new M("unimplemented","Blobs are unavailable in Firestore in this environment.")}var zh=class n{constructor(e){this._delegate=e}static fromBase64String(e){return ZR(),new n(xn.fromBase64String(e))}static fromUint8Array(e){return JR(),new n(xn.fromUint8Array(e))}toBase64(){return ZR(),this._delegate.toBase64()}toUint8Array(){return JR(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function ny(n){return vM(n,["next","error","complete"])}function vM(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var ry=class{enableIndexedDbPersistence(e,t){return uR(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return hR(e._delegate)}clearIndexedDbPersistence(e){return fR(e._delegate)}},Gh=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Fr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Yt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){$_(this._delegate,e,t,r)}enableNetwork(){return gR(this._delegate)}disableNetwork(){return mR(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,q_("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return pR(this._delegate)}onSnapshotsInSync(e){return GR(this._delegate,e)}get app(){if(!this._appCompat)throw new M("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ho(this,z_(this._delegate,e))}catch(t){throw bt(t,"collection()","Firestore.collection()")}}doc(e){try{return new On(this,kc(this._delegate,e))}catch(t){throw bt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Bi(this,aR(this._delegate,e))}catch(t){throw bt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return WR(this._delegate,t=>e(new Wh(this,t)))}batch(){return et(this._delegate),new Kh(new Mh(this._delegate,e=>co(this._delegate,e)))}loadBundle(e){return _R(this._delegate,e)}namedQuery(e){return yR(this._delegate,e).then(t=>t?new Bi(this,t):null)}},lo=class extends to{constructor(e){super(),this.firestore=e}convertBytes(e){return new zh(new xn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return On.forKey(t,this.firestore,null)}};function wM(n){Db(n)}var Wh=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new lo(e)}get(e){let t=Vi(e);return this._delegate.get(t).then(r=>new Ui(this._firestore,new Jt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Vi(e);return r?(ay("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Vi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Vi(e);return this._delegate.delete(t),this}},Kh=class{constructor(e){this._delegate=e}set(e,t,r){let i=Vi(e);return r?(ay("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Vi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Vi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},uo=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new xr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ji(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new lo(e),t),i.set(t,s)),s}};uo.INSTANCES=new WeakMap;var On=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lo(e)}static forPath(e,t,r){if(e.length%2!==0)throw new M("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new be(t._delegate,r,new q(e)))}static forKey(e,t,r){return new n(t,new be(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ho(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ho(this.firestore,z_(this._delegate,e))}catch(t){throw bt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ee(e),e instanceof be?G_(this._delegate,e):!1}set(e,t){t=ay("DocumentReference.set",t);try{return t?J_(this._delegate,e,t):J_(this._delegate,e)}catch(r){throw bt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Z_(this._delegate,e):Z_(this._delegate,e,t,...r)}catch(i){throw bt(i,"updateDoc()","DocumentReference.update()")}}delete(){return $R(this._delegate)}onSnapshot(...e){let t=eS(e),r=tS(e,i=>new Ui(this.firestore,new Jt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return ey(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=VR(this._delegate):e?.source==="server"?t=UR(this._delegate):t=FR(this._delegate),t.then(r=>new Ui(this.firestore,new Jt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(uo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function bt(n,e,t){return n.message=n.message.replace(e,t),n}function eS(n){for(let e of n)if(typeof e=="object"&&!ny(e))return e;return{}}function tS(n,e){var t,r;let i;return ny(n[0])?i=n[0]:ny(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Ui=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new On(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return X_(this._delegate,e._delegate)}},ji=class extends Ui{data(e){let t=this._delegate.data(e);return this._delegate._converter||Nb(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Bi=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lo(e)}where(e,t,r){try{return new n(this.firestore,ar(this._delegate,SR(e,t,r)))}catch(i){throw bt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,ar(this._delegate,CR(e,t)))}catch(r){throw bt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,ar(this._delegate,PR(e)))}catch(t){throw bt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,ar(this._delegate,DR(e)))}catch(t){throw bt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,ar(this._delegate,NR(...e)))}catch(t){throw bt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,ar(this._delegate,kR(...e)))}catch(t){throw bt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,ar(this._delegate,xR(...e)))}catch(t){throw bt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,ar(this._delegate,OR(...e)))}catch(t){throw bt(t,"endAt()","Query.endAt()")}}isEqual(e){return W_(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=BR(this._delegate):e?.source==="server"?t=qR(this._delegate):t=jR(this._delegate),t.then(r=>new xc(this.firestore,new dn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=eS(e),r=tS(e,i=>new xc(this.firestore,new dn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return ey(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(uo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},iy=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ji(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},xc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Bi(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ji(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new iy(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ji(this._firestore,r))})}isEqual(e){return X_(this._delegate,e._delegate)}},ho=class n extends Bi{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new On(this.firestore,e):null}doc(e){try{return e===void 0?new On(this.firestore,kc(this._delegate)):new On(this.firestore,kc(this._delegate,e))}catch(t){throw bt(t,"doc()","CollectionReference.doc()")}}add(e){return zR(this._delegate,e).then(t=>new On(this.firestore,t))}isEqual(e){return G_(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(uo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Vi(n){return fe(n,be)}var sy=class n{constructor(...e){this._delegate=new hn(...e)}static documentId(){return new n(qe.keyField().canonicalString())}isEqual(e){return e=ee(e),e instanceof hn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var oy=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=HR();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=KR();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=QR(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=YR(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=XR(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var EM={Firestore:Gh,GeoPoint:ki,Timestamp:xe,Blob:zh,Transaction:Wh,WriteBatch:Kh,DocumentReference:On,DocumentSnapshot:Ui,Query:Bi,QueryDocumentSnapshot:ji,QuerySnapshot:xc,CollectionReference:ho,FieldPath:sy,FieldValue:oy,setLogLevel:wM,CACHE_SIZE_UNLIMITED:cR};function TM(n,e){n.INTERNAL.registerComponent(new ct("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},EM)))}function IM(n){TM(n,(e,t)=>new Gh(e,t,new ry)),n.registerVersion(_M,yM)}IM(Ce);function bM(n,e=rs){return new kt(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function nS(n,e){return bM(n,e)}function AM(n,e){return nS(n,e).pipe(cs(void 0),Ll(),Q(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function uy(n,e){return nS(n,e).pipe(Q(t=>({payload:t,type:"query"})))}var Hh=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=aS(r,t);return new Yh(i,s,this.afs)}snapshotChanges(){return AM(this.ref,this.afs.schedulers.outsideAngular).pipe(Pe)}valueChanges(e={}){return this.snapshotChanges().pipe(Q(({payload:t})=>e.idField?Fe(G({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Ie(this.ref.get(e)).pipe(Pe)}};function Qh(n,e){return uy(n,e).pipe(cs(void 0),Ll(),Q(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let u=s.find(f=>f.doc.ref.isEqual(a.ref)),h=r?.payload.docs.find(f=>f.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&h&&JSON.stringify(h.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function rS(n,e,t){return Qh(n,t).pipe(Gn((r,i)=>RM(r,i.map(s=>s.payload),e),[]),Ml(),Q(r=>r.map(i=>({type:i.type,payload:i}))))}function RM(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=SM(n,r))}),n}function cy(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function SM(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return cy(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return cy(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return cy(n,e.oldIndex,1);break}return n}function iS(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Yh=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Qh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Q(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(cs(void 0),Ll(),xt(([r,i])=>i.length>0||!r),Q(([,r])=>r),Pe)}auditTrail(e){return this.stateChanges(e).pipe(Gn((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=iS(e);return rS(this.query,t,this.afs.schedulers.outsideAngular).pipe(Pe)}valueChanges(e={}){return uy(this.query,this.afs.schedulers.outsideAngular).pipe(Q(t=>t.payload.docs.map(r=>e.idField?Fe(G({},r.data()),{[e.idField]:r.id}):r.data())),Pe)}get(e){return Ie(this.query.get(e)).pipe(Pe)}add(e){return this.ref.add(e)}doc(e){return new Hh(this.ref.doc(e),this.afs)}},ly=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Qh(this.query,this.afs.schedulers.outsideAngular).pipe(Pe):Qh(this.query,this.afs.schedulers.outsideAngular).pipe(Q(t=>t.filter(r=>e.indexOf(r.type)>-1)),xt(t=>t.length>0),Pe)}auditTrail(e){return this.stateChanges(e).pipe(Gn((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=iS(e);return rS(this.query,t,this.afs.schedulers.outsideAngular).pipe(Pe)}valueChanges(e={}){return uy(this.query,this.afs.schedulers.outsideAngular).pipe(Q(r=>r.payload.docs.map(i=>e.idField?G({[e.idField]:i.id},i.data()):i.data())),Pe)}get(e){return Ie(this.query.get(e)).pipe(Pe)}},sS=new te("angularfire2.enableFirestorePersistence"),oS=new te("angularfire2.firestore.persistenceSettings"),CM=new te("angularfire2.firestore.settings"),PM=new te("angularfire2.firestore.use-emulator");function aS(n,e=t=>t){return{query:e(n),ref:n}}var hy=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,u,h,f,g,_,E,S,I,O,j){this.schedulers=l;let x=Xn(t,a,r),U=h;f&&Ga(x,a,g,E,S,I,_,O),[this.firestore,this.persistenceEnabled$]=Rr(`${x.name}.firestore`,"AngularFirestore",x.name,()=>{let Y=a.runOutsideAngular(()=>x.firestore());if(s&&Y.settings(s),U&&Y.useEmulator(...U),i&&!mr(o)){let H=()=>{try{return Ie(Y.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),W(!1)}};return[Y,a.runOutsideAngular(H)]}else return[Y,W(!1)]},[s,U,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=aS(i,r),a=this.schedulers.ngZone.run(()=>s);return new Yh(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new ly(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Hh(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(F(In),F(bn,8),F(sS,8),F(CM,8),F(Je),F(Ve),F(Tn),F(oS,8),F(PM,8),F(bs,8),F(Ua,8),F(ja,8),F(Ba,8),F(qa,8),F($a,8),F(za,8),F(on,8))};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),SB=(()=>{class n{constructor(){Ce.registerVersion("angularfire",an.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:sS,useValue:!0},{provide:oS,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=vn({type:n});static \u0275inj=yn({providers:[hy]})}return n})();var cS="@firebase/database",lS="1.0.5";var Iv="";function bv(n){Iv=n}var vy=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),We(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Xl(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var wy=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Wt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var jS=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vy(e)}}catch{}return new wy},$i=jS("localStorage"),Ey=jS("sessionStorage");var mo=new yr("@firebase/database"),BS=function(){let n=1;return function(){return n++}}(),qS=function(n){let e=gT(n),t=new pT;t.update(e);let r=t.digest();return Hl.encodeByteArray(r)},rl=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=rl.apply(null,r):typeof r=="object"?e+=We(r):e+=r,e+=" "}return e},zi=null,uS=!0,$S=function(n,e){V(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(mo.logLevel=Kt.VERBOSE,zi=mo.log.bind(mo),e&&Ey.set("logging_enabled",!0)):typeof n=="function"?zi=n:(zi=null,Ey.remove("logging_enabled"))},st=function(...n){if(uS===!0&&(uS=!1,zi===null&&Ey.get("logging_enabled")===!0&&$S(!0)),zi){let e=rl.apply(null,n);zi(e)}},il=function(n){return function(...e){st(n,...e)}},Ty=function(...n){let e="FIREBASE INTERNAL ERROR: "+rl(...n);mo.error(e)},Fn=function(...n){let e=`FIREBASE FATAL ERROR: ${rl(...n)}`;throw mo.error(e),new Error(e)},yt=function(...n){let e="FIREBASE WARNING: "+rl(...n);mo.warn(e)},NM=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&yt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bd=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},kM=function(n){if(wn()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Yr="[MIN_NAME]",cr="[MAX_NAME]",Wi=function(n,e){if(n===e)return 0;if(n===Yr||e===cr)return-1;if(e===Yr||n===cr)return 1;{let t=hS(n),r=hS(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},xM=function(n,e){return n===e?0:n<e?-1:1},Oc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+We(e))},Av=function(n){if(typeof n!="object"||n===null)return We(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=We(e[r]),t+=":",t+=Av(n[e[r]]);return t+="}",t},zS=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function ot(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var GS=function(n){V(!bd(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,l;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(i?1:0),u.reverse();let h=u.join(""),f="";for(l=0;l<64;l+=8){let g=parseInt(h.substr(l,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},OM=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},MM=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function LM(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var FM=new RegExp("^-?(0*)\\d{1,10}$"),VM=-2147483648,UM=2147483647,hS=function(n){if(FM.test(n)){let e=Number(n);if(e>=VM&&e<=UM)return e}return null},Ao=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw yt("Exception was thrown by user callback.",t),e},Math.floor(0))}},jM=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Vc=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Iy=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){yt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var by=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(st("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',yt(e)}},Uc=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Jh="5",WS="v",KS="s",HS="r",QS="f",YS=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,XS="ls",JS="p",Ay="ac",ZS="websocket",eC="long_polling";var Zh=class{constructor(e,t,r,i,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=$i.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&$i.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function BM(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function tC(n,e,t){V(typeof e=="string","typeof type must == string"),V(typeof t=="object","typeof params must == object");let r;if(e===ZS)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===eC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);BM(n)&&(t.ns=n.namespace);let i=[];return ot(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Ry=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Wt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return cT(this.counters_)}};var dy={},fy={};function Rv(n){let e=n.toString();return dy[e]||(dy[e]=new Ry),dy[e]}function qM(n,e){let t=n.toString();return fy[t]||(fy[t]=e()),fy[t]}var Sy=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Ao(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var dS="start",$M="close",zM="pLPCommand",GM="pRTLPCB",nC="id",rC="pw",iC="ser",WM="cb",KM="seg",HM="ts",QM="d",YM="dframe",sC=1870,oC=30,XM=sC-oC,JM=25e3,ZM=3e4,$c=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=il(e),this.stats_=Rv(t),this.urlFn=l=>(this.appCheckToken&&(l[Ay]=this.appCheckToken),tC(t,eC,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Sy(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ZM)),kM(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Cy((...s)=>{let[o,a,l,u,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===dS)this.id=a,this.password=l;else if(o===$M)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[dS]="t",r[iC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[WM]=this.scriptTagHolder.uniqueCallbackIdentifier),r[WS]=Jh,this.transportSessionId&&(r[KS]=this.transportSessionId),this.lastSessionId&&(r[XS]=this.lastSessionId),this.applicationId&&(r[JS]=this.applicationId),this.appCheckToken&&(r[Ay]=this.appCheckToken),typeof location<"u"&&location.hostname&&YS.test(location.hostname)&&(r[HS]=QS);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return wn()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!OM()&&!MM()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=aT(t),i=zS(r,XM);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(wn())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[YM]="t",r[nC]=e,r[rC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=We(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Cy=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,wn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=BS(),window[zM+this.uniqueCallbackIdentifier]=e,window[GM+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){st("frame writing exception"),a.stack&&st(a.stack),st(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||st("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[nC]=this.myID,e[rC]=this.myPW,e[iC]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+oC+r.length<=sC;){let o=this.pendingSegs.shift();r=r+"&"+KM+i+"="+o.seg+"&"+HM+i+"="+o.ts+"&"+QM+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(JM)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){wn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{st("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var e1=16384,t1=45e3,ed=null;typeof MozWebSocket<"u"?ed=MozWebSocket:typeof WebSocket<"u"&&(ed=WebSocket);var po=(()=>{class n{constructor(t,r,i,s,o,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=il(this.connId),this.stats_=Rv(r),this.connURL=n.connectionURL_(r,a,l,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[WS]=Jh,!wn()&&typeof location<"u"&&location.hostname&&YS.test(location.hostname)&&(a[HS]=QS),r&&(a[KS]=r),i&&(a[XS]=i),s&&(a[Ay]=s),o&&(a[JS]=o),tC(t,ZS,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,$i.set("previous_websocket_failure",!0);try{let i;if(wn()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Jh}/${Iv}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new ed(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&ed!==null&&!n.forceDisallow_}static previouslyFailed(){return $i.isInMemoryStorage||$i.get("previous_websocket_failure")===!0}markConnectionHealthy(){$i.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Xl(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(V(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=We(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=zS(r,e1);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(t1))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),aC=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[$c,po]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=po&&po.isAvailable(),i=r&&!po.previouslyFailed();if(t.webSocketOnly&&(r||yt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[po];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),n1=6e4,r1=5e3,i1=10*1024,s1=100*1024,py="t",fS="d",o1="s",pS="r",a1="e",gS="o",mS="a",_S="n",yS="p",c1="h",Py=class{constructor(e,t,r,i,s,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=il("c:"+this.id+":"),this.transportManager_=new aC(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Vc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>s1?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>i1?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(py in e){let t=e[py];t===mS?this.upgradeIfSecondaryHealthy_():t===pS?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===gS&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Oc("t",e),r=Oc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:yS,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:mS,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_S,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Oc("t",e),r=Oc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Oc(py,e);if(fS in e){let r=e[fS];if(t===c1){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===_S){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===o1?this.onConnectionShutdown_(r):t===pS?this.onReset_(r):t===a1?Ty("Server Error: "+r):t===gS?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ty("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Jh!==r&&yt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Vc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(n1))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Vc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(r1))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:yS,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&($i.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var td=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var nd=class{constructor(e){this.allowedEvents_=e,this.listeners_={},V(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){V(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var rd=class n extends nd{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Wf()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return V(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var vS=32,wS=768,me=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function ge(){return new me("")}function ae(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Xr(n){return n.pieces_.length-n.pieceNum_}function Te(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new me(n.pieces_,e)}function Sv(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function l1(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function zc(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function cC(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new me(e,0)}function Ne(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof me)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new me(t,0)}function ce(n){return n.pieceNum_>=n.pieces_.length}function At(n,e){let t=ae(n),r=ae(e);if(t===null)return e;if(t===r)return At(Te(n),Te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function u1(n,e){let t=zc(n,0),r=zc(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=Wi(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Cv(n,e){if(Xr(n)!==Xr(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Zt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Xr(n)>Xr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var Dy=class{constructor(e,t){this.errorPrefix_=t,this.parts_=zc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=ua(this.parts_[r]);lC(this)}};function h1(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=ua(e),lC(n)}function d1(n){let e=n.parts_.pop();n.byteLength_-=ua(e),n.parts_.length>0&&(n.byteLength_-=1)}function lC(n){if(n.byteLength_>wS)throw new Error(n.errorPrefix_+"has a key path longer than "+wS+" bytes ("+n.byteLength_+").");if(n.parts_.length>vS)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+vS+") or object contains a cycle "+qi(n))}function qi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Ny=class n extends nd{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return V(e==="visible","Unknown event type: "+e),[this.visible_]}};var Mc=1e3,f1=60*5*1e3,ES=30*1e3,p1=1.3,g1=3e4,m1="server_kill",TS=3,Pv=(()=>{class n extends td{constructor(t,r,i,s,o,a,l,u){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=il("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Mc,this.maxReconnectDelay_=f1,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!wn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ny.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&rd.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(We(o)),V(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new tt,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),V(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),V(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let u=l.d,h=l.s;n.warnOnListenWarnings_(u,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(h,u))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&Wt(t,"w")){let i=_r(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();yt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||dT(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ES)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=hT(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),V(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+We(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):Ty("Unrecognized action received from server: "+We(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){V(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Mc,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Mc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>g1&&(this.reconnectDelay_=Mc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*p1)}this.onConnectStatus_(!1)}establishConnection_(){return P(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,u=function(){l?l.close():(a=!0,i())},h=function(g){V(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(g)};this.realtime_={close:u,sendRequest:h};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?st("getToken() completed but was canceled"):(st("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=_&&_.token,l=new Py(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,E=>{yt(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(m1)},o))}catch(g){this.log_("Failed to get token: "+g),a||(this.repoInfo_.nodeAdmin&&yt(g),u())}}})}interrupt(t){st("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){st("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Jl(this.interruptReasons_)&&(this.reconnectDelay_=Mc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>Av(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new me(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){st("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=TS&&(this.reconnectDelay_=ES,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){st("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=TS&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";wn()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+Iv.replace(/\./g,"-")]=1,Wf()?t["framework.cordova"]=1:lT()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=rd.getInstance().currentlyOnline();return Jl(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),le=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var _o=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new le(Yr,e),i=new le(Yr,t);return this.compare(r,i)!==0}minPost(){return le.MIN}};var Xh,id=class extends _o{static get __EMPTY_NODE(){return Xh}static set __EMPTY_NODE(e){Xh=e}compare(e,t){return Wi(e.name,t.name)}isDefinedOn(e){throw us("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return le.MIN}maxPost(){return new le(cr,Xh)}makePost(e,t){return V(typeof e=="string","KeyIndex indexValue must always be a string."),new le(e,Xh)}toString(){return".key"}},Ln=new id;var go=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},fn=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??en.EMPTY_NODE,this.right=o??en.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return en.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return en.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),ky=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new fn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},en=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fn.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fn.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new go(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new go(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new go(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new go(this.root_,null,this.comparator_,!0,e)}};en.EMPTY_NODE=new ky;function _1(n,e){return Wi(n.name,e.name)}function Dv(n,e){return Wi(n,e)}var xy;function y1(n){xy=n}var uC=function(n){return typeof n=="number"?"number:"+GS(n):"string:"+n},hC=function(n){if(n.isLeafNode()){let e=n.val();V(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Wt(e,".sv"),"Priority must be a string or number.")}else V(n===xy||n.isEmpty(),"priority of unexpected type.");V(n===xy||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var IS,yo=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,V(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),hC(this.priorityNode_)}static set __childrenNodeConstructor(t){IS=t}static get __childrenNodeConstructor(){return IS}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ce(t)?this:ae(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=ae(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(V(i!==".priority"||Xr(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Te(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+uC(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=GS(this.value_):t+=this.value_,this.lazyHash_=qS(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(V(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return V(s>=0,"Unknown leaf type: "+r),V(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),dC,fC;function v1(n){dC=n}function w1(n){fC=n}var Oy=class extends _o{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?Wi(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return le.MIN}maxPost(){return new le(cr,new yo("[PRIORITY-POST]",fC))}makePost(e,t){let r=dC(e);return new le(t,new yo("[PRIORITY-POST]",r))}toString(){return".priority"}},Ae=new Oy;var E1=Math.log(2),My=class{constructor(e){let t=s=>parseInt(Math.log(s)/E1,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},sd=function(n,e,t,r){n.sort(e);let i=function(l,u){let h=u-l,f,g;if(h===0)return null;if(h===1)return f=n[l],g=t?t(f):f,new fn(g,f.node,fn.BLACK,null,null);{let _=parseInt(h/2,10)+l,E=i(l,_),S=i(_+1,u);return f=n[_],g=t?t(f):f,new fn(g,f.node,fn.BLACK,E,S)}},s=function(l){let u=null,h=null,f=n.length,g=function(E,S){let I=f-E,O=f;f-=E;let j=i(I+1,O),x=n[I],U=t?t(x):x;_(new fn(U,x.node,S,null,j))},_=function(E){u?(u.left=E,u=E):(h=E,u=E)};for(let E=0;E<l.count;++E){let S=l.nextBitIsOne(),I=Math.pow(2,l.count-(E+1));S?g(I,fn.BLACK):(g(I,fn.BLACK),g(I,fn.RED))}return h},o=new My(n.length),a=s(o);return new en(r||e,a)};var gy,fo={},vo=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return V(fo&&Ae,"ChildrenNode.ts has not been loaded"),gy=gy||new n({".priority":fo},{".priority":Ae}),gy}get(e){let t=_r(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof en?t:null}hasIndex(e){return Wt(this.indexSet_,e.toString())}addIndex(e,t){V(e!==Ln,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(le.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=sd(r,e.getCompare()):a=fo;let l=e.toString(),u=Object.assign({},this.indexSet_);u[l]=e;let h=Object.assign({},this.indexes_);return h[l]=a,new n(h,u)}addToIndexes(e,t){let r=la(this.indexes_,(i,s)=>{let o=_r(this.indexSet_,s);if(V(o,"Missing index implementation for "+s),i===fo)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(le.Wrap),u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),sd(a,o.getCompare())}else return fo;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new le(e.name,a))),l.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=la(this.indexes_,i=>{if(i===fo)return i;{let s=t.get(e.name);return s?i.remove(new le(e.name,s)):i}});return new n(r,this.indexSet_)}};var Lc,re=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&hC(this.priorityNode_),this.children_.isEmpty()&&V(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Lc||(Lc=new n(new en(Dv),null,vo.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Lc}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?Lc:r}}getChild(t){let r=ae(t);return r===null?this:this.getImmediateChild(r).getChild(Te(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(V(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new le(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?Lc:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=ae(t);if(i===null)return r;{V(ae(t)!==".priority"||Xr(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Te(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(Ae,(a,l)=>{r[a]=l.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let l in r)a[l]=r[l];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+uC(this.getPriority().val())+":"),this.forEachChild(Ae,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":qS(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new le(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new le(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new le(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,le.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===sl?-1:0}withIndex(t){if(t===Ln||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Ln||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(Ae),s=r.getIterator(Ae),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Ln?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Ly=class extends re{constructor(){super(new en(Dv),re.EMPTY_NODE,vo.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return re.EMPTY_NODE}isEmpty(){return!1}},sl=new Ly;Object.defineProperties(le,{MIN:{value:new le(Yr,re.EMPTY_NODE)},MAX:{value:new le(cr,sl)}});id.__EMPTY_NODE=re.EMPTY_NODE;yo.__childrenNodeConstructor=re;y1(sl);w1(sl);var T1=!0;function Oe(n,e=null){if(n===null)return re.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),V(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new yo(t,Oe(e))}if(!(n instanceof Array)&&T1){let t=[],r=!1;if(ot(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=Oe(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new le(o,l)))}}),t.length===0)return re.EMPTY_NODE;let s=sd(t,_1,o=>o.name,Dv);if(r){let o=sd(t,Ae.getCompare());return new re(s,Oe(e),new vo({".priority":o},{".priority":Ae}))}else return new re(s,Oe(e),vo.Default)}else{let t=re.EMPTY_NODE;return ot(n,(r,i)=>{if(Wt(n,r)&&r.substring(0,1)!=="."){let s=Oe(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Oe(e))}}v1(Oe);var Gc=class extends _o{constructor(e){super(),this.indexPath_=e,V(!ce(e)&&ae(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?Wi(e.name,t.name):s}makePost(e,t){let r=Oe(e),i=re.EMPTY_NODE.updateChild(this.indexPath_,r);return new le(t,i)}maxPost(){let e=re.EMPTY_NODE.updateChild(this.indexPath_,sl);return new le(cr,e)}toString(){return zc(this.indexPath_,0).join("/")}};var Fy=class extends _o{compare(e,t){let r=e.node.compareTo(t.node);return r===0?Wi(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return le.MIN}maxPost(){return le.MAX}makePost(e,t){let r=Oe(e);return new le(t,r)}toString(){return".value"}},Nv=new Fy;function pC(n){return{type:"value",snapshotNode:n}}function wo(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Wc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Kc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function I1(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Hc=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){V(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Wc(t,a)):V(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(wo(t,r)):o.trackChildChange(Kc(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Ae,(i,s)=>{t.hasChild(i)||r.trackChildChange(Wc(i,s))}),t.isLeafNode()||t.forEachChild(Ae,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Kc(i,s,o))}else r.trackChildChange(wo(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?re.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var od=class n{constructor(e){this.indexedFilter_=new Hc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new le(t,r))||(r=re.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=re.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(re.EMPTY_NODE);let s=this;return t.forEachChild(Ae,(o,a)=>{s.matches(new le(o,a))||(i=i.updateImmediateChild(o,re.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Vy=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new od(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new le(t,r))||(r=re.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=re.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=re.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(re.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,re.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let f=this.index_.getCompare();o=(g,_)=>f(_,g)}else o=this.index_.getCompare();let a=e;V(a.numChildren()===this.limit_,"");let l=new le(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){let f=a.getImmediateChild(t),g=i.getChildAfterChild(this.index_,u,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let _=g==null?1:o(g,l);if(h&&!r.isEmpty()&&_>=0)return s?.trackChildChange(Kc(t,r,f)),a.updateImmediateChild(t,r);{s?.trackChildChange(Wc(t,f));let S=a.updateImmediateChild(t,re.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(s?.trackChildChange(wo(g.name,g.node)),S.updateImmediateChild(g.name,g.node)):S}}else return r.isEmpty()?e:h&&o(u,l)>=0?(s!=null&&(s.trackChildChange(Wc(u.name,u.node)),s.trackChildChange(wo(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,re.EMPTY_NODE)):e}};var Qc=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ae}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return V(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return V(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Yr}hasEnd(){return this.endSet_}getIndexEndValue(){return V(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return V(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:cr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return V(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ae}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function b1(n){return n.loadsAllData()?new Hc(n.getIndex()):n.hasLimit()?new Vy(n):new od(n)}function A1(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function R1(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Uy(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function S1(n,e,t){let r;return n.index_===Ln||t?r=Uy(n,e,t):r=Uy(n,e,cr),r.startAfterSet_=!0,r}function jy(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function C1(n,e,t){let r;return n.index_===Ln||t?r=jy(n,e,t):r=jy(n,e,Yr),r.endBeforeSet_=!0,r}function Ad(n,e){let t=n.copy();return t.index_=e,t}function bS(n){let e={};if(n.isDefault())return e;let t;if(n.index_===Ae?t="$priority":n.index_===Nv?t="$value":n.index_===Ln?t="$key":(V(n.index_ instanceof Gc,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=We(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=We(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+We(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=We(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+We(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function AS(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ae&&(e.i=n.index_.toString()),e}var By=class n extends td{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=il("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(V(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let l=bS(e._queryParams);this.restRequest_(s+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(s,f,!1,r),_r(this.listens_,o)===a){let g;u?u===401?g="permission_denied":g="rest_error:"+u:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=bS(e._queryParams),r=e._path.toString(),i=new tt;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+fT(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Xl(a.responseText)}catch{yt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&yt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var qy=class{constructor(){this.rootNode_=re.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function ad(){return{value:null,children:new Map}}function Ro(n,e,t){if(ce(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=ae(e);n.children.has(r)||n.children.set(r,ad());let i=n.children.get(r);e=Te(e),Ro(i,e,t)}}function $y(n,e){if(ce(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(Ae,(r,i)=>{Ro(n,new me(r),i)}),$y(n,e)}}else if(n.children.size>0){let t=ae(e);return e=Te(e),n.children.has(t)&&$y(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function zy(n,e,t){n.value!==null?t(e,n.value):P1(n,(r,i)=>{let s=new me(e.toString()+"/"+r);zy(i,s,t)})}function P1(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Gy=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ot(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var RS=10*1e3,D1=30*1e3,N1=5*60*1e3,Wy=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Gy(e);let r=RS+(D1-RS)*Math.random();Vc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;ot(e,(i,s)=>{s>0&&Wt(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Vc(this.reportStats_.bind(this),Math.floor(Math.random()*2*N1))}};var Mn=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Mn||{});function kv(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function xv(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ov(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Ky=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Mn.ACK_USER_WRITE,this.source=kv()}operationForChild(e){if(ce(this.path)){if(this.affectedTree.value!=null)return V(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new me(e));return new n(ge(),t,this.revert)}}else return V(ae(this.path)===e,"operationForChild called for unrelated child."),new n(Te(this.path),this.affectedTree,this.revert)}};var cd=class n{constructor(e,t){this.source=e,this.path=t,this.type=Mn.LISTEN_COMPLETE}operationForChild(e){return ce(this.path)?new n(this.source,ge()):new n(this.source,Te(this.path))}};var Eo=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Mn.OVERWRITE}operationForChild(e){return ce(this.path)?new n(this.source,ge(),this.snap.getImmediateChild(e)):new n(this.source,Te(this.path),this.snap)}};var Yc=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Mn.MERGE}operationForChild(e){if(ce(this.path)){let t=this.children.subtree(new me(e));return t.isEmpty()?null:t.value?new Eo(this.source,ge(),t.value):new n(this.source,ge(),t)}else return V(ae(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Vn=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ce(e))return this.isFullyInitialized()&&!this.filtered_;let t=ae(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Hy=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function k1(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(I1(o.childName,o.snapshotNode))}),Fc(n,i,"child_removed",e,r,t),Fc(n,i,"child_added",e,r,t),Fc(n,i,"child_moved",s,r,t),Fc(n,i,"child_changed",e,r,t),Fc(n,i,"value",e,r,t),i}function Fc(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,l)=>O1(n,a,l)),o.forEach(a=>{let l=x1(n,a,s);i.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function x1(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function O1(n,e,t){if(e.childName==null||t.childName==null)throw us("Should only compare child_ events.");let r=new le(e.childName,e.snapshotNode),i=new le(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Rd(n,e){return{eventCache:n,serverCache:e}}function jc(n,e,t,r){return Rd(new Vn(e,t,r),n.serverCache)}function gC(n,e,t,r){return Rd(n.eventCache,new Vn(e,t,r))}function ld(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Gi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var my,M1=()=>(my||(my=new en(xM)),my),Rt=class n{constructor(e,t=M1()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return ot(e,(r,i)=>{t=t.set(new me(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ge(),value:this.value};if(ce(e))return null;{let r=ae(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Te(e),t);return s!=null?{path:Ne(new me(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ce(e))return this;{let t=ae(e),r=this.children.get(t);return r!==null?r.subtree(Te(e)):new n(null)}}set(e,t){if(ce(e))return new n(t,this.children);{let r=ae(e),s=(this.children.get(r)||new n(null)).set(Te(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ce(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=ae(e),r=this.children.get(t);if(r){let i=r.remove(Te(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ce(e))return this.value;{let t=ae(e),r=this.children.get(t);return r?r.get(Te(e)):null}}setTree(e,t){if(ce(e))return t;{let r=ae(e),s=(this.children.get(r)||new n(null)).setTree(Te(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(ge(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(Ne(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ge(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ce(e))return null;{let s=ae(e),o=this.children.get(s);return o?o.findOnPath_(Te(e),Ne(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ge(),t)}foreachOnPath_(e,t,r){if(ce(e))return this;{this.value&&r(t,this.value);let i=ae(e),s=this.children.get(i);return s?s.foreachOnPath_(Te(e),Ne(t,i),r):new n(null)}}foreach(e){this.foreach_(ge(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(Ne(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var pn=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new Rt(null))}};function Bc(n,e,t){if(ce(e))return new pn(new Rt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=At(i,e);return s=s.updateChild(o,t),new pn(n.writeTree_.set(i,s))}else{let i=new Rt(t),s=n.writeTree_.setTree(e,i);return new pn(s)}}}function Qy(n,e,t){let r=n;return ot(t,(i,s)=>{r=Bc(r,Ne(e,i),s)}),r}function SS(n,e){if(ce(e))return pn.empty();{let t=n.writeTree_.setTree(e,new Rt(null));return new pn(t)}}function Yy(n,e){return Ki(n,e)!=null}function Ki(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(At(t.path,e)):null}function CS(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ae,(r,i)=>{e.push(new le(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new le(r,i.value))}),e}function Hr(n,e){if(ce(e))return n;{let t=Ki(n,e);return t!=null?new pn(new Rt(t)):new pn(n.writeTree_.subtree(e))}}function Xy(n){return n.writeTree_.isEmpty()}function To(n,e){return mC(ge(),n.writeTree_,e)}function mC(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(V(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=mC(Ne(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Ne(n,".priority"),r)),t}}function Sd(n,e){return wC(e,n)}function L1(n,e,t,r,i){V(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Bc(n.visibleWrites,e,t)),n.lastWriteId=r}function F1(n,e,t,r){V(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Qy(n.visibleWrites,e,t),n.lastWriteId=r}function V1(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function U1(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);V(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&j1(a,r.path)?i=!1:Zt(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return B1(n),!0;if(r.snap)n.visibleWrites=SS(n.visibleWrites,r.path);else{let a=r.children;ot(a,l=>{n.visibleWrites=SS(n.visibleWrites,Ne(r.path,l))})}return!0}else return!1}function j1(n,e){if(n.snap)return Zt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Zt(Ne(n.path,t),e))return!0;return!1}function B1(n){n.visibleWrites=_C(n.allWrites,q1,ge()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function q1(n){return n.visible}function _C(n,e,t){let r=pn.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)Zt(t,o)?(a=At(t,o),r=Bc(r,a,s.snap)):Zt(o,t)&&(a=At(o,t),r=Bc(r,ge(),s.snap.getChild(a)));else if(s.children){if(Zt(t,o))a=At(t,o),r=Qy(r,a,s.children);else if(Zt(o,t))if(a=At(o,t),ce(a))r=Qy(r,ge(),s.children);else{let l=_r(s.children,ae(a));if(l){let u=l.getChild(Te(a));r=Bc(r,ge(),u)}}}else throw us("WriteRecord should have .snap or .children")}}return r}function yC(n,e,t,r,i){if(!r&&!i){let s=Ki(n.visibleWrites,e);if(s!=null)return s;{let o=Hr(n.visibleWrites,e);if(Xy(o))return t;if(t==null&&!Yy(o,ge()))return null;{let a=t||re.EMPTY_NODE;return To(o,a)}}}else{let s=Hr(n.visibleWrites,e);if(!i&&Xy(s))return t;if(!i&&t==null&&!Yy(s,ge()))return null;{let o=function(u){return(u.visible||i)&&(!r||!~r.indexOf(u.writeId))&&(Zt(u.path,e)||Zt(e,u.path))},a=_C(n.allWrites,o,e),l=t||re.EMPTY_NODE;return To(a,l)}}}function $1(n,e,t){let r=re.EMPTY_NODE,i=Ki(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Ae,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=Hr(n.visibleWrites,e);return t.forEachChild(Ae,(o,a)=>{let l=To(Hr(s,new me(o)),a);r=r.updateImmediateChild(o,l)}),CS(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=Hr(n.visibleWrites,e);return CS(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function z1(n,e,t,r,i){V(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=Ne(e,t);if(Yy(n.visibleWrites,s))return null;{let o=Hr(n.visibleWrites,s);return Xy(o)?i.getChild(t):To(o,i.getChild(t))}}function G1(n,e,t,r){let i=Ne(e,t),s=Ki(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=Hr(n.visibleWrites,i);return To(o,r.getNode().getImmediateChild(t))}else return null}function W1(n,e){return Ki(n.visibleWrites,e)}function K1(n,e,t,r,i,s,o){let a,l=Hr(n.visibleWrites,e),u=Ki(l,ge());if(u!=null)a=u;else if(t!=null)a=To(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],f=o.getCompare(),g=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),_=g.getNext();for(;_&&h.length<i;)f(_,r)!==0&&h.push(_),_=g.getNext();return h}else return[]}function H1(){return{visibleWrites:pn.empty(),allWrites:[],lastWriteId:-1}}function ud(n,e,t,r){return yC(n.writeTree,n.treePath,e,t,r)}function Mv(n,e){return $1(n.writeTree,n.treePath,e)}function PS(n,e,t,r){return z1(n.writeTree,n.treePath,e,t,r)}function hd(n,e){return W1(n.writeTree,Ne(n.treePath,e))}function Q1(n,e,t,r,i,s){return K1(n.writeTree,n.treePath,e,t,r,i,s)}function Lv(n,e,t){return G1(n.writeTree,n.treePath,e,t)}function vC(n,e){return wC(Ne(n.treePath,e),n.writeTree)}function wC(n,e){return{treePath:n,writeTree:e}}var Jy=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;V(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),V(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Kc(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Wc(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,wo(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Kc(r,e.snapshotNode,i.oldSnap));else throw us("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Zy=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},EC=new Zy,Xc=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Vn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Lv(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Gi(this.viewCache_),s=Q1(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function Y1(n){return{filter:n}}function X1(n,e){V(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),V(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function J1(n,e,t,r,i){let s=new Jy,o,a;if(t.type===Mn.OVERWRITE){let u=t;u.source.fromUser?o=ev(n,e,u.path,u.snap,r,i,s):(V(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!ce(u.path),o=dd(n,e,u.path,u.snap,r,i,a,s))}else if(t.type===Mn.MERGE){let u=t;u.source.fromUser?o=eL(n,e,u.path,u.children,r,i,s):(V(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=tv(n,e,u.path,u.children,r,i,a,s))}else if(t.type===Mn.ACK_USER_WRITE){let u=t;u.revert?o=rL(n,e,u.path,r,i,s):o=tL(n,e,u.path,u.affectedTree,r,i,s)}else if(t.type===Mn.LISTEN_COMPLETE)o=nL(n,e,t.path,r,s);else throw us("Unknown operation type: "+t.type);let l=s.getChanges();return Z1(e,o,l),{viewCache:o,changes:l}}function Z1(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=ld(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(pC(ld(e)))}}function TC(n,e,t,r,i,s){let o=e.eventCache;if(hd(r,t)!=null)return e;{let a,l;if(ce(t))if(V(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=Gi(e),h=u instanceof re?u:re.EMPTY_NODE,f=Mv(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{let u=ud(r,Gi(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=ae(t);if(u===".priority"){V(Xr(t)===1,"Can't have a priority with additional path components");let h=o.getNode();l=e.serverCache.getNode();let f=PS(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{let h=Te(t),f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();let g=PS(r,t,o.getNode(),l);g!=null?f=o.getNode().getImmediateChild(u).updateChild(h,g):f=o.getNode().getImmediateChild(u)}else f=Lv(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,i,s):a=o.getNode()}}return jc(e,a,o.isFullyInitialized()||ce(t),n.filter.filtersNodes())}}function dd(n,e,t,r,i,s,o,a){let l=e.serverCache,u,h=o?n.filter:n.filter.getIndexedFilter();if(ce(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){let _=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),_,null)}else{let _=ae(t);if(!l.isCompleteForPath(t)&&Xr(t)>1)return e;let E=Te(t),I=l.getNode().getImmediateChild(_).updateChild(E,r);_===".priority"?u=h.updatePriority(l.getNode(),I):u=h.updateChild(l.getNode(),_,I,E,EC,null)}let f=gC(e,u,l.isFullyInitialized()||ce(t),h.filtersNodes()),g=new Xc(i,f,s);return TC(n,f,t,i,g,a)}function ev(n,e,t,r,i,s,o){let a=e.eventCache,l,u,h=new Xc(i,e,s);if(ce(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=jc(e,u,!0,n.filter.filtersNodes());else{let f=ae(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=jc(e,u,a.isFullyInitialized(),a.isFiltered());else{let g=Te(t),_=a.getNode().getImmediateChild(f),E;if(ce(g))E=r;else{let S=h.getCompleteChild(f);S!=null?Sv(g)===".priority"&&S.getChild(cC(g)).isEmpty()?E=S:E=S.updateChild(g,r):E=re.EMPTY_NODE}if(_.equals(E))l=e;else{let S=n.filter.updateChild(a.getNode(),f,E,g,h,o);l=jc(e,S,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function DS(n,e){return n.eventCache.isCompleteForChild(e)}function eL(n,e,t,r,i,s,o){let a=e;return r.foreach((l,u)=>{let h=Ne(t,l);DS(e,ae(h))&&(a=ev(n,a,h,u,i,s,o))}),r.foreach((l,u)=>{let h=Ne(t,l);DS(e,ae(h))||(a=ev(n,a,h,u,i,s,o))}),a}function NS(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function tv(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;ce(t)?u=r:u=new Rt(null).setTree(t,r);let h=e.serverCache.getNode();return u.children.inorderTraversal((f,g)=>{if(h.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),E=NS(n,_,g);l=dd(n,l,new me(f),E,i,s,o,a)}}),u.children.inorderTraversal((f,g)=>{let _=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!h.hasChild(f)&&!_){let E=e.serverCache.getNode().getImmediateChild(f),S=NS(n,E,g);l=dd(n,l,new me(f),S,i,s,o,a)}}),l}function tL(n,e,t,r,i,s,o){if(hd(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(ce(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return dd(n,e,t,l.getNode().getChild(t),i,s,a,o);if(ce(t)){let u=new Rt(null);return l.getNode().forEachChild(Ln,(h,f)=>{u=u.set(new me(h),f)}),tv(n,e,t,u,i,s,a,o)}else return e}else{let u=new Rt(null);return r.foreach((h,f)=>{let g=Ne(t,h);l.isCompleteForPath(g)&&(u=u.set(h,l.getNode().getChild(g)))}),tv(n,e,t,u,i,s,a,o)}}function nL(n,e,t,r,i){let s=e.serverCache,o=gC(e,s.getNode(),s.isFullyInitialized()||ce(t),s.isFiltered());return TC(n,o,t,r,EC,i)}function rL(n,e,t,r,i,s){let o;if(hd(r,t)!=null)return e;{let a=new Xc(r,e,i),l=e.eventCache.getNode(),u;if(ce(t)||ae(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=ud(r,Gi(e));else{let f=e.serverCache.getNode();V(f instanceof re,"serverChildren would be complete if leaf node"),h=Mv(r,f)}h=h,u=n.filter.updateFullNode(l,h,s)}else{let h=ae(t),f=Lv(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Te(t),a,s):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,re.EMPTY_NODE,Te(t),a,s):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ud(r,Gi(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||hd(r,ge())!=null,jc(e,u,o,n.filter.filtersNodes())}}var nv=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Hc(r.getIndex()),s=b1(r);this.processor_=Y1(s);let o=t.serverCache,a=t.eventCache,l=i.updateFullNode(re.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(re.EMPTY_NODE,a.getNode(),null),h=new Vn(l,o.isFullyInitialized(),i.filtersNodes()),f=new Vn(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Rd(f,h),this.eventGenerator_=new Hy(this.query_)}get query(){return this.query_}};function iL(n){return n.viewCache_.serverCache.getNode()}function sL(n){return ld(n.viewCache_)}function oL(n,e){let t=Gi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ce(e)&&!t.getImmediateChild(ae(e)).isEmpty())?t.getChild(e):null}function kS(n){return n.eventRegistrations_.length===0}function aL(n,e){n.eventRegistrations_.push(e)}function xS(n,e,t){let r=[];if(t){V(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function OS(n,e,t,r){e.type===Mn.MERGE&&e.source.queryId!==null&&(V(Gi(n.viewCache_),"We should always have a full cache before handling merges"),V(ld(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=J1(n.processor_,i,e,t,r);return X1(n.processor_,s.viewCache),V(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,IC(n,s.changes,s.viewCache.eventCache.getNode(),null)}function cL(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ae,(s,o)=>{r.push(wo(s,o))}),t.isFullyInitialized()&&r.push(pC(t.getNode())),IC(n,r,t.getNode(),e)}function IC(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return k1(n.eventGenerator_,e,t,i)}var fd,pd=class{constructor(){this.views=new Map}};function lL(n){V(!fd,"__referenceConstructor has already been defined"),fd=n}function uL(){return V(fd,"Reference.ts has not been loaded"),fd}function hL(n){return n.views.size===0}function Fv(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return V(s!=null,"SyncTree gave us an op for an invalid query."),OS(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(OS(o,e,t,r));return s}}function bC(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=ud(t,i?r:null),l=!1;a?l=!0:r instanceof re?(a=Mv(t,r),l=!1):(a=re.EMPTY_NODE,l=!1);let u=Rd(new Vn(a,l,!1),new Vn(r,i,!1));return new nv(e,u)}return o}function dL(n,e,t,r,i,s){let o=bC(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),aL(o,t),cL(o,t)}function fL(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=Jr(n);if(i==="default")for(let[l,u]of n.views.entries())o=o.concat(xS(u,t,r)),kS(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||s.push(u.query));else{let l=n.views.get(i);l&&(o=o.concat(xS(l,t,r)),kS(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!Jr(n)&&s.push(new(uL())(e._repo,e._path)),{removed:s,events:o}}function AC(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Qr(n,e){let t=null;for(let r of n.views.values())t=t||oL(r,e);return t}function RC(n,e){if(e._queryParams.loadsAllData())return Cd(n);{let r=e._queryIdentifier;return n.views.get(r)}}function SC(n,e){return RC(n,e)!=null}function Jr(n){return Cd(n)!=null}function Cd(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var gd;function pL(n){V(!gd,"__referenceConstructor has already been defined"),gd=n}function gL(){return V(gd,"Reference.ts has not been loaded"),gd}var mL=1,md=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Rt(null),this.pendingWriteTree_=H1(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Vv(n,e,t,r,i){return L1(n.pendingWriteTree_,e,t,r,i),i?So(n,new Eo(kv(),e,t)):[]}function _L(n,e,t,r){F1(n.pendingWriteTree_,e,t,r);let i=Rt.fromObject(t);return So(n,new Yc(kv(),e,i))}function Kr(n,e,t=!1){let r=V1(n.pendingWriteTree_,e);if(U1(n.pendingWriteTree_,e)){let s=new Rt(null);return r.snap!=null?s=s.set(ge(),!0):ot(r.children,o=>{s=s.set(new me(o),!0)}),So(n,new Ky(r.path,s,t))}else return[]}function ol(n,e,t){return So(n,new Eo(xv(),e,t))}function yL(n,e,t){let r=Rt.fromObject(t);return So(n,new Yc(xv(),e,r))}function vL(n,e){return So(n,new cd(xv(),e))}function wL(n,e,t){let r=Uv(n,t);if(r){let i=jv(r),s=i.path,o=i.queryId,a=At(s,e),l=new cd(Ov(o),a);return Bv(n,s,l)}else return[]}function _d(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||SC(o,e))){let l=fL(o,e,t,r);hL(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=l.removed;if(a=l.events,!i){let h=u.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(s,(g,_)=>Jr(_));if(h&&!f){let g=n.syncPointTree_.subtree(s);if(!g.isEmpty()){let _=IL(g);for(let E=0;E<_.length;++E){let S=_[E],I=S.query,O=NC(n,S);n.listenProvider_.startListening(qc(I),Jc(n,I),O.hashFn,O.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(qc(e),null):u.forEach(g=>{let _=n.queryToTagMap.get(Dd(g));n.listenProvider_.stopListening(qc(g),_)}))}bL(n,u)}return a}function CC(n,e,t,r){let i=Uv(n,r);if(i!=null){let s=jv(i),o=s.path,a=s.queryId,l=At(o,e),u=new Eo(Ov(a),l,t);return Bv(n,o,u)}else return[]}function EL(n,e,t,r){let i=Uv(n,r);if(i){let s=jv(i),o=s.path,a=s.queryId,l=At(o,e),u=Rt.fromObject(t),h=new Yc(Ov(a),l,u);return Bv(n,o,h)}else return[]}function rv(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(g,_)=>{let E=At(g,i);s=s||Qr(_,E),o=o||Jr(_)});let a=n.syncPointTree_.get(i);a?(o=o||Jr(a),s=s||Qr(a,ge())):(a=new pd,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;s!=null?l=!0:(l=!1,s=re.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((_,E)=>{let S=Qr(E,ge());S&&(s=s.updateImmediateChild(_,S))}));let u=SC(a,e);if(!u&&!e._queryParams.loadsAllData()){let g=Dd(e);V(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let _=AL();n.queryToTagMap.set(g,_),n.tagToQueryMap.set(_,g)}let h=Sd(n.pendingWriteTree_,i),f=dL(a,e,t,h,s,l);if(!u&&!o&&!r){let g=RC(a,e);f=f.concat(RL(n,e,g))}return f}function Pd(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=At(o,e),u=Qr(a,l);if(u)return u});return yC(i,e,s,t,!0)}function TL(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{let f=At(u,t);r=r||Qr(h,f)});let i=n.syncPointTree_.get(t);i?r=r||Qr(i,ge()):(i=new pd,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Vn(r,!0,!1):null,a=Sd(n.pendingWriteTree_,e._path),l=bC(i,e,a,s?o.getNode():re.EMPTY_NODE,s);return sL(l)}function So(n,e){return PC(e,n.syncPointTree_,null,Sd(n.pendingWriteTree_,ge()))}function PC(n,e,t,r){if(ce(n.path))return DC(n,e,t,r);{let i=e.get(ge());t==null&&i!=null&&(t=Qr(i,ge()));let s=[],o=ae(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let u=t?t.getImmediateChild(o):null,h=vC(r,o);s=s.concat(PC(a,l,u,h))}return i&&(s=s.concat(Fv(i,n,r,t))),s}}function DC(n,e,t,r){let i=e.get(ge());t==null&&i!=null&&(t=Qr(i,ge()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,u=vC(r,o),h=n.operationForChild(o);h&&(s=s.concat(DC(h,a,l,u)))}),i&&(s=s.concat(Fv(i,n,r,t))),s}function NC(n,e){let t=e.query,r=Jc(n,t);return{hashFn:()=>(iL(e)||re.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?wL(n,t._path,r):vL(n,t._path);{let s=LM(i,t);return _d(n,t,null,s)}}}}function Jc(n,e){let t=Dd(e);return n.queryToTagMap.get(t)}function Dd(n){return n._path.toString()+"$"+n._queryIdentifier}function Uv(n,e){return n.tagToQueryMap.get(e)}function jv(n){let e=n.indexOf("$");return V(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new me(n.substr(0,e))}}function Bv(n,e,t){let r=n.syncPointTree_.get(e);V(r,"Missing sync point for query tag that we're tracking");let i=Sd(n.pendingWriteTree_,e);return Fv(r,t,i,null)}function IL(n){return n.fold((e,t,r)=>{if(t&&Jr(t))return[Cd(t)];{let i=[];return t&&(i=AC(t)),ot(r,(s,o)=>{i=i.concat(o)}),i}})}function qc(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(gL())(n._repo,n._path):n}function bL(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=Dd(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function AL(){return mL++}function RL(n,e,t){let r=e._path,i=Jc(n,e),s=NC(n,t),o=n.listenProvider_.startListening(qc(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)V(!Jr(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((u,h,f)=>{if(!ce(u)&&h&&Jr(h))return[Cd(h).query];{let g=[];return h&&(g=g.concat(AC(h).map(_=>_.query))),ot(f,(_,E)=>{g=g.concat(E)}),g}});for(let u=0;u<l.length;++u){let h=l[u];n.listenProvider_.stopListening(qc(h),Jc(n,h))}}return o}var iv=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},sv=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Ne(this.path_,e);return new n(this.syncTree_,t)}node(){return Pd(this.syncTree_,this.path_)}},SL=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},MS=function(n,e,t){if(!n||typeof n!="object")return n;if(V(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return CL(n[".sv"],e,t);if(typeof n[".sv"]=="object")return PL(n[".sv"],e);V(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},CL=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:V(!1,"Unexpected server value: "+n)}},PL=function(n,e,t){n.hasOwnProperty("increment")||V(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&V(!1,"Unexpected increment value: "+r);let i=e.node();if(V(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},kC=function(n,e,t,r){return $v(e,new sv(t,n),r)},qv=function(n,e,t){return $v(n,new iv(e),t)};function $v(n,e,t){let r=n.getPriority().val(),i=MS(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=MS(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new yo(a,Oe(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new yo(i))),o.forEachChild(Ae,(a,l)=>{let u=$v(l,e.getImmediateChild(a),t);u!==l&&(s=s.updateImmediateChild(a,u))}),s}}var Zc=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Nd(n,e){let t=e instanceof me?e:new me(e),r=n,i=ae(t);for(;i!==null;){let s=_r(r.node.children,i)||{children:{},childCount:0};r=new Zc(i,r,s),t=Te(t),i=ae(t)}return r}function Hi(n){return n.node.value}function zv(n,e){n.node.value=e,ov(n)}function xC(n){return n.node.childCount>0}function DL(n){return Hi(n)===void 0&&!xC(n)}function kd(n,e){ot(n.node.children,(t,r)=>{e(new Zc(t,n,r))})}function OC(n,e,t,r){t&&!r&&e(n),kd(n,i=>{OC(i,e,!0,r)}),t&&r&&e(n)}function NL(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function al(n){return new me(n.parent===null?n.name:al(n.parent)+"/"+n.name)}function ov(n){n.parent!==null&&kL(n.parent,n.name,n)}function kL(n,e,t){let r=DL(t),i=Wt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,ov(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,ov(n))}var xL=/[\[\].#$\/\u0000-\u001F\u007F]/,OL=/[\[\].#$\u0000-\u001F\u007F]/,_y=10*1024*1024,xd=function(n){return typeof n=="string"&&n.length!==0&&!xL.test(n)},MC=function(n){return typeof n=="string"&&n.length!==0&&!OL.test(n)},ML=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),MC(n)},el=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!bd(n)||n&&typeof n=="object"&&Wt(n,".sv")},Un=function(n,e,t,r){r&&e===void 0||cl(Pt(n,"value"),e,t)},cl=function(n,e,t){let r=t instanceof me?new Dy(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+qi(r));if(typeof e=="function")throw new Error(n+"contains a function "+qi(r)+" with contents = "+e.toString());if(bd(e))throw new Error(n+"contains "+e.toString()+" "+qi(r));if(typeof e=="string"&&e.length>_y/3&&ua(e)>_y)throw new Error(n+"contains a string greater than "+_y+" utf8 bytes "+qi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(ot(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!xd(o)))throw new Error(n+" contains an invalid key ("+o+") "+qi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);h1(r,o),cl(n,a,r),d1(r)}),i&&s)throw new Error(n+' contains ".value" child '+qi(r)+" in addition to actual children.")}},LL=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=zc(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!xd(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(u1);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&Zt(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},LC=function(n,e,t,r){if(r&&e===void 0)return;let i=Pt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];ot(e,(o,a)=>{let l=new me(o);if(cl(i,a,Ne(t,l)),Sv(l)===".priority"&&!el(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),LL(i,s)},Gv=function(n,e,t){if(!(t&&e===void 0)){if(bd(e))throw new Error(Pt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!el(e))throw new Error(Pt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ll=function(n,e,t,r){if(!(r&&t===void 0)&&!xd(t))throw new Error(Pt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Co=function(n,e,t,r){if(!(r&&t===void 0)&&!MC(t))throw new Error(Pt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},FL=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Co(n,e,t,r)},Vt=function(n,e){if(ae(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},FC=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!xd(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!ML(t))throw new Error(Pt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var av=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Od(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!Cv(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function VC(n,e,t){Od(n,t),UC(n,r=>Cv(r,e))}function Ut(n,e,t){Od(n,t),UC(n,r=>Zt(r,e)||Zt(e,r))}function UC(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(VL(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function VL(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();zi&&st("event: "+t.toString()),Ao(r)}}}var jC="repo_interrupt",UL=25,cv=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new av,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ad(),this.transactionQueueTree_=new Zc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function jL(n,e,t){if(n.stats_=Rv(n.repoInfo_),n.forceRestClient_||jM())n.server_=new By(n.repoInfo_,(r,i,s,o)=>{LS(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>FS(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{We(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Pv(n.repoInfo_,e,(r,i,s,o)=>{LS(n,r,i,s,o)},r=>{FS(n,r)},r=>{BL(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=qM(n.repoInfo_,()=>new Wy(n.stats_,n.server_)),n.infoData_=new qy,n.infoSyncTree_=new md({startListening:(r,i,s,o)=>{let a=[],l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=ol(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Wv(n,"connected",!1),n.serverSyncTree_=new md({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,l)=>{let u=o(a,l);Ut(n.eventQueue_,r._path,u)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function BC(n){let t=n.infoData_.getNode(new me(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ul(n){return SL({timestamp:BC(n)})}function LS(n,e,t,r,i){n.dataUpdateCount++;let s=new me(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let l=la(t,u=>Oe(u));o=EL(n.serverSyncTree_,s,l,i)}else{let l=Oe(t);o=CC(n.serverSyncTree_,s,l,i)}else if(r){let l=la(t,u=>Oe(u));o=yL(n.serverSyncTree_,s,l)}else{let l=Oe(t);o=ol(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Io(n,s)),Ut(n.eventQueue_,a,o)}function FS(n,e){Wv(n,"connected",e),e===!1&&zL(n)}function BL(n,e){ot(e,(t,r)=>{Wv(n,t,r)})}function Wv(n,e,t){let r=new me("/.info/"+e),i=Oe(t);n.infoData_.updateSnapshot(r,i);let s=ol(n.infoSyncTree_,r,i);Ut(n.eventQueue_,r,s)}function Md(n){return n.nextWriteId_++}function qL(n,e,t){let r=TL(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Oe(i).withIndex(e._queryParams.getIndex());rv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ol(n.serverSyncTree_,e._path,s);else{let a=Jc(n.serverSyncTree_,e);o=CC(n.serverSyncTree_,e._path,s,a)}return Ut(n.eventQueue_,e._path,o),_d(n.serverSyncTree_,e,t,null,!0),s},i=>(Po(n,"get for query "+We(e)+" failed: "+i),Promise.reject(new Error(i))))}function Kv(n,e,t,r,i){Po(n,"set",{path:e.toString(),value:t,priority:r});let s=ul(n),o=Oe(t,r),a=Pd(n.serverSyncTree_,e),l=qv(o,a,s),u=Md(n),h=Vv(n.serverSyncTree_,e,l,u,!0);Od(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(g,_)=>{let E=g==="ok";E||yt("set at "+e+" failed: "+g);let S=Kr(n.serverSyncTree_,u,!E);Ut(n.eventQueue_,e,S),Zr(n,i,g,_)});let f=Qv(n,e);Io(n,f),Ut(n.eventQueue_,f,[])}function $L(n,e,t,r){Po(n,"update",{path:e.toString(),value:t});let i=!0,s=ul(n),o={};if(ot(t,(a,l)=>{i=!1,o[a]=kC(Ne(e,a),Oe(l),n.serverSyncTree_,s)}),i)st("update() called with empty data.  Don't do anything."),Zr(n,r,"ok",void 0);else{let a=Md(n),l=_L(n.serverSyncTree_,e,o,a);Od(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{let f=u==="ok";f||yt("update at "+e+" failed: "+u);let g=Kr(n.serverSyncTree_,a,!f),_=g.length>0?Io(n,e):e;Ut(n.eventQueue_,_,g),Zr(n,r,u,h)}),ot(t,u=>{let h=Qv(n,Ne(e,u));Io(n,h)}),Ut(n.eventQueue_,e,[])}}function zL(n){Po(n,"onDisconnectEvents");let e=ul(n),t=ad();zy(n.onDisconnect_,ge(),(i,s)=>{let o=kC(i,s,n.serverSyncTree_,e);Ro(t,i,o)});let r=[];zy(t,ge(),(i,s)=>{r=r.concat(ol(n.serverSyncTree_,i,s));let o=Qv(n,i);Io(n,o)}),n.onDisconnect_=ad(),Ut(n.eventQueue_,ge(),r)}function GL(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&$y(n.onDisconnect_,e),Zr(n,t,r,i)})}function VS(n,e,t,r){let i=Oe(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Ro(n.onDisconnect_,e,i),Zr(n,r,s,o)})}function WL(n,e,t,r,i){let s=Oe(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ro(n.onDisconnect_,e,s),Zr(n,i,o,a)})}function KL(n,e,t,r){if(Jl(t)){st("onDisconnect().update() called with empty data.  Don't do anything."),Zr(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&ot(t,(o,a)=>{let l=Oe(a);Ro(n.onDisconnect_,Ne(e,o),l)}),Zr(n,r,i,s)})}function HL(n,e,t){let r;ae(e._path)===".info"?r=rv(n.infoSyncTree_,e,t):r=rv(n.serverSyncTree_,e,t),VC(n.eventQueue_,e._path,r)}function lv(n,e,t){let r;ae(e._path)===".info"?r=_d(n.infoSyncTree_,e,t):r=_d(n.serverSyncTree_,e,t),VC(n.eventQueue_,e._path,r)}function qC(n){n.persistentConnection_&&n.persistentConnection_.interrupt(jC)}function QL(n){n.persistentConnection_&&n.persistentConnection_.resume(jC)}function Po(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),st(t,...e)}function Zr(n,e,t,r){e&&Ao(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function YL(n,e,t,r,i,s){Po(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:BS(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Hv(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{cl("transaction failed: Data returned ",l,o.path),o.status=0;let u=Nd(n.transactionQueueTree_,e),h=Hi(u)||[];h.push(o),zv(u,h);let f;typeof l=="object"&&l!==null&&Wt(l,".priority")?(f=_r(l,".priority"),V(el(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Pd(n.serverSyncTree_,e)||re.EMPTY_NODE).getPriority().val();let g=ul(n),_=Oe(l,f),E=qv(_,a,g);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=E,o.currentWriteId=Md(n);let S=Vv(n.serverSyncTree_,e,E,o.currentWriteId,o.applyLocally);Ut(n.eventQueue_,e,S),Ld(n,n.transactionQueueTree_)}}function Hv(n,e,t){return Pd(n.serverSyncTree_,e,t)||re.EMPTY_NODE}function Ld(n,e=n.transactionQueueTree_){if(e||Fd(n,e),Hi(e)){let t=zC(n,e);V(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&XL(n,al(e),t)}else xC(e)&&kd(e,t=>{Ld(n,t)})}function XL(n,e,t){let r=t.map(u=>u.currentWriteId),i=Hv(n,e,r),s=i,o=i.hash();for(let u=0;u<t.length;u++){let h=t[u];V(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let f=At(e,h.path);s=s.updateChild(f,h.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Po(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){let f=[];for(let g=0;g<t.length;g++)t[g].status=2,h=h.concat(Kr(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Fd(n,Nd(n.transactionQueueTree_,e)),Ld(n,n.transactionQueueTree_),Ut(n.eventQueue_,e,h);for(let g=0;g<f.length;g++)Ao(f[g])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{yt("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Io(n,e)}},o)}function Io(n,e){let t=$C(n,e),r=al(t),i=zC(n,t);return JL(n,i,r),r}function JL(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],u=At(t,l.path),h=!1,f;if(V(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,i=i.concat(Kr(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=UL)h=!0,f="maxretry",i=i.concat(Kr(n.serverSyncTree_,l.currentWriteId,!0));else{let g=Hv(n,l.path,o);l.currentInputSnapshot=g;let _=e[a].update(g.val());if(_!==void 0){cl("transaction failed: Data returned ",_,l.path);let E=Oe(_);typeof _=="object"&&_!=null&&Wt(_,".priority")||(E=E.updatePriority(g.getPriority()));let I=l.currentWriteId,O=ul(n),j=qv(E,g,O);l.currentOutputSnapshotRaw=E,l.currentOutputSnapshotResolved=j,l.currentWriteId=Md(n),o.splice(o.indexOf(I),1),i=i.concat(Vv(n.serverSyncTree_,l.path,j,l.currentWriteId,l.applyLocally)),i=i.concat(Kr(n.serverSyncTree_,I,!0))}else h=!0,f="nodata",i=i.concat(Kr(n.serverSyncTree_,l.currentWriteId,!0))}Ut(n.eventQueue_,t,i),i=[],h&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Fd(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Ao(r[a]);Ld(n,n.transactionQueueTree_)}function $C(n,e){let t,r=n.transactionQueueTree_;for(t=ae(e);t!==null&&Hi(r)===void 0;)r=Nd(r,t),e=Te(e),t=ae(e);return r}function zC(n,e){let t=[];return GC(n,e,t),t.sort((r,i)=>r.order-i.order),t}function GC(n,e,t){let r=Hi(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);kd(e,i=>{GC(n,i,t)})}function Fd(n,e){let t=Hi(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,zv(e,t.length>0?t:void 0)}kd(e,r=>{Fd(n,r)})}function Qv(n,e){let t=al($C(n,e)),r=Nd(n.transactionQueueTree_,e);return NL(r,i=>{yy(n,i)}),yy(n,r),OC(r,i=>{yy(n,i)}),t}function yy(n,e){let t=Hi(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(V(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(V(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Kr(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?zv(e,void 0):t.length=s+1,Ut(n.eventQueue_,al(e),i);for(let o=0;o<r.length;o++)Ao(r[o])}}function ZL(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function eF(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):yt(`Invalid query segment '${t}' in query '${n}'`)}return e}var uv=function(n,e){let t=tF(n),r=t.namespace;t.domain==="firebase.com"&&Fn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Fn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||NM();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Zh(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new me(t.pathString)}},tF=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(i=ZL(n.substring(h,f)));let g=eF(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;let _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let E=e.indexOf(".");r=e.substring(0,E).toLowerCase(),t=e.substring(E+1),s=r}"ns"in g&&(s=g.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var US="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",nF=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=US.charAt(t%64),t=Math.floor(t/64);V(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=US.charAt(e[i]);return V(o.length===20,"nextPushId: Length should be 20."),o}}();var yd=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+We(this.snapshot.exportVal())}},vd=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var tl=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return V(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var wd=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new tt;return GL(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Vt("OnDisconnect.remove",this._path);let e=new tt;return VS(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Vt("OnDisconnect.set",this._path),Un("OnDisconnect.set",e,this._path,!1);let t=new tt;return VS(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Vt("OnDisconnect.setWithPriority",this._path),Un("OnDisconnect.setWithPriority",e,this._path,!1),Gv("OnDisconnect.setWithPriority",t,!1);let r=new tt;return WL(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Vt("OnDisconnect.update",this._path),LC("OnDisconnect.update",e,this._path,!1);let t=new tt;return KL(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var St=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ce(this._path)?null:Sv(this._path)}get ref(){return new jt(this._repo,this._path)}get _queryIdentifier(){let e=AS(this._queryParams),t=Av(e);return t==="{}"?"default":t}get _queryObject(){return AS(this._queryParams)}isEqual(e){if(e=ee(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=Cv(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+l1(this._path)}};function Vd(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function ti(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Ln){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Yr)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==cr)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===Ae){if(e!=null&&!el(e)||t!=null&&!el(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(V(n.getIndex()instanceof Gc||n.getIndex()===Nv,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ud(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var jt=class n extends St{constructor(e,t){super(e,t,new Qc,!1)}get parent(){let e=cC(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},bo=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new me(e),r=ei(this.ref,e);return new n(this._node.getChild(t),r,Ae)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,ei(this.ref,r),Ae)))}hasChild(e){let t=new me(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Yv(n,e){return n=ee(n),n._checkNotDeleted("ref"),e!==void 0?ei(n._root,e):n._root}function Xv(n,e){n=ee(n),n._checkNotDeleted("refFromURL");let t=uv(e,n._repo.repoInfo_.nodeAdmin);FC("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Fn("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Yv(n,t.path.toString())}function ei(n,e){return n=ee(n),ae(n._path)===null?FL("child","path",e,!1):Co("child","path",e,!1),new jt(n._repo,Ne(n._path,e))}function WC(n,e){n=ee(n),Vt("push",n._path),Un("push",e,n._path,!0);let t=BC(n._repo),r=nF(t),i=ei(n,r),s=ei(n,r),o;return e!=null?o=jd(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function KC(n){return Vt("remove",n._path),jd(n,null)}function jd(n,e){n=ee(n),Vt("set",n._path),Un("set",e,n._path,!1);let t=new tt;return Kv(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function HC(n,e){n=ee(n),Vt("setPriority",n._path),Gv("setPriority",e,!1);let t=new tt;return Kv(n._repo,Ne(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function QC(n,e,t){if(Vt("setWithPriority",n._path),Un("setWithPriority",e,n._path,!1),Gv("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new tt;return Kv(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function YC(n,e){LC("update",e,n._path,!1);let t=new tt;return $L(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function XC(n){n=ee(n);let e=new tl(()=>{}),t=new nl(e);return qL(n._repo,n,t).then(r=>new bo(r,new jt(n._repo,n._path),n._queryParams.getIndex()))}var nl=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new yd("value",this,new bo(e.snapshotNode,new jt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new vd(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Ed=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new vd(this,e,t):null}createEvent(e,t){V(e.childName!=null,"Child events should have a childName.");let r=ei(new jt(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new yd(e.type,this,new bo(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function hl(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let l=t,u=(h,f)=>{lv(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new tl(t,s||void 0),a=e==="value"?new nl(o):new Ed(e,o);return HL(n._repo,n,a),()=>lv(n._repo,n,a)}function Bd(n,e,t,r){return hl(n,"value",e,t,r)}function Jv(n,e,t,r){return hl(n,"child_added",e,t,r)}function Zv(n,e,t,r){return hl(n,"child_changed",e,t,r)}function ew(n,e,t,r){return hl(n,"child_moved",e,t,r)}function tw(n,e,t,r){return hl(n,"child_removed",e,t,r)}function nw(n,e,t){let r=null,i=t?new tl(t):null;e==="value"?r=new nl(i):e&&(r=new Ed(e,i)),lv(n._repo,n,r)}var Bt=class{},Td=class extends Bt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Un("endAt",this._value,e._path,!0);let t=jy(e._queryParams,this._value,this._key);if(Ud(t),ti(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}};function JC(n,e){return ll("endAt","key",e,!0),new Td(n,e)}var hv=class extends Bt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Un("endBefore",this._value,e._path,!1);let t=C1(e._queryParams,this._value,this._key);if(Ud(t),ti(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}};function ZC(n,e){return ll("endBefore","key",e,!0),new hv(n,e)}var Id=class extends Bt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Un("startAt",this._value,e._path,!0);let t=Uy(e._queryParams,this._value,this._key);if(Ud(t),ti(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}};function e0(n=null,e){return ll("startAt","key",e,!0),new Id(n,e)}var dv=class extends Bt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Un("startAfter",this._value,e._path,!1);let t=S1(e._queryParams,this._value,this._key);if(Ud(t),ti(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}};function t0(n,e){return ll("startAfter","key",e,!0),new dv(n,e)}var fv=class extends Bt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new St(e._repo,e._path,A1(e._queryParams,this._limit),e._orderByCalled)}};function n0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new fv(n)}var pv=class extends Bt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new St(e._repo,e._path,R1(e._queryParams,this._limit),e._orderByCalled)}};function r0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new pv(n)}var gv=class extends Bt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Vd(e,"orderByChild");let t=new me(this._path);if(ce(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Gc(t),i=Ad(e._queryParams,r);return ti(i),new St(e._repo,e._path,i,!0)}};function i0(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Co("orderByChild","path",n,!1),new gv(n)}var mv=class extends Bt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Vd(e,"orderByKey");let t=Ad(e._queryParams,Ln);return ti(t),new St(e._repo,e._path,t,!0)}};function s0(){return new mv}var _v=class extends Bt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Vd(e,"orderByPriority");let t=Ad(e._queryParams,Ae);return ti(t),new St(e._repo,e._path,t,!0)}};function o0(){return new _v}var yv=class extends Bt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Vd(e,"orderByValue");let t=Ad(e._queryParams,Nv);return ti(t),new St(e._repo,e._path,t,!0)}};function a0(){return new yv}var vv=class extends Bt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Un("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Td(this._value,this._key)._apply(new Id(this._value,this._key)._apply(e))}};function c0(n,e){return ll("equalTo","key",e,!0),new vv(n,e)}function tn(n,...e){let t=ee(n);for(let r of e)t=r._apply(t);return t}lL(jt);pL(jt);var rF="FIREBASE_DATABASE_EMULATOR_HOST",wv={},iF=!1;function sF(n,e,t,r){n.repoInfo_=new Zh(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function rw(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Fn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),st("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=uv(s,i),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[rF]),u?(l=!0,s=`http://${u}?ns=${a.namespace}`,o=uv(s,i),a=o.repoInfo):l=!o.repoInfo.secure;let h=i&&l?new Uc(Uc.OWNER):new by(n.name,n.options,e);FC("Invalid Firebase Database URL",o),ce(o.path)||Fn("Database URL must point to the root of a Firebase Database (not including a child path).");let f=aF(a,n,h,new Iy(n.name,t));return new Ev(f,n)}function oF(n,e){let t=wv[e];(!t||t[n.key]!==n)&&Fn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),qC(n),delete t[n.key]}function aF(n,e,t,r){let i=wv[e.name];i||(i={},wv[e.name]=i);let s=i[n.toURLString()];return s&&Fn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new cv(n,iF,t,r),i[n.toURLString()]=s,s}var Ev=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(jL(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jt(this._repo,ge())),this._rootInternal}_delete(){return this._rootInternal!==null&&(oF(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Fn("Cannot call "+e+" on a deleted database.")}};function l0(){aC.IS_TRANSPORT_INITIALIZED&&yt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function u0(){l0(),$c.forceDisallow()}function h0(){l0(),po.forceDisallow(),$c.forceAllow()}function xB(n=Kn(),e){let t=hi(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let r=hs("database");r&&iw(t,...r)}return t}function iw(n,e,t,r={}){n=ee(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Fn("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Fn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Uc(Uc.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:ds(r.mockUserToken,n.app.options.projectId);s=new Uc(o)}sF(i,e,t,s)}function d0(n){n=ee(n),n._checkNotDeleted("goOffline"),qC(n._repo)}function f0(n){n=ee(n),n._checkNotDeleted("goOnline"),QL(n._repo)}function p0(n,e){$S(n,e)}function cF(n){bv(fs),Wn(new ct("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return rw(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),nt(cS,lS,n),nt(cS,lS,"esm2017")}var lF={".sv":"timestamp"};function g0(){return lF}function m0(n){return{".sv":{increment:n}}}var Tv=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function _0(n,e,t){var r;if(n=ee(n),Vt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new tt,o=(l,u,h)=>{let f=null;l?s.reject(l):(f=new bo(h,new jt(n._repo,n._path),Ae),s.resolve(new Tv(u,f)))},a=Bd(n,()=>{});return YL(n._repo,n._path,e,o,a,i),s.promise}Pv.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Pv.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};cF();var uF="@firebase/database-compat",hF="1.0.5";var dF=new yr("@firebase/database-compat"),y0=function(n){let e="FIREBASE WARNING: "+n;dF.warn(e)};var fF=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(Pt(n,e)+"must be a boolean.")},pF=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Pt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var sw=class{constructor(e){this._delegate=e}cancel(e){J("OnDisconnect.cancel",0,1,arguments.length),Ze("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){J("OnDisconnect.remove",0,1,arguments.length),Ze("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){J("OnDisconnect.set",1,2,arguments.length),Ze("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){J("OnDisconnect.setWithPriority",2,3,arguments.length),Ze("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(J("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,y0("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ze("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var ow=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return J("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Qi=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return J("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return J("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return J("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return J("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return J("DataSnapshot.child",0,1,arguments.length),e=String(e),Co("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return J("DataSnapshot.hasChild",1,1,arguments.length),Co("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return J("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return J("DataSnapshot.forEach",1,1,arguments.length),Ze("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return J("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return J("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return J("DataSnapshot.ref",0,0,arguments.length),new lr(this._database,this._delegate.ref)}get ref(){return this.getRef()}},qd=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;J("Query.on",2,4,arguments.length),Ze("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(u,h)=>{t.call(o.context,new Qi(this.database,u),h)};a.userCallback=t,a.context=o.context;let l=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return Bd(this._delegate,a,l),t;case"child_added":return Jv(this._delegate,a,l),t;case"child_removed":return tw(this._delegate,a,l),t;case"child_changed":return Zv(this._delegate,a,l),t;case"child_moved":return ew(this._delegate,a,l),t;default:throw new Error(Pt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(J("Query.off",0,3,arguments.length),pF("Query.off",e,!0),Ze("Query.off","callback",t,!0),Qf("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,nw(this._delegate,e,i)}else nw(this._delegate,e)}get(){return XC(this._delegate).then(e=>new Qi(this.database,e))}once(e,t,r,i){J("Query.once",1,4,arguments.length),Ze("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new tt,a=(u,h)=>{let f=new Qi(this.database,u);t&&t.call(s.context,f,h),o.resolve(f)};a.userCallback=t,a.context=s.context;let l=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":Bd(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Jv(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":tw(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Zv(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":ew(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(Pt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return J("Query.limitToFirst",1,1,arguments.length),new n(this.database,tn(this._delegate,n0(e)))}limitToLast(e){return J("Query.limitToLast",1,1,arguments.length),new n(this.database,tn(this._delegate,r0(e)))}orderByChild(e){return J("Query.orderByChild",1,1,arguments.length),new n(this.database,tn(this._delegate,i0(e)))}orderByKey(){return J("Query.orderByKey",0,0,arguments.length),new n(this.database,tn(this._delegate,s0()))}orderByPriority(){return J("Query.orderByPriority",0,0,arguments.length),new n(this.database,tn(this._delegate,o0()))}orderByValue(){return J("Query.orderByValue",0,0,arguments.length),new n(this.database,tn(this._delegate,a0()))}startAt(e=null,t){return J("Query.startAt",0,2,arguments.length),new n(this.database,tn(this._delegate,e0(e,t)))}startAfter(e=null,t){return J("Query.startAfter",0,2,arguments.length),new n(this.database,tn(this._delegate,t0(e,t)))}endAt(e=null,t){return J("Query.endAt",0,2,arguments.length),new n(this.database,tn(this._delegate,JC(e,t)))}endBefore(e=null,t){return J("Query.endBefore",0,2,arguments.length),new n(this.database,tn(this._delegate,ZC(e,t)))}equalTo(e,t){return J("Query.equalTo",1,2,arguments.length),new n(this.database,tn(this._delegate,c0(e,t)))}toString(){return J("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return J("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(J("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Ze(e,"cancel",i.cancel,!0),i.context=r,Qf(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(Pt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new lr(this.database,new jt(this._delegate._repo,this._delegate._path))}},lr=class n extends qd{constructor(e,t){super(e,new St(t._repo,t._path,new Qc,!1)),this.database=e,this._delegate=t}getKey(){return J("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return J("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,ei(this._delegate,e))}getParent(){J("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return J("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){J("Reference.set",1,2,arguments.length),Ze("Reference.set","onComplete",t,!0);let r=jd(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(J("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,y0("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Vt("Reference.update",this._delegate._path),Ze("Reference.update","onComplete",t,!0);let r=YC(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){J("Reference.setWithPriority",2,3,arguments.length),Ze("Reference.setWithPriority","onComplete",r,!0);let i=QC(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){J("Reference.remove",0,1,arguments.length),Ze("Reference.remove","onComplete",e,!0);let t=KC(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){J("Reference.transaction",1,3,arguments.length),Ze("Reference.transaction","transactionUpdate",e,!1),Ze("Reference.transaction","onComplete",t,!0),fF("Reference.transaction","applyLocally",r,!0);let i=_0(this._delegate,e,{applyLocally:r}).then(s=>new ow(s.committed,new Qi(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){J("Reference.setPriority",1,2,arguments.length),Ze("Reference.setPriority","onComplete",t,!0);let r=HC(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){J("Reference.push",0,2,arguments.length),Ze("Reference.push","onComplete",t,!0);let r=WC(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return Vt("Reference.onDisconnect",this._delegate._path),new sw(new wd(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Yi=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:u0,forceLongPolling:h0}}useEmulator(e,t,r={}){iw(this._delegate,e,t,r)}ref(e){if(J("database.ref",0,1,arguments.length),e instanceof lr){let t=Xv(this._delegate,e.toString());return new lr(this,t)}else{let t=Yv(this._delegate,e);return new lr(this,t)}}refFromURL(e){J("database.refFromURL",1,1,arguments.length);let r=Xv(this._delegate,e);return new lr(this,r)}goOffline(){return J("database.goOffline",0,0,arguments.length),d0(this._delegate)}goOnline(){return J("database.goOnline",0,0,arguments.length),f0(this._delegate)}};Yi.ServerValue={TIMESTAMP:g0(),increment:n=>m0(n)};function gF({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){bv(t);let a=new Yf("database-standalone"),l=new Zl("auth-internal",a);l.setComponent(new ct("auth-internal",()=>r,"PRIVATE"));let u;return i&&(u=new Zl("app-check-internal",a),u.setComponent(new ct("app-check-internal",()=>i,"PRIVATE"))),{instance:new Yi(rw(n,l,u,e,o),n),namespace:s}}var mF=Object.freeze({__proto__:null,initStandalone:gF});var _F=Yi.ServerValue;function yF(n){n.INTERNAL.registerComponent(new ct("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Yi(i,r)},"PUBLIC").setServiceProps({Reference:lr,Query:qd,Database:Yi,DataSnapshot:Qi,enableLogging:p0,INTERNAL:mF,ServerValue:_F}).setMultipleInstances(!0)),n.registerVersion(uF,hF)}yF(Ce);function dl(n,e,t="on",r=rs){return new kt(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Q(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),OE())}function vF(n){return typeof n=="string"}function wF(n){return typeof n.exportVal=="function"}function I0(n){return n==null}function b0(n){return typeof n.set=="function"}function v0(n,e){return b0(e)?e:n.ref(e)}function A0(n,e){if(vF(n))return e.stringCase();if(b0(n))return e.firebaseCase();if(wF(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function R0(n){return(I0(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function S0(n,e,t){e=R0(e);let r=e.map(i=>dl(n,i,"on",t));return ia(...r)}function EF(n,e,t){let r=S0(n,e).pipe(Gn((i,s)=>[...i,s],[]));return IF(n,r,t)}function TF(n,e){return dl(n,"value","on",e).pipe(Q(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function IF(n,e,t){return TF(n,t).pipe(FE(e),Q(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(l=>l.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),ME(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Q(i=>i.actions))}function w0(n,e){return function(r,i){return A0(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function bF(n){return function(t){return t?A0(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function AF(n,e,t){return dl(n,"value","once",t).pipe(we(r=>{let i=[W(r)];return e.forEach(s=>i.push(dl(n,s,"on",t))),ia(...i).pipe(Gn(SF,[]))}),Ml())}function C0(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function RF(n,e){if(I0(e))return 0;{let t=C0(n,e);return t===-1?n.length:t+1}}function SF(n,e){let{payload:t,prevKey:r,key:i}=e,s=C0(n,i),o=RF(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let u={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function E0(n,e,t){return e=R0(e),AF(n,e,t)}function CF(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:w0(r,"update"),set:w0(r,"set"),push:i=>r.push(i),remove:bF(r),snapshotChanges(i){return E0(n,i,t).pipe(Pe)},stateChanges(i){return S0(n,i,t).pipe(Pe)},auditTrail(i){return EF(n,i,t).pipe(Pe)},valueChanges(i,s){return E0(n,i,t).pipe(Q(a=>a.map(l=>s&&s.idField?Fe(G({},l.payload.val()),{[s.idField]:l.key}):l.payload.val())),Pe)}}}function T0(n,e){return function(){return dl(n,"value","on",e)}}function PF(n,e){return{query:n,snapshotChanges(){return T0(n,e.schedulers.outsideAngular)().pipe(Pe)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return T0(n,e.schedulers.outsideAngular)().pipe(Pe,Q(r=>r.payload.exists()?r.payload.val():null))}}}var DF=new te("angularfire2.realtimeDatabaseURL"),NF=new te("angularfire2.database.use-emulator"),P0=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,l,u,h,f,g,_,E,S,I){this.schedulers=a;let O=l,j=Xn(t,o,r);u&&Ga(j,o,h,g,_,E,f,S),this.database=Rr(`${j.name}.database.${i}`,"AngularFireDatabase",j.name,()=>{let x=o.runOutsideAngular(()=>j.database(i||void 0));return O&&x.useEmulator(...O),x},[O])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>v0(this.database,t)),s=i;return r&&(s=r(i)),CF(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>v0(this.database,t));return PF(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(F(In),F(bn,8),F(DF,8),F(Je),F(Ve),F(Tn),F(NF,8),F(bs,8),F(Ua,8),F(ja,8),F(Ba,8),F(qa,8),F($a,8),F(za,8),F(on,8))};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var V0="firebasestorage.googleapis.com",U0="storageBucket",xF=2*60*1e3,OF=10*60*1e3,MF=1e3;var Me=class n extends Yl{constructor(e,t,r=0){super(aw(e),`Firebase Storage: ${t} (${aw(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return aw(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},ke=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(ke||{});function aw(n){return"storage/"+n}function gw(){let n="An unknown error occurred, please check the error payload for server response.";return new Me(ke.UNKNOWN,n)}function LF(n){return new Me(ke.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function FF(n){return new Me(ke.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function VF(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Me(ke.UNAUTHENTICATED,n)}function UF(){return new Me(ke.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function jF(n){return new Me(ke.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function j0(){return new Me(ke.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function B0(){return new Me(ke.CANCELED,"User canceled the upload/download.")}function BF(n){return new Me(ke.INVALID_URL,"Invalid URL '"+n+"'.")}function qF(n){return new Me(ke.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function $F(){return new Me(ke.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+U0+"' property when initializing the app?")}function q0(){return new Me(ke.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function zF(){return new Me(ke.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function GF(){return new Me(ke.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function WF(n){return new Me(ke.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Xi(n){return new Me(ke.INVALID_ARGUMENT,n)}function $0(){return new Me(ke.APP_DELETED,"The Firebase app was deleted.")}function mw(n){return new Me(ke.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function pl(n,e){return new Me(ke.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function fl(n){throw new Me(ke.INTERNAL_ERROR,"Internal error: "+n)}var Ct=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw qF(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(U){U.path.charAt(U.path.length-1)==="/"&&(U.path_=U.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),l={bucket:1,path:3};function u(U){U.path_=decodeURIComponent(U.path)}let h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",_=new RegExp(`^https?://${f}/${h}/b/${i}/o${g}`,"i"),E={bucket:1,path:3},S=t===V0?"(?:storage.googleapis.com|storage.cloud.google.com)":t,I="([^?#]*)",O=new RegExp(`^https?://${S}/${i}/${I}`,"i"),x=[{regex:a,indices:l,postModify:s},{regex:_,indices:E,postModify:u},{regex:O,indices:{bucket:1,path:2},postModify:u}];for(let U=0;U<x.length;U++){let Y=x[U],H=Y.regex.exec(e);if(H){let T=H[Y.indices.bucket],y=H[Y.indices.path];y||(y=""),r=new n(T,y),Y.postModify(r);break}}if(r==null)throw BF(e);return r}},lw=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function KF(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function l(){return a===2}let u=!1;function h(...I){u||(u=!0,e.apply(null,I))}function f(I){i=setTimeout(()=>{i=null,n(_,l())},I)}function g(){s&&clearTimeout(s)}function _(I,...O){if(u){g();return}if(I){g(),h.call(null,I,...O);return}if(l()||o){g(),h.call(null,I,...O);return}r<64&&(r*=2);let x;a===1?(a=2,x=0):x=(r+Math.random())*1e3,f(x)}let E=!1;function S(I){E||(E=!0,g(),!u&&(i!==null?(I||(a=2),clearTimeout(i),f(0)):I||(a=1)))}return f(0),s=setTimeout(()=>{o=!0,S(!0)},t),S}function HF(n){n(!1)}function QF(n){return n!==void 0}function YF(n){return typeof n=="function"}function XF(n){return typeof n=="object"&&!Array.isArray(n)}function Gd(n){return typeof n=="string"||n instanceof String}function D0(n){return _w()&&n instanceof Blob}function _w(){return typeof Blob<"u"}function uw(n,e,t,r){if(r<e)throw Xi(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Xi(`Invalid value for '${n}'. Expected ${t} or less.`)}function ni(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function z0(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var ko=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(ko||{});function G0(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var hw=class{constructor(e,t,r,i,s,o,a,l,u,h,f,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=h,this.connectionFactory_=f,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,E)=>{this.resolve_=_,this.reject_=E,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new No(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=a=>{let l=a.loaded,u=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let a=s.getErrorCode()===ko.NO_ERROR,l=s.getStatus();if(!a||G0(l,this.additionalRetryCodes_)&&this.retry){let h=s.getErrorCode()===ko.ABORT;r(!1,new No(!1,null,h));return}let u=this.successCodes_.indexOf(l)!==-1;r(!0,new No(u,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let l=this.callback_(a,a.getResponse());QF(l)?s(l):s()}catch(l){o(l)}else if(a!==null){let l=gw();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(i.canceled){let l=this.appDelete_?$0():B0();o(l)}else{let l=j0();o(l)}};this.canceled_?t(!1,new No(!1,null,!0)):this.backoffId_=KF(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&HF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},No=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function JF(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function ZF(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function eV(n,e){e&&(n["X-Firebase-GMPID"]=e)}function tV(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function nV(n,e,t,r,i,s,o=!0){let a=z0(n.urlParams),l=n.url+a,u=Object.assign({},n.headers);return eV(u,e),JF(u,t),ZF(u,s),tV(u,r),new hw(l,n.method,u,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function rV(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function iV(...n){let e=rV();if(e!==void 0){let t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(_w())return new Blob(n);throw new Me(ke.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function sV(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function oV(n){if(typeof atob>"u")throw WF("base-64");return atob(n)}var qt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},gl=class{constructor(e,t){this.data=e,this.contentType=t||null}};function yw(n,e){switch(n){case qt.RAW:return new gl(W0(e));case qt.BASE64:case qt.BASE64URL:return new gl(K0(n,e));case qt.DATA_URL:return new gl(cV(e),lV(e))}throw gw()}function W0(n){let e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=r,o=n.charCodeAt(++t);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function aV(n){let e;try{e=decodeURIComponent(n)}catch{throw pl(qt.DATA_URL,"Malformed data URL.")}return W0(e)}function K0(n,e){switch(n){case qt.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw pl(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case qt.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw pl(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=oV(e)}catch(i){throw i.message.includes("polyfill")?i:pl(n,"Invalid character found")}let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}var zd=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw pl(qt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;r!=null&&(this.base64=uV(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}};function cV(n){let e=new zd(n);return e.base64?K0(qt.BASE64,e.rest):aV(e.rest)}function lV(n){return new zd(n).contentType}function uV(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}var xo=class n{constructor(e,t){let r=0,i="";D0(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(D0(this.data_)){let r=this.data_,i=sV(r,e,t);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,e,t-e);return new n(r,!0)}}static getBlob(...e){if(_w()){let t=e.map(r=>r instanceof n?r.data_:r);return new n(iV.apply(null,t))}else{let t=e.map(o=>Gd(o)?yw(qt.RAW,o).data:o.data_),r=0;t.forEach(o=>{r+=o.byteLength});let i=new Uint8Array(r),s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new n(i,!0)}}uploadData(){return this.data_}};function vw(n){let e;try{e=JSON.parse(n)}catch{return null}return XF(e)?e:null}function hV(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function dV(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function H0(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function fV(n,e){return e}var ht=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||fV}},$d=null;function pV(n){return!Gd(n)||n.length<2?n:H0(n)}function Wd(){if($d)return $d;let n=[];n.push(new ht("bucket")),n.push(new ht("generation")),n.push(new ht("metageneration")),n.push(new ht("name","fullPath",!0));function e(s,o){return pV(o)}let t=new ht("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new ht("size");return i.xform=r,n.push(i),n.push(new ht("timeCreated")),n.push(new ht("updated")),n.push(new ht("md5Hash",null,!0)),n.push(new ht("cacheControl",null,!0)),n.push(new ht("contentDisposition",null,!0)),n.push(new ht("contentEncoding",null,!0)),n.push(new ht("contentLanguage",null,!0)),n.push(new ht("contentType",null,!0)),n.push(new ht("metadata","customMetadata",!0)),$d=n,$d}function gV(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new Ct(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function mV(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return gV(r,n),r}function Q0(n,e,t){let r=vw(e);return r===null?null:mV(n,r,t)}function _V(n,e,t,r){let i=vw(e);if(i===null||!Gd(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(u=>{let h=n.bucket,f=n.fullPath,g="/b/"+o(h)+"/o/"+o(f),_=ni(g,t,r),E=z0({alt:"media",token:u});return _+E})[0]}function ww(n,e){let t={},r=e.length;for(let i=0;i<r;i++){let s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}var N0="prefixes",k0="items";function yV(n,e,t){let r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[N0])for(let i of t[N0]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new Ct(e,s));r.prefixes.push(o)}if(t[k0])for(let i of t[k0]){let s=n._makeStorageReference(new Ct(e,i.name));r.items.push(s)}return r}function vV(n,e,t){let r=vw(t);return r===null?null:yV(n,e,r)}var gn=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function Bn(n){if(!n)throw gw()}function Kd(n,e){function t(r,i){let s=Q0(n,i,e);return Bn(s!==null),s}return t}function wV(n,e){function t(r,i){let s=vV(n,e,i);return Bn(s!==null),s}return t}function EV(n,e){function t(r,i){let s=Q0(n,i,e);return Bn(s!==null),_V(s,i,n.host,n._protocol)}return t}function Lo(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=UF():i=VF():t.getStatus()===402?i=FF(n.bucket):t.getStatus()===403?i=jF(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function Hd(n){let e=Lo(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=LF(n.path)),s.serverResponse=i.serverResponse,s}return t}function Y0(n,e,t){let r=e.fullServerUrl(),i=ni(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new gn(i,s,Kd(n,t),o);return a.errorHandler=Hd(e),a}function TV(n,e,t,r,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),a=ni(o,n.host,n._protocol),l="GET",u=n.maxOperationRetryTime,h=new gn(a,l,wV(n,e.bucket),u);return h.urlParams=s,h.errorHandler=Lo(e),h}function IV(n,e,t){let r=e.fullServerUrl(),i=ni(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new gn(i,s,EV(n,t),o);return a.errorHandler=Hd(e),a}function bV(n,e,t,r){let i=e.fullServerUrl(),s=ni(i,n.host,n._protocol),o="PATCH",a=ww(t,r),l={"Content-Type":"application/json; charset=utf-8"},u=n.maxOperationRetryTime,h=new gn(s,o,Kd(n,r),u);return h.headers=l,h.body=a,h.errorHandler=Hd(e),h}function AV(n,e){let t=e.fullServerUrl(),r=ni(t,n.host,n._protocol),i="DELETE",s=n.maxOperationRetryTime;function o(l,u){}let a=new gn(r,i,o,s);return a.successCodes=[200,204],a.errorHandler=Hd(e),a}function RV(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function X0(n,e,t){let r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=RV(null,e)),r}function SV(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let x="";for(let U=0;U<2;U++)x=x+Math.random().toString().slice(2);return x}let l=a();o["Content-Type"]="multipart/related; boundary="+l;let u=X0(e,r,i),h=ww(u,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+u.contentType+`\r
\r
`,g=`\r
--`+l+"--",_=xo.getBlob(f,r,g);if(_===null)throw q0();let E={name:u.fullPath},S=ni(s,n.host,n._protocol),I="POST",O=n.maxUploadRetryTime,j=new gn(S,I,Kd(n,t),O);return j.urlParams=E,j.headers=o,j.body=_.uploadData(),j.errorHandler=Lo(e),j}var Oo=class{constructor(e,t,r,i){this.current=e,this.total=t,this.finalized=!!r,this.metadata=i||null}};function Ew(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{Bn(!1)}return Bn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function CV(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),o=X0(e,r,i),a={name:o.fullPath},l=ni(s,n.host,n._protocol),u="POST",h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},f=ww(o,t),g=n.maxUploadRetryTime;function _(S){Ew(S);let I;try{I=S.getResponseHeader("X-Goog-Upload-URL")}catch{Bn(!1)}return Bn(Gd(I)),I}let E=new gn(l,u,_,g);return E.urlParams=a,E.headers=h,E.body=f,E.errorHandler=Lo(e),E}function PV(n,e,t,r){let i={"X-Goog-Upload-Command":"query"};function s(u){let h=Ew(u,["active","final"]),f=null;try{f=u.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Bn(!1)}f||Bn(!1);let g=Number(f);return Bn(!isNaN(g)),new Oo(g,r.size(),h==="final")}let o="POST",a=n.maxUploadRetryTime,l=new gn(t,o,s,a);return l.headers=i,l.errorHandler=Lo(e),l}var x0=256*1024;function DV(n,e,t,r,i,s,o,a){let l=new Oo(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw zF();let u=l.total-l.current,h=u;i>0&&(h=Math.min(h,i));let f=l.current,g=f+h,_="";h===0?_="finalize":u===h?_="upload, finalize":_="upload";let E={"X-Goog-Upload-Command":_,"X-Goog-Upload-Offset":`${l.current}`},S=r.slice(f,g);if(S===null)throw q0();function I(U,Y){let H=Ew(U,["active","final"]),T=l.current+h,y=r.size(),w;return H==="final"?w=Kd(e,s)(U,Y):w=null,new Oo(T,y,H==="final",w)}let O="POST",j=e.maxUploadRetryTime,x=new gn(t,O,I,j);return x.headers=E,x.body=S.uploadData(),x.progressCallback=a||null,x.errorHandler=Lo(n),x}var J0={STATE_CHANGED:"state_changed"},vt={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function cw(n){switch(n){case"running":case"pausing":case"canceling":return vt.RUNNING;case"paused":return vt.PAUSED;case"success":return vt.SUCCESS;case"canceled":return vt.CANCELED;case"error":return vt.ERROR;default:return vt.ERROR}}var dw=class{constructor(e,t,r){if(YF(e)||t!=null||r!=null)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{let s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}};function Do(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}var O0=null,fw=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ko.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ko.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ko.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw fl("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw fl("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw fl("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw fl("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw fl("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},pw=class extends fw{initXhr(){this.xhr_.responseType="text"}};function jn(){return O0?O0():new pw}var ml=class{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=Wd(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(ke.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let s=this.isExponentialBackoffExpired();if(G0(i.status,[]))if(s)i=j0();else{this.sleepTime=Math.max(this.sleepTime*2,MF),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(ke.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{let r=CV(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,jn,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let e=this._uploadUrl;this._resolveToken((t,r)=>{let i=PV(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,jn,t,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let e=x0*this._chunkMultiplier,t=new Oo(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=DV(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}let a=this._ref.storage._makeRequest(o,jn,i,s,!1);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){x0*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{let r=Y0(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,jn,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{let r=SV(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,jn,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){let t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=B0(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let e=cw(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,i){let s=new dw(t||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){let t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(cw(this._state)){case vt.SUCCESS:Do(this._resolve.bind(null,this.snapshot))();break;case vt.CANCELED:case vt.ERROR:let t=this._reject;Do(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(cw(this._state)){case vt.RUNNING:case vt.PAUSED:e.next&&Do(e.next.bind(e,this.snapshot))();break;case vt.SUCCESS:e.complete&&Do(e.complete.bind(e))();break;case vt.CANCELED:case vt.ERROR:e.error&&Do(e.error.bind(e,this._error))();break;default:e.error&&Do(e.error.bind(e,this._error))()}}resume(){let e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){let e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){let e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}};var Mo=class n{constructor(e,t){this._service=e,t instanceof Ct?this._location=t:this._location=Ct.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new Ct(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return H0(this._location.path)}get storage(){return this._service}get parent(){let e=hV(this._location.path);if(e===null)return null;let t=new Ct(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw mw(e)}};function NV(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new ml(n,new xo(e),t)}function kV(n){let e={prefixes:[],items:[]};return Z0(n,e).then(()=>e)}function Z0(n,e,t){return P(this,null,function*(){let i=yield eP(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield Z0(n,e,i.nextPageToken))})}function eP(n,e){e!=null&&typeof e.maxResults=="number"&&uw("options.maxResults",1,1e3,e.maxResults);let t=e||{},r=TV(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,jn)}function xV(n){n._throwIfRoot("getMetadata");let e=Y0(n.storage,n._location,Wd());return n.storage.makeRequestWithTokens(e,jn)}function OV(n,e){n._throwIfRoot("updateMetadata");let t=bV(n.storage,n._location,e,Wd());return n.storage.makeRequestWithTokens(t,jn)}function MV(n){n._throwIfRoot("getDownloadURL");let e=IV(n.storage,n._location,Wd());return n.storage.makeRequestWithTokens(e,jn).then(t=>{if(t===null)throw GF();return t})}function LV(n){n._throwIfRoot("deleteObject");let e=AV(n.storage,n._location);return n.storage.makeRequestWithTokens(e,jn)}function tP(n,e){let t=dV(n._location.path,e),r=new Ct(n._location.bucket,t);return new Mo(n.storage,r)}function FV(n){return/^[A-Za-z]+:\/\//.test(n)}function VV(n,e){return new Mo(n,e)}function nP(n,e){if(n instanceof _l){let t=n;if(t._bucket==null)throw $F();let r=new Mo(t,t._bucket);return e!=null?nP(r,e):r}else return e!==void 0?tP(n,e):n}function UV(n,e){if(e&&FV(e)){if(n instanceof _l)return VV(n,e);throw Xi("To use ref(service, url), the first argument must be a Storage instance.")}else return nP(n,e)}function M0(n,e){let t=e?.[U0];return t==null?null:Ct.makeFromBucketSpec(t,n)}function jV(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:ds(i,n.app.options.projectId))}var _l=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=V0,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=xF,this._maxUploadRetryTime=OF,this._requests=new Set,i!=null?this._bucket=Ct.makeFromBucketSpec(i,this._host):this._bucket=M0(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ct.makeFromBucketSpec(this._url,e):this._bucket=M0(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){uw("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){uw("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return P(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return P(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Mo(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new lw($0());{let o=nV(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return P(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},L0="@firebase/storage",F0="0.12.5";var rP="storage";function iP(n,e,t){return n=ee(n),NV(n,e,t)}function sP(n){return n=ee(n),xV(n)}function oP(n,e){return n=ee(n),OV(n,e)}function aP(n,e){return n=ee(n),eP(n,e)}function cP(n){return n=ee(n),kV(n)}function lP(n){return n=ee(n),MV(n)}function uP(n){return n=ee(n),LV(n)}function Tw(n,e){return n=ee(n),UV(n,e)}function hP(n,e){return tP(n,e)}function oq(n=Kn(),e){n=ee(n);let r=hi(n,rP).getImmediate({identifier:e}),i=hs("storage");return i&&Iw(r,...i),r}function Iw(n,e,t,r={}){jV(n,e,t,r)}function BV(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new _l(t,r,i,e,fs)}function qV(){Wn(new ct(rP,BV,"PUBLIC").setMultipleInstances(!0)),nt(L0,F0,""),nt(L0,F0,"esm2017")}qV();var Fo=class{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var Qd=class{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Fo(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new Fo(r,this,this._ref))},t)}on(e,t,r,i){let s;return t&&(typeof t=="function"?s=o=>t(new Fo(o,this,this._ref)):s={next:t.next?o=>t.next(new Fo(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,r||void 0,i||void 0)}},Yd=class{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Ji(e,this._service))}get items(){return this._delegate.items.map(e=>new Ji(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var Ji=class n{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){let t=hP(this._delegate,e);return new n(t,this.storage)}get root(){return new n(this._delegate.root,this.storage)}get parent(){let e=this._delegate.parent;return e==null?null:new n(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Qd(iP(this._delegate,e,t),this)}putString(e,t=qt.RAW,r){this._throwIfRoot("putString");let i=yw(t,e),s=Object.assign({},r);return s.contentType==null&&i.contentType!=null&&(s.contentType=i.contentType),new Qd(new ml(this._delegate,new xo(i.data,!0),s),this)}listAll(){return cP(this._delegate).then(e=>new Yd(e,this.storage))}list(e){return aP(this._delegate,e||void 0).then(t=>new Yd(t,this.storage))}getMetadata(){return sP(this._delegate)}updateMetadata(e){return oP(this._delegate,e)}getDownloadURL(){return lP(this._delegate)}delete(){return this._throwIfRoot("delete"),uP(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw mw(e)}};var Xd=class{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(dP(e))throw Xi("ref() expected a child path but got a URL, use refFromURL instead.");return new Ji(Tw(this._delegate,e),this)}refFromURL(e){if(!dP(e))throw Xi("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Ct.makeFromUrl(e,this._delegate.host)}catch{throw Xi("refFromUrl() expected a valid full URL but got an invalid one.")}return new Ji(Tw(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){Iw(this._delegate,e,t,r)}};function dP(n){return/^[A-Za-z]+:\/\//.test(n)}var $V="@firebase/storage-compat",zV="0.3.8";var GV="storage-compat";function WV(n,{instanceIdentifier:e}){let t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new Xd(t,r)}function KV(n){let e={TaskState:vt,TaskEvent:J0,StringFormat:qt,Storage:Xd,Reference:Ji};n.INTERNAL.registerComponent(new ct(GV,WV,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion($V,zV)}KV(Ce);function HV(n){return new kt(e=>{let t=o=>e.next(o),r=o=>e.error(o),i=()=>e.complete();t(n.snapshot);let s=n.on("state_changed",t);return n.then(o=>{t(o),i()},o=>{t(n.snapshot),r(o)}),function(){s()}}).pipe(NE(0))}function fP(n){let e=HV(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>e,percentageChanges:()=>e.pipe(Q(t=>t.bytesTransferred/t.totalBytes*100))}}function Jd(n){return{getDownloadURL:()=>W(void 0).pipe(Xp,we(()=>n.getDownloadURL()),Pe),getMetadata:()=>W(void 0).pipe(Xp,we(()=>n.getMetadata()),Pe),delete:()=>Ie(n.delete()),child:e=>Jd(n.child(e)),updateMetadata:e=>Ie(n.updateMetadata(e)),put:(e,t)=>{let r=n.put(e,t);return fP(r)},putString:(e,t,r)=>{let i=n.putString(e,t,r);return fP(i)},list:e=>Ie(n.list(e)),listAll:()=>Ie(n.listAll())}}var QV=new te("angularfire2.storageBucket"),YV=new te("angularfire2.storage.maxUploadRetryTime"),XV=new te("angularfire2.storage.maxOperationRetryTime"),JV=new te("angularfire2.storage.use-emulator"),pP=(()=>{class n{storage;constructor(t,r,i,s,o,a,l,u,h,f){let g=Xn(t,o,r);this.storage=Rr(`${g.name}.storage.${i}`,"AngularFireStorage",g.name,()=>{let _=o.runOutsideAngular(()=>g.storage(i||void 0)),E=h;return E&&_.useEmulator(...E),l&&_.setMaxUploadRetryTime(l),u&&_.setMaxOperationRetryTime(u),_},[l,u])}ref(t){return Jd(this.storage.ref(t))}refFromURL(t){return Jd(this.storage.refFromURL(t))}upload(t,r,i){let s=this.storage.ref(t);return Jd(s).put(r,i)}static \u0275fac=function(r){return new(r||n)(F(In),F(bn,8),F(QV,8),F(Je),F(Ve),F(Tn),F(YV,8),F(XV,8),F(JV,8),F(on,8))};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Nq=(()=>{let e=class e{constructor(r,i,s,o){this.auth=r,this.firestore=i,this.db=s,this.storage=o,this.PATH="Usuarios",this.loguado=!1,this.esAdmin=!1,this.items$=this.db.list(this.PATH).valueChanges()}getAll(){return this.items$}registrar(r){return P(this,null,function*(){let{mail:i,contrase\u00F1a:s,imagenes:o}=r,l=(yield this.auth.createUserWithEmailAndPassword(i,s)).user?.uid;if(l){let u=Array.isArray(o)?o:[o],h=yield this.uploadImages(u,l);yield this.firestore.collection(this.PATH).doc(l).set(Fe(G({},r),{uid:l,imagenes:h}))}})}uploadImages(r,i){return P(this,null,function*(){let s=r.map((o,a)=>{let l=`users/${i}/profile_${a}`;return this.storage.upload(l,o).then(()=>this.storage.ref(l).getDownloadURL().toPromise())});return Promise.all(s)})}login(r,i){return P(this,null,function*(){try{let s=yield this.auth.signInWithEmailAndPassword(r,i);yield this.updateLastLogin(s.user.uid)}catch(s){throw console.error("Error de inicio de sesi\xF3n:",s),s}})}loginWithGoogle(){return P(this,null,function*(){try{let r=new Ce.auth.GoogleAuthProvider,i=yield this.auth.signInWithPopup(r);yield this.updateLastLogin(i.user?.uid)}catch(r){throw console.error("Error de inicio de sesi\xF3n con Google:",r),r}})}updateLastLogin(r){return P(this,null,function*(){let i=new Date;yield this.firestore.collection(this.PATH).doc(r).update({lastLogin:i})})}guardarUsuarioFirestore(r,i,s,o,a,l,u,h,f,g){return P(this,null,function*(){yield this.firestore.collection("Usuarios").doc(r).set({nombre:i,apellido:o,dni:a,obraSocial:l,especialidad:u,mail:s,imagenes:f,aprobado:g,lastLogin:Ce.firestore.FieldValue.serverTimestamp()})})}logout(){return P(this,null,function*(){try{yield this.auth.signOut()}catch(r){throw console.error("Error al cerrar sesi\xF3n:",r),r}})}estaLogueado(){return this.auth.currentUser!==null}usuarioActual(){return new Promise((r,i)=>{this.auth.onAuthStateChanged(s=>{s?this.firestore.collection(this.PATH).doc(s.uid).valueChanges().subscribe(o=>{o?(o.lastLogin=o.lastLogin?o.lastLogin.toDate():null,r(new Is(o.nombre,o.apellido,o.dni,o.edad,o.obraSocial,o.especialidad,"",o.mail,o.imagenes,o.code,o.lastLogin))):i("No se encontr\xF3 el usuario en la base de datos")},o=>i(o)):i("No hay un usuario logueado")})})}getCurrentUser(){return this.auth.authState}getCurrentUserName(){return this.auth.authState.pipe(we(r=>r?this.firestore.collection(this.PATH).doc(r.uid).valueChanges().pipe(we(i=>W(i?.nombre||null))):W(null)))}verificarMensajeExistenteAlIniciarSesion(){return P(this,null,function*(){let r=Ce.auth().currentUser;if(!r){console.error("Usuario no autenticado al verificar el mensaje existente al iniciar sesi\xF3n");return}let i=yield this.firestore.collection("messages").ref.where("userEmail","==",r.email).get();if(i.empty){console.log("No hay mensajes existentes para este usuario al iniciar sesi\xF3n");return}let s=this.firestore.firestore.batch();i.forEach(o=>{s.delete(o.ref)}),yield s.commit(),console.log("Mensajes existentes eliminados para este usuario al iniciar sesi\xF3n")})}getAllUsers(){return this.firestore.collection(this.PATH).snapshotChanges().pipe(Q(r=>r.map(i=>{let s=i.payload.doc.data();return new Is(s.nombre,s.apellido,s.dni,s.edad,s.obraSocial,s.especialidad,"",s.mail,s.imagenes,s.code,s.lastLogin?s.lastLogin.toDate():null)})))}obtenerSolicitudesEspecialistas(){return this.firestore.collection(this.PATH,r=>r.where("especialidad","!=",null).where("aprobado","==",!1)).snapshotChanges().pipe(Q(r=>r.map(i=>{let s=i.payload.doc.data();return new Is(s.nombre,s.apellido,s.dni,s.edad,s.obraSocial,s.especialidad,"",s.mail,s.imagenes,s.code,s.lastLogin?s.lastLogin.toDate():null)})))}aceptarEspecialista(r){return P(this,null,function*(){yield this.firestore.collection(this.PATH).doc(r).update({aprobado:!0})})}};e.\u0275fac=function(i){return new(i||e)(F(bs),F(hy),F(P0),F(pP))},e.\u0275prov=oe({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{dU as a,RT as b,GU as c,mN as d,Hp as e,I2 as f,b2 as g,Is as h,an as i,U2 as j,Uk as k,on as l,Tn as m,Fa as n,Jp as o,X2 as p,Cj as q,rB as r,SB as s,xB as t,oq as u,Nq as v};
