import{o as vs}from"./chunk-TQDNXVMP.js";import{H as ue,I as cn,L as rt,M as Is,N as ii,O as xa,P as md,R as si,S as Ts,T as Ke,U as qe,c as ld,f as hd,g as Pa,h as dd,i as ri,m as Ca,n as Es,o as fd,p as gd,y as Da}from"./chunk-XVKEA2E4.js";import{$ as Se,Aa as Ft,Db as Ra,F as id,H as sd,K as ps,L as _s,Ma as nt,N as Sa,P as ys,Q as un,R as ba,T as od,Y as zn,Z as ei,ba as J,c as Bn,da as ti,f as td,ga as ni,h as ms,i as nd,ja as ad,k as kt,l as jn,m as Vt,n as Nt,r as Fe,ta as ud,tb as cd,ub as ws,x as rd,y as Zr}from"./chunk-75HCPL27.js";import{a as gs,b as Ta,i as Aa,j as C}from"./chunk-GLKGYJID.js";var Wp="firebase",Hp="10.12.2";qe.registerVersion(Wp,Hp,"app-compat");var Jp="firebase",Xp="10.12.2";Ke(Jp,Xp,"app");var _t=new cd("ANGULARFIRE2_VERSION");function nv(r,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(r).getImmediate({optional:!0})}var Yp=(r,e)=>{let t=e?[e]:Ts(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(a=>{n.includes(a)||n.push(a)})}),n},ln=class{constructor(){return Yp(Zp)}},Zp="app-check";function ka(){}var As=class{zone;delegate;constructor(e,t=nd){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(s,t,n)}},Va=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ka,{},ka,ka)),t.pipe(od({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Gn=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new As(Zone.current)),this.insideAngular=t.run(()=>new As(Zone.current,ms)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)(J(nt))};static \u0275prov=zn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function pd(){let r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return r}function rv(r){return r.pipe(kt(pd().outsideAngular))}function Ue(r){return e_(pd())(r)}function e_(r){return function(t){return t=t.lift(new Va(r.ngZone)),t.pipe(jn(r.outsideAngular),kt(r.insideAngular))}}var oi=class{constructor(e){return e}},Fa=class{constructor(){return Ts()}};function t_(r){return r&&r.length===1?r[0]:new oi(si())}var Ma=new Se("angularfire2._apps"),n_={provide:oi,useFactory:t_,deps:[[new ti,Ma]]},r_={provide:Fa,deps:[[new ti,Ma]]};function i_(r){return(e,t)=>{let n=t.get(Ft);Ke("angularfire",_t.full,"core"),Ke("angularfire",_t.full,"app"),Ke("angular",ws.full,n.toString());let i=e.runOutsideAngular(()=>r(t));return new oi(i)}}function mv(r,...e){return ad([n_,r_,{provide:Ma,useFactory:i_(r),multi:!0,deps:[nt,ud,Gn,...e]}])}var s_=["ngOnDestroy"],wd=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(s_.indexOf(s)>-1)return()=>{};let a=e.toPromise().then(u=>{let c=u?.[s];return typeof c=="function"?c.bind(u):c?.then?c.then(d=>t.run(()=>d)):t.run(()=>c)});return new Proxy(()=>{},{get:(u,c)=>a[c],apply:(u,c,d)=>a.then(f=>{let m=f?.(...d);return n?.spy?.apply&&n.spy.apply(s,d,m),m})})})});var Ss=class{constructor(e){return e}},Kn=new Se("angularfire2.app.options"),$n=new Se("angularfire2.app.name");function ai(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let a=qe.apps.filter(u=>u&&u.name===i.name)[0]||e.runOutsideAngular(()=>qe.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(a.options)){let u=!!module.hot;o_("error",`${a.name} Firebase App already initialized with different options${u?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Ss(a)}var o_=(r,...e)=>{Ra()&&typeof console<"u"&&console[r](...e)},a_={provide:Ss,useFactory:ai,deps:[Kn,nt,[new ti,$n]]},Tv=(()=>{class r{static initializeApp(t,n){return{ngModule:r,providers:[{provide:Kn,useValue:t},{provide:$n,useValue:n}]}}constructor(t){qe.registerVersion("angularfire",_t.full,"core"),qe.registerVersion("angularfire",_t.full,"app-compat"),qe.registerVersion("angular",ws.full,t.toString())}static \u0275fac=function(n){return new(n||r)(J(Ft))};static \u0275mod=ni({type:r});static \u0275inj=ei({providers:[a_]})}return r})();function bs(r,e,t,n,i){let[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(u=>u[0]===r)||[];if(s)return u_(i,a)||(yd("error",`${e} was already initialized on the ${t} Firebase App with different settings.${c_?" You may need to reload as Firebase is not HMR aware.":""}`),yd("warn",{is:i,was:a})),s;{let u=n();return globalThis.\u0275AngularfireInstanceCache.push([r,u,i]),u}}function u_(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var c_=typeof module<"u"&&!!module.hot,yd=(r,...e)=>{Ra()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var l_=new Map,h_={activated:!1,tokenObservers:[]},d_={initialized:!1,enabled:!1};function Xe(r){return l_.get(r)||Object.assign({},h_)}function Ad(){return d_}var f_="https://content-firebaseappcheck.googleapis.com/v1";var g_="exchangeDebugToken",vd={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Vv=24*60*60*1e3;var La=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return C(this,null,function*(){this.stop();try{this.pending=new Pa,this.pending.promise.catch(t=>{}),yield m_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Pa,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function m_(r){return new Promise(e=>{setTimeout(e,r)})}var p_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Mt=new gd("appCheck","AppCheck",p_);function Sd(r){if(!Xe(r).activated)throw Mt.create("use-before-activation",{appName:r.name})}function bd(n,i){return C(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let A=yield a.getHeartbeatsHeader();A&&(s["X-Firebase-Client"]=A)}let u={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(r,u)}catch(A){throw Mt.create("fetch-network-error",{originalErrorMessage:A?.message})}if(c.status!==200)throw Mt.create("fetch-status-error",{httpStatus:c.status});let d;try{d=yield c.json()}catch(A){throw Mt.create("fetch-parse-error",{originalErrorMessage:A?.message})}let f=d.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw Mt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let m=Number(f[1])*1e3,_=Date.now();return{token:d.token,expireTimeMillis:_+m,issuedAtTimeMillis:_}})}function Rd(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${f_}/projects/${t}/apps/${n}:${g_}?key=${i}`,body:{debug_token:e}}}var __="firebase-app-check-database",y_=1,qa="firebase-app-check-store";var Rs=null;function w_(){return Rs||(Rs=new Promise((r,e)=>{try{let t=indexedDB.open(__,y_);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(Mt.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(qa,{keyPath:"compositeKey"})}}}catch(t){e(Mt.create("storage-open",{originalErrorMessage:t?.message}))}}),Rs)}function v_(r,e){return E_(I_(r),e)}function E_(r,e){return C(this,null,function*(){let n=(yield w_()).transaction(qa,"readwrite"),s=n.objectStore(qa).put({compositeKey:r,value:e});return new Promise((a,u)=>{s.onsuccess=c=>{a()},n.onerror=c=>{var d;u(Mt.create("storage-set",{originalErrorMessage:(d=c.target.error)===null||d===void 0?void 0:d.message}))}})})}function I_(r){return`${r.options.appId}-${r.name}`}var Ua=new Is("@firebase/app-check");function Oa(r,e){return Es()?v_(r,e).catch(t=>{Ua.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Pd(){return Ad().enabled}function Cd(){return C(this,null,function*(){let r=Ad();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var T_={error:"UNKNOWN_ERROR"};function A_(r){return ld.encodeString(JSON.stringify(r),!1)}function Ba(r,e=!1){return C(this,null,function*(){let t=r.app;Sd(t);let n=Xe(t),i=n.token,s;if(i&&!ui(i)&&(n.token=void 0,i=void 0),!i){let c=yield n.cachedTokenPromise;c&&(ui(c)?i=c:yield Oa(t,void 0))}if(!e&&i&&ui(i))return{token:i.token};let a=!1;if(Pd()){n.exchangeTokenPromise||(n.exchangeTokenPromise=bd(Rd(t,yield Cd()),r.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),a=!0);let c=yield n.exchangeTokenPromise;return yield Oa(t,c),n.token=c,{token:c.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),a=!0),i=yield Xe(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Ua.warn(c.message):Ua.error(c),s=c}let u;return i?s?ui(i)?u={token:i.token,internalError:s}:u=Id(s):(u={token:i.token},n.token=i,yield Oa(t,i)):u=Id(s),a&&P_(t,u),u})}function S_(r){return C(this,null,function*(){let e=r.app;Sd(e);let{provider:t}=Xe(e);if(Pd()){let n=yield Cd(),{token:i}=yield bd(Rd(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function b_(r,e,t,n){let{app:i}=r,s=Xe(i),a={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&ui(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),Ed(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Ed(r))}function Dd(r,e){let t=Xe(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function Ed(r){let{app:e}=r,t=Xe(e),n=t.tokenRefresher;n||(n=R_(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function R_(r){let{app:e}=r;return new La(()=>C(this,null,function*(){let t=Xe(e),n;if(t.token?n=yield Ba(r,!0):n=yield Ba(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=Xe(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},vd.RETRIAL_MIN_WAIT,vd.RETRIAL_MAX_WAIT)}function P_(r,e){let t=Xe(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function ui(r){return r.expireTimeMillis-Date.now()>0}function Id(r){return{token:A_(T_),error:r}}var ja=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Xe(this.app);for(let t of e)Dd(this.app,t.next);return Promise.resolve()}};function C_(r,e){return new ja(r,e)}function D_(r){return{getToken:e=>Ba(r,e),getLimitedUseToken:()=>S_(r),addTokenListener:e=>b_(r,"INTERNAL",e),removeTokenListener:e=>Dd(r.app,e)}}var x_="@firebase/app-check",k_="0.8.4";var V_="app-check",Td="app-check-internal";function N_(){ii(new cn(V_,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return C_(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(Td).initialize()})),ii(new cn(Td,r=>{let e=r.getProvider("app-check").getImmediate();return D_(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ke(x_,k_)}N_();var F_=["localhost","0.0.0.0","127.0.0.1"],Kv=typeof window<"u"&&F_.includes(window.location.hostname);var za=new Se("angularfire2.auth.use-emulator"),Ga=new Se("angularfire2.auth.settings"),Ka=new Se("angularfire2.auth.tenant-id"),$a=new Se("angularfire2.auth.langugage-code"),Qa=new Se("angularfire2.auth.use-device-language"),Wa=new Se("angularfire.auth.persistence"),Ha=(r,e,t,n,i,s,a,u)=>bs(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let c=e.runOutsideAngular(()=>r.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=i,s&&c.useDeviceLanguage(),a)for(let[d,f]of Object.entries(a))c.settings[d]=f;return u&&c.setPersistence(u),c},[t,n,i,s,a,u]),kd=(()=>{class r{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,a,u,c,d,f,m,_,A){let V=new td,N=Nt(void 0).pipe(kt(a.outsideAngular),un(()=>s.runOutsideAngular(()=>import("./chunk-PTHDQQDP.js"))),Fe(()=>ai(t,s,n)),Fe(D=>Ha(D,s,u,d,f,m,c,_)),Sa({bufferSize:1,refCount:!1}));if(vs(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Nt(null);else{N.pipe(sd()).subscribe();let D=N.pipe(un(M=>M.getRedirectResult().then(G=>G,()=>null)),Ue,Sa({bufferSize:1,refCount:!1})),j=N.pipe(un(M=>new Bn(G=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(K=>G.next(K),K=>G.error(K),()=>G.complete()))})))),z=N.pipe(un(M=>new Bn(G=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(K=>G.next(K),K=>G.error(K),()=>G.complete()))}))));this.authState=D.pipe(ba(j),jn(a.outsideAngular),kt(a.insideAngular)),this.user=D.pipe(ba(z),jn(a.outsideAngular),kt(a.insideAngular)),this.idToken=this.user.pipe(un(M=>M?Vt(M.getIdToken()):Nt(null))),this.idTokenResult=this.user.pipe(un(M=>M?Vt(M.getIdTokenResult()):Nt(null))),this.credential=rd(D,V,this.authState.pipe(Zr(M=>!M))).pipe(Fe(M=>M?.user?M:null),jn(a.outsideAngular),kt(a.insideAngular))}return wd(this,N,s,{spy:{apply:(D,j,z)=>{(D.startsWith("signIn")||D.startsWith("createUser"))&&z.then(M=>V.next(M))}}})}static \u0275fac=function(n){return new(n||r)(J(Kn),J($n,8),J(Ft),J(nt),J(Gn),J(za,8),J(Ga,8),J(Ka,8),J($a,8),J(Qa,8),J(Wa,8),J(ln,8))};static \u0275prov=zn({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var Vd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Nd={};var Ot,Ja;(function(){var r;function e(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(E,I,S){for(var y=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)y[gt-2]=arguments[gt];return p.prototype[I].apply(E,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var E=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)E[I]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(I=0;16>I;++I)E[I]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],I=v.g[2];var S=v.g[3],y=p+(S^w&(I^S))+E[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=S+(I^p&(w^I))+E[1]+3905402710&4294967295,S=p+(y<<12&4294967295|y>>>20),y=I+(w^S&(p^w))+E[2]+606105819&4294967295,I=S+(y<<17&4294967295|y>>>15),y=w+(p^I&(S^p))+E[3]+3250441966&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(S^w&(I^S))+E[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=S+(I^p&(w^I))+E[5]+1200080426&4294967295,S=p+(y<<12&4294967295|y>>>20),y=I+(w^S&(p^w))+E[6]+2821735955&4294967295,I=S+(y<<17&4294967295|y>>>15),y=w+(p^I&(S^p))+E[7]+4249261313&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(S^w&(I^S))+E[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=S+(I^p&(w^I))+E[9]+2336552879&4294967295,S=p+(y<<12&4294967295|y>>>20),y=I+(w^S&(p^w))+E[10]+4294925233&4294967295,I=S+(y<<17&4294967295|y>>>15),y=w+(p^I&(S^p))+E[11]+2304563134&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(S^w&(I^S))+E[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=S+(I^p&(w^I))+E[13]+4254626195&4294967295,S=p+(y<<12&4294967295|y>>>20),y=I+(w^S&(p^w))+E[14]+2792965006&4294967295,I=S+(y<<17&4294967295|y>>>15),y=w+(p^I&(S^p))+E[15]+1236535329&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(I^S&(w^I))+E[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=S+(w^I&(p^w))+E[6]+3225465664&4294967295,S=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(S^p))+E[11]+643717713&4294967295,I=S+(y<<14&4294967295|y>>>18),y=w+(S^p&(I^S))+E[0]+3921069994&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^S&(w^I))+E[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=S+(w^I&(p^w))+E[10]+38016083&4294967295,S=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(S^p))+E[15]+3634488961&4294967295,I=S+(y<<14&4294967295|y>>>18),y=w+(S^p&(I^S))+E[4]+3889429448&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^S&(w^I))+E[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=S+(w^I&(p^w))+E[14]+3275163606&4294967295,S=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(S^p))+E[3]+4107603335&4294967295,I=S+(y<<14&4294967295|y>>>18),y=w+(S^p&(I^S))+E[8]+1163531501&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^S&(w^I))+E[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=S+(w^I&(p^w))+E[2]+4243563512&4294967295,S=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(S^p))+E[7]+1735328473&4294967295,I=S+(y<<14&4294967295|y>>>18),y=w+(S^p&(I^S))+E[12]+2368359562&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(w^I^S)+E[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=S+(p^w^I)+E[8]+2272392833&4294967295,S=p+(y<<11&4294967295|y>>>21),y=I+(S^p^w)+E[11]+1839030562&4294967295,I=S+(y<<16&4294967295|y>>>16),y=w+(I^S^p)+E[14]+4259657740&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^S)+E[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=S+(p^w^I)+E[4]+1272893353&4294967295,S=p+(y<<11&4294967295|y>>>21),y=I+(S^p^w)+E[7]+4139469664&4294967295,I=S+(y<<16&4294967295|y>>>16),y=w+(I^S^p)+E[10]+3200236656&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^S)+E[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=S+(p^w^I)+E[0]+3936430074&4294967295,S=p+(y<<11&4294967295|y>>>21),y=I+(S^p^w)+E[3]+3572445317&4294967295,I=S+(y<<16&4294967295|y>>>16),y=w+(I^S^p)+E[6]+76029189&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^S)+E[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=S+(p^w^I)+E[12]+3873151461&4294967295,S=p+(y<<11&4294967295|y>>>21),y=I+(S^p^w)+E[15]+530742520&4294967295,I=S+(y<<16&4294967295|y>>>16),y=w+(I^S^p)+E[2]+3299628645&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(I^(w|~S))+E[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=S+(w^(p|~I))+E[7]+1126891415&4294967295,S=p+(y<<10&4294967295|y>>>22),y=I+(p^(S|~w))+E[14]+2878612391&4294967295,I=S+(y<<15&4294967295|y>>>17),y=w+(S^(I|~p))+E[5]+4237533241&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~S))+E[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=S+(w^(p|~I))+E[3]+2399980690&4294967295,S=p+(y<<10&4294967295|y>>>22),y=I+(p^(S|~w))+E[10]+4293915773&4294967295,I=S+(y<<15&4294967295|y>>>17),y=w+(S^(I|~p))+E[1]+2240044497&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~S))+E[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=S+(w^(p|~I))+E[15]+4264355552&4294967295,S=p+(y<<10&4294967295|y>>>22),y=I+(p^(S|~w))+E[6]+2734768916&4294967295,I=S+(y<<15&4294967295|y>>>17),y=w+(S^(I|~p))+E[13]+1309151649&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~S))+E[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=S+(w^(p|~I))+E[11]+3174756917&4294967295,S=p+(y<<10&4294967295|y>>>22),y=I+(p^(S|~w))+E[2]+718787259&4294967295,I=S+(y<<15&4294967295|y>>>17),y=w+(S^(I|~p))+E[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+S&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,E=this.B,I=this.h,S=0;S<p;){if(I==0)for(;S<=w;)i(this,v,S),S+=this.blockSize;if(typeof v=="string"){for(;S<p;)if(E[I++]=v.charCodeAt(S++),I==this.blockSize){i(this,E),I=0;break}}else for(;S<p;)if(E[I++]=v[S++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var E=0;32>E;E+=8)v[w++]=this.g[p]>>>E&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],E=!0,I=v.length-1;0<=I;I--){var S=v[I]|0;E&&S==p||(w[I]=S,E=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return D(d(-v));for(var p=[],w=1,E=0;v>=w;E++)p[E]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return D(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),E=m,I=0;I<v.length;I+=8){var S=Math.min(8,v.length-I),y=parseInt(v.substring(I,I+S),p);8>S?(S=d(Math.pow(p,S)),E=E.j(S).add(d(y))):(E=E.j(w),E=E.add(d(y)))}return E}var m=c(0),_=c(1),A=c(16777216);r=a.prototype,r.m=function(){if(N(this))return-D(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var E=this.i(w);v+=(0<=E?E:4294967296+E)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(V(this))return"0";if(N(this))return"-"+D(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,E="";;){var I=G(w,p).g;w=j(w,I.j(p));var S=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=I,V(w))return S+E;for(;6>S.length;)S="0"+S;E=S+E}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function V(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function N(v){return v.h==-1}r.l=function(v){return v=j(this,v),N(v)?-1:V(v)?0:1};function D(v){for(var p=v.g.length,w=[],E=0;E<p;E++)w[E]=~v.g[E];return new a(w,~v.h).add(_)}r.abs=function(){return N(this)?D(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],E=0,I=0;I<=p;I++){var S=E+(this.i(I)&65535)+(v.i(I)&65535),y=(S>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);E=y>>>16,S&=65535,y&=65535,w[I]=y<<16|S}return new a(w,w[w.length-1]&-2147483648?-1:0)};function j(v,p){return v.add(D(p))}r.j=function(v){if(V(this)||V(v))return m;if(N(this))return N(v)?D(this).j(D(v)):D(D(this).j(v));if(N(v))return D(this.j(D(v)));if(0>this.l(A)&&0>v.l(A))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],E=0;E<2*p;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<v.g.length;I++){var S=this.i(E)>>>16,y=this.i(E)&65535,gt=v.i(I)>>>16,Nr=v.i(I)&65535;w[2*E+2*I]+=y*Nr,z(w,2*E+2*I),w[2*E+2*I+1]+=S*Nr,z(w,2*E+2*I+1),w[2*E+2*I+1]+=y*gt,z(w,2*E+2*I+1),w[2*E+2*I+2]+=S*gt,z(w,2*E+2*I+2)}for(E=0;E<p;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=p;E<2*p;E++)w[E]=0;return new a(w,0)};function z(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function M(v,p){this.g=v,this.h=p}function G(v,p){if(V(p))throw Error("division by zero");if(V(v))return new M(m,m);if(N(v))return p=G(D(v),p),new M(D(p.g),D(p.h));if(N(p))return p=G(v,D(p)),new M(D(p.g),p.h);if(30<v.g.length){if(N(v)||N(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,E=p;0>=E.l(v);)w=K(w),E=K(E);var I=$(w,1),S=$(E,1);for(E=$(E,2),w=$(w,2);!V(E);){var y=S.add(E);0>=y.l(v)&&(I=I.add(w),S=y),E=$(E,1),w=$(w,1)}return p=j(v,I.j(p)),new M(I,p)}for(I=m;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),S=d(w),y=S.j(p);N(y)||0<y.l(v);)w-=E,S=d(w),y=S.j(p);V(S)&&(S=_),I=I.add(S),v=j(v,y)}return new M(I,v)}r.A=function(v){return G(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],E=0;E<p;E++)w[E]=this.i(E)&v.i(E);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],E=0;E<p;E++)w[E]=this.i(E)|v.i(E);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],E=0;E<p;E++)w[E]=this.i(E)^v.i(E);return new a(w,this.h^v.h)};function K(v){for(var p=v.g.length+1,w=[],E=0;E<p;E++)w[E]=v.i(E)<<1|v.i(E-1)>>>31;return new a(w,v.h)}function $(v,p){var w=p>>5;p%=32;for(var E=v.g.length-w,I=[],S=0;S<E;S++)I[S]=0<p?v.i(S+w)>>>p|v.i(S+w+1)<<32-p:v.i(S+w);return new a(I,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ja=Nd.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Ot=Nd.Integer=a}).apply(typeof Vd<"u"?Vd:typeof self<"u"?self:typeof window<"u"?window:{});var Ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yt={};var Xa,Ya,Qn,Za,ci,Cs,eu,tu,nu;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ps=="object"&&Ps];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=t(this);function i(o,l){if(l)e:{var h=n;o=o.split(".");for(var g=0;g<o.length-1;g++){var T=o[g];if(!(T in h))break e;h=h[T]}o=o[o.length-1],g=h[o],l=l(g),l!=g&&l!=null&&e(h,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var h=0,g=!1,T={next:function(){if(!g&&h<o.length){var R=h++;return{value:l(R,o[R]),done:!1}}return g=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,h){return h})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function m(o,l,h){if(!o)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,g),o.apply(l,T)}}return function(){return o.apply(l,arguments)}}function _(o,l,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,_.apply(null,arguments)}function A(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var g=h.slice();return g.push.apply(g,arguments),o.apply(this,g)}}function V(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(g,T,R){for(var F=Array(arguments.length-2),ne=2;ne<arguments.length;ne++)F[ne-2]=arguments[ne];return l.prototype[T].apply(g,F)}}function N(o){let l=o.length;if(0<l){let h=Array(l);for(let g=0;g<l;g++)h[g]=o[g];return h}return[]}function D(o,l){for(let h=1;h<arguments.length;h++){let g=arguments[h];if(c(g)){let T=o.length||0,R=g.length||0;o.length=T+R;for(let F=0;F<R;F++)o[T+F]=g[F]}else o.push(g)}}class j{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function z(o){return/^[\s\xa0]*$/.test(o)}function M(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function G(o){return G[" "](o),o}G[" "]=function(){};var K=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function $(o,l,h){for(let g in o)l.call(h,o[g],g,o)}function v(o,l){for(let h in o)l.call(void 0,o[h],h,o)}function p(o){let l={};for(let h in o)l[h]=o[h];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let h,g;for(let T=1;T<arguments.length;T++){g=arguments[T];for(h in g)o[h]=g[h];for(let R=0;R<w.length;R++)h=w[R],Object.prototype.hasOwnProperty.call(g,h)&&(o[h]=g[h])}}function I(o){var l=1;o=o.split(":");let h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function S(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Yo;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class gt{constructor(){this.h=this.g=null}add(l,h){let g=Nr.get();g.set(l,h),this.h?this.h.next=g:this.g=g,this.h=g}}var Nr=new j(()=>new gp,o=>o.reset());class gp{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Fr,Mr=!1,Yo=new gt,eh=()=>{let o=u.Promise.resolve(void 0);Fr=()=>{o.then(mp)}};var mp=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){S(h)}var l=Nr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Mr=!1};function Pt(){this.s=this.s,this.C=this.C}Pt.prototype.s=!1,Pt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Pt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Re(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Re.prototype.h=function(){this.defaultPrevented=!0};var pp=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,l),u.removeEventListener("test",h,l)}catch{}return o}();function Or(o,l){if(Re.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,g=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(K){e:{try{G(l.nodeName);var T=!0;break e}catch{}T=!1}T||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:_p[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Or.aa.h.call(this)}}V(Or,Re);var _p={2:"touch",3:"pen",4:"mouse"};Or.prototype.h=function(){Or.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Lr="closure_listenable_"+(1e6*Math.random()|0),yp=0;function wp(o,l,h,g,T){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!g,this.ha=T,this.key=++yp,this.da=this.fa=!1}function Xi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Yi(o){this.src=o,this.g={},this.h=0}Yi.prototype.add=function(o,l,h,g,T){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var F=ea(o,l,g,T);return-1<F?(l=o[F],h||(l.fa=!1)):(l=new wp(l,this.src,R,!!g,T),l.fa=h,o.push(l)),l};function Zo(o,l){var h=l.type;if(h in o.g){var g=o.g[h],T=Array.prototype.indexOf.call(g,l,void 0),R;(R=0<=T)&&Array.prototype.splice.call(g,T,1),R&&(Xi(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ea(o,l,h,g){for(var T=0;T<o.length;++T){var R=o[T];if(!R.da&&R.listener==l&&R.capture==!!h&&R.ha==g)return T}return-1}var ta="closure_lm_"+(1e6*Math.random()|0),na={};function th(o,l,h,g,T){if(g&&g.once)return rh(o,l,h,g,T);if(Array.isArray(l)){for(var R=0;R<l.length;R++)th(o,l[R],h,g,T);return null}return h=oa(h),o&&o[Lr]?o.K(l,h,d(g)?!!g.capture:!!g,T):nh(o,l,h,!1,g,T)}function nh(o,l,h,g,T,R){if(!l)throw Error("Invalid event type");var F=d(T)?!!T.capture:!!T,ne=ia(o);if(ne||(o[ta]=ne=new Yi(o)),h=ne.add(l,h,g,F,R),h.proxy)return h;if(g=vp(),h.proxy=g,g.src=o,g.listener=h,o.addEventListener)pp||(T=F),T===void 0&&(T=!1),o.addEventListener(l.toString(),g,T);else if(o.attachEvent)o.attachEvent(sh(l.toString()),g);else if(o.addListener&&o.removeListener)o.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return h}function vp(){function o(h){return l.call(o.src,o.listener,h)}let l=Ep;return o}function rh(o,l,h,g,T){if(Array.isArray(l)){for(var R=0;R<l.length;R++)rh(o,l[R],h,g,T);return null}return h=oa(h),o&&o[Lr]?o.L(l,h,d(g)?!!g.capture:!!g,T):nh(o,l,h,!0,g,T)}function ih(o,l,h,g,T){if(Array.isArray(l))for(var R=0;R<l.length;R++)ih(o,l[R],h,g,T);else g=d(g)?!!g.capture:!!g,h=oa(h),o&&o[Lr]?(o=o.i,l=String(l).toString(),l in o.g&&(R=o.g[l],h=ea(R,h,g,T),-1<h&&(Xi(R[h]),Array.prototype.splice.call(R,h,1),R.length==0&&(delete o.g[l],o.h--)))):o&&(o=ia(o))&&(l=o.g[l.toString()],o=-1,l&&(o=ea(l,h,g,T)),(h=-1<o?l[o]:null)&&ra(h))}function ra(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[Lr])Zo(l.i,o);else{var h=o.type,g=o.proxy;l.removeEventListener?l.removeEventListener(h,g,o.capture):l.detachEvent?l.detachEvent(sh(h),g):l.addListener&&l.removeListener&&l.removeListener(g),(h=ia(l))?(Zo(h,o),h.h==0&&(h.src=null,l[ta]=null)):Xi(o)}}}function sh(o){return o in na?na[o]:na[o]="on"+o}function Ep(o,l){if(o.da)o=!0;else{l=new Or(l,this);var h=o.listener,g=o.ha||o.src;o.fa&&ra(o),o=h.call(g,l)}return o}function ia(o){return o=o[ta],o instanceof Yi?o:null}var sa="__closure_events_fn_"+(1e9*Math.random()>>>0);function oa(o){return typeof o=="function"?o:(o[sa]||(o[sa]=function(l){return o.handleEvent(l)}),o[sa])}function Pe(){Pt.call(this),this.i=new Yi(this),this.M=this,this.F=null}V(Pe,Pt),Pe.prototype[Lr]=!0,Pe.prototype.removeEventListener=function(o,l,h,g){ih(this,o,l,h,g)};function Ve(o,l){var h,g=o.F;if(g)for(h=[];g;g=g.F)h.push(g);if(o=o.M,g=l.type||l,typeof l=="string")l=new Re(l,o);else if(l instanceof Re)l.target=l.target||o;else{var T=l;l=new Re(g,o),E(l,T)}if(T=!0,h)for(var R=h.length-1;0<=R;R--){var F=l.g=h[R];T=Zi(F,g,!0,l)&&T}if(F=l.g=o,T=Zi(F,g,!0,l)&&T,T=Zi(F,g,!1,l)&&T,h)for(R=0;R<h.length;R++)F=l.g=h[R],T=Zi(F,g,!1,l)&&T}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],g=0;g<h.length;g++)Xi(h[g]);delete o.g[l],o.h--}}this.F=null},Pe.prototype.K=function(o,l,h,g){return this.i.add(String(o),l,!1,h,g)},Pe.prototype.L=function(o,l,h,g){return this.i.add(String(o),l,!0,h,g)};function Zi(o,l,h,g){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var T=!0,R=0;R<l.length;++R){var F=l[R];if(F&&!F.da&&F.capture==h){var ne=F.listener,Ae=F.ha||F.src;F.fa&&Zo(o.i,F),T=ne.call(Ae,g)!==!1&&T}}return T&&!g.defaultPrevented}function oh(o,l,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function ah(o){o.g=oh(()=>{o.g=null,o.i&&(o.i=!1,ah(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Ip extends Pt{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:ah(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qr(o){Pt.call(this),this.h=o,this.g={}}V(qr,Pt);var uh=[];function ch(o){$(o.g,function(l,h){this.g.hasOwnProperty(h)&&ra(l)},o),o.g={}}qr.prototype.N=function(){qr.aa.N.call(this),ch(this)},qr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var aa=u.JSON.stringify,Tp=u.JSON.parse,Ap=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function ua(){}ua.prototype.h=null;function lh(o){return o.h||(o.h=o.i())}function hh(){}var Ur={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ca(){Re.call(this,"d")}V(ca,Re);function la(){Re.call(this,"c")}V(la,Re);var rn={},dh=null;function es(){return dh=dh||new Pe}rn.La="serverreachability";function fh(o){Re.call(this,rn.La,o)}V(fh,Re);function Br(o){let l=es();Ve(l,new fh(l))}rn.STAT_EVENT="statevent";function gh(o,l){Re.call(this,rn.STAT_EVENT,o),this.stat=l}V(gh,Re);function Ne(o){let l=es();Ve(l,new gh(l,o))}rn.Ma="timingevent";function mh(o,l){Re.call(this,rn.Ma,o),this.size=l}V(mh,Re);function jr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function zr(){this.g=!0}zr.prototype.xa=function(){this.g=!1};function Sp(o,l,h,g,T,R){o.info(function(){if(o.g)if(R)for(var F="",ne=R.split("&"),Ae=0;Ae<ne.length;Ae++){var ee=ne[Ae].split("=");if(1<ee.length){var Ce=ee[0];ee=ee[1];var De=Ce.split("_");F=2<=De.length&&De[1]=="type"?F+(Ce+"="+ee+"&"):F+(Ce+"=redacted&")}}else F=null;else F=R;return"XMLHTTP REQ ("+g+") [attempt "+T+"]: "+l+`
`+h+`
`+F})}function bp(o,l,h,g,T,R,F){o.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+T+"]: "+l+`
`+h+`
`+R+" "+F})}function On(o,l,h,g){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+Pp(o,h)+(g?" "+g:"")})}function Rp(o,l){o.info(function(){return"TIMEOUT: "+l})}zr.prototype.info=function(){};function Pp(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var g=h[o];if(!(2>g.length)){var T=g[1];if(Array.isArray(T)&&!(1>T.length)){var R=T[0];if(R!="noop"&&R!="stop"&&R!="close")for(var F=1;F<T.length;F++)T[F]=""}}}}return aa(h)}catch{return l}}var ts={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ph={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ha;function ns(){}V(ns,ua),ns.prototype.g=function(){return new XMLHttpRequest},ns.prototype.i=function(){return{}},ha=new ns;function Ct(o,l,h,g){this.j=o,this.i=l,this.l=h,this.R=g||1,this.U=new qr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new _h}function _h(){this.i=null,this.g="",this.h=!1}var yh={},da={};function fa(o,l,h){o.L=1,o.v=os(mt(l)),o.m=h,o.P=!0,wh(o,null)}function wh(o,l){o.F=Date.now(),rs(o),o.A=mt(o.v);var h=o.A,g=o.R;Array.isArray(g)||(g=[String(g)]),Vh(h.i,"t",g),o.C=0,h=o.j.J,o.h=new _h,o.g=Xh(o.j,h?l:null,!o.m),0<o.O&&(o.M=new Ip(_(o.Y,o,o.g),o.O)),l=o.U,h=o.g,g=o.ca;var T="readystatechange";Array.isArray(T)||(T&&(uh[0]=T.toString()),T=uh);for(var R=0;R<T.length;R++){var F=th(h,T[R],g||l.handleEvent,!1,l.h||l);if(!F)break;l.g[F.key]=F}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Br(),Sp(o.i,o.u,o.A,o.l,o.R,o.m)}Ct.prototype.ca=function(o){o=o.target;let l=this.M;l&&pt(o)==3?l.j():this.Y(o)},Ct.prototype.Y=function(o){try{if(o==this.g)e:{let De=pt(this.g);var l=this.g.Ba();let Un=this.g.Z();if(!(3>De)&&(De!=3||this.g&&(this.h.h||this.g.oa()||Uh(this.g)))){this.J||De!=4||l==7||(l==8||0>=Un?Br(3):Br(2)),ga(this);var h=this.g.Z();this.X=h;t:if(vh(this)){var g=Uh(this.g);o="";var T=g.length,R=pt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){sn(this),Gr(this);var F="";break t}this.h.i=new u.TextDecoder}for(l=0;l<T;l++)this.h.h=!0,o+=this.h.i.decode(g[l],{stream:!(R&&l==T-1)});g.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,bp(this.i,this.u,this.A,this.l,this.R,De,h),this.o){if(this.T&&!this.K){t:{if(this.g){var ne,Ae=this.g;if((ne=Ae.g?Ae.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(ne)){var ee=ne;break t}}ee=null}if(h=ee)On(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ma(this,h);else{this.o=!1,this.s=3,Ne(12),sn(this),Gr(this);break e}}if(this.P){h=!0;let Je;for(;!this.J&&this.C<F.length;)if(Je=Cp(this,F),Je==da){De==4&&(this.s=4,Ne(14),h=!1),On(this.i,this.l,null,"[Incomplete Response]");break}else if(Je==yh){this.s=4,Ne(15),On(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else On(this.i,this.l,Je,null),ma(this,Je);if(vh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),De!=4||F.length!=0||this.h.h||(this.s=1,Ne(16),h=!1),this.o=this.o&&h,!h)On(this.i,this.l,F,"[Invalid Chunked Response]"),sn(this),Gr(this);else if(0<F.length&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.ba&&!Ce.M&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Ea(Ce),Ce.M=!0,Ne(11))}}else On(this.i,this.l,F,null),ma(this,F);De==4&&sn(this),this.o&&!this.J&&(De==4?Qh(this.j,this):(this.o=!1,rs(this)))}else $p(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,Ne(12)):(this.s=0,Ne(13)),sn(this),Gr(this)}}}catch{}finally{}};function vh(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Cp(o,l){var h=o.C,g=l.indexOf(`
`,h);return g==-1?da:(h=Number(l.substring(h,g)),isNaN(h)?yh:(g+=1,g+h>l.length?da:(l=l.slice(g,g+h),o.C=g+h,l)))}Ct.prototype.cancel=function(){this.J=!0,sn(this)};function rs(o){o.S=Date.now()+o.I,Eh(o,o.I)}function Eh(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=jr(_(o.ba,o),l)}function ga(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ct.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Rp(this.i,this.A),this.L!=2&&(Br(),Ne(17)),sn(this),this.s=2,Gr(this)):Eh(this,this.S-o)};function Gr(o){o.j.G==0||o.J||Qh(o.j,o)}function sn(o){ga(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,ch(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function ma(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||pa(h.h,o))){if(!o.K&&pa(h.h,o)&&h.G==3){try{var g=h.Da.g.parse(l)}catch{g=null}if(Array.isArray(g)&&g.length==3){var T=g;if(T[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)hs(h),cs(h);else break e;va(h),Ne(18)}}else h.za=T[1],0<h.za-h.T&&37500>T[2]&&h.F&&h.v==0&&!h.C&&(h.C=jr(_(h.Za,h),6e3));if(1>=Ah(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else an(h,11)}else if((o.K||h.g==o)&&hs(h),!z(l))for(T=h.Da.g.parse(l),l=0;l<T.length;l++){let ee=T[l];if(h.T=ee[0],ee=ee[1],h.G==2)if(ee[0]=="c"){h.K=ee[1],h.ia=ee[2];let Ce=ee[3];Ce!=null&&(h.la=Ce,h.j.info("VER="+h.la));let De=ee[4];De!=null&&(h.Aa=De,h.j.info("SVER="+h.Aa));let Un=ee[5];Un!=null&&typeof Un=="number"&&0<Un&&(g=1.5*Un,h.L=g,h.j.info("backChannelRequestTimeoutMs_="+g)),g=h;let Je=o.g;if(Je){let fs=Je.g?Je.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(fs){var R=g.h;R.g||fs.indexOf("spdy")==-1&&fs.indexOf("quic")==-1&&fs.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(_a(R,R.h),R.h=null))}if(g.D){let Ia=Je.g?Je.g.getResponseHeader("X-HTTP-Session-Id"):null;Ia&&(g.ya=Ia,se(g.I,g.D,Ia))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),g=h;var F=o;if(g.qa=Jh(g,g.J?g.ia:null,g.W),F.K){Sh(g.h,F);var ne=F,Ae=g.L;Ae&&(ne.I=Ae),ne.B&&(ga(ne),rs(ne)),g.g=F}else Kh(g);0<h.i.length&&ls(h)}else ee[0]!="stop"&&ee[0]!="close"||an(h,7);else h.G==3&&(ee[0]=="stop"||ee[0]=="close"?ee[0]=="stop"?an(h,7):wa(h):ee[0]!="noop"&&h.l&&h.l.ta(ee),h.v=0)}}Br(4)}catch{}}var Dp=class{constructor(o,l){this.g=o,this.map=l}};function Ih(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Th(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Ah(o){return o.h?1:o.g?o.g.size:0}function pa(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function _a(o,l){o.g?o.g.add(l):o.h=l}function Sh(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Ih.prototype.cancel=function(){if(this.i=bh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function bh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let h of o.g.values())l=l.concat(h.D);return l}return N(o.i)}function xp(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],h=o.length,g=0;g<h;g++)l.push(o[g]);return l}l=[],h=0;for(g in o)l[h++]=o[g];return l}function kp(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(let g in o)l[h++]=g;return l}}}function Rh(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=kp(o),g=xp(o),T=g.length,R=0;R<T;R++)l.call(void 0,g[R],h&&h[R],o)}var Ph=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Vp(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var g=o[h].indexOf("="),T=null;if(0<=g){var R=o[h].substring(0,g);T=o[h].substring(g+1)}else R=o[h];l(R,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function on(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof on){this.h=o.h,is(this,o.j),this.o=o.o,this.g=o.g,ss(this,o.s),this.l=o.l;var l=o.i,h=new Qr;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),Ch(this,h),this.m=o.m}else o&&(l=String(o).match(Ph))?(this.h=!1,is(this,l[1]||"",!0),this.o=Kr(l[2]||""),this.g=Kr(l[3]||"",!0),ss(this,l[4]),this.l=Kr(l[5]||"",!0),Ch(this,l[6]||"",!0),this.m=Kr(l[7]||"")):(this.h=!1,this.i=new Qr(null,this.h))}on.prototype.toString=function(){var o=[],l=this.j;l&&o.push($r(l,Dh,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push($r(l,Dh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push($r(h,h.charAt(0)=="/"?Mp:Fp,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",$r(h,Lp)),o.join("")};function mt(o){return new on(o)}function is(o,l,h){o.j=h?Kr(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function ss(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Ch(o,l,h){l instanceof Qr?(o.i=l,qp(o.i,o.h)):(h||(l=$r(l,Op)),o.i=new Qr(l,o.h))}function se(o,l,h){o.i.set(l,h)}function os(o){return se(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Kr(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function $r(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,Np),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Np(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Dh=/[#\/\?@]/g,Fp=/[#\?:]/g,Mp=/[#\?]/g,Op=/[#\?@]/g,Lp=/#/g;function Qr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Dt(o){o.g||(o.g=new Map,o.h=0,o.i&&Vp(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=Qr.prototype,r.add=function(o,l){Dt(this),this.i=null,o=Ln(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function xh(o,l){Dt(o),l=Ln(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function kh(o,l){return Dt(o),l=Ln(o,l),o.g.has(l)}r.forEach=function(o,l){Dt(this),this.g.forEach(function(h,g){h.forEach(function(T){o.call(l,T,g,this)},this)},this)},r.na=function(){Dt(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let g=0;g<l.length;g++){let T=o[g];for(let R=0;R<T.length;R++)h.push(l[g])}return h},r.V=function(o){Dt(this);let l=[];if(typeof o=="string")kh(this,o)&&(l=l.concat(this.g.get(Ln(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return Dt(this),this.i=null,o=Ln(this,o),kh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function Vh(o,l,h){xh(o,l),0<h.length&&(o.i=null,o.g.set(Ln(o,l),N(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var g=l[h];let R=encodeURIComponent(String(g)),F=this.V(g);for(g=0;g<F.length;g++){var T=R;F[g]!==""&&(T+="="+encodeURIComponent(String(F[g]))),o.push(T)}}return this.i=o.join("&")};function Ln(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function qp(o,l){l&&!o.j&&(Dt(o),o.i=null,o.g.forEach(function(h,g){var T=g.toLowerCase();g!=T&&(xh(this,g),Vh(this,T,h))},o)),o.j=l}function Up(o,l){let h=new zr;if(u.Image){let g=new Image;g.onload=A(xt,h,"TestLoadImage: loaded",!0,l,g),g.onerror=A(xt,h,"TestLoadImage: error",!1,l,g),g.onabort=A(xt,h,"TestLoadImage: abort",!1,l,g),g.ontimeout=A(xt,h,"TestLoadImage: timeout",!1,l,g),u.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=o}else l(!1)}function Bp(o,l){let h=new zr,g=new AbortController,T=setTimeout(()=>{g.abort(),xt(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:g.signal}).then(R=>{clearTimeout(T),R.ok?xt(h,"TestPingServer: ok",!0,l):xt(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(T),xt(h,"TestPingServer: error",!1,l)})}function xt(o,l,h,g,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),g(h)}catch{}}function jp(){this.g=new Ap}function zp(o,l,h){let g=h||"";try{Rh(o,function(T,R){let F=T;d(T)&&(F=aa(T)),l.push(g+R+"="+encodeURIComponent(F))})}catch(T){throw l.push(g+"type="+encodeURIComponent("_badmap")),T}}function Wr(o){this.l=o.Ub||null,this.j=o.eb||!1}V(Wr,ua),Wr.prototype.g=function(){return new as(this.l,this.j)},Wr.prototype.i=function(o){return function(){return o}}({});function as(o,l){Pe.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(as,Pe),r=as.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,Jr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Jr(this)),this.g&&(this.readyState=3,Jr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Nh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Hr(this):Jr(this),this.readyState==3&&Nh(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Hr(this))},r.Qa=function(o){this.g&&(this.response=o,Hr(this))},r.ga=function(){this.g&&Hr(this)};function Hr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Jr(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function Jr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(as.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Fh(o){let l="";return $(o,function(h,g){l+=g,l+=":",l+=h,l+=`\r
`}),l}function ya(o,l,h){e:{for(g in h){var g=!1;break e}g=!0}g||(h=Fh(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):se(o,l,h))}function le(o){Pe.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(le,Pe);var Gp=/^https?$/i,Kp=["POST","PUT"];r=le.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ha.g(),this.v=this.o?lh(this.o):lh(ha),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(R){Mh(this,R);return}if(o=h||"",h=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var T in g)h.set(T,g[T]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let R of g.keys())h.set(R,g.get(R));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),T=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Kp,l,void 0))||g||T||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,F]of h)this.g.setRequestHeader(R,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qh(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){Mh(this,R)}};function Mh(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Oh(o),us(o)}function Oh(o){o.A||(o.A=!0,Ve(o,"complete"),Ve(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ve(this,"complete"),Ve(this,"abort"),us(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),us(this,!0)),le.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Lh(this):this.bb())},r.bb=function(){Lh(this)};function Lh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||pt(o)!=4||o.Z()!=2)){if(o.u&&pt(o)==4)oh(o.Ea,0,o);else if(Ve(o,"readystatechange"),pt(o)==4){o.h=!1;try{let F=o.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var g;if(g=F===0){var T=String(o.D).match(Ph)[1]||null;!T&&u.self&&u.self.location&&(T=u.self.location.protocol.slice(0,-1)),g=!Gp.test(T?T.toLowerCase():"")}h=g}if(h)Ve(o,"complete"),Ve(o,"success");else{o.m=6;try{var R=2<pt(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",Oh(o)}}finally{us(o)}}}}function us(o,l){if(o.g){qh(o);let h=o.g,g=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Ve(o,"ready");try{h.onreadystatechange=g}catch{}}}function qh(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function pt(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<pt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),Tp(l)}};function Uh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function $p(o){let l={};o=(o.g&&2<=pt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<o.length;g++){if(z(o[g]))continue;var h=I(o[g]);let T=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let R=l[T]||[];l[T]=R,R.push(h)}v(l,function(g){return g.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xr(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function Bh(o){this.Aa=0,this.i=[],this.j=new zr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xr("baseRetryDelayMs",5e3,o),this.cb=Xr("retryDelaySeedMs",1e4,o),this.Wa=Xr("forwardChannelMaxRetries",2,o),this.wa=Xr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Ih(o&&o.concurrentRequestLimit),this.Da=new jp,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Bh.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,g){Ne(0),this.W=o,this.H=l||{},h&&g!==void 0&&(this.H.OSID=h,this.H.OAID=g),this.F=this.X,this.I=Jh(this,null,this.W),ls(this)};function wa(o){if(jh(o),o.G==3){var l=o.U++,h=mt(o.I);if(se(h,"SID",o.K),se(h,"RID",l),se(h,"TYPE","terminate"),Yr(o,h),l=new Ct(o,o.j,l),l.L=2,l.v=os(mt(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=l.v,h=!0),h||(l.g=Xh(l.j,null),l.g.ea(l.v)),l.F=Date.now(),rs(l)}Hh(o)}function cs(o){o.g&&(Ea(o),o.g.cancel(),o.g=null)}function jh(o){cs(o),o.u&&(u.clearTimeout(o.u),o.u=null),hs(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function ls(o){if(!Th(o.h)&&!o.s){o.s=!0;var l=o.Ga;Fr||eh(),Mr||(Fr(),Mr=!0),Yo.add(l,o),o.B=0}}function Qp(o,l){return Ah(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=jr(_(o.Ga,o,l),Wh(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let T=new Ct(this,this.j,o),R=this.o;if(this.S&&(R?(R=p(R),E(R,this.S)):R=this.S),this.m!==null||this.O||(T.H=R,R=null),this.P)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var g=this.i[h];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(l+=g,4096<l){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=Gh(this,T,l),h=mt(this.I),se(h,"RID",o),se(h,"CVER",22),this.D&&se(h,"X-HTTP-Session-Id",this.D),Yr(this,h),R&&(this.O?l="headers="+encodeURIComponent(String(Fh(R)))+"&"+l:this.m&&ya(h,this.m,R)),_a(this.h,T),this.Ua&&se(h,"TYPE","init"),this.P?(se(h,"$req",l),se(h,"SID","null"),T.T=!0,fa(T,h,null)):fa(T,h,l),this.G=2}}else this.G==3&&(o?zh(this,o):this.i.length==0||Th(this.h)||zh(this))};function zh(o,l){var h;l?h=l.l:h=o.U++;let g=mt(o.I);se(g,"SID",o.K),se(g,"RID",h),se(g,"AID",o.T),Yr(o,g),o.m&&o.o&&ya(g,o.m,o.o),h=new Ct(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Gh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),_a(o.h,h),fa(h,g,l)}function Yr(o,l){o.H&&$(o.H,function(h,g){se(l,g,h)}),o.l&&Rh({},function(h,g){se(l,g,h)})}function Gh(o,l,h){h=Math.min(o.i.length,h);var g=o.l?_(o.l.Na,o.l,o):null;e:{var T=o.i;let R=-1;for(;;){let F=["count="+h];R==-1?0<h?(R=T[0].g,F.push("ofs="+R)):R=0:F.push("ofs="+R);let ne=!0;for(let Ae=0;Ae<h;Ae++){let ee=T[Ae].g,Ce=T[Ae].map;if(ee-=R,0>ee)R=Math.max(0,T[Ae].g-100),ne=!1;else try{zp(Ce,F,"req"+ee+"_")}catch{g&&g(Ce)}}if(ne){g=F.join("&");break e}}}return o=o.i.splice(0,h),l.D=o,g}function Kh(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Fr||eh(),Mr||(Fr(),Mr=!0),Yo.add(l,o),o.v=0}}function va(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=jr(_(o.Fa,o),Wh(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,$h(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=jr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ne(10),cs(this),$h(this))};function Ea(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function $h(o){o.g=new Ct(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=mt(o.qa);se(l,"RID","rpc"),se(l,"SID",o.K),se(l,"AID",o.T),se(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&se(l,"TO",o.ja),se(l,"TYPE","xmlhttp"),Yr(o,l),o.m&&o.o&&ya(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=os(mt(l)),h.m=null,h.P=!0,wh(h,o)}r.Za=function(){this.C!=null&&(this.C=null,cs(this),va(this),Ne(19))};function hs(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Qh(o,l){var h=null;if(o.g==l){hs(o),Ea(o),o.g=null;var g=2}else if(pa(o.h,l))h=l.D,Sh(o.h,l),g=1;else return;if(o.G!=0){if(l.o)if(g==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var T=o.B;g=es(),Ve(g,new mh(g,h)),ls(o)}else Kh(o);else if(T=l.s,T==3||T==0&&0<l.X||!(g==1&&Qp(o,l)||g==2&&va(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),T){case 1:an(o,5);break;case 4:an(o,10);break;case 3:an(o,6);break;default:an(o,2)}}}function Wh(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function an(o,l){if(o.j.info("Error code "+l),l==2){var h=_(o.fb,o),g=o.Xa;let T=!g;g=new on(g||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||is(g,"https"),os(g),T?Up(g.toString(),h):Bp(g.toString(),h)}else Ne(2);o.G=0,o.l&&o.l.sa(l),Hh(o),jh(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function Hh(o){if(o.G=0,o.ka=[],o.l){let l=bh(o.h);(l.length!=0||o.i.length!=0)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function Jh(o,l,h){var g=h instanceof on?mt(h):new on(h);if(g.g!="")l&&(g.g=l+"."+g.g),ss(g,g.s);else{var T=u.location;g=T.protocol,l=l?l+"."+T.hostname:T.hostname,T=+T.port;var R=new on(null);g&&is(R,g),l&&(R.g=l),T&&ss(R,T),h&&(R.l=h),g=R}return h=o.D,l=o.ya,h&&l&&se(g,h,l),se(g,"VER",o.la),Yr(o,g),g}function Xh(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new le(new Wr({eb:h})):new le(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Yh(){}r=Yh.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function ds(){}ds.prototype.g=function(o,l){return new je(o,l)};function je(o,l){Pe.call(this),this.g=new Bh(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!z(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new qn(this)}V(je,Pe),je.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},je.prototype.close=function(){wa(this.g)},je.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=aa(o),o=h);l.i.push(new Dp(l.Ya++,o)),l.G==3&&ls(l)},je.prototype.N=function(){this.g.l=null,delete this.j,wa(this.g),delete this.g,je.aa.N.call(this)};function Zh(o){ca.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(let h in l){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}V(Zh,ca);function ed(){la.call(this),this.status=1}V(ed,la);function qn(o){this.g=o}V(qn,Yh),qn.prototype.ua=function(){Ve(this.g,"a")},qn.prototype.ta=function(o){Ve(this.g,new Zh(o))},qn.prototype.sa=function(o){Ve(this.g,new ed)},qn.prototype.ra=function(){Ve(this.g,"b")},ds.prototype.createWebChannel=ds.prototype.g,je.prototype.send=je.prototype.o,je.prototype.open=je.prototype.m,je.prototype.close=je.prototype.close,nu=yt.createWebChannelTransport=function(){return new ds},tu=yt.getStatEventTarget=function(){return es()},eu=yt.Event=rn,Cs=yt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ts.NO_ERROR=0,ts.TIMEOUT=8,ts.HTTP_ERROR=6,ci=yt.ErrorCode=ts,ph.COMPLETE="complete",Za=yt.EventType=ph,hh.EventType=Ur,Ur.OPEN="a",Ur.CLOSE="b",Ur.ERROR="c",Ur.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,Qn=yt.WebChannel=hh,Ya=yt.FetchXmlHttpFactory=Wr,le.prototype.listenOnce=le.prototype.L,le.prototype.getLastError=le.prototype.Ka,le.prototype.getLastErrorCode=le.prototype.Ba,le.prototype.getStatus=le.prototype.Z,le.prototype.getResponseJson=le.prototype.Oa,le.prototype.getResponseText=le.prototype.oa,le.prototype.send=le.prototype.ea,le.prototype.setWithCredentials=le.prototype.Ha,Xa=yt.XhrIo=le}).apply(typeof Ps<"u"?Ps:typeof self<"u"?self:typeof window<"u"?window:{});var Fd="@firebase/firestore";var ye=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");var Ar="10.12.1";var Gt=new Is("@firebase/firestore");function Yn(){return Gt.logLevel}function Mf(r){Gt.setLogLevel(r)}function k(r,...e){if(Gt.logLevel<=rt.DEBUG){let t=e.map(sl);Gt.debug(`Firestore (${Ar}): ${r}`,...t)}}function fe(r,...e){if(Gt.logLevel<=rt.ERROR){let t=e.map(sl);Gt.error(`Firestore (${Ar}): ${r}`,...t)}}function Qe(r,...e){if(Gt.logLevel<=rt.WARN){let t=e.map(sl);Gt.warn(`Firestore (${Ar}): ${r}`,...t)}}function sl(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function q(r="Unexpected state"){let e=`FIRESTORE (${Ar}) INTERNAL ASSERTION FAILED: `+r;throw fe(e),new Error(e)}function U(r,e){r||q()}function Of(r,e){r||q()}function L(r,e){return r}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends fd{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var we=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Us=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},au=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ye.UNAUTHENTICATED))}shutdown(){}},uu=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},cu=class{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new we;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new we,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;e.enqueueRetryable(()=>C(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new we)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U(typeof n.accessToken=="string"),new Us(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return U(e===null||typeof e=="string"),new ye(e)}},lu=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},hu=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new lu(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}},du=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},fu=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=s=>{s.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U(typeof t.token=="string"),this.R=t.token,new du(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function O_(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var Bs=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=O_(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}};function Q(r,e){return r<e?-1:r>e?1:0}function ar(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Lf(r){return r+"\0"}var ce=class r{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class r{constructor(e){this.timestamp=e}static fromTimestamp(e){return new r(e)}static min(){return new r(new ce(0,0))}static max(){return new r(new ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var js=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&q(),n===void 0?n=e.length-t:n>e.length-t&&q(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Y=class r extends js{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},L_=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ge=class r extends js{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return L_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var O=class r{constructor(e){this.path=e}static fromPath(e){return new r(Y.fromString(e))}static fromName(e){return new r(Y.fromString(e).popFirst(5))}static empty(){return new r(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Y.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Y.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new Y(e.slice()))}};var ur=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function gu(r){return r.fields.find(e=>e.kind===2)}function dn(r){return r.fields.filter(e=>e.kind!==2)}ur.UNKNOWN_ID=-1;var ir=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ei=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,We.min())}};function qf(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=B.fromTimestamp(n===1e9?new ce(t+1,0):new ce(t,n));return new We(i,O.empty(),e)}function Uf(r){return new We(r.readTime,r.key,-1)}var We=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(B.min(),O.empty(),-1)}static max(){return new r(B.max(),O.empty(),-1)}};function ol(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=O.comparator(r.documentKey,e.documentKey),t!==0?t:Q(r.largestBatchId,e.largestBatchId))}var Bf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",zs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function en(r){return C(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==Bf)throw r;k("LocalStore","Unexpectedly lost primary lease")})}var b=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let d=c;t(e[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var Gs=class r{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new we,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new yn(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=al(n.target.error);this.V.reject(new yn(e,i))}}static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new yn(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(k("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new pu(t)}},Kt=class r{constructor(e,t,n){this.name=e,this.version=t,this.p=n,r.S(ri())===12.2&&fe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return k("SimpleDb","Removing database:",e),fn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Es())return!1;if(r.C())return!0;let e=ri(),t=r.S(e),n=0<t&&t<10,i=jf(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return C(this,null,function*(){return this.db||(k("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;t(a)},i.onblocked=()=>{n(new yn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new yn(e,a))},i.onupgradeneeded=s=>{k("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{k("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return C(this,null,function*(){let s=t==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(e);let u=Gs.open(this.db,e,s?"readonly":"readwrite",n),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),b.reject(d))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,d=c.name!=="FirebaseError"&&a<3;if(k("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function jf(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var mu=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return fn(this.B.delete())}},yn=class extends x{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function tn(r){return r.name==="IndexedDbTransactionError"}var pu=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(k("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(k("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),fn(n)}add(e){return k("SimpleDb","ADD",this.store.name,e,e),fn(this.store.add(e))}get(e){return fn(this.store.get(e)).next(t=>(t===void 0&&(t=null),k("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return k("SimpleDb","DELETE",this.store.name,e),fn(this.store.delete(e))}count(){return k("SimpleDb","COUNT",this.store.name),fn(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new b((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new b((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){k("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new b((n,i)=>{t.onerror=s=>{let a=al(s.target.error);i(a)},t.onsuccess=s=>{let a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){let n=[];return new b((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new mu(u),d=t(u.primaryKey,u.value,c);if(d instanceof b){let f=d.catch(m=>(c.done(),b.reject(m)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>b.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function fn(r){return new b((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=al(n.target.error);t(i)}})}var Md=!1;function al(r){let e=Kt.S(ri());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Md||(Md=!0,setTimeout(()=>{throw n},0)),n}}return r}var _u=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){k("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>C(this,null,function*(){this.task=null;try{k("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){tn(t)?k("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield en(t)}yield this.X(6e4)}))}},yu=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return C(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,i=t,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!n.has(a))return k("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(k("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let a=Uf(s);ol(a,n)>0&&(n=a)}),new We(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var ze=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function zi(r){return r==null}function Ii(r){return r===0&&1/r==-1/0}function zf(r){return typeof r=="number"&&Number.isInteger(r)&&!Ii(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Me(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Od(e)),e=q_(r.get(t),e);return Od(e)}function q_(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Od(r){return r+""}function it(r){let e=r.length;if(U(e>=2),e===2)return U(r.charAt(0)===""&&r.charAt(1)===""),Y.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let a=r.indexOf("",s);switch((a<0||a>t)&&q(),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:q()}s=a+2}return new Y(n)}var Ld=["userId","batchId"];function Ns(r,e){return[r,Me(e)]}function Gf(r,e,t){return[r,Me(e),t]}var U_={},B_=["prefixPath","collectionGroup","readTime","documentId"],j_=["prefixPath","collectionGroup","documentId"],z_=["collectionGroup","readTime","prefixPath","documentId"],G_=["canonicalId","targetId"],K_=["targetId","path"],$_=["path","targetId"],Q_=["collectionId","parent"],W_=["indexId","uid"],H_=["uid","sequenceNumber"],J_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],X_=["indexId","uid","orderedDocumentKey"],Y_=["userId","collectionPath","documentId"],Z_=["userId","collectionPath","largestBatchId"],ey=["userId","collectionGroup","largestBatchId"],Kf=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ty=[...Kf,"documentOverlays"],$f=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Qf=$f,Wf=[...Qf,"indexConfiguration","indexState","indexEntries"],ny=Wf;var Ti=class extends zs{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Te(r,e){let t=L(r);return Kt.F(t._e,e)}function qd(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Dn(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Hf(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var oe=class r{constructor(e,t){this.comparator=e,this.root=t||ot.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ot.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ot.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rr(this.root,e,this.comparator,!1)}getReverseIterator(){return new rr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rr(this.root,e,this.comparator,!0)}},rr=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ot=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw q();let e=this.left.check();if(e!==this.right.check())throw q();return e+(this.isRed()?0:1)}};ot.EMPTY=null,ot.RED=!0,ot.BLACK=!1;ot.EMPTY=new class{constructor(){this.size=0}get key(){throw q()}get value(){throw q()}get color(){throw q()}get left(){throw q()}get right(){throw q()}copy(e,t,n,i,s){return this}insert(e,t,n){return new ot(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var re=class r{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ks(this.data.getIterator())}getIteratorFrom(e){return new Ks(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},Ks=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Wn(r){return r.hasNext()?r.getNext():void 0}var Ge=class r{constructor(e){this.fields=e,e.sort(ge.comparator)}static empty(){return new r([])}unionWith(e){let t=new re(ge.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ar(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var $s=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Jf(){return typeof atob<"u"}var Ie=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new $s("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ie.EMPTY_BYTE_STRING=new Ie("");var ry=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Et(r){if(U(!!r),typeof r=="string"){let e=0,t=ry.exec(r);if(U(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:he(r.seconds),nanos:he(r.nanos)}}function he(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function $t(r){return typeof r=="string"?Ie.fromBase64String(r):Ie.fromUint8Array(r)}function Oo(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function ul(r){let e=r.mapValue.fields.__previous_value__;return Oo(e)?ul(e):e}function Ai(r){let e=Et(r.mapValue.fields.__local_write_time__.timestampValue);return new ce(e.seconds,e.nanos)}var wu=class{constructor(e,t,n,i,s,a,u,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}},Qt=class r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var jt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Fs={nullValue:"NULL_VALUE"};function wn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Oo(r)?4:Xf(r)?9007199254740991:10:q()}function ct(r,e){if(r===e)return!0;let t=wn(r);if(t!==wn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Ai(r).isEqual(Ai(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Et(i.timestampValue),u=Et(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return $t(i.bytesValue).isEqual($t(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return he(i.geoPointValue.latitude)===he(s.geoPointValue.latitude)&&he(i.geoPointValue.longitude)===he(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return he(i.integerValue)===he(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=he(i.doubleValue),u=he(s.doubleValue);return a===u?Ii(a)===Ii(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return ar(r.arrayValue.values||[],e.arrayValue.values||[],ct);case 10:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(qd(a)!==qd(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!ct(a[c],u[c])))return!1;return!0}(r,e);default:return q()}}function Si(r,e){return(r.values||[]).find(t=>ct(t,e))!==void 0}function Wt(r,e){if(r===e)return 0;let t=wn(r),n=wn(e);if(t!==n)return Q(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(r.booleanValue,e.booleanValue);case 2:return function(s,a){let u=he(s.integerValue||s.doubleValue),c=he(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return Ud(r.timestampValue,e.timestampValue);case 4:return Ud(Ai(r),Ai(e));case 5:return Q(r.stringValue,e.stringValue);case 6:return function(s,a){let u=$t(s),c=$t(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let d=0;d<u.length&&d<c.length;d++){let f=Q(u[d],c[d]);if(f!==0)return f}return Q(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){let u=Q(he(s.latitude),he(a.latitude));return u!==0?u:Q(he(s.longitude),he(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,a){let u=s.values||[],c=a.values||[];for(let d=0;d<u.length&&d<c.length;++d){let f=Wt(u[d],c[d]);if(f)return f}return Q(u.length,c.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===jt.mapValue&&a===jt.mapValue)return 0;if(s===jt.mapValue)return 1;if(a===jt.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){let _=Q(c[m],f[m]);if(_!==0)return _;let A=Wt(u[c[m]],d[f[m]]);if(A!==0)return A}return Q(c.length,f.length)}(r.mapValue,e.mapValue);default:throw q()}}function Ud(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return Q(r,e);let t=Et(r),n=Et(e),i=Q(t.seconds,n.seconds);return i!==0?i:Q(t.nanos,n.nanos)}function cr(r){return vu(r)}function vu(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=Et(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return $t(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return O.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=vu(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${vu(t.fields[a])}`;return i+"}"}(r.mapValue):q()}function vn(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Eu(r){return!!r&&"integerValue"in r}function bi(r){return!!r&&"arrayValue"in r}function Bd(r){return!!r&&"nullValue"in r}function jd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ms(r){return!!r&&"mapValue"in r}function pi(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return Dn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=pi(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=pi(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Xf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function iy(r){return"nullValue"in r?Fs:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?vn(Qt.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:q()}function sy(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?vn(Qt.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?jt:q()}function zd(r,e){let t=Wt(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Gd(r,e){let t=Wt(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var ke=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ms(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pi(t)}setAll(e){let t=ge.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=pi(a):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());Ms(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ct(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Ms(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Dn(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(pi(this.value))}};function Yf(r){let e=[];return Dn(r.fields,(t,n)=>{let i=new ge([t]);if(Ms(n)){let s=Yf(n.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Ge(e)}var ve=class r{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new r(e,0,B.min(),B.min(),B.min(),ke.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,B.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,B.min(),B.min(),ke.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,B.min(),B.min(),ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var lt=class{constructor(e,t){this.position=e,this.inclusive=t}};function Kd(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],a=r.position[i];if(s.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),t.key):n=Wt(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function $d(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!ct(r.position[t],e.position[t]))return!1;return!0}var En=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function oy(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var Qs=class{},H=class r extends Qs{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Au(e,t,n):t==="array-contains"?new Ru(e,n):t==="in"?new Ws(e,n):t==="not-in"?new Pu(e,n):t==="array-contains-any"?new Cu(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Su(e,n):new bu(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Wt(t,this.value)):t!==null&&wn(this.value)===wn(t)&&this.matchesComparison(Wt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},te=class r extends Qs{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new r(e,t)}matches(e){return lr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function lr(r){return r.op==="and"}function Iu(r){return r.op==="or"}function cl(r){return Zf(r)&&lr(r)}function Zf(r){for(let e of r.filters)if(e instanceof te)return!1;return!0}function Tu(r){if(r instanceof H)return r.field.canonicalString()+r.op.toString()+cr(r.value);if(cl(r))return r.filters.map(e=>Tu(e)).join(",");{let e=r.filters.map(t=>Tu(t)).join(",");return`${r.op}(${e})`}}function eg(r,e){return r instanceof H?function(n,i){return i instanceof H&&n.op===i.op&&n.field.isEqual(i.field)&&ct(n.value,i.value)}(r,e):r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&eg(a,i.filters[u]),!0):!1}(r,e):void q()}function tg(r,e){let t=r.filters.concat(e);return te.create(t,r.op)}function ng(r){return r instanceof H?function(t){return`${t.field.canonicalString()} ${t.op} ${cr(t.value)}`}(r):r instanceof te?function(t){return t.op.toString()+" {"+t.getFilters().map(ng).join(" ,")+"}"}(r):"Filter"}var Au=class extends H{constructor(e,t,n){super(e,t,n),this.key=O.fromName(n.referenceValue)}matches(e){let t=O.comparator(e.key,this.key);return this.matchesComparison(t)}},Su=class extends H{constructor(e,t){super(e,"in",t),this.keys=rg("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},bu=class extends H{constructor(e,t){super(e,"not-in",t),this.keys=rg("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function rg(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>O.fromName(n.referenceValue))}var Ru=class extends H{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return bi(t)&&Si(t.arrayValue,this.value)}},Ws=class extends H{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Si(this.value.arrayValue,t)}},Pu=class extends H{constructor(e,t){super(e,"not-in",t)}matches(e){if(Si(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Si(this.value.arrayValue,t)}},Cu=class extends H{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!bi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Si(this.value.arrayValue,n))}};var Du=class{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function xu(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Du(r,e,t,n,i,s,a)}function In(r){let e=L(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Tu(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),zi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>cr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>cr(n)).join(",")),e.ue=t}return e.ue}function Gi(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!oy(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!eg(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!$d(r.startAt,e.startAt)&&$d(r.endAt,e.endAt)}function Hs(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Js(r,e){return r.filters.filter(t=>t instanceof H&&t.field.isEqual(e))}function Qd(r,e,t){let n=Fs,i=!0;for(let s of Js(r,e)){let a=Fs,u=!0;switch(s.op){case"<":case"<=":a=iy(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Fs}zd({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];zd({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}function Wd(r,e,t){let n=jt,i=!0;for(let s of Js(r,e)){let a=jt,u=!0;switch(s.op){case">=":case">":a=sy(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=jt}Gd({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];Gd({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}var Ye=class{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function ig(r,e,t,n,i,s,a,u){return new Ye(r,e,t,n,i,s,a,u)}function Sr(r){return new Ye(r)}function Hd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function ll(r){return r.collectionGroup!==null}function sr(r){let e=L(r);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new re(ge.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new En(s,n))}),t.has(ge.keyField().canonicalString())||e.ce.push(new En(ge.keyField(),n))}return e.ce}function Oe(r){let e=L(r);return e.le||(e.le=ay(e,sr(r))),e.le}function ay(r,e){if(r.limitType==="F")return xu(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new En(i.field,s)});let t=r.endAt?new lt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new lt(r.startAt.position,r.startAt.inclusive):null;return xu(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function ku(r,e){let t=r.filters.concat([e]);return new Ye(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Xs(r,e,t){return new Ye(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ki(r,e){return Gi(Oe(r),Oe(e))&&r.limitType===e.limitType}function sg(r){return`${In(Oe(r))}|lt:${r.limitType}`}function Zn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>ng(i)).join(", ")}]`),zi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>cr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>cr(i)).join(",")),`Target(${n})`}(Oe(r))}; limitType=${r.limitType})`}function $i(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of sr(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(a,u,c){let d=Kd(a,u,c);return a.inclusive?d<=0:d<0}(n.startAt,sr(n),i)||n.endAt&&!function(a,u,c){let d=Kd(a,u,c);return a.inclusive?d>=0:d>0}(n.endAt,sr(n),i))}(r,e)}function og(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function ag(r){return(e,t)=>{let n=!1;for(let i of sr(r)){let s=uy(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function uy(r,e,t){let n=r.field.isKeyField()?O.comparator(e.key,t.key):function(s,a,u){let c=a.data.field(s),d=u.data.field(s);return c!==null&&d!==null?Wt(c,d):q()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return q()}}var ht=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Dn(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return Hf(this.inner)}size(){return this.innerSize}};var cy=new oe(O.comparator);function Be(){return cy}var ug=new oe(O.comparator);function gi(...r){let e=ug;for(let t of r)e=e.insert(t.key,t);return e}function cg(r){let e=ug;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function st(){return _i()}function lg(){return _i()}function _i(){return new ht(r=>r.toString(),(r,e)=>r.isEqual(e))}var ly=new oe(O.comparator),hy=new re(O.comparator);function W(...r){let e=hy;for(let t of r)e=e.add(t);return e}var dy=new re(Q);function hl(){return dy}function hg(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ii(e)?"-0":e}}function dg(r){return{integerValue:""+r}}function fg(r,e){return zf(e)?dg(e):hg(r,e)}var hr=class{constructor(){this._=void 0}};function fy(r,e,t){return r instanceof Ht?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Oo(s)&&(s=ul(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof It?mg(r,e):r instanceof Tt?pg(r,e):function(i,s){let a=gg(i,s),u=Jd(a)+Jd(i.Pe);return Eu(a)&&Eu(i.Pe)?dg(u):hg(i.serializer,u)}(r,e)}function gy(r,e,t){return r instanceof It?mg(r,e):r instanceof Tt?pg(r,e):t}function gg(r,e){return r instanceof Jt?function(n){return Eu(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var Ht=class extends hr{},It=class extends hr{constructor(e){super(),this.elements=e}};function mg(r,e){let t=_g(e);for(let n of r.elements)t.some(i=>ct(i,n))||t.push(n);return{arrayValue:{values:t}}}var Tt=class extends hr{constructor(e){super(),this.elements=e}};function pg(r,e){let t=_g(e);for(let n of r.elements)t=t.filter(i=>!ct(i,n));return{arrayValue:{values:t}}}var Jt=class extends hr{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Jd(r){return he(r.integerValue||r.doubleValue)}function _g(r){return bi(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Tn=class{constructor(e,t){this.field=e,this.transform=t}};function my(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof It&&i instanceof It||n instanceof Tt&&i instanceof Tt?ar(n.elements,i.elements,ct):n instanceof Jt&&i instanceof Jt?ct(n.Pe,i.Pe):n instanceof Ht&&i instanceof Ht}(r.transform,e.transform)}var Vu=class{constructor(e,t){this.version=e,this.transformResults=t}},de=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Os(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var dr=class{};function yg(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Yt(r.key,de.none()):new Xt(r.key,r.data,de.none());{let t=r.data,n=ke.empty(),i=new re(ge.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new Ze(r.key,n,new Ge(i.toArray()),de.none())}}function py(r,e,t){r instanceof Xt?function(i,s,a){let u=i.value.clone(),c=Yd(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Ze?function(i,s,a){if(!Os(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Yd(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(wg(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function yi(r,e,t,n){return r instanceof Xt?function(s,a,u,c){if(!Os(s.precondition,a))return u;let d=s.value.clone(),f=Zd(s.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,e,t,n):r instanceof Ze?function(s,a,u,c){if(!Os(s.precondition,a))return u;let d=Zd(s.fieldTransforms,c,a),f=a.data;return f.setAll(wg(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(r,e,t,n):function(s,a,u){return Os(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,e,t)}function _y(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=gg(n.transform,i||null);s!=null&&(t===null&&(t=ke.empty()),t.set(n.field,s))}return t||null}function Xd(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&ar(n,i,(s,a)=>my(s,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var Xt=class extends dr{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ze=class extends dr{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function wg(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function Yd(r,e,t){let n=new Map;U(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,gy(a,u,t[i]))}return n}function Zd(r,e,t){let n=new Map;for(let i of r){let s=i.transform,a=t.data.field(i.field);n.set(i.field,fy(s,a,e))}return n}var Yt=class extends dr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ri=class extends dr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Pi=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&py(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=yi(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=yi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=lg();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;let c=yg(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),W())}isEqual(e){return this.batchId===e.batchId&&ar(this.mutations,e.mutations,(t,n)=>Xd(t,n))&&ar(this.baseMutations,e.baseMutations,(t,n)=>Xd(t,n))}},Nu=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){U(e.mutations.length===n.length);let i=function(){return ly}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(e,t,n,i)}};var Ci=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Fu=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var pe,X;function vg(r){switch(r){default:return q();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function Eg(r){if(r===void 0)return fe("GRPC error has no .code"),P.UNKNOWN;switch(r){case pe.OK:return P.OK;case pe.CANCELLED:return P.CANCELLED;case pe.UNKNOWN:return P.UNKNOWN;case pe.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case pe.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case pe.INTERNAL:return P.INTERNAL;case pe.UNAVAILABLE:return P.UNAVAILABLE;case pe.UNAUTHENTICATED:return P.UNAUTHENTICATED;case pe.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case pe.NOT_FOUND:return P.NOT_FOUND;case pe.ALREADY_EXISTS:return P.ALREADY_EXISTS;case pe.PERMISSION_DENIED:return P.PERMISSION_DENIED;case pe.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case pe.ABORTED:return P.ABORTED;case pe.OUT_OF_RANGE:return P.OUT_OF_RANGE;case pe.UNIMPLEMENTED:return P.UNIMPLEMENTED;case pe.DATA_LOSS:return P.DATA_LOSS;default:return q()}}(X=pe||(pe={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var ef=null;function Ig(){return new TextEncoder}var yy=new Ot([4294967295,4294967295],0);function tf(r){let e=Ig().encode(r),t=new Ja;return t.update(e),new Uint8Array(t.digest())}function nf(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ot([t,n],0),new Ot([i,s],0)]}var Mu=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new _n(`Invalid padding: ${t}`);if(n<0)throw new _n(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new _n(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new _n(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Ot.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Ot.fromNumber(n)));return i.compare(yy)===1&&(i=new Ot([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=tf(e),[n,i]=nf(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new r(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(this.Ie===0)return;let t=tf(e),[n,i]=nf(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},_n=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Di=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,xi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(B.min(),i,new oe(Q),Be(),W())}},xi=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,W(),W(),W())}};var or=class{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}},Ys=class{constructor(e,t){this.targetId=e,this.me=t}},Zs=class{constructor(e,t,n=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},eo=class{constructor(){this.fe=0,this.ge=sf(),this.pe=Ie.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=W(),t=W(),n=W();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:q()}}),new xi(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=sf()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,U(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Ou=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Be(),this.qe=rf(),this.Qe=new oe(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:q()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Hs(s))if(n===0){let a=new O(s.path);this.Ue(t,a,ve.newNoDocument(a,B.min()))}else U(n===1);else{let a=this.Ye(t);if(a!==n){let u=this.Ze(e),c=u?this.Xe(u,e,a):1;if(c!==0){this.je(t);let d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}ef?.et(function(f,m,_,A,V){var N,D,j,z,M,G;let K={localCacheCount:f,existenceFilterCount:m.count,databaseId:_.database,projectId:_.projectId},$=m.unchangedNames;return $&&(K.bloomFilter={applied:V===0,hashCount:(N=$?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(z=(j=(D=$?.bits)===null||D===void 0?void 0:D.bitmap)===null||j===void 0?void 0:j.length)!==null&&z!==void 0?z:0,padding:(G=(M=$?.bits)===null||M===void 0?void 0:M.padding)!==null&&G!==void 0?G:0,mightContain:v=>{var p;return(p=A?.mightContain(v))!==null&&p!==void 0&&p}}),K}(a,e.me,this.Le.tt(),u,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,a,u;try{a=$t(n).toUint8Array()}catch(c){if(c instanceof $s)return Qe("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Mu(a,i,s)}catch(c){return Qe(c instanceof _n?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&Hs(u.target)){let c=new O(u.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,ve.newNoDocument(c,e))}s.be&&(t.set(a,s.Ce()),s.ve())}});let n=W();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));let i=new Di(e,t,this.Qe,this.ke,n);return this.ke=Be(),this.qe=rf(),this.Qe=new oe(Q),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new eo,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new re(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new eo),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function rf(){return new oe(O.comparator)}function sf(){return new oe(O.comparator)}var wy={asc:"ASCENDING",desc:"DESCENDING"},vy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ey={and:"AND",or:"OR"},Lu=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function qu(r,e){return r.useProto3Json||zi(e)?e:{value:e}}function fr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Tg(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function Iy(r,e){return fr(r,e.toTimestamp())}function me(r){return U(!!r),B.fromTimestamp(function(t){let n=Et(t);return new ce(n.seconds,n.nanos)}(r))}function dl(r,e){return Uu(r,e).canonicalString()}function Uu(r,e){let t=function(i){return new Y(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function Ag(r){let e=Y.fromString(r);return U(Ng(e)),e}function ki(r,e){return dl(r.databaseId,e.path)}function at(r,e){let t=Ag(e);if(t.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new O(Rg(t))}function Sg(r,e){return dl(r.databaseId,e)}function bg(r){let e=Ag(r);return e.length===4?Y.emptyPath():Rg(e)}function Bu(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Rg(r){return U(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function of(r,e,t){return{name:ki(r,e),fields:t.value.mapValue.fields}}function Pg(r,e,t){let n=at(r,e.name),i=me(e.updateTime),s=e.createTime?me(e.createTime):B.min(),a=new ke({mapValue:{fields:e.fields}}),u=ve.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Ty(r,e){return"found"in e?function(n,i){U(!!i.found),i.found.name,i.found.updateTime;let s=at(n,i.found.name),a=me(i.found.updateTime),u=i.found.createTime?me(i.found.createTime):B.min(),c=new ke({mapValue:{fields:i.found.fields}});return ve.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){U(!!i.missing),U(!!i.readTime);let s=at(n,i.missing),a=me(i.readTime);return ve.newNoDocument(s,a)}(r,e):q()}function Ay(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:q()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(U(f===void 0||typeof f=="string"),Ie.fromBase64String(f||"")):(U(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Ie.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let f=d.code===void 0?P.UNKNOWN:Eg(d.code);return new x(f,d.message||"")}(a);t=new Zs(n,i,s,u||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=at(r,n.document.name),s=me(n.document.updateTime),a=n.document.createTime?me(n.document.createTime):B.min(),u=new ke({mapValue:{fields:n.document.fields}}),c=ve.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];t=new or(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=at(r,n.document),s=n.readTime?me(n.readTime):B.min(),a=ve.newNoDocument(i,s),u=n.removedTargetIds||[];t=new or([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=at(r,n.document),s=n.removedTargetIds||[];t=new or([],s,i,null)}else{if(!("filter"in e))return q();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Fu(i,s),u=n.targetId;t=new Ys(u,a)}}return t}function Vi(r,e){let t;if(e instanceof Xt)t={update:of(r,e.key,e.value)};else if(e instanceof Yt)t={delete:ki(r,e.key)};else if(e instanceof Ze)t={update:of(r,e.key,e.data),updateMask:Dy(e.fieldMask)};else{if(!(e instanceof Ri))return q();t={verify:ki(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Ht)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof It)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Tt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Jt)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw q()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Iy(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:q()}(r,e.precondition)),t}function ju(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?de.updateTime(me(s.updateTime)):s.exists!==void 0?de.exists(s.exists):de.none()}(e.currentDocument):de.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)U(u.setToServerValue==="REQUEST_TIME"),c=new Ht;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new It(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Tt(f)}else"increment"in u?c=new Jt(a,u.increment):q();let d=ge.fromServerFormat(u.fieldPath);return new Tn(d,c)}(r,i)):[];if(e.update){e.update.name;let i=at(r,e.update.name),s=new ke({mapValue:{fields:e.update.fields}});if(e.updateMask){let a=function(c){let d=c.fieldPaths||[];return new Ge(d.map(f=>ge.fromServerFormat(f)))}(e.updateMask);return new Ze(i,s,a,t,n)}return new Xt(i,s,t,n)}if(e.delete){let i=at(r,e.delete);return new Yt(i,t)}if(e.verify){let i=at(r,e.verify);return new Ri(i,t)}return q()}function Sy(r,e){return r&&r.length>0?(U(e!==void 0),r.map(t=>function(i,s){let a=i.updateTime?me(i.updateTime):me(s);return a.isEqual(B.min())&&(a=me(s)),new Vu(a,i.transformResults||[])}(t,e))):[]}function Cg(r,e){return{documents:[Sg(r,e.path)]}}function Dg(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Sg(r,i);let s=function(d){if(d.length!==0)return Vg(te.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:er(_.field),direction:Ry(_.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=qu(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:i}}function xg(r){let e=bg(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){U(n===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(m){let _=kg(m);return _ instanceof te&&cl(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(_=>function(V){return new En(tr(V.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(_))}(t.orderBy));let u=null;t.limit&&(u=function(m){let _;return _=typeof m=="object"?m.value:m,zi(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(m){let _=!!m.before,A=m.values||[];return new lt(A,_)}(t.startAt));let d=null;return t.endAt&&(d=function(m){let _=!m.before,A=m.values||[];return new lt(A,_)}(t.endAt)),ig(e,i,a,s,u,"F",c,d)}function by(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function kg(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=tr(t.unaryFilter.field);return H.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=tr(t.unaryFilter.field);return H.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=tr(t.unaryFilter.field);return H.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=tr(t.unaryFilter.field);return H.create(a,"!=",{nullValue:"NULL_VALUE"});default:return q()}}(r):r.fieldFilter!==void 0?function(t){return H.create(tr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return q()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return te.create(t.compositeFilter.filters.map(n=>kg(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return q()}}(t.compositeFilter.op))}(r):q()}function Ry(r){return wy[r]}function Py(r){return vy[r]}function Cy(r){return Ey[r]}function er(r){return{fieldPath:r.canonicalString()}}function tr(r){return ge.fromServerFormat(r.fieldPath)}function Vg(r){return r instanceof H?function(t){if(t.op==="=="){if(jd(t.value))return{unaryFilter:{field:er(t.field),op:"IS_NAN"}};if(Bd(t.value))return{unaryFilter:{field:er(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(jd(t.value))return{unaryFilter:{field:er(t.field),op:"IS_NOT_NAN"}};if(Bd(t.value))return{unaryFilter:{field:er(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:er(t.field),op:Py(t.op),value:t.value}}}(r):r instanceof te?function(t){let n=t.getFilters().map(i=>Vg(i));return n.length===1?n[0]:{compositeFilter:{op:Cy(t.op),filters:n}}}(r):q()}function Dy(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ng(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var gr=class r{constructor(e,t,n,i,s=B.min(),a=B.min(),u=Ie.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var to=class{constructor(e){this.ct=e}};function xy(r,e){let t;if(e.document)t=Pg(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=O.fromSegments(e.noDocument.path),i=Sn(e.noDocument.readTime);t=ve.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return q();{let n=O.fromSegments(e.unknownDocument.path),i=Sn(e.unknownDocument.version);t=ve.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ce(i[0],i[1]);return B.fromTimestamp(s)}(e.readTime)),t}function af(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:no(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,a){return{name:ki(s,a.key),fields:a.data.value.mapValue.fields,updateTime:fr(s,a.version.toTimestamp()),createTime:fr(s,a.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:An(e.version)};else{if(!e.isUnknownDocument())return q();n.unknownDocument={path:t.path.toArray(),version:An(e.version)}}return n}function no(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function An(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Sn(r){let e=new ce(r.seconds,r.nanoseconds);return B.fromTimestamp(e)}function gn(r,e){let t=(e.baseMutations||[]).map(s=>ju(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let u=e.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>ju(r.ct,s)),i=ce.fromMillis(e.localWriteTimeMs);return new Pi(e.batchId,i,t,n)}function mi(r){let e=Sn(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?Sn(r.lastLimboFreeSnapshotVersion):B.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return U(s.documents.length===1),Oe(Sr(bg(s.documents[0])))}(r.query):function(s){return Oe(xg(s))}(r.query),new gr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ie.fromBase64String(r.resumeToken))}function Fg(r,e){let t=An(e.snapshotVersion),n=An(e.lastLimboFreeSnapshotVersion),i;i=Hs(e.target)?Cg(r.ct,e.target):Dg(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:In(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function fl(r){let e=xg({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Xs(e,e.limit,"L"):e}function ru(r,e){return new Ci(e.largestBatchId,ju(r.ct,e.overlayMutation))}function uf(r,e){let t=e.path.lastSegment();return[r,Me(e.path.popLast()),t]}function cf(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:An(n.readTime),documentKey:Me(n.documentKey.path),largestBatchId:n.largestBatchId}}var zu=class{getBundleMetadata(e,t){return lf(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:Sn(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return lf(e).put(function(i){return{bundleId:i.id,createTime:An(me(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return hf(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:fl(s.bundledQuery),readTime:Sn(s.readTime)}}(n)})}saveNamedQuery(e,t){return hf(e).put(function(i){return{name:i.name,readTime:An(me(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function lf(r){return Te(r,"bundles")}function hf(r){return Te(r,"namedQueries")}var ro=class r{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return li(e).get(uf(this.userId,t)).next(n=>n?ru(this.serializer,n):null)}getOverlays(e,t){let n=st();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,a)=>{let u=new Ci(t,a);i.push(this.ht(e,u))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(a=>i.add(Me(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(li(e).j("collectionPathOverlayIndex",u))}),b.waitFor(s)}getOverlaysForCollection(e,t,n){let i=st(),s=Me(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return li(e).U("collectionPathOverlayIndex",a).next(u=>{for(let c of u){let d=ru(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=st(),a,u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return li(e).J({index:"collectionGroupOverlayIndex",range:u},(c,d,f)=>{let m=ru(this.serializer,d);s.size()<i||m.largestBatchId===a?(s.set(m.getKey(),m),a=m.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return li(e).put(function(i,s,a){let[u,c,d]=uf(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Vi(i.ct,a.mutation)}}(this.serializer,this.userId,t))}};function li(r){return Te(r,"documentOverlays")}var wt=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(he(e.integerValue));else if("doubleValue"in e){let n=he(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Ii(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),typeof n=="string"&&(n=Et(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft($t(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Xf(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):q()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let n=e.fields||{};this.Et(t,55);for(let i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){let n=e.values||[];this.Et(t,50);for(let i of n)this.It(i,t)}gt(e,t){this.Et(t,37),O.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};wt.bt=new wt;function ky(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function df(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let a=ky(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(e/8)}var Gu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),n=df(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),n=df(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Ku=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},$u=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},mn=class{constructor(){this.Gt=new Gu,this.zt=new Ku(this.Gt),this.jt=new $u(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var pn=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function Lt(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=ff(r.arrayValue,e.arrayValue),t!==0?t:(t=ff(r.directionalValue,e.directionalValue),t!==0?t:O.comparator(r.documentKey,e.documentKey)))}function ff(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}var io=class{constructor(e){this.Yt=new re((t,n)=>ge.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let n=t;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(e){if(U(e.collectionGroup===this.collectionId),this.en)return!1;let t=gu(e);if(t!==void 0&&!this.nn(t))return!1;let n=dn(e),i=new Set,s=0,a=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){let u=this.Yt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.rn(u,c)||!this.sn(this.Zt[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.Zt.length||!this.sn(this.Zt[a++],u))return!1}return!0}on(){if(this.en)return null;let e=new re(ge.comparator),t=[];for(let n of this.Xt)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new ir(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ir(n.field,0))}for(let n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ir(n.field,n.dir==="asc"?0:1)));return new ur(ur.UNKNOWN_ID,this.collectionId,t,Ei.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function Mg(r){var e,t;if(U(r instanceof H||r instanceof te),r instanceof H){if(r instanceof Ws){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>H.create(r.field,"==",s)))||[];return te.create(i,"or")}return r}let n=r.filters.map(i=>Mg(i));return te.create(n,r.op)}function Vy(r){if(r.getFilters().length===0)return[];let e=Hu(Mg(r));return U(Og(e)),Qu(e)||Wu(e)?[e]:e.getFilters()}function Qu(r){return r instanceof H}function Wu(r){return r instanceof te&&cl(r)}function Og(r){return Qu(r)||Wu(r)||function(t){if(t instanceof te&&Iu(t)){for(let n of t.getFilters())if(!Qu(n)&&!Wu(n))return!1;return!0}return!1}(r)}function Hu(r){if(U(r instanceof H||r instanceof te),r instanceof H)return r;if(r.filters.length===1)return Hu(r.filters[0]);let e=r.filters.map(n=>Hu(n)),t=te.create(e,r.op);return t=so(t),Og(t)?t:(U(t instanceof te),U(lr(t)),U(t.filters.length>1),t.filters.reduce((n,i)=>gl(n,i)))}function gl(r,e){let t;return U(r instanceof H||r instanceof te),U(e instanceof H||e instanceof te),t=r instanceof H?e instanceof H?function(i,s){return te.create([i,s],"and")}(r,e):gf(r,e):e instanceof H?gf(e,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0),lr(i)&&lr(s))return tg(i,s.getFilters());let a=Iu(i)?i:s,u=Iu(i)?s:i,c=a.filters.map(d=>gl(d,u));return te.create(c,"or")}(r,e),so(t)}function gf(r,e){if(lr(e))return tg(e,r.getFilters());{let t=e.filters.map(n=>gl(r,n));return te.create(t,"or")}}function so(r){if(U(r instanceof H||r instanceof te),r instanceof H)return r;let e=r.getFilters();if(e.length===1)return so(e[0]);if(Zf(r))return r;let t=e.map(i=>so(i)),n=[];return t.forEach(i=>{i instanceof H?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:te.create(n,r.op)}var Ju=class{constructor(){this._n=new Ni}addToCollectionParentIndex(e,t){return this._n.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(We.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(We.min())}updateCollectionGroup(e,t,n){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},Ni=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new re(Y.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new re(Y.comparator)).toArray()}};var Ds=new Uint8Array(0),Xu=class{constructor(e,t){this.databaseId=t,this.an=new Ni,this.un=new ht(n=>In(n),(n,i)=>Gi(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:n,parent:Me(i)};return mf(e).put(s)}return b.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[Lf(t),""],!1,!0);return mf(e).U(i).next(s=>{for(let a of s){if(a.collectionId!==t)break;n.push(it(a.parent))}return n})}addFieldIndex(e,t){let n=hi(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let a=Jn(e);return s.next(u=>{a.put(cf(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=hi(e),i=Jn(e),s=Hn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hi(e),n=Hn(e),i=Jn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return b.forEach(this.cn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new io(n).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=Hn(e),i=!0,s=new Map;return b.forEach(this.cn(t),a=>this.ln(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=W(),u=[];return b.forEach(s,(c,d)=>{k("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`}(c)} to execute ${In(t)}`);let f=function(M,G){let K=gu(G);if(K===void 0)return null;for(let $ of Js(M,K.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(d,c),m=function(M,G){let K=new Map;for(let $ of dn(G))for(let v of Js(M,$.fieldPath))switch(v.op){case"==":case"in":K.set($.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return K.set($.fieldPath.canonicalString(),v.value),Array.from(K.values())}return null}(d,c),_=function(M,G){let K=[],$=!0;for(let v of dn(G)){let p=v.kind===0?Qd(M,v.fieldPath,M.startAt):Wd(M,v.fieldPath,M.startAt);K.push(p.value),$&&($=p.inclusive)}return new lt(K,$)}(d,c),A=function(M,G){let K=[],$=!0;for(let v of dn(G)){let p=v.kind===0?Wd(M,v.fieldPath,M.endAt):Qd(M,v.fieldPath,M.endAt);K.push(p.value),$&&($=p.inclusive)}return new lt(K,$)}(d,c),V=this.hn(c,d,_),N=this.hn(c,d,A),D=this.Pn(c,d,m),j=this.In(c.indexId,f,V,_.inclusive,N,A.inclusive,D);return b.forEach(j,z=>n.G(z,t.limit).next(M=>{M.forEach(G=>{let K=O.fromSegments(G.documentKey);a.has(K)||(a=a.add(K),u.push(K))})}))}).next(()=>u)}return b.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=Vy(te.create(e.filters,"and")).map(n=>xu(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,n,i,s,a,u){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),d=c/(t!=null?t.length:1),f=[];for(let m=0;m<c;++m){let _=t?this.Tn(t[m/d]):Ds,A=this.En(e,_,n[m%d],i),V=this.dn(e,_,s[m%d],a),N=u.map(D=>this.En(e,_,D,!0));f.push(...this.createRange(A,V,N))}return f}En(e,t,n,i){let s=new pn(e,O.empty(),t,n);return i?s:s.Jt()}dn(e,t,n,i){let s=new pn(e,O.empty(),t,n);return i?s.Jt():s}ln(e,t){let n=new io(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(let u of s)n.tn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2,i=this.cn(t);return b.forEach(i,s=>this.ln(e,s).next(a=>{a?n!==0&&a.fields.length<function(c){let d=new re(ge.comparator),f=!1;for(let m of c.filters)for(let _ of m.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let m of c.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(t)&&i.length>1&&n===2?1:n)}An(e,t){let n=new mn;for(let i of dn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let a=n.Ht(i.kind);wt.bt.Pt(s,a)}return n.Wt()}Tn(e){let t=new mn;return wt.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let n=new mn;return wt.bt.Pt(vn(this.databaseId,t),n.Ht(function(s){let a=dn(s);return a.length===0?0:a[a.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(n===null)return[];let i=[];i.push(new mn);let s=0;for(let a of dn(e)){let u=n[s++];for(let c of i)if(this.Vn(t,a.fieldPath)&&bi(u))i=this.mn(i,a,u);else{let d=c.Ht(a.kind);wt.bt.Pt(u,d)}}return this.fn(i)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){let i=[...e],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new mn;c.seed(u.Wt()),wt.bt.Pt(a,c.Ht(t.kind)),s.push(c)}return s}Vn(e,t){return!!e.filters.find(n=>n instanceof H&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=hi(e),i=Jn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let a=[];return b.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,m){let _=m?new Ei(m.sequenceNumber,new We(Sn(m.readTime),new O(it(m.documentKey)),m.largestBatchId)):Ei.empty(),A=f.fields.map(([V,N])=>new ir(ge.fromServerFormat(V),N));return new ur(f.indexId,f.collectionGroup,A,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Q(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=hi(e),s=Jn(e);return this.gn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>b.forEach(u,c=>s.put(cf(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){let n=new Map;return b.forEach(t,(i,s)=>{let a=n.get(i.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),b.forEach(u,c=>this.pn(e,i,c).next(d=>{let f=this.yn(s,c);return d.isEqual(f)?b.resolve():this.wn(e,s,c,d,f)}))))})}Sn(e,t,n,i){return Hn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,i){return Hn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){let i=Hn(e),s=new re(Lt);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(a,u)=>{s=s.add(new pn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}yn(e,t){let n=new re(Lt),i=this.An(t,e);if(i==null)return n;let s=gu(t);if(s!=null){let a=e.data.field(s.fieldPath);if(bi(a))for(let u of a.arrayValue.values||[])n=n.add(new pn(t.indexId,e.key,this.Tn(u),i))}else n=n.add(new pn(t.indexId,e.key,Ds,i));return n}wn(e,t,n,i,s){k("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let a=[];return function(c,d,f,m,_){let A=c.getIterator(),V=d.getIterator(),N=Wn(A),D=Wn(V);for(;N||D;){let j=!1,z=!1;if(N&&D){let M=f(N,D);M<0?z=!0:M>0&&(j=!0)}else N!=null?z=!0:j=!0;j?(m(D),D=Wn(V)):z?(_(N),N=Wn(A)):(N=Wn(A),D=Wn(V))}}(i,s,Lt,u=>{a.push(this.Sn(e,t,n,u))},u=>{a.push(this.bn(e,t,n,u))}),b.waitFor(a)}gn(e){let t=1;return Jn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>Lt(a,u)).filter((a,u,c)=>!u||Lt(a,c[u-1])!==0);let i=[];i.push(e);for(let a of n){let u=Lt(a,e),c=Lt(a,t);if(u===0)i[0]=e.Jt();else if(u>0&&c<0)i.push(a),i.push(a.Jt());else if(c>0)break}i.push(t);let s=[];for(let a=0;a<i.length;a+=2){if(this.Dn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Ds,[]],c=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Ds,[]];s.push(IDBKeyRange.bound(u,c))}return s}Dn(e,t){return Lt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(pf)}getMinOffset(e,t){return b.mapArray(this.cn(t),n=>this.ln(e,n).next(i=>i||q())).next(pf)}};function mf(r){return Te(r,"collectionParents")}function Hn(r){return Te(r,"indexEntries")}function hi(r){return Te(r,"indexConfiguration")}function Jn(r){return Te(r,"indexState")}function pf(r){U(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;ol(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new We(e.readTime,e.documentKey,t)}var _f={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$e=class r{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Lg(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId),u=0,c=n.J({range:a},(f,m,_)=>(u++,_.delete()));s.push(c.next(()=>{U(u===1)}));let d=[];for(let f of t.mutations){let m=Gf(e,f.key.path,t.batchId);s.push(i.delete(m)),d.push(f.key)}return b.waitFor(s).next(()=>d)}function oo(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw q();e=r.noDocument}return JSON.stringify(e).length}$e.DEFAULT_COLLECTION_PERCENTILE=10,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$e.DEFAULT=new $e(41943040,$e.DEFAULT_COLLECTION_PERCENTILE,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$e.DISABLED=new $e(-1,0,0);var ao=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(e,t,n,i){U(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=nr(e),a=qt(e);return a.add({}).next(u=>{U(typeof u=="number");let c=new Pi(u,t,n,i),d=function(A,V,N){let D=N.baseMutations.map(z=>Vi(A.ct,z)),j=N.mutations.map(z=>Vi(A.ct,z));return{userId:V,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:D,mutations:j}}(this.serializer,this.userId,c),f=[],m=new re((_,A)=>Q(_.canonicalString(),A.canonicalString()));for(let _ of i){let A=Gf(this.userId,_.key.path,u);m=m.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(A,U_))}return m.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Cn[u]=c.keys()}),b.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return qt(e).get(t).next(n=>n?(U(n.userId===this.userId),gn(this.serializer,n)):null)}vn(e,t){return this.Cn[t]?b.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return qt(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(U(u.batchId>=n),s=gn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return qt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qt(e).U("userMutationsIndex",t).next(n=>n.map(i=>gn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=Ns(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return nr(e).J({range:i},(a,u,c)=>{let[d,f,m]=a,_=it(f);if(d===this.userId&&t.path.isEqual(_))return qt(e).get(m).next(A=>{if(!A)throw q();U(A.userId===this.userId),s.push(gn(this.serializer,A))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new re(Q),i=[];return t.forEach(s=>{let a=Ns(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=nr(e).J({range:u},(d,f,m)=>{let[_,A,V]=d,N=it(A);_===this.userId&&s.path.isEqual(N)?n=n.add(V):m.done()});i.push(c)}),b.waitFor(i).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=Ns(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new re(Q);return nr(e).J({range:a},(c,d,f)=>{let[m,_,A]=c,V=it(_);m===this.userId&&n.isPrefixOf(V)?V.length===i&&(u=u.add(A)):f.done()}).next(()=>this.Fn(e,u))}Fn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(qt(e).get(s).next(a=>{if(a===null)throw q();U(a.userId===this.userId),n.push(gn(this.serializer,a))}))}),b.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Lg(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),b.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return nr(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=it(s[1]);i.push(c)}else u.done()}).next(()=>{U(i.length===0)})})}containsKey(e,t){return qg(e,this.userId,t)}xn(e){return Ug(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function qg(r,e,t){let n=Ns(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return nr(r).J({range:s,H:!0},(u,c,d)=>{let[f,m,_]=u;f===e&&m===i&&(a=!0),d.done()}).next(()=>a)}function qt(r){return Te(r,"mutations")}function nr(r){return Te(r,"documentMutations")}function Ug(r){return Te(r,"mutationQueues")}var mr=class r{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new r(0)}static Ln(){return new r(-1)}};var Yu=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let n=new mr(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>B.fromTimestamp(new ce(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Xn(e).delete(t.targetId)).next(()=>this.Bn(e)).next(n=>(U(n.targetCount>0),n.targetCount-=1,this.kn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return Xn(e).J((a,u)=>{let c=mi(u);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Xn(e).J((n,i)=>{let s=mi(i);t(s)})}Bn(e){return yf(e).get("targetGlobalKey").next(t=>(U(t!==null),t))}kn(e,t){return yf(e).put("targetGlobalKey",t)}qn(e,t){return Xn(e).put(Fg(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=In(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Xn(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{let d=mi(u);Gi(t,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Ut(e);return t.forEach(a=>{let u=Me(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),b.waitFor(i)}removeMatchingKeys(e,t,n){let i=Ut(e);return b.forEach(t,s=>{let a=Me(s.path);return b.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Ut(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ut(e),s=W();return i.J({range:n,H:!0},(a,u,c)=>{let d=it(a[1]),f=new O(d);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=Me(t.path),i=IDBKeyRange.bound([n],[Lf(n)],!1,!0),s=0;return Ut(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(e,t){return Xn(e).get(t).next(n=>n?mi(n):null)}};function Xn(r){return Te(r,"targets")}function yf(r){return Te(r,"targetGlobal")}function Ut(r){return Te(r,"targetDocuments")}function wf([r,e],[t,n]){let i=Q(r,t);return i===0?Q(e,n):i}var Zu=class{constructor(e){this.Kn=e,this.buffer=new re(wf),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();wf(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},ec=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){k("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>C(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){tn(t)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield en(t)}yield this.zn(3e5)}))}},tc=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return b.resolve(ze.oe);let n=new Zu(t);return this.jn.forEachTarget(e,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(_f)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_f):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,i,s,a,u,c,d,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,u=Date.now(),this.removeTargets(e,n,t))).next(m=>(s=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(d=Date.now(),Yn()<=rt.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function Ny(r,e){return new tc(r,e)}var nc=class{constructor(e,t){this.db=e,this.garbageCollector=Ny(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}Zn(e){let t=0;return this.Jn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(n,i)=>t(i))}addReference(e,t,n){return xs(e,n)}removeReference(e,t,n){return xs(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return xs(e,t)}er(e,t){return function(i,s){let a=!1;return Ug(i).Y(u=>qg(i,u,s).next(c=>(c&&(a=!0),b.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(a,u)=>{if(u<=t){let c=this.er(e,a).next(d=>{if(!d)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,B.min()),Ut(e).delete(function(m){return[0,Me(m.path)]}(a))))});i.push(c)}}).next(()=>b.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return xs(e,t)}Xn(e,t){let n=Ut(e),i,s=ze.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:d})=>{a===0?(s!==ze.oe&&t(new O(it(i)),s),s=d,i=c):s=ze.oe}).next(()=>{s!==ze.oe&&t(new O(it(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function xs(r,e){return Ut(r).put(function(n,i){return{targetId:0,path:Me(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var uo=class{constructor(){this.changes=new ht(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ve.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?b.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var rc=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return hn(e).put(n)}removeEntry(e,t,n){return hn(e).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],no(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=ve.newInvalidDocument(t);return hn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(di(t))},(i,s)=>{n=this.nr(t,s)}).next(()=>n)}rr(e,t){let n={size:0,document:ve.newInvalidDocument(t)};return hn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(di(t))},(i,s)=>{n={document:this.nr(t,s),size:oo(s)}}).next(()=>n)}getEntries(e,t){let n=Be();return this.ir(e,t,(i,s)=>{let a=this.nr(i,s);n=n.insert(i,a)}).next(()=>n)}sr(e,t){let n=Be(),i=new oe(O.comparator);return this.ir(e,t,(s,a)=>{let u=this.nr(s,a);n=n.insert(s,u),i=i.insert(s,oo(a))}).next(()=>({documents:n,_r:i}))}ir(e,t,n){if(t.isEmpty())return b.resolve();let i=new re(If);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(di(i.first()),di(i.last())),a=i.getIterator(),u=a.getNext();return hn(e).J({index:"documentKeyIndex",range:s},(c,d,f)=>{let m=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&If(u,m)<0;)n(u,null),u=a.getNext();u&&u.isEqual(m)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(di(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let a=t.path,u=[a.popLast().toArray(),a.lastSegment(),no(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hn(e).U(IDBKeyRange.bound(u,c,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Be();for(let m of d){let _=this.nr(O.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);_.isFoundDocument()&&($i(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=Be(),a=Ef(t,n),u=Ef(t,We.max());return hn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,d,f)=>{let m=this.nr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new ic(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return vf(e).get("remoteDocumentGlobalKey").next(t=>(U(!!t),t))}tr(e,t){return vf(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let n=xy(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return ve.newInvalidDocument(e)}};function Bg(r){return new rc(r)}var ic=class extends uo{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new ht(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new re((s,a)=>Q(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,u.readTime)),a.isValidDocument()){let c=af(this.ar.serializer,a);i=i.add(s.path.popLast());let d=oo(c);n+=d-u.size,t.push(this.ar.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){let c=af(this.ar.serializer,a.convertToNoDocument(B.min()));t.push(this.ar.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,n)),b.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(n=>(this.ur.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:n,_r:i})=>(i.forEach((s,a)=>{this.ur.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function vf(r){return Te(r,"remoteDocumentGlobal")}function hn(r){return Te(r,"remoteDocumentsV14")}function di(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ef(r,e){let t=e.documentKey.path.toArray();return[r,no(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function If(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=Q(t[s],n[s]),i)return i;return i=Q(t.length,n.length),i||(i=Q(t[t.length-2],n[n.length-2]),i||Q(t[t.length-1],n[n.length-1]))}var sc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var co=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&yi(n.mutation,i,Ge.empty(),ce.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,W()).next(()=>n))}getLocalViewOfDocuments(e,t,n=W()){let i=st();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=gi();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let n=st();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,W()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=Be(),a=_i(),u=function(){return _i()}();return t.forEach((c,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof Ze)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),yi(f.mutation,d,f.mutation.getFieldMask(),ce.now())):a.set(d.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((d,f)=>a.set(d,f)),t.forEach((d,f)=>{var m;return u.set(d,new sc(f,(m=a.get(d))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(e,t){let n=_i(),i=new oe((a,u)=>a-u),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(c=>{let d=t.get(c);if(d===null)return;let f=n.get(c)||Ge.empty();f=u.applyToLocalView(d,f),n.set(c,f);let m=(i.get(u.batchId)||W()).add(c);i=i.insert(u.batchId,m)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),d=c.key,f=c.value,m=lg();f.forEach(_=>{if(!s.has(_)){let A=yg(t.get(_),n.get(_));A!==null&&m.set(_,A),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ll(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):b.resolve(st()),u=-1,c=s;return a.next(d=>b.forEach(d,(f,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,c,d,W())).next(f=>({batchId:u,changes:cg(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(n=>{let i=gi();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,a=gi();return this.indexManager.getCollectionParents(e,s).next(u=>b.forEach(u,c=>{let d=function(m,_){return new Ye(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,n,i).next(f=>{f.forEach((m,_)=>{a=a.insert(m,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,ve.newInvalidDocument(f)))});let u=gi();return a.forEach((c,d)=>{let f=s.get(c);f!==void 0&&yi(f.mutation,d,Ge.empty(),ce.now()),$i(t,d)&&(u=u.insert(c,d))}),u})}};var oc=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return b.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:me(i.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:fl(i.bundledQuery),readTime:me(i.readTime)}}(t)),b.resolve()}};var ac=class{constructor(){this.overlays=new oe(O.comparator),this.hr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let n=st();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.hr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),b.resolve()}getOverlaysForCollection(e,t,n){let i=st(),s=t.length+1,a=new O(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new oe((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=st(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=st(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return b.resolve(u)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Ci(t,n));let s=this.hr.get(t);s===void 0&&(s=W(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}};var Fi=class{constructor(){this.Pr=new re(_e.Ir),this.Tr=new re(_e.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let n=new _e(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Ar(new _e(e,t))}Rr(e,t){e.forEach(n=>this.removeReference(n,t))}Vr(e){let t=new O(new Y([])),n=new _e(t,e),i=new _e(t,e+1),s=[];return this.Tr.forEachInRange([n,i],a=>{this.Ar(a),s.push(a.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new O(new Y([])),n=new _e(t,e),i=new _e(t,e+1),s=W();return this.Tr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new _e(e,0),n=this.Pr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},_e=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return O.comparator(e.key,t.key)||Q(e.pr,t.pr)}static Er(e,t){return Q(e.pr,t.pr)||O.comparator(e.key,t.key)}};var uc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new re(_e.Ir)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Pi(s,t,n,i);this.mutationQueue.push(a);for(let u of i)this.wr=this.wr.add(new _e(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(e,t){return b.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.br(n),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new _e(t,0),i=new _e(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],a=>{let u=this.Sr(a.pr);s.push(u)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new re(Q);return t.forEach(i=>{let s=new _e(i,0),a=new _e(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,a],u=>{n=n.add(u.pr)})}),b.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;O.isDocumentKey(s)||(s=s.child(""));let a=new _e(new O(s),0),u=new re(Q);return this.wr.forEachWhile(c=>{let d=c.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.pr)),!0)},a),b.resolve(this.Dr(u))}Dr(e){let t=[];return e.forEach(n=>{let i=this.Sr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){U(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.wr;return b.forEach(t.mutations,i=>{let s=new _e(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){let n=new _e(t,0),i=this.wr.firstAfterOrEqual(n);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var cc=class{constructor(e){this.vr=e,this.docs=function(){return new oe(O.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return b.resolve(n?n.document.mutableCopy():ve.newInvalidDocument(t))}getEntries(e,t){let n=Be();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():ve.newInvalidDocument(i))}),b.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Be(),a=t.path,u=new O(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ol(Uf(f),n)<=0||(i.has(f.key)||$i(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,n,i){q()}Fr(e,t){return b.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new lc(this)}getSize(e){return b.resolve(this.size)}},lc=class extends uo{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(n)}),b.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var hc=class{constructor(e){this.persistence=e,this.Mr=new ht(t=>In(t),Gi),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Fi,this.targetCount=0,this.Lr=mr.Nn()}forEachTarget(e,t){return this.Mr.forEach((n,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),b.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new mr(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.qn(t),b.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Mr.forEach((a,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.Mr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let n=this.Mr.get(t)||null;return b.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),b.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Nr.gr(t);return b.resolve(n)}containsKey(e,t){return b.resolve(this.Nr.containsKey(t))}};var lo=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new ze(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new hc(this),this.indexManager=new Ju,this.remoteDocumentCache=function(i){return new cc(i)}(n=>this.referenceDelegate.Kr(n)),this.serializer=new to(t),this.$r=new oc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ac,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new uc(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);let i=new dc(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return b.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}},dc=class extends zs{constructor(e){super(),this.currentSequenceNumber=e}},ho=class r{constructor(e){this.persistence=e,this.zr=new Fi,this.jr=null}static Hr(e){return new r(e)}get Jr(){if(this.jr)return this.jr;throw q()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),b.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),b.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Jr,n=>{let i=O.fromPath(n);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,B.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(n=>{n?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return b.or([()=>b.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var fc=class{constructor(e){this.serializer=e}O(e,t,n,i){let s=new Gs("createOrUpgrade",t);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ld,{unique:!0}),c.createObjectStore("documentMutations")}(e),Tf(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=b.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Tf(e)),a=a.next(()=>function(c){let d=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ld,{unique:!0});let m=d.store("mutations"),_=f.map(A=>m.put(A));return b.waitFor(_)})}(e,s))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(a=a.next(()=>this.Xr(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),n<7&&i>=7&&(a=a.next(()=>this.ti(s))),n<8&&i>=8&&(a=a.next(()=>this.ni(e,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(a=a.next(()=>this.ri(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let d=c.createObjectStore("documentOverlays",{keyPath:Y_});d.createIndex("collectionPathOverlayIndex",Z_,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",ey,{unique:!1})})(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){let d=c.createObjectStore("remoteDocumentsV14",{keyPath:B_});d.createIndex("documentKeyIndex",j_),d.createIndex("collectionGroupIndex",z_)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.si(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:W_}).createIndex("sequenceNumberIndex",H_,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:J_}).createIndex("documentKeyIndex",X_,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),a}ei(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=oo(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>b.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>b.forEach(u,c=>{U(c.userId===s.userId);let d=gn(this.serializer,c);return Lg(e,s.userId,d).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let c=new Y(a),d=function(m){return[0,Me(m)]}(c);s.push(t.get(d).next(f=>f?b.resolve():(m=>t.put({targetId:0,path:Me(m),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>b.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Q_});let n=t.store("collectionParents"),i=new Ni,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Me(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{let c=new Y(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],d)=>{let f=it(u);return s(f.popLast())}))}ri(e){let t=e.store("targets");return t.J((n,i)=>{let s=mi(i),a=Fg(this.serializer,s);return t.put(a)})}ii(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=t.store("remoteDocumentsV14"),c=function(m){return m.document?new O(Y.fromString(m.document.name).popFirst(5)):m.noDocument?O.fromSegments(m.noDocument.path):m.unknownDocument?O.fromSegments(m.unknownDocument.path):q()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>b.waitFor(i))}si(e,t){let n=t.store("mutations"),i=Bg(this.serializer),s=new lo(ho.Hr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(c=>{var d;let f=(d=u.get(c.userId))!==null&&d!==void 0?d:W();gn(this.serializer,c).keys().forEach(m=>f=f.add(m)),u.set(c.userId,f)}),b.forEach(u,(c,d)=>{let f=new ye(d),m=ro.lt(this.serializer,f),_=s.getIndexManager(f),A=ao.lt(f,this.serializer,_,s.referenceDelegate);return new co(i,A,m,_).recalculateAndSaveOverlaysForDocumentKeys(new Ti(t,ze.oe),c).next()})})}};function Tf(r){r.createObjectStore("targetDocuments",{keyPath:K_}).createIndex("documentTargetsIndex",$_,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",G_,{unique:!0}),r.createObjectStore("targetGlobal")}var iu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",gc=class r{constructor(e,t,n,i,s,a,u,c,d,f,m=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=s,this.window=a,this.document=u,this._i=d,this.ai=f,this.ui=m,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=_=>Promise.resolve(),!r.D())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new nc(this,i),this.Ti=t+"main",this.serializer=new to(c),this.Ei=new Kt(this.Ti,this.ui,new fc(this.serializer)),this.Qr=new Yu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Bg(this.serializer),this.$r=new zu,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,f===!1&&fe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,iu);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new ze(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>C(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(t=>C(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ks(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(tn(e))return k("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return fi(e).get("owner").next(t=>b.resolve(this.Si(t)))}bi(e){return ks(e).delete(this.clientId)}Di(){return C(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Te(t,"clientMetadata");return n.U().next(i=>{let s=this.vi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return b.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?b.resolve(!0):fi(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,iu);return!1}}return!(!this.networkEnabled||!this.inForeground)||ks(e).U().next(n=>this.vi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&k("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return C(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ti(e,ze.oe);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(n=>this.Ci(n.updateTimeMs,t)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>ks(e).U().next(t=>this.vi(t,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return ao.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Xu(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ro.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){k("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===16?ny:c===15?Wf:c===14?Qf:c===13?$f:c===12?ty:c===11?Kf:void q()}(this.ui),a;return this.Ei.runTransaction(e,i,s,u=>(a=new Ti(u,this.kr?this.kr.next():ze.oe),t==="readwrite-primary"?this.gi(a).next(c=>!!c||this.pi(a)).next(c=>{if(!c)throw fe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new x(P.FAILED_PRECONDITION,Bf);return n(a)}).next(c=>this.wi(a).next(()=>c)):this.ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ki(e){return fi(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,iu)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fi(e).put("owner",t)}static D(){return Kt.D()}yi(e){let t=fi(e);return t.get("owner").next(n=>this.Si(n)?(k("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Ci(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(fe(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;Ca()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let n=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return k("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return fe("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){fe("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function fi(r){return Te(r,"owner")}function ks(r){return Te(r,"clientMetadata")}function ml(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var mc=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=i}static Ki(e,t){let n=W(),i=W();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var pc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var fo=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Ca()?8:jf(ri())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.ji(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Hi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new pc;return this.Ji(e,t,a).next(u=>{if(s.result=u,this.Ui)return this.Yi(e,t,a,u.size)})}).next(()=>s.result)}Yi(e,t,n,i){return n.documentReadCount<this.Wi?(Yn()<=rt.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Zn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),b.resolve()):(Yn()<=rt.DEBUG&&k("QueryEngine","Query:",Zn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(Yn()<=rt.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Zn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Oe(t))):b.resolve())}ji(e,t){if(Hd(t))return b.resolve(null);let n=Oe(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Xs(t,null,"F"),n=Oe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let a=W(...s);return this.zi.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{let d=this.Zi(t,u);return this.Xi(t,d,a,c.readTime)?this.ji(e,Xs(t,null,"F")):this.es(e,d,t,c)}))})))}Hi(e,t,n,i){return Hd(t)||i.isEqual(B.min())?b.resolve(null):this.zi.getDocuments(e,n).next(s=>{let a=this.Zi(t,s);return this.Xi(t,a,n,i)?b.resolve(null):(Yn()<=rt.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Zn(t)),this.es(e,a,t,qf(i,-1)).next(u=>u))})}Zi(e,t){let n=new re(ag(e));return t.forEach((i,s)=>{$i(e,s)&&(n=n.add(s))}),n}Xi(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,n){return Yn()<=rt.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Zn(t)),this.zi.getDocumentsMatchingQuery(e,t,We.min(),n)}es(e,t,n,i){return this.zi.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var _c=class{constructor(e,t,n,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new oe(Q),this.rs=new ht(s=>In(s),Gi),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new co(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function jg(r,e,t,n){return new _c(r,e,t,n)}function zg(r,e){return C(this,null,function*(){let t=L(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=W();for(let d of i){a.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(d=>({us:d,removedBatchIds:a,addedBatchIds:u}))})})})}function Fy(r,e){let t=L(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(u,c,d,f){let m=d.batch,_=m.keys(),A=b.resolve();return _.forEach(V=>{A=A.next(()=>f.getEntry(c,V)).next(N=>{let D=d.docVersions.get(V);U(D!==null),N.version.compareTo(D)<0&&(m.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=W();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Gg(r){let e=L(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function My(r,e){let t=L(r),n=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let u=[];e.targetChanges.forEach((f,m)=>{let _=i.get(m);if(!_)return;u.push(t.Qr.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Qr.addMatchingKeys(s,f.addedDocuments,m)));let A=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?A=A.withResumeToken(Ie.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(m,A),function(N,D,j){return N.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(_,A,f)&&u.push(t.Qr.updateTargetData(s,A))});let c=Be(),d=W();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Kg(s,a,e.documentUpdates).next(f=>{c=f.cs,d=f.ls})),!n.isEqual(B.min())){let f=t.Qr.getLastRemoteSnapshotVersion(s).next(m=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return b.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(t.ns=i,s))}function Kg(r,e,t){let n=W(),i=W();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=Be();return t.forEach((u,c)=>{let d=s.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(B.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):k("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{cs:a,ls:i}})}function Oy(r,e){let t=L(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function pr(r,e){let t=L(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Qr.getTargetData(n,e).next(s=>s?(i=s,b.resolve(i)):t.Qr.allocateTargetId(n).next(a=>(i=new gr(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.ns.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(n.targetId,n),t.rs.set(e,n.targetId)),n})}function _r(r,e,t){return C(this,null,function*(){let n=L(r),i=n.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!tn(a))throw a;k("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.ns=n.ns.remove(e),n.rs.delete(i.target)})}function go(r,e,t){let n=L(r),i=B.min(),s=W();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){let m=L(c),_=m.rs.get(f);return _!==void 0?b.resolve(m.ns.get(_)):m.Qr.getTargetData(d,f)}(n,a,Oe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ts.getDocumentsMatchingQuery(a,e,t?i:B.min(),t?s:W())).next(u=>(Wg(n,og(e),u),{documents:u,hs:s})))}function $g(r,e){let t=L(r),n=L(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function Qg(r,e){let t=L(r),n=t.ss.get(e)||B.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,qf(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Wg(t,e,i),i))}function Wg(r,e,t){let n=r.ss.get(e)||B.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(e,n)}function Ly(r,e,t,n){return C(this,null,function*(){let i=L(r),s=W(),a=Be();for(let d of t){let f=e.Ps(d.metadata.name);d.document&&(s=s.add(f));let m=e.Is(d);m.setReadTime(e.Ts(d.metadata.readTime)),a=a.insert(f,m)}let u=i.os.newChangeBuffer({trackRemovals:!0}),c=yield pr(i,function(f){return Oe(Sr(Y.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>Kg(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(d,c.targetId).next(()=>i.Qr.addMatchingKeys(d,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.cs,f.ls)).next(()=>f.cs)))})}function qy(n,i){return C(this,arguments,function*(r,e,t=W()){let s=yield pr(r,Oe(fl(e.bundledQuery))),a=L(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=me(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return a.$r.saveNamedQuery(u,e);let d=s.withResumeToken(Ie.EMPTY_BYTE_STRING,c);return a.ns=a.ns.insert(d.targetId,d),a.Qr.updateTargetData(u,d).next(()=>a.Qr.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Qr.addMatchingKeys(u,t,s.targetId)).next(()=>a.$r.saveNamedQuery(u,e))})})}function Af(r,e){return`firestore_clients_${r}_${e}`}function Sf(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function su(r,e){return`firestore_targets_${r}_${e}`}var mo=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Es(e,t,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new x(i.error.code,i.error.message))),a?new r(e,t,i.state,s):(fe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},wi=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new x(n.error.code,n.error.message))),s?new r(e,n.state,i):(fe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},po=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=hl();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=zf(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(e,s):(fe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},yc=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(fe("SharedClientState",`Failed to parse online state: ${e}`),null)}},Mi=class{constructor(){this.activeTargetIds=hl()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},vi=class{constructor(e,t,n,i,s){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new oe(Q),this.started=!1,this.ys=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=Af(this.persistenceKey,this.Vs),this.Ss=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Mi),this.bs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Fs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return C(this,null,function*(){let e=yield this.syncEngine.Bi();for(let n of e){if(n===this.Vs)continue;let i=this.getItem(Af(this.persistenceKey,n));if(i){let s=po.Es(n,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let n=this.xs(t);n&&this.Os(n)}for(let n of this.ys)this.gs(n);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(su(this.persistenceKey,e));if(n){let i=wi.Es(e,n);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(su(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return k("SharedClientState","READ",e,t),t}setItem(e,t){k("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){k("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(k("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void fe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>C(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let n=this.$s(t.key);return this.Us(n,null)}{let n=this.Ws(t.key,t.newValue);if(n)return this.Us(n.clientId,n)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let n=this.Gs(t.key,t.newValue);if(n)return this.zs(n)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let n=this.js(t.key,t.newValue);if(n)return this.Hs(n)}}else if(t.key===this.vs){if(t.newValue!==null){let n=this.xs(t.newValue);if(n)return this.Os(n)}}else if(t.key===this.Ss){let n=function(s){let a=ze.oe;if(s!=null)try{let u=JSON.parse(s);U(typeof u=="number"),a=u}catch(u){fe("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(t.newValue);n!==ze.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Fs){let n=this.Js(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){let i=new mo(this.currentUser,e,t,n),s=Sf(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=Sf(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){let i=su(this.persistenceKey,e),s=new wi(e,t,n);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let n=this.$s(e);return po.Es(n,t)}Gs(e,t){let n=this.Ds.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return mo.Es(new ye(s),i,t)}js(e,t){let n=this.Cs.exec(e),i=Number(n[1]);return wi.Es(i,t)}xs(e){return yc.Es(e)}Js(e){return JSON.parse(e)}zs(e){return C(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);k("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let n=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.eo(a,u).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=hl();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},_o=class{constructor(){this.no=new Mi,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Mi,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var wc=class{io(e){}shutdown(){}};var yo=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Vs=null;function ou(){return Vs===null?Vs=function(){return 268435456+Math.round(2147483648*Math.random())}():Vs++,"0x"+Vs.toString(16)}var Uy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var vc=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}};var xe="WebChannelConnection",Ec=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+t.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(t,n,i,s,a){let u=ou(),c=this.vo(t,n.toUriEncodedString());k("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);let d={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(d,s,a),this.Mo(t,c,d,i).then(f=>(k("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Qe("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}xo(t,n,i,s,a,u){return this.Co(t,n,i,s,a)}Fo(t,n,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ar}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}vo(t,n){let i=Uy[t];return`${this.wo}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,i){let s=ou();return new Promise((a,u)=>{let c=new Xa;c.setWithCredentials(!0),c.listenOnce(Za.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case ci.NO_ERROR:let f=c.getResponseJson();k(xe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case ci.TIMEOUT:k(xe,`RPC '${e}' ${s} timed out`),u(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case ci.HTTP_ERROR:let m=c.getStatus();if(k(xe,`RPC '${e}' ${s} failed with status:`,m,"response text:",c.getResponseText()),m>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let A=_?.error;if(A&&A.status&&A.message){let V=function(D){let j=D.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(j)>=0?j:P.UNKNOWN}(A.status);u(new x(V,A.message))}else u(new x(P.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new x(P.UNAVAILABLE,"Connection failed."));break;default:q()}}finally{k(xe,`RPC '${e}' ${s} completed.`)}});let d=JSON.stringify(i);k(xe,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",d,n,15)})}Oo(e,t,n){let i=ou(),s=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=nu(),u=tu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.xmlHttpFactory=new Ya({})),this.Fo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let f=s.join("");k(xe,`Creating RPC '${e}' stream ${i}: ${f}`,c);let m=a.createWebChannel(f,c),_=!1,A=!1,V=new vc({lo:D=>{A?k(xe,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(k(xe,`Opening RPC '${e}' stream ${i} transport.`),m.open(),_=!0),k(xe,`RPC '${e}' stream ${i} sending:`,D),m.send(D))},ho:()=>m.close()}),N=(D,j,z)=>{D.listen(j,M=>{try{z(M)}catch(G){setTimeout(()=>{throw G},0)}})};return N(m,Qn.EventType.OPEN,()=>{A||(k(xe,`RPC '${e}' stream ${i} transport opened.`),V.mo())}),N(m,Qn.EventType.CLOSE,()=>{A||(A=!0,k(xe,`RPC '${e}' stream ${i} transport closed`),V.po())}),N(m,Qn.EventType.ERROR,D=>{A||(A=!0,Qe(xe,`RPC '${e}' stream ${i} transport errored:`,D),V.po(new x(P.UNAVAILABLE,"The operation could not be completed")))}),N(m,Qn.EventType.MESSAGE,D=>{var j;if(!A){let z=D.data[0];U(!!z);let M=z,G=M.error||((j=M[0])===null||j===void 0?void 0:j.error);if(G){k(xe,`RPC '${e}' stream ${i} received error:`,G);let K=G.status,$=function(w){let E=pe[w];if(E!==void 0)return Eg(E)}(K),v=G.message;$===void 0&&($=P.INTERNAL,v="Unknown error status: "+K+" with message "+G.message),A=!0,V.po(new x($,v)),m.close()}else k(xe,`RPC '${e}' stream ${i} received:`,z),V.yo(z)}}),N(u,eu.STAT_EVENT,D=>{D.stat===Cs.PROXY?k(xe,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Cs.NOPROXY&&k(xe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{V.fo()},0),V}};function Hg(){return typeof window<"u"?window:null}function Ls(){return typeof document<"u"?document:null}function Qi(r){return new Lu(r,!0)}var Oi=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,t-n);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var wo=class{constructor(e,t,n,i,s,a,u,c){this.oi=e,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Oi(e,t)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return C(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}r_(){return C(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(e,t){return C(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(fe(t.toString()),fe("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Ao(t)})}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===t&&this.u_(n,i)},n=>{e(()=>{let i=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(e,t){let n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>C(this,null,function*(){this.state=0,this.start()}))}c_(e){return k("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ic=class extends wo{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=Ay(this.serializer,e),n=function(s){if(!("targetChange"in s))return B.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?me(a.readTime):B.min()}(e);return this.listener.h_(t,n)}P_(e){let t={};t.database=Bu(this.serializer),t.addTarget=function(s,a){let u,c=a.target;if(u=Hs(c)?{documents:Cg(s,c)}:{query:Dg(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Tg(s,a.resumeToken);let d=qu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=fr(s,a.snapshotVersion.toTimestamp());let d=qu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let n=by(this.serializer,e);n&&(t.labels=n),this.i_(t)}I_(e){let t={};t.database=Bu(this.serializer),t.removeTarget=e,this.i_(t)}},Tc=class extends wo{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(U(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let t=Sy(e.writeResults,e.commitTime),n=me(e.commitTime);return this.listener.A_(n,t)}return U(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=Bu(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Vi(this.serializer,n))};this.i_(t)}};var Ac=class extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,Uu(t,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(P.UNKNOWN,s.toString())})}xo(e,t,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.xo(e,Uu(t,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},Sc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(fe(t),this.y_=!1):k("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var bc=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(a=>{n.enqueueAndForget(()=>C(this,null,function*(){nn(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(c){return C(this,null,function*(){let d=L(c);d.M_.add(4),yield br(d),d.N_.set("Unknown"),d.M_.delete(4),yield Wi(d)})}(this))}))}),this.N_=new Sc(n,i)}};function Wi(r){return C(this,null,function*(){if(nn(r))for(let e of r.x_)yield e(!0)})}function br(r){return C(this,null,function*(){for(let e of r.x_)yield e(!1)})}function Lo(r,e){let t=L(r);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),yl(t)?_l(t):Pr(t).Xo()&&pl(t,e))}function yr(r,e){let t=L(r),n=Pr(t);t.F_.delete(e),n.Xo()&&Jg(t,e),t.F_.size===0&&(n.Xo()?n.n_():nn(t)&&t.N_.set("Unknown"))}function pl(r,e){if(r.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(B.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Pr(r).P_(e)}function Jg(r,e){r.L_.xe(e),Pr(r).I_(e)}function _l(r){r.L_=new Ou({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.F_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Pr(r).start(),r.N_.w_()}function yl(r){return nn(r)&&!Pr(r).Zo()&&r.F_.size>0}function nn(r){return L(r).M_.size===0}function Xg(r){r.L_=void 0}function By(r){return C(this,null,function*(){r.N_.set("Online")})}function jy(r){return C(this,null,function*(){r.F_.forEach((e,t)=>{pl(r,e)})})}function zy(r,e){return C(this,null,function*(){Xg(r),yl(r)?(r.N_.D_(e),_l(r)):r.N_.set("Unknown")})}function Gy(r,e,t){return C(this,null,function*(){if(r.N_.set("Online"),e instanceof Zs&&e.state===2&&e.cause)try{yield function(i,s){return C(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.F_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.F_.delete(u),i.L_.removeTarget(u))})}(r,e)}catch(n){k("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield vo(r,n)}else if(e instanceof or?r.L_.Ke(e):e instanceof Ys?r.L_.He(e):r.L_.We(e),!t.isEqual(B.min()))try{let n=yield Gg(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){let u=s.L_.rt(a);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.F_.get(d);f&&s.F_.set(d,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,d)=>{let f=s.F_.get(c);if(!f)return;s.F_.set(c,f.withResumeToken(Ie.EMPTY_BYTE_STRING,f.snapshotVersion)),Jg(s,c);let m=new gr(f.target,c,d,f.sequenceNumber);pl(s,m)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){k("RemoteStore","Failed to raise snapshot:",n),yield vo(r,n)}})}function vo(r,e,t){return C(this,null,function*(){if(!tn(e))throw e;r.M_.add(1),yield br(r),r.N_.set("Offline"),t||(t=()=>Gg(r.localStore)),r.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield t(),r.M_.delete(1),yield Wi(r)}))})}function Yg(r,e){return e().catch(t=>vo(r,t,e))}function Rr(r){return C(this,null,function*(){let e=L(r),t=Zt(e),n=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;Ky(e);)try{let i=yield Oy(e.localStore,n);if(i===null){e.v_.length===0&&t.n_();break}n=i.batchId,$y(e,i)}catch(i){yield vo(e,i)}Zg(e)&&em(e)})}function Ky(r){return nn(r)&&r.v_.length<10}function $y(r,e){r.v_.push(e);let t=Zt(r);t.Xo()&&t.E_&&t.d_(e.mutations)}function Zg(r){return nn(r)&&!Zt(r).Zo()&&r.v_.length>0}function em(r){Zt(r).start()}function Qy(r){return C(this,null,function*(){Zt(r).V_()})}function Wy(r){return C(this,null,function*(){let e=Zt(r);for(let t of r.v_)e.d_(t.mutations)})}function Hy(r,e,t){return C(this,null,function*(){let n=r.v_.shift(),i=Nu.from(n,e,t);yield Yg(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Rr(r)})}function Jy(r,e){return C(this,null,function*(){e&&Zt(r).E_&&(yield function(n,i){return C(this,null,function*(){if(function(a){return vg(a)&&a!==P.ABORTED}(i.code)){let s=n.v_.shift();Zt(n).t_(),yield Yg(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Rr(n)}})}(r,e)),Zg(r)&&em(r)})}function bf(r,e){return C(this,null,function*(){let t=L(r);t.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let n=nn(t);t.M_.add(3),yield br(t),n&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Wi(t)})}function Rc(r,e){return C(this,null,function*(){let t=L(r);e?(t.M_.delete(2),yield Wi(t)):e||(t.M_.add(2),yield br(t),t.N_.set("Unknown"))})}function Pr(r){return r.B_||(r.B_=function(t,n,i){let s=L(t);return s.f_(),new Ic(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:By.bind(null,r),To:jy.bind(null,r),Ao:zy.bind(null,r),h_:Gy.bind(null,r)}),r.x_.push(e=>C(this,null,function*(){e?(r.B_.t_(),yl(r)?_l(r):r.N_.set("Unknown")):(yield r.B_.stop(),Xg(r))}))),r.B_}function Zt(r){return r.k_||(r.k_=function(t,n,i){let s=L(t);return s.f_(),new Tc(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:Qy.bind(null,r),Ao:Jy.bind(null,r),R_:Wy.bind(null,r),A_:Hy.bind(null,r)}),r.x_.push(e=>C(this,null,function*(){e?(r.k_.t_(),yield Rr(r)):(yield r.k_.stop(),r.v_.length>0&&(k("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))}))),r.k_}var Pc=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new we,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let a=Date.now()+n,u=new r(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Cr(r,e){if(fe("AsyncQueue",`${e}: ${r}`),tn(r))return new x(P.UNAVAILABLE,`${e}: ${r}`);throw r}var Eo=class r{constructor(e){this.comparator=e?(t,n)=>e(t,n)||O.comparator(t.key,n.key):(t,n)=>O.comparator(t.key,n.key),this.keyedMap=gi(),this.sortedSet=new oe(this.comparator)}static emptySet(e){return new r(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Io=class{constructor(){this.q_=new oe(O.comparator)}track(e){let t=e.doc.key,n=this.q_.get(t);n?e.type!==0&&n.type===3?this.q_=this.q_.insert(t,e):e.type===3&&n.type!==1?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.q_=this.q_.remove(t):e.type===1&&n.type===2?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):q():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}},wr=class r{constructor(e,t,n,i,s,a,u,c,d){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,n,i,s){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new r(e,t,Eo.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ki(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var Cc=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},Dc=class{constructor(){this.queries=new ht(e=>sg(e),Ki),this.onlineState="Unknown",this.z_=new Set}};function wl(r,e){return C(this,null,function*(){let t=L(r),n=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(n=2):(s=new Cc,n=e.G_()?0:1);try{switch(n){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Cr(a,`Initialization of query '${Zn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&El(t)})}function vl(r,e){return C(this,null,function*(){let t=L(r),n=e.query,i=3,s=t.queries.get(n);if(s){let a=s.U_.indexOf(e);a>=0&&(s.U_.splice(a,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function Xy(r,e){let t=L(r),n=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let u of a.U_)u.H_(i)&&(n=!0);a.K_=i}}n&&El(t)}function Yy(r,e,t){let n=L(r),i=n.queries.get(e);if(i)for(let s of i.U_)s.onError(t);n.queries.delete(e)}function El(r){r.z_.forEach(e=>{e.next()})}var xc,Rf;(Rf=xc||(xc={})).J_="default",Rf.Cache="cache";var Li=class{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new wr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let n=t!=="Offline";return(!this.options.ra||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=wr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==xc.Cache}};var kc=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var To=class{constructor(e){this.serializer=e}Ps(e){return at(this.serializer,e)}Is(e){return e.metadata.exists?Pg(this.serializer,e.document,!1):ve.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return me(e)}},Vc=class{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=tm(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let n=Y.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,n=new To(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Ps(i.metadata.name);for(let a of i.metadata.queries){let u=(t.get(a)||W()).add(s);t.set(a,u)}}return t}complete(){return C(this,null,function*(){let e=yield Ly(this.localStore,new To(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let n of this.queries)yield qy(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function tm(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Ao=class{constructor(e){this.key=e}},So=class{constructor(e){this.key=e}},bo=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=W(),this.mutatedKeys=W(),this.Ia=ag(e),this.Ta=new Eo(this.Ia)}get Ea(){return this.la}da(e,t){let n=t?t.Aa:new Io,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let _=i.get(f),A=$i(this.query,m)?m:null,V=!!_&&this.mutatedKeys.has(_.key),N=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),D=!1;_&&A?_.data.isEqual(A.data)?V!==N&&(n.track({type:3,doc:A}),D=!0):this.Ra(_,A)||(n.track({type:2,doc:A}),D=!0,(c&&this.Ia(A,c)>0||d&&this.Ia(A,d)<0)&&(u=!0)):!_&&A?(n.track({type:0,doc:A}),D=!0):_&&!A&&(n.track({type:1,doc:_}),D=!0,(c||d)&&(u=!0)),D&&(A?(a=a.add(A),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:a,Aa:n,Xi:u,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let a=e.Aa.Q_();a.sort((f,m)=>function(A,V){let N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q()}};return N(A)-N(V)}(f.type,m.type)||this.Ia(f.doc,m.doc)),this.Va(n),i=i!=null&&i;let u=t&&!i?this.ma():[],c=this.Pa.size===0&&this.current&&!i?1:0,d=c!==this.ha;return this.ha=c,a.length!==0||d?{snapshot:new wr(this.query,e.Ta,s,a,e.mutatedKeys,c===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Io,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=W(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});let t=[];return e.forEach(n=>{this.Pa.has(n)||t.push(new So(n))}),this.Pa.forEach(n=>{e.has(n)||t.push(new Ao(n))}),t}pa(e){this.la=e.hs,this.Pa=W();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return wr.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},Nc=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Fc=class{constructor(e){this.key=e,this.wa=!1}},Mc=class{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new ht(u=>sg(u),Ki),this.Da=new Map,this.Ca=new Set,this.va=new oe(O.comparator),this.Fa=new Map,this.Ma=new Fi,this.xa={},this.Oa=new Map,this.Na=mr.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function Zy(r,e,t=!0){return C(this,null,function*(){let n=qo(r),i,s=n.ba.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield nm(n,e,t,!0),i})}function ew(r,e){return C(this,null,function*(){let t=qo(r);yield nm(t,e,!0,!1)})}function nm(r,e,t,n){return C(this,null,function*(){let i=yield pr(r.localStore,Oe(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current",u;return n&&(u=yield Il(r,e,s,a==="current",i.resumeToken)),r.isPrimaryClient&&t&&Lo(r.remoteStore,i),u})}function Il(r,e,t,n,i){return C(this,null,function*(){r.Ba=(m,_,A)=>function(N,D,j,z){return C(this,null,function*(){let M=D.view.da(j);M.Xi&&(M=yield go(N.localStore,D.query,!1).then(({documents:v})=>D.view.da(v,M)));let G=z&&z.targetChanges.get(D.targetId),K=z&&z.targetMismatches.get(D.targetId)!=null,$=D.view.applyChanges(M,N.isPrimaryClient,G,K);return Oc(N,D.targetId,$.fa),$.snapshot})}(r,m,_,A);let s=yield go(r.localStore,e,!0),a=new bo(e,s.hs),u=a.da(s.documents),c=xi.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,c);Oc(r,t,d.fa);let f=new Nc(e,t,a);return r.ba.set(e,f),r.Da.has(t)?r.Da.get(t).push(e):r.Da.set(t,[e]),d.snapshot})}function tw(r,e,t){return C(this,null,function*(){let n=L(r),i=n.ba.get(e),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(a=>!Ki(a,e))),void n.ba.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield _r(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&yr(n.remoteStore,i.targetId),vr(n,i.targetId)}).catch(en))):(vr(n,i.targetId),yield _r(n.localStore,i.targetId,!0))})}function nw(r,e){return C(this,null,function*(){let t=L(r),n=t.ba.get(e),i=t.Da.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),yr(t.remoteStore,n.targetId))})}function rw(r,e,t){return C(this,null,function*(){let n=bl(r);try{let i=yield function(a,u){let c=L(a),d=ce.now(),f=u.reduce((A,V)=>A.add(V.key),W()),m,_;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let V=Be(),N=W();return c.os.getEntries(A,f).next(D=>{V=D,V.forEach((j,z)=>{z.isValidDocument()||(N=N.add(j))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,V)).next(D=>{m=D;let j=[];for(let z of u){let M=_y(z,m.get(z.key).overlayedDocument);M!=null&&j.push(new Ze(z.key,M,Yf(M.value.mapValue),de.exists(!0)))}return c.mutationQueue.addMutationBatch(A,d,j,u)}).next(D=>{_=D;let j=D.applyToLocalDocumentSet(m,N);return c.documentOverlayCache.saveOverlays(A,D.batchId,j)})}).then(()=>({batchId:_.batchId,changes:cg(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let d=a.xa[a.currentUser.toKey()];d||(d=new oe(Q)),d=d.insert(u,c),a.xa[a.currentUser.toKey()]=d}(n,i.batchId,t),yield bt(n,i.changes),yield Rr(n.remoteStore)}catch(i){let s=Cr(i,"Failed to persist write");t.reject(s)}})}function rm(r,e){return C(this,null,function*(){let t=L(r);try{let n=yield My(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Fa.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?U(a.wa):i.removedDocuments.size>0&&(U(a.wa),a.wa=!1))}),yield bt(t,n,e)}catch(n){yield en(n)}})}function Pf(r,e,t){let n=L(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.ba.forEach((s,a)=>{let u=a.view.j_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=L(a);c.onlineState=u;let d=!1;c.queries.forEach((f,m)=>{for(let _ of m.U_)_.j_(u)&&(d=!0)}),d&&El(c)}(n.eventManager,e),i.length&&n.Sa.h_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function iw(r,e,t){return C(this,null,function*(){let n=L(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Fa.get(e),s=i&&i.key;if(s){let a=new oe(O.comparator);a=a.insert(s,ve.newNoDocument(s,B.min()));let u=W().add(s),c=new Di(B.min(),new Map,new oe(Q),a,u);yield rm(n,c),n.va=n.va.remove(s),n.Fa.delete(e),Sl(n)}else yield _r(n.localStore,e,!1).then(()=>vr(n,e,t)).catch(en)})}function sw(r,e){return C(this,null,function*(){let t=L(r),n=e.batch.batchId;try{let i=yield Fy(t.localStore,e);Al(t,n,null),Tl(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield bt(t,i)}catch(i){yield en(i)}})}function ow(r,e,t){return C(this,null,function*(){let n=L(r);try{let i=yield function(a,u){let c=L(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,u).next(m=>(U(m!==null),f=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(n.localStore,e);Al(n,e,t),Tl(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield bt(n,i)}catch(i){yield en(i)}})}function aw(r,e){return C(this,null,function*(){let t=L(r);nn(t.remoteStore)||k("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=L(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let i=t.Oa.get(n)||[];i.push(e),t.Oa.set(n,i)}catch(n){let i=Cr(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Tl(r,e){(r.Oa.get(e)||[]).forEach(t=>{t.resolve()}),r.Oa.delete(e)}function Al(r,e,t){let n=L(r),i=n.xa[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.xa[n.currentUser.toKey()]=i}}function vr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Da.get(e))r.ba.delete(n),t&&r.Sa.ka(n,t);r.Da.delete(e),r.isPrimaryClient&&r.Ma.Vr(e).forEach(n=>{r.Ma.containsKey(n)||im(r,n)})}function im(r,e){r.Ca.delete(e.path.canonicalString());let t=r.va.get(e);t!==null&&(yr(r.remoteStore,t),r.va=r.va.remove(e),r.Fa.delete(t),Sl(r))}function Oc(r,e,t){for(let n of t)n instanceof Ao?(r.Ma.addReference(n.key,e),uw(r,n)):n instanceof So?(k("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,e),r.Ma.containsKey(n.key)||im(r,n.key)):q()}function uw(r,e){let t=e.key,n=t.path.canonicalString();r.va.get(t)||r.Ca.has(n)||(k("SyncEngine","New document in limbo: "+t),r.Ca.add(n),Sl(r))}function Sl(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){let e=r.Ca.values().next().value;r.Ca.delete(e);let t=new O(Y.fromString(e)),n=r.Na.next();r.Fa.set(n,new Fc(t)),r.va=r.va.insert(t,n),Lo(r.remoteStore,new gr(Oe(Sr(t.path)),n,"TargetPurposeLimboResolution",ze.oe))}}function bt(r,e,t){return C(this,null,function*(){let n=L(r),i=[],s=[],a=[];n.ba.isEmpty()||(n.ba.forEach((u,c)=>{a.push(n.Ba(c,e,t).then(d=>{if((d||t)&&n.isPrimaryClient){let f=d&&!d.fromCache;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){i.push(d);let f=mc.Ki(c.targetId,d);s.push(f)}}))}),yield Promise.all(a),n.Sa.h_(i),yield function(c,d){return C(this,null,function*(){let f=L(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>b.forEach(d,_=>b.forEach(_.qi,A=>f.persistence.referenceDelegate.addReference(m,_.targetId,A)).next(()=>b.forEach(_.Qi,A=>f.persistence.referenceDelegate.removeReference(m,_.targetId,A)))))}catch(m){if(!tn(m))throw m;k("LocalStore","Failed to update sequence numbers: "+m)}for(let m of d){let _=m.targetId;if(!m.fromCache){let A=f.ns.get(_),V=A.snapshotVersion,N=A.withLastLimboFreeSnapshotVersion(V);f.ns=f.ns.insert(_,N)}}})}(n.localStore,s))})}function cw(r,e){return C(this,null,function*(){let t=L(r);if(!t.currentUser.isEqual(e)){k("SyncEngine","User change. New user:",e.toKey());let n=yield zg(t.localStore,e);t.currentUser=e,function(s,a){s.Oa.forEach(u=>{u.forEach(c=>{c.reject(new x(P.CANCELLED,a))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield bt(t,n.us)}})}function lw(r,e){let t=L(r),n=t.Fa.get(e);if(n&&n.wa)return W().add(n.key);{let i=W(),s=t.Da.get(e);if(!s)return i;for(let a of s){let u=t.ba.get(a);i=i.unionWith(u.view.Ea)}return i}}function hw(r,e){return C(this,null,function*(){let t=L(r),n=yield go(t.localStore,e.query,!0),i=e.view.pa(n);return t.isPrimaryClient&&Oc(t,e.targetId,i.fa),i})}function dw(r,e){return C(this,null,function*(){let t=L(r);return Qg(t.localStore,e).then(n=>bt(t,n))})}function fw(r,e,t,n){return C(this,null,function*(){let i=L(r),s=yield function(u,c){let d=L(u),f=L(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.vn(m,c).next(_=>_?d.localDocuments.getDocuments(m,_):b.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Rr(i.remoteStore):t==="acknowledged"||t==="rejected"?(Al(i,e,n||null),Tl(i,e),function(u,c){L(L(u).mutationQueue).Mn(c)}(i.localStore,e)):q(),yield bt(i,s)):k("SyncEngine","Cannot apply mutation batch with id: "+e)})}function gw(r,e){return C(this,null,function*(){let t=L(r);if(qo(t),bl(t),e===!0&&t.La!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Cf(t,n.toArray());t.La=!0,yield Rc(t.remoteStore,!0);for(let s of i)Lo(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let n=[],i=Promise.resolve();t.Da.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(vr(t,a),_r(t.localStore,a,!0))),yr(t.remoteStore,a)}),yield i,yield Cf(t,n),function(a){let u=L(a);u.Fa.forEach((c,d)=>{yr(u.remoteStore,d)}),u.Ma.mr(),u.Fa=new Map,u.va=new oe(O.comparator)}(t),t.La=!1,yield Rc(t.remoteStore,!1)}})}function Cf(r,e,t){return C(this,null,function*(){let n=L(r),i=[],s=[];for(let a of e){let u,c=n.Da.get(a);if(c&&c.length!==0){u=yield pr(n.localStore,Oe(c[0]));for(let d of c){let f=n.ba.get(d),m=yield hw(n,f);m.snapshot&&s.push(m.snapshot)}}else{let d=yield $g(n.localStore,a);u=yield pr(n.localStore,d),yield Il(n,sm(d),a,!1,u.resumeToken)}i.push(u)}return n.Sa.h_(s),i})}function sm(r){return ig(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function mw(r){return function(t){return L(L(t).persistence).Bi()}(L(r).localStore)}function pw(r,e,t,n){return C(this,null,function*(){let i=L(r);if(i.La)return void k("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let a=yield Qg(i.localStore,og(s[0])),u=Di.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ie.EMPTY_BYTE_STRING);yield bt(i,a,u);break}case"rejected":yield _r(i.localStore,e,!0),vr(i,e,n);break;default:q()}})}function _w(r,e,t){return C(this,null,function*(){let n=qo(r);if(n.La){for(let i of e){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){k("SyncEngine","Adding an already active target "+i);continue}let s=yield $g(n.localStore,i),a=yield pr(n.localStore,s);yield Il(n,sm(s),a.targetId,!1,a.resumeToken),Lo(n.remoteStore,a)}for(let i of t)n.Da.has(i)&&(yield _r(n.localStore,i,!1).then(()=>{yr(n.remoteStore,i),vr(n,i)}).catch(en))}})}function qo(r){let e=L(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=rm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=iw.bind(null,e),e.Sa.h_=Xy.bind(null,e.eventManager),e.Sa.ka=Yy.bind(null,e.eventManager),e}function bl(r){let e=L(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sw.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ow.bind(null,e),e}function yw(r,e,t){let n=L(r);(function(s,a,u){return C(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(A,V){let N=L(A),D=me(V.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",j=>N.$r.getBundleMetadata(j,V.id)).then(j=>!!j&&j.createTime.compareTo(D)>=0)}(s.localStore,c))return yield a.close(),u._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(tm(c));let d=new Vc(c,s.localStore,a.serializer),f=yield a.qa();for(;f;){let _=yield d._a(f);_&&u._updateProgress(_),f=yield a.qa()}let m=yield d.complete();return yield bt(s,m.ca,void 0),yield function(A,V){let N=L(A);return N.persistence.runTransaction("Save bundle","readwrite",D=>N.$r.saveBundleMetadata(D,V))}(s.localStore,c),u._completeWith(m.progress),Promise.resolve(m.ua)}catch(c){return Qe("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var qi=class{constructor(){this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=Qi(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return jg(this.persistence,new fo,e.initialUser,this.serializer)}createPersistence(e){return new lo(ho.Hr,this.serializer)}createSharedClientState(e){return new _o}terminate(){return C(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Ro=class r extends qi{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){yield Aa(r.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield bl(this.Qa.syncEngine),yield Rr(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return jg(this.persistence,new fo,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new ec(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new yu(t,this.persistence);return new _u(e.asyncQueue,n)}createPersistence(e){let t=ml(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?$e.withCacheSize(this.cacheSizeBytes):$e.DEFAULT;return new gc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Hg(),Ls(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new _o}},Lc=class r extends Ro{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return C(this,null,function*(){yield Aa(r.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof vi&&(this.sharedClientState.syncEngine={Zs:fw.bind(null,t),Xs:pw.bind(null,t),eo:_w.bind(null,t),Bi:mw.bind(null,t),Ys:dw.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(n=>C(this,null,function*(){yield gw(this.Qa.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=Hg();if(!vi.D(t))throw new x(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ml(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new vi(t,e.asyncQueue,n,e.clientId,e.initialUser)}},Ui=class{initialize(e,t){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Pf(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=cw.bind(null,this.syncEngine),yield Rc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Dc}()}createDatastore(e){let t=Qi(e.databaseInfo.databaseId),n=function(s){return new Ec(s)}(e.databaseInfo);return function(s,a,u,c){return new Ac(s,a,u,c)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,s,a,u){return new bc(n,i,s,a,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Pf(this.syncEngine,t,0),function(){return yo.D()?new yo:new wc}())}createSyncEngine(e,t){return function(i,s,a,u,c,d,f){let m=new Mc(i,s,a,u,c,d);return f&&(m.La=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return C(this,null,function*(){var e;yield function(n){return C(this,null,function*(){let i=L(n);k("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield br(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function Df(r,e=10240){let t=0;return{read(){return C(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return C(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Er=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):fe("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var qc=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new we,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){return C(this,null,function*(){return this.metadata.promise})}qa(){return C(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return C(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),n=Number(t);isNaN(n)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(n);return new kc(JSON.parse(i),e.length+n)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return C(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return C(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return C(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Uc=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return C(this,null,function*(){let a=L(i),u={documents:s.map(m=>ki(a.serializer,m))},c=yield a.xo("BatchGetDocuments",a.serializer.databaseId,Y.emptyPath(),u,s.length),d=new Map;c.forEach(m=>{let _=Ty(a.serializer,m);d.set(_.key.toString(),_)});let f=[];return s.forEach(m=>{let _=d.get(m.toString());U(!!_),f.push(_)}),f})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Yt(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=O.fromPath(n);this.mutations.push(new Ri(i,this.precondition(i)))}),yield function(n,i){return C(this,null,function*(){let s=L(n),a={writes:i.map(u=>Vi(s.serializer,u))};yield s.Co("Commit",s.serializer.databaseId,Y.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw q();t=B.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new x(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(B.min())?de.exists(!1):de.updateTime(t):de.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(B.min()))throw new x(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return de.updateTime(t)}return de.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Bc=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new Oi(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>C(this,null,function*(){let e=new Uc(this.datastore),t=this.tu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.nu(i)}))}).catch(n=>{this.nu(n)})}))}tu(e){try{let t=this.updateFunction(e);return!zi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vg(t)}return!1}};var jc=class{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ye.UNAUTHENTICATED,this.clientId=Bs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,s=>C(this,null,function*(){k("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(k("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new we;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Cr(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function qs(r,e){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>C(this,null,function*(){n.isEqual(i)||(yield zg(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function zc(r,e){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield Rl(r);k("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>bf(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>bf(e.remoteStore,i)),r._onlineComponents=e})}function om(r){return r.name==="FirebaseError"?r.code===P.FAILED_PRECONDITION||r.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}function Rl(r){return C(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield qs(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!om(t))throw t;Qe("Error using user provided cache. Falling back to memory cache: "+t),yield qs(r,new qi)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield qs(r,new qi);return r._offlineComponents})}function Uo(r){return C(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield zc(r,r._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield zc(r,new Ui))),r._onlineComponents})}function am(r){return Rl(r).then(e=>e.persistence)}function Pl(r){return Rl(r).then(e=>e.localStore)}function um(r){return Uo(r).then(e=>e.remoteStore)}function Cl(r){return Uo(r).then(e=>e.syncEngine)}function ww(r){return Uo(r).then(e=>e.datastore)}function Ir(r){return C(this,null,function*(){let e=yield Uo(r),t=e.eventManager;return t.onListen=Zy.bind(null,e.syncEngine),t.onUnlisten=tw.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=ew.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nw.bind(null,e.syncEngine),t})}function vw(r){return r.asyncQueue.enqueue(()=>C(this,null,function*(){let e=yield am(r),t=yield um(r);return e.setNetworkEnabled(!0),function(i){let s=L(i);return s.M_.delete(0),Wi(s)}(t)}))}function Ew(r){return r.asyncQueue.enqueue(()=>C(this,null,function*(){let e=yield am(r),t=yield um(r);return e.setNetworkEnabled(!1),function(i){return C(this,null,function*(){let s=L(i);s.M_.add(0),yield br(s),s.N_.set("Offline")})}(t)}))}function Iw(r,e){let t=new we;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s,a){return C(this,null,function*(){try{let u=yield function(d,f){let m=L(d);return m.persistence.runTransaction("read document","readonly",_=>m.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new x(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Cr(u,`Failed to get document '${s} from cache`);a.reject(c)}})}(yield Pl(r),e,t)})),t.promise}function cm(r,e,t={}){let n=new we;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(s,a,u,c,d){let f=new Er({next:_=>{a.enqueueAndForget(()=>vl(s,m));let A=_.docs.has(u);!A&&_.fromCache?d.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&_.fromCache&&c&&c.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),m=new Li(Sr(u.path),f,{includeMetadataChanges:!0,ra:!0});return wl(s,m)}(yield Ir(r),r.asyncQueue,e,t,n)})),n.promise}function Tw(r,e){let t=new we;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s,a){return C(this,null,function*(){try{let u=yield go(i,s,!0),c=new bo(s,u.hs),d=c.da(u.documents),f=c.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let c=Cr(u,`Failed to execute query '${s} against cache`);a.reject(c)}})}(yield Pl(r),e,t)})),t.promise}function lm(r,e,t={}){let n=new we;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(s,a,u,c,d){let f=new Er({next:_=>{a.enqueueAndForget(()=>vl(s,m)),_.fromCache&&c.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),m=new Li(u,f,{includeMetadataChanges:!0,ra:!0});return wl(s,m)}(yield Ir(r),r.asyncQueue,e,t,n)})),n.promise}function Aw(r,e){let t=new Er(e);return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s){L(i).z_.add(s),s.next()}(yield Ir(r),t)})),()=>{t.$a(),r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,s){L(i).z_.delete(s)}(yield Ir(r),t)}))}}function Sw(r,e,t,n){let i=function(a,u){let c;return c=typeof a=="string"?Ig().encode(a):a,function(f,m){return new qc(f,m)}(function(f,m){if(f instanceof Uint8Array)return Df(f,m);if(f instanceof ArrayBuffer)return Df(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(t,Qi(e));r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){yw(yield Cl(r),i,n)}))}function bw(r,e){return r.asyncQueue.enqueue(()=>C(this,null,function*(){return function(n,i){let s=L(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.$r.getNamedQuery(a,i))}(yield Pl(r),e)}))}function hm(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var xf=new Map;function Dl(r,e,t){if(!t)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function xl(r,e,t,n){if(e===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function kf(r){if(!O.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Vf(r){if(O.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Bo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":q()}function Z(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Bo(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function dm(r,e){if(e<=0)throw new x(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}var Po=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hm((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},bn=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Po({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Po(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new au;switch(n.type){case"firstParty":return new hu(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=xf.get(t);n&&(k("ComponentProvider","Removing Datastore"),xf.delete(t),n.terminate())}(this),Promise.resolve()}};function kl(r,e,t,n={}){var i;let s=(r=Z(r,bn))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&Qe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=ye.MOCK_USER;else{u=dd(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new ye(d)}r._authCredentials=new uu(new Us(u,c))}}var be=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},ie=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ut(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},ut=class r extends be{constructor(e,t,n){super(e,t,Sr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ie(this.firestore,null,new O(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function Vl(r,e,...t){if(r=ue(r),Dl("collection","path",e),r instanceof bn){let n=Y.fromString(e,...t);return Vf(n),new ut(r,null,n)}{if(!(r instanceof ie||r instanceof ut))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(e,...t));return Vf(n),new ut(r.firestore,null,n)}}function fm(r,e){if(r=Z(r,bn),Dl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new be(r,null,function(n){return new Ye(Y.emptyPath(),n)}(e))}function Hi(r,e,...t){if(r=ue(r),arguments.length===1&&(e=Bs.newId()),Dl("doc","path",e),r instanceof bn){let n=Y.fromString(e,...t);return kf(n),new ie(r,null,new O(n))}{if(!(r instanceof ie||r instanceof ut))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(e,...t));return kf(n),new ie(r.firestore,r instanceof ut?r.converter:null,new O(n))}}function Nl(r,e){return r=ue(r),e=ue(e),(r instanceof ie||r instanceof ut)&&(e instanceof ie||e instanceof ut)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Fl(r,e){return r=ue(r),e=ue(e),r instanceof be&&e instanceof be&&r.firestore===e.firestore&&Ki(r._query,e._query)&&r.converter===e.converter}var Gc=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Oi(this,"async_queue_retry"),this.hu=()=>{let t=Ls();t&&k("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};let e=Ls();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Ls();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new we;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return C(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!tn(e))throw e;k("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(n=>{this.au=n,this.uu=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw fe("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.uu=!1,n))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=Pc.createAndSchedule(this,e,t,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&q()}verifyOperationInProgress(){}du(){return C(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function Kc(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var $c=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new we,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var gm=-1,ae=class extends bn{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=function(){return new Gc}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||mm(this),this._firestoreClient.terminate()}};function EE(r,e){let t=typeof r=="object"?r:si(),n=typeof r=="string"?r:e||"(default)",i=xa(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=hd("firestore");s&&kl(i,...s)}return i}function Ee(r){return r._firestoreClient||mm(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function mm(r){var e,t,n;let i=r._freezeSettings(),s=function(u,c,d,f){return new wu(u,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,hm(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._firestoreClient=new jc(r._authCredentials,r._appCheckCredentials,r._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function pm(r,e){Sm(r=Z(r,ae));let t=Ee(r);if(t._uninitializedComponentsProvider)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");Qe("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=r._freezeSettings(),i=new Ui;return ym(t,i,new Ro(i,n.cacheSizeBytes,e?.forceOwnership))}function _m(r){Sm(r=Z(r,ae));let e=Ee(r);if(e._uninitializedComponentsProvider)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");Qe("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings(),n=new Ui;return ym(e,n,new Lc(n,t.cacheSizeBytes))}function ym(r,e,t){let n=new we;return r.asyncQueue.enqueue(()=>C(this,null,function*(){try{yield qs(r,t),yield zc(r,e),n.resolve()}catch(i){let s=i;if(!om(s))throw s;Qe("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function wm(r){if(r._initialized&&!r._terminated)throw new x(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new we;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{yield function(n){return C(this,null,function*(){if(!Kt.D())return Promise.resolve();let i=n+"main";yield Kt.delete(i)})}(ml(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function vm(r){return function(t){let n=new we;return t.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return aw(yield Cl(t),n)})),n.promise}(Ee(r=Z(r,ae)))}function Em(r){return vw(Ee(r=Z(r,ae)))}function Im(r){return Ew(Ee(r=Z(r,ae)))}function Tm(r,e){let t=Ee(r=Z(r,ae)),n=new $c;return Sw(t,r._databaseId,e,n),n}function Am(r,e){return bw(Ee(r=Z(r,ae)),e).then(t=>t?new be(r,null,t.query):null)}function Sm(r){if(r._initialized||r._terminated)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var dt=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Ie.fromBase64String(e))}catch(t){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var et=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var At=class{constructor(e){this._methodName=e}};var Rn=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var Rw=/^__.*__$/,Qc=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xt(e,this.data,t,this.fieldTransforms)}},Co=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function bm(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q()}}var Do=class r{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.wu(e),i}Su(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return xo(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(bm(this.fu)&&Rw.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},Wc=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Qi(e)}Fu(e,t,n,i=!1){return new Do({fu:e,methodName:t,vu:n,path:ge.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function xn(r){let e=r._freezeSettings(),t=Qi(r._databaseId);return new Wc(r._databaseId,!!e.ignoreUndefinedProperties,t)}function jo(r,e,t,n,i,s={}){let a=r.Fu(s.merge||s.mergeFields?2:0,e,t,i);Ll("Data must be an object, but it was:",a,n);let u=Cm(n,a),c,d;if(s.merge)c=new Ge(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let _=Zc(e,m,t);if(!a.contains(_))throw new x(P.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);xm(f,_)||f.push(_)}c=new Ge(f),d=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=a.fieldTransforms;return new Qc(new ke(u),c,d)}var Bi=class r extends At{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function Rm(r,e,t){return new Do({fu:3,vu:e.settings.vu,methodName:r._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Hc=class r extends At{_toFieldTransform(e){return new Tn(e.path,new Ht)}isEqual(e){return e instanceof r}},Jc=class r extends At{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=Rm(this,e,!0),n=this.Mu.map(s=>kn(s,t)),i=new It(n);return new Tn(e.path,i)}isEqual(e){return e instanceof r&&Da(this.Mu,e.Mu)}},Xc=class r extends At{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=Rm(this,e,!0),n=this.Mu.map(s=>kn(s,t)),i=new Tt(n);return new Tn(e.path,i)}isEqual(e){return e instanceof r&&Da(this.Mu,e.Mu)}},Yc=class r extends At{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new Jt(e.serializer,fg(e.serializer,this.xu));return new Tn(e.path,t)}isEqual(e){return e instanceof r&&this.xu===e.xu}};function Ml(r,e,t,n){let i=r.Fu(1,e,t);Ll("Data must be an object, but it was:",i,n);let s=[],a=ke.empty();Dn(n,(c,d)=>{let f=ql(e,c,t);d=ue(d);let m=i.Su(f);if(d instanceof Bi)s.push(f);else{let _=kn(d,m);_!=null&&(s.push(f),a.set(f,_))}});let u=new Ge(s);return new Co(a,u,i.fieldTransforms)}function Ol(r,e,t,n,i,s){let a=r.Fu(1,e,t),u=[Zc(e,n,t)],c=[i];if(s.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Zc(e,s[_])),c.push(s[_+1]);let d=[],f=ke.empty();for(let _=u.length-1;_>=0;--_)if(!xm(d,u[_])){let A=u[_],V=c[_];V=ue(V);let N=a.Su(A);if(V instanceof Bi)d.push(A);else{let D=kn(V,N);D!=null&&(d.push(A),f.set(A,D))}}let m=new Ge(d);return new Co(f,m,a.fieldTransforms)}function Pm(r,e,t,n=!1){return kn(t,r.Fu(n?4:3,e))}function kn(r,e){if(Dm(r=ue(r)))return Ll("Unsupported field value:",e,r),Cm(r,e);if(r instanceof At)return function(n,i){if(!bm(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=kn(u,i.bu(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ue(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return fg(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=ce.fromDate(n);return{timestampValue:fr(i.serializer,s)}}if(n instanceof ce){let s=new ce(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:fr(i.serializer,s)}}if(n instanceof Rn)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof dt)return{bytesValue:Tg(i.serializer,n._byteString)};if(n instanceof ie){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:dl(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${Bo(n)}`)}(r,e)}function Cm(r,e){let t={};return Hf(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dn(r,(n,i)=>{let s=kn(i,e.pu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function Dm(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ce||r instanceof Rn||r instanceof dt||r instanceof ie||r instanceof At)}function Ll(r,e,t){if(!Dm(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=Bo(t);throw n==="an object"?e.Du(r+" a custom object"):e.Du(r+" "+n)}}function Zc(r,e,t){if((e=ue(e))instanceof et)return e._internalPath;if(typeof e=="string")return ql(r,e);throw xo("Field path arguments must be of type string or ",r,!1,void 0,t)}var Pw=new RegExp("[~\\*/\\[\\]]");function ql(r,e,t){if(e.search(Pw)>=0)throw xo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new et(...e.split("."))._internalPath}catch{throw xo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function xo(r,e,t,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new x(P.INVALID_ARGUMENT,u+r+c)}function xm(r,e){return r.some(t=>t.isEqual(e))}var Pn=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new el(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(zo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},el=class extends Pn{data(){return super.data()}};function zo(r,e){return typeof e=="string"?ql(r,e):e instanceof et?e._internalPath:e._delegate._internalPath}function km(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ji=class{},Cn=class extends ji{};function Rt(r,e,...t){let n=[];e instanceof ji&&n.push(e),n=n.concat(t),function(s){let a=s.filter(c=>c instanceof tl).length,u=s.filter(c=>c instanceof ko).length;if(a>1||a>0&&u>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var ko=class r extends Cn{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return jm(e._query,t),new be(e.firestore,e.converter,ku(e._query,t))}_parse(e){let t=xn(e.firestore);return function(s,a,u,c,d,f,m){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Ff(m,f);let A=[];for(let V of m)A.push(Nf(c,s,V));_={arrayValue:{values:A}}}else _=Nf(c,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Ff(m,f),_=Pm(u,a,m,f==="in"||f==="not-in");return H.create(d,f,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Vm(r,e,t){let n=e,i=zo("where",r);return ko._create(i,n,t)}var tl=class r extends ji{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:te.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)jm(a,c),a=ku(a,c)}(e._query,t),new be(e.firestore,e.converter,ku(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var nl=class r extends Cn{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,a){if(i.startAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new En(s,a)}(e._query,this._field,this._direction);return new be(e.firestore,e.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new Ye(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function Nm(r,e="asc"){let t=e,n=zo("orderBy",r);return nl._create(n,t)}var Vo=class r extends Cn{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new be(e.firestore,e.converter,Xs(e._query,this._limit,this._limitType))}};function Fm(r){return dm("limit",r),Vo._create("limit",r,"F")}function Mm(r){return dm("limitToLast",r),Vo._create("limitToLast",r,"L")}var No=class r extends Cn{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=Bm(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new Ye(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Om(...r){return No._create("startAt",r,!0)}function Lm(...r){return No._create("startAfter",r,!1)}var Fo=class r extends Cn{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=Bm(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new Ye(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function qm(...r){return Fo._create("endBefore",r,!1)}function Um(...r){return Fo._create("endAt",r,!0)}function Bm(r,e,t,n){if(t[0]=ue(t[0]),t[0]instanceof Pn)return function(s,a,u,c,d){if(!c)throw new x(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let m of sr(s))if(m.field.isKeyField())f.push(vn(a,c.key));else{let _=c.data.field(m.field);if(Oo(_))throw new x(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let A=m.field.canonicalString();throw new x(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(_)}return new lt(f,d)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=xn(r.firestore);return function(a,u,c,d,f,m){let _=a.explicitOrderBy;if(f.length>_.length)throw new x(P.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let A=[];for(let V=0;V<f.length;V++){let N=f[V];if(_[V].field.isKeyField()){if(typeof N!="string")throw new x(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!ll(a)&&N.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);let D=a.path.child(Y.fromString(N));if(!O.isDocumentKey(D))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let j=new O(D);A.push(vn(u,j))}else{let D=Pm(c,d,N);A.push(D)}}return new lt(A,m)}(r._query,r.firestore._databaseId,i,e,t,n)}}function Nf(r,e,t){if(typeof(t=ue(t))=="string"){if(t==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ll(e)&&t.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(Y.fromString(t));if(!O.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return vn(r,new O(n))}if(t instanceof ie)return vn(r,t._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bo(t)}.`)}function Ff(r,e){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function jm(r,e){let t=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Tr=class{convertValue(e,t="none"){switch(wn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($t(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw q()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Dn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertGeoPoint(e){return new Rn(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ul(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ai(e));default:return null}}convertTimestamp(e){let t=Et(e);return new ce(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=Y.fromString(e);U(Ng(n));let i=new Qt(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(t)||fe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Go(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var rl=class extends Tr{constructor(e){super(),this.firestore=e}convertBytes(e){return new dt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ie(this.firestore,null,t)}};var vt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},He=class extends Pn{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new zt(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(zo("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},zt=class extends He{data(e={}){return super.data(e)}},tt=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new vt(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new zt(this._firestore,this._userDataWriter,n.key,n,new vt(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new zt(i._firestore,i._userDataWriter,u.doc.key,u.doc,new vt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new zt(i._firestore,i._userDataWriter,u.doc.key,u.doc,new vt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Cw(u.type),doc:c,oldIndex:d,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Cw(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q()}}function Ul(r,e){return r instanceof He&&e instanceof He?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof tt&&e instanceof tt&&r._firestore===e._firestore&&Fl(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function zm(r){r=Z(r,ie);let e=Z(r.firestore,ae);return cm(Ee(e),r._key).then(t=>Gl(e,r,t))}var St=class extends Tr{constructor(e){super(),this.firestore=e}convertBytes(e){return new dt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ie(this.firestore,null,t)}};function Gm(r){r=Z(r,ie);let e=Z(r.firestore,ae),t=Ee(e),n=new St(e);return Iw(t,r._key).then(i=>new He(e,n,r._key,i,new vt(i!==null&&i.hasLocalMutations,!0),r.converter))}function Km(r){r=Z(r,ie);let e=Z(r.firestore,ae);return cm(Ee(e),r._key,{source:"server"}).then(t=>Gl(e,r,t))}function $m(r){r=Z(r,be);let e=Z(r.firestore,ae),t=Ee(e),n=new St(e);return km(r._query),lm(t,r._query).then(i=>new tt(e,n,r,i))}function Qm(r){r=Z(r,be);let e=Z(r.firestore,ae),t=Ee(e),n=new St(e);return Tw(t,r._query).then(i=>new tt(e,n,r,i))}function Wm(r){r=Z(r,be);let e=Z(r.firestore,ae),t=Ee(e),n=new St(e);return lm(t,r._query,{source:"server"}).then(i=>new tt(e,n,r,i))}function Bl(r,e,t){r=Z(r,ie);let n=Z(r.firestore,ae),i=Go(r.converter,e,t);return Dr(n,[jo(xn(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,de.none())])}function jl(r,e,t,...n){r=Z(r,ie);let i=Z(r.firestore,ae),s=xn(i),a;return a=typeof(e=ue(e))=="string"||e instanceof et?Ol(s,"updateDoc",r._key,e,t,n):Ml(s,"updateDoc",r._key,e),Dr(i,[a.toMutation(r._key,de.exists(!0))])}function Hm(r){return Dr(Z(r.firestore,ae),[new Yt(r._key,de.none())])}function Jm(r,e){let t=Z(r.firestore,ae),n=Hi(r),i=Go(r.converter,e);return Dr(t,[jo(xn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,de.exists(!1))]).then(()=>n)}function zl(r,...e){var t,n,i;r=ue(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Kc(e[a])||(s=e[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Kc(e[a])){let m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(n=m.error)===null||n===void 0?void 0:n.bind(m),e[a+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let c,d,f;if(r instanceof ie)d=Z(r.firestore,ae),f=Sr(r._key.path),c={next:m=>{e[a]&&e[a](Gl(d,r,m))},error:e[a+1],complete:e[a+2]};else{let m=Z(r,be);d=Z(m.firestore,ae),f=m._query;let _=new St(d);c={next:A=>{e[a]&&e[a](new tt(d,_,m,A))},error:e[a+1],complete:e[a+2]},km(r._query)}return function(_,A,V,N){let D=new Er(N),j=new Li(A,D,V);return _.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return wl(yield Ir(_),j)})),()=>{D.$a(),_.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return vl(yield Ir(_),j)}))}}(Ee(d),f,u,c)}function Xm(r,e){return Aw(Ee(r=Z(r,ae)),Kc(e)?e:{next:e})}function Dr(r,e){return function(n,i){let s=new we;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return rw(yield Cl(n),i,s)})),s.promise}(Ee(r),e)}function Gl(r,e,t){let n=t.docs.get(e._key),i=new St(r);return new He(r,i,e._key,n,new vt(t.hasPendingWrites,t.fromCache),e.converter)}var Dw={maxAttempts:5};var Mo=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xn(e)}set(e,t,n){this._verifyNotCommitted();let i=Bt(e,this._firestore),s=Go(i.converter,t,n),a=jo(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,de.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=Bt(e,this._firestore),a;return a=typeof(t=ue(t))=="string"||t instanceof et?Ol(this._dataReader,"WriteBatch.update",s._key,t,n,i):Ml(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,de.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Bt(e,this._firestore);return this._mutations=this._mutations.concat(new Yt(t._key,de.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Bt(r,e){if((r=ue(r)).firestore!==e)throw new x(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var il=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=xn(t)}get(t){let n=Bt(t,this._firestore),i=new rl(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return q();let a=s[0];if(a.isFoundDocument())return new Pn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new Pn(this._firestore,i,n._key,null,n.converter);throw q()})}set(t,n,i){let s=Bt(t,this._firestore),a=Go(s.converter,n,i),u=jo(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){let a=Bt(t,this._firestore),u;return u=typeof(n=ue(n))=="string"||n instanceof et?Ol(this._dataReader,"Transaction.update",a._key,n,i,s):Ml(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){let n=Bt(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Bt(e,this._firestore),n=new St(this._firestore);return super.get(e).then(i=>new He(this._firestore,n,t._key,i._document,new vt(!1,!1),t.converter))}};function Ym(r,e,t){r=Z(r,ae);let n=Object.assign(Object.assign({},Dw),t);return function(s){if(s.maxAttempts<1)throw new x(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new we;return s.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let d=yield ww(s);new Bc(s.asyncQueue,d,u,a,c).Xa()})),c.promise}(Ee(r),i=>e(new il(r,i)),n)}function Zm(){return new Bi("deleteField")}function ep(){return new Hc("serverTimestamp")}function tp(...r){return new Jc("arrayUnion",r)}function np(...r){return new Xc("arrayRemove",r)}function rp(r){return new Yc("increment",r)}(function(e,t=!0){(function(i){Ar=i})(md),ii(new cn("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new ae(new cu(n.getProvider("auth-internal")),new fu(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qt(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Ke(Fd,"4.6.3",e),Ke(Fd,"4.6.3","esm2017")})();var xw="@firebase/firestore-compat",kw="0.3.32";function Jl(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new x("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function ip(){if(typeof Uint8Array>"u")throw new x("unimplemented","Uint8Arrays are not available in this environment.")}function sp(){if(!Jf())throw new x("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Ko=class r{constructor(e){this._delegate=e}static fromBase64String(e){return sp(),new r(dt.fromBase64String(e))}static fromUint8Array(e){return ip(),new r(dt.fromUint8Array(e))}toBase64(){return sp(),this._delegate.toBase64()}toUint8Array(){return ip(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Kl(r){return Vw(r,["next","error","complete"])}function Vw(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var $l=class{enableIndexedDbPersistence(e,t){return pm(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return _m(e._delegate)}clearIndexedDbPersistence(e){return wm(e._delegate)}},$o=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Qt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Qe("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){kl(this._delegate,e,t,n)}enableNetwork(){return Em(this._delegate)}disableNetwork(){return Im(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,xl("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return vm(this._delegate)}onSnapshotsInSync(e){return Xm(this._delegate,e)}get app(){if(!this._appCompat)throw new x("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Vr(this,Vl(this._delegate,e))}catch(t){throw Le(t,"collection()","Firestore.collection()")}}doc(e){try{return new ft(this,Hi(this._delegate,e))}catch(t){throw Le(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Mn(this,fm(this._delegate,e))}catch(t){throw Le(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Ym(this._delegate,t=>e(new Qo(this,t)))}batch(){return Ee(this._delegate),new Wo(new Mo(this._delegate,e=>Dr(this._delegate,e)))}loadBundle(e){return Tm(this._delegate,e)}namedQuery(e){return Am(this._delegate,e).then(t=>t?new Mn(this,t):null)}},xr=class extends Tr{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ko(new dt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return ft.forKey(t,this.firestore,null)}};function Nw(r){Mf(r)}var Qo=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new xr(e)}get(e){let t=Vn(e);return this._delegate.get(t).then(n=>new Nn(this._firestore,new He(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=Vn(e);return n?(Jl("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Vn(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Vn(e);return this._delegate.delete(t),this}},Wo=class{constructor(e){this._delegate=e}set(e,t,n){let i=Vn(e);return n?(Jl("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Vn(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Vn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},kr=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new zt(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fn(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new xr(e),t),i.set(t,s)),s}};kr.INSTANCES=new WeakMap;var ft=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new xr(e)}static forPath(e,t,n){if(e.length%2!==0)throw new x("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new ie(t._delegate,n,new O(e)))}static forKey(e,t,n){return new r(t,new ie(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Vr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Vr(this.firestore,Vl(this._delegate,e))}catch(t){throw Le(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ue(e),e instanceof ie?Nl(this._delegate,e):!1}set(e,t){t=Jl("DocumentReference.set",t);try{return t?Bl(this._delegate,e,t):Bl(this._delegate,e)}catch(n){throw Le(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?jl(this._delegate,e):jl(this._delegate,e,t,...n)}catch(i){throw Le(i,"updateDoc()","DocumentReference.update()")}}delete(){return Hm(this._delegate)}onSnapshot(...e){let t=op(e),n=ap(e,i=>new Nn(this.firestore,new He(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return zl(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=Gm(this._delegate):e?.source==="server"?t=Km(this._delegate):t=zm(this._delegate),t.then(n=>new Nn(this.firestore,new He(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(kr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Le(r,e,t){return r.message=r.message.replace(e,t),r}function op(r){for(let e of r)if(typeof e=="object"&&!Kl(e))return e;return{}}function ap(r,e){var t,n;let i;return Kl(r[0])?i=r[0]:Kl(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var Nn=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ft(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ul(this._delegate,e._delegate)}},Fn=class extends Nn{data(e){let t=this._delegate.data(e);return this._delegate._converter||Of(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Mn=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new xr(e)}where(e,t,n){try{return new r(this.firestore,Rt(this._delegate,Vm(e,t,n)))}catch(i){throw Le(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,Rt(this._delegate,Nm(e,t)))}catch(n){throw Le(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,Rt(this._delegate,Fm(e)))}catch(t){throw Le(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,Rt(this._delegate,Mm(e)))}catch(t){throw Le(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,Rt(this._delegate,Om(...e)))}catch(t){throw Le(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,Rt(this._delegate,Lm(...e)))}catch(t){throw Le(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,Rt(this._delegate,qm(...e)))}catch(t){throw Le(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,Rt(this._delegate,Um(...e)))}catch(t){throw Le(t,"endAt()","Query.endAt()")}}isEqual(e){return Fl(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Qm(this._delegate):e?.source==="server"?t=Wm(this._delegate):t=$m(this._delegate),t.then(n=>new Ji(this.firestore,new tt(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=op(e),n=ap(e,i=>new Ji(this.firestore,new tt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return zl(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(kr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Ql=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Ji=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Mn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fn(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Ql(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Fn(this._firestore,n))})}isEqual(e){return Ul(this._delegate,e._delegate)}},Vr=class r extends Mn{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new ft(this.firestore,e):null}doc(e){try{return e===void 0?new ft(this.firestore,Hi(this._delegate)):new ft(this.firestore,Hi(this._delegate,e))}catch(t){throw Le(t,"doc()","CollectionReference.doc()")}}add(e){return Jm(this._delegate,e).then(t=>new ft(this.firestore,t))}isEqual(e){return Nl(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(kr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Vn(r){return Z(r,ie)}var Wl=class r{constructor(...e){this._delegate=new et(...e)}static documentId(){return new r(ge.keyField().canonicalString())}isEqual(e){return e=ue(e),e instanceof et?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Hl=class r{constructor(e){this._delegate=e}static serverTimestamp(){let e=ep();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=Zm();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=tp(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=np(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=rp(e);return t._methodName="FieldValue.increment",new r(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Fw={Firestore:$o,GeoPoint:Rn,Timestamp:ce,Blob:Ko,Transaction:Qo,WriteBatch:Wo,DocumentReference:ft,DocumentSnapshot:Nn,Query:Mn,QueryDocumentSnapshot:Fn,QuerySnapshot:Ji,CollectionReference:Vr,FieldPath:Wl,FieldValue:Hl,setLogLevel:Nw,CACHE_SIZE_UNLIMITED:gm};function Mw(r,e){r.INTERNAL.registerComponent(new cn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},Fw)))}function Ow(r){Mw(r,(e,t)=>new $o(e,t,new $l)),r.registerVersion(xw,kw)}Ow(qe);function Lw(r,e=ms){return new Bn(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function up(r,e){return Lw(r,e)}function qw(r,e){return up(r,e).pipe(ys(void 0),ps(),Fe(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Zl(r,e){return up(r,e).pipe(Fe(t=>({payload:t,type:"query"})))}var Ho=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=fp(n,t);return new Xo(i,s,this.afs)}snapshotChanges(){return qw(this.ref,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return this.snapshotChanges().pipe(Fe(({payload:t})=>e.idField?Ta(gs({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Vt(this.ref.get(e)).pipe(Ue)}};function Jo(r,e){return Zl(r,e).pipe(ys(void 0),ps(),Fe(t=>{let[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{let d=s.find(m=>m.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(m=>m.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function cp(r,e,t){return Jo(r,t).pipe(_s((n,i)=>Uw(n,i.map(s=>s.payload),e),[]),id(),Fe(n=>n.map(i=>({type:i.type,payload:i}))))}function Uw(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=Bw(r,n))}),r}function Xl(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function Bw(r,e){switch(e.type){case"added":if(!(r[e.newIndex]&&r[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Xl(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Xl(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Xl(r,e.oldIndex,1);break}return r}function lp(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Xo=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Jo(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Fe(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(ys(void 0),ps(),Zr(([n,i])=>i.length>0||!n),Fe(([,n])=>n),Ue)}auditTrail(e){return this.stateChanges(e).pipe(_s((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=lp(e);return cp(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return Zl(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(t=>t.payload.docs.map(n=>e.idField?Ta(gs({},n.data()),{[e.idField]:n.id}):n.data())),Ue)}get(e){return Vt(this.query.get(e)).pipe(Ue)}add(e){return this.ref.add(e)}doc(e){return new Ho(this.ref.doc(e),this.afs)}},Yl=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Jo(this.query,this.afs.schedulers.outsideAngular).pipe(Ue):Jo(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(t=>t.filter(n=>e.indexOf(n.type)>-1)),Zr(t=>t.length>0),Ue)}auditTrail(e){return this.stateChanges(e).pipe(_s((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=lp(e);return cp(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return Zl(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(n=>n.payload.docs.map(i=>e.idField?gs({[e.idField]:i.id},i.data()):i.data())),Ue)}get(e){return Vt(this.query.get(e)).pipe(Ue)}},hp=new Se("angularfire2.enableFirestorePersistence"),dp=new Se("angularfire2.firestore.persistenceSettings"),jw=new Se("angularfire2.firestore.settings"),zw=new Se("angularfire2.firestore.use-emulator");function fp(r,e=t=>t){return{query:e(r),ref:r}}var Gw=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,a,u,c,d,f,m,_,A,V,N,D,j,z){this.schedulers=c;let M=ai(t,u,n),G=f;m&&Ha(M,u,_,V,N,D,A,j),[this.firestore,this.persistenceEnabled$]=bs(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let K=u.runOutsideAngular(()=>M.firestore());if(s&&K.settings(s),G&&K.useEmulator(...G),i&&!vs(a)){let $=()=>{try{return Vt(K.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(v){return typeof console<"u"&&console.warn(v),Nt(!1)}};return[K,u.runOutsideAngular($)]}else return[K,Nt(!1)]},[s,G,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:a}=fp(i,n),u=this.schedulers.ngZone.run(()=>s);return new Xo(u,a,this)}collectionGroup(t,n){let i=n||(a=>a),s=this.firestore.collectionGroup(t);return new Yl(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.schedulers.ngZone.run(()=>n);return new Ho(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(J(Kn),J($n,8),J(hp,8),J(jw,8),J(Ft),J(nt),J(Gn),J(dp,8),J(zw,8),J(kd,8),J(za,8),J(Ga,8),J(Ka,8),J($a,8),J(Qa,8),J(Wa,8),J(ln,8))};static \u0275prov=zn({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),KE=(()=>{class r{constructor(){qe.registerVersion("angularfire",_t.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:hp,useValue:!0},{provide:dp,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=ni({type:r});static \u0275inj=ei({providers:[Gw]})}return r})();export{_t as a,nv as b,Yp as c,ln as d,Gn as e,rv as f,Ue as g,oi as h,Fa as i,mv as j,Kn as k,$n as l,ai as m,Tv as n,bs as o,za as p,Ga as q,Ka as r,$a as s,Qa as t,Wa as u,Ha as v,kd as w,EE as x,Gw as y,KE as z};
