import{a as V}from"./chunk-U4O4KU6Q.js";import{a as B,b as f}from"./chunk-P4PAYY2C.js";import{a as H,b as L,d as X,g as N,s as W}from"./chunk-WQDWLB3F.js";import{h as I,i as A,k as u}from"./chunk-TQDNXVMP.js";import{$a as w,Ga as r,Ha as _,Ua as x,Wa as h,Ya as a,Za as e,cb as g,fa as P,fb as t,hb as p,jb as b,kb as E,lb as v,mb as y,nb as k,pa as M,pb as O,qa as F,rb as D}from"./chunk-75HCPL27.js";import{a as C,b as T}from"./chunk-GLKGYJID.js";function z(l,d){l&1&&(a(0,"div")(1,"p"),t(2,"No hay historias cl\xEDnicas para mostrar."),e()())}function q(l,d){if(l&1&&(a(0,"div")(1,"p")(2,"strong"),t(3),e(),t(4),e()()),l&2){let s=d.$implicit;r(3),p("",s.clave,":"),r(),p(" ",s.valor,"")}}function G(l,d){if(l&1){let s=w();a(0,"div",8)(1,"input",9),v("ngModelChange",function(n){let o=M(s).$implicit;return E(o.seleccionado,n)||(o.seleccionado=n),F(n)}),e(),a(2,"p")(3,"strong"),t(4,"Fecha:"),e(),t(5),O(6,"date"),e(),a(7,"p")(8,"strong"),t(9,"Paciente:"),e(),t(10),e(),a(11,"p")(12,"strong"),t(13,"Especialista:"),e(),t(14),e(),a(15,"p")(16,"strong"),t(17,"Especialidad:"),e(),t(18),e(),a(19,"p")(20,"strong"),t(21,"Altura:"),e(),t(22),e(),a(23,"p")(24,"strong"),t(25,"Peso:"),e(),t(26),e(),a(27,"p")(28,"strong"),t(29,"Temperatura:"),e(),t(30),e(),a(31,"p")(32,"strong"),t(33,"Presi\xF3n:"),e(),t(34),e(),x(35,q,5,2,"div",10),e()}if(l&2){let s=d.$implicit;r(),b("ngModel",s.seleccionado),r(4),p(" ",D(6,10,s.fecha,"short"),""),r(5),p(" ",s.nombrePaciente,""),r(4),p(" ",s.nombreEspecialista,""),r(4),p(" ",s.especialidad,""),r(4),p(" ",s.altura," cm"),r(4),p(" ",s.peso," kg"),r(4),p(" ",s.temperatura," \xB0C"),r(4),p(" ",s.presion,""),r(),h("ngForOf",s.datosDinamicos)}}var $=(()=>{let d=class d{constructor(i,n){this.historiaClinicaService=i,this.datePipe=n,this.historiasClinicas=[],this.historiasClinicasFiltradas=[],this.filtro=""}ngOnInit(){this.historiaClinicaService.obtenerTodasHistorias().subscribe(i=>{this.historiasClinicas=i.map(n=>{let o=n.payload.doc.data();return o.id=n.payload.doc.id,o.fecha=this.convertTimestampToDate(o.fecha),o}).sort((n,o)=>o.fecha.getTime()-n.fecha.getTime()),this.historiasClinicasFiltradas=this.historiasClinicas})}convertTimestampToDate(i){return i instanceof Date?i:i.toDate()}aplicarFiltro(){let i=this.filtro.toLowerCase();this.historiasClinicasFiltradas=this.historiasClinicas.filter(n=>n.nombrePaciente.toLowerCase().includes(i)||n.nombreEspecialista.toLowerCase().includes(i)||this.dateToString(n.fecha).includes(i))}dateToString(i){return this.datePipe.transform(i,"shortDate")?.toLowerCase()||""}exportarSeleccionados(){let i=this.historiasClinicasFiltradas.filter(c=>c.seleccionado);if(i.length===0){alert("No hay historias cl\xEDnicas seleccionadas.");return}let n=i.map(c=>C({Fecha:this.dateToString(c.fecha),Paciente:c.nombrePaciente,Especialista:c.nombreEspecialista,Especialidad:c.especialidad,Altura:c.altura+" cm",Peso:c.peso+" kg",Temperatura:c.temperatura+" \xB0C",Presi\u00F3n:c.presion},c.datosDinamicos.reduce((j,S)=>T(C({},j),{[S.clave]:S.valor}),{}))),o=f.json_to_sheet(n),m=f.book_new();f.book_append_sheet(m,o,"Historias Cl\xEDnicas"),B(m,"historias_clinicas_seleccionadas.xlsx")}seleccionarTodos(){this.historiasClinicasFiltradas.forEach(i=>i.seleccionado=!0)}deseleccionarTodos(){this.historiasClinicasFiltradas.forEach(i=>i.seleccionado=!1)}};d.\u0275fac=function(n){return new(n||d)(_(V),_(u))},d.\u0275cmp=P({type:d,selectors:[["app-hist-clinica-admin"]],standalone:!0,features:[y([u]),k],decls:13,vars:3,consts:[[1,"contenedor"],[4,"ngIf"],[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],[1,"botonseleccionarTodos",3,"click"],[1,"botonDeseleccionarTodos",3,"click"],[1,"botonExportarSeleccionados",3,"click"],["class","historia-clinica",4,"ngFor","ngForOf"],[1,"historia-clinica"],["type","checkbox",1,"checkbox",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"h2"),t(2,"Historias Cl\xEDnicas (Admin)"),e(),x(3,z,3,0,"div",1),a(4,"div",2)(5,"input",3),v("ngModelChange",function(c){return E(o.filtro,c)||(o.filtro=c),c}),g("input",function(){return o.aplicarFiltro()}),e(),a(6,"button",4),g("click",function(){return o.seleccionarTodos()}),t(7,"Seleccionar Todos"),e(),a(8,"button",5),g("click",function(){return o.deseleccionarTodos()}),t(9,"Deseleccionar Todos"),e(),a(10,"button",6),g("click",function(){return o.exportarSeleccionados()}),t(11,"Exportar Seleccionados a Excel"),e(),x(12,G,36,13,"div",7),e()()),n&2&&(r(3),h("ngIf",o.historiasClinicas.length===0),r(2),b("ngModel",o.filtro),r(7),h("ngForOf",o.historiasClinicasFiltradas))},dependencies:[I,A,W,L,H,X,N,u],styles:[".contenedor[_ngcontent-%COMP%]{width:80%;margin:0 auto;padding:20px;border:1px solid #000000;border-radius:5px;box-shadow:0 2px 5px #000;background-color:#c9090958}h2[_ngcontent-%COMP%]{text-align:center;font-size:24px;margin-bottom:20px}.historia-clinica[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:5px;padding:15px;margin-bottom:15px}.historia-clinica[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:5px}.historia-clinica[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700}.datos-dinamicos[_ngcontent-%COMP%]{margin-top:10px}.datos-dinamicos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.botonseleccionarTodos[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#0b7a7a;border:1px solid #0b7a7a;border-radius:5px;padding:5px 10px;cursor:pointer}.botonExportarSeleccionados[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#0e1df1;border:1px solid #0b7a0f;border-radius:5px;padding:5px 10px;cursor:pointer}.botonDeseleccionarTodos[_ngcontent-%COMP%]{margin-top:20px;margin-left:10px;color:#deb887;background-color:#451432;border:1px solid #0b7a0f;border-radius:5px;padding:5px 10px;cursor:pointer}"]});let l=d;return l})();export{$ as a};
