import{a as q}from"./chunk-3EEHIX2G.js";import{a as G}from"./chunk-UXX4BWXT.js";import{b as D,d as O,e as L,f as N,g as B,h as H,q as R,s as A}from"./chunk-QWB637DO.js";import{d as z}from"./chunk-J4KM255L.js";import{h as P,i as k,k as W}from"./chunk-NCUWAZGR.js";import{$a as _,Ga as s,Ha as E,Ua as S,Wa as m,Ya as a,Za as o,cb as g,db as c,eb as v,fa as M,fb as l,hb as w,jb as C,kb as f,lb as x,nb as V,ob as I,pa as p,qa as u,qb as F}from"./chunk-GBDBB4LJ.js";import{h as b}from"./chunk-DEPBX7UX.js";function U(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c().$implicit,n=c();return u(n.cancelarTurno(e,"Raz\xF3n de cancelaci\xF3n"))}),l(1,"Cancelar Turno"),o()}}function J(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c().$implicit,n=c();return u(n.rechazarTurno(e,"Raz\xF3n de rechazo"))}),l(1,"Rechazar Turno"),o()}}function K(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c().$implicit,n=c();return u(n.aceptarTurno(e))}),l(1,"Aceptar Turno"),o()}}function Q(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c().$implicit,n=c();return u(n.mostrarFormularioHistoriaClinica(e))}),l(1,"Finalizar Turno"),o()}}function X(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c().$implicit,n=c();return u(n.verResenia(e))}),l(1,"Ver Rese\xF1a"),o()}}function Z(r,d){if(r&1){let i=_();a(0,"div")(1,"p"),l(2),o(),a(3,"button",7),g("click",function(){p(i);let e=c().$implicit;return u(e.mostrarresenia=!1)}),l(4,"Ocultar Rese\xF1a"),o()()}if(r&2){let i=c().$implicit;s(2),w("Rese\xF1a: ",i.comentario,"")}}function $(r,d){if(r&1&&(a(0,"div",4)(1,"p"),l(2),o(),a(3,"p"),l(4),o(),a(5,"p"),l(6),I(7,"date"),o(),a(8,"p"),l(9),o(),S(10,U,2,0,"button",5)(11,J,2,0,"button",5)(12,K,2,0,"button",5)(13,Q,2,0,"button",5)(14,X,2,0,"button",5)(15,Z,5,1,"div",6),o()),r&2){let i=d.$implicit;s(2),w("Especialidad: ",i.especialidad,""),s(2),w("Paciente: ",i.pacienteNombre,""),s(2),w("Fecha y Hora: ",F(7,10,i.fechaHora,"dd/MM/yyyy HH:mm"),""),s(3),w("Estado: ",i.estado,""),s(),m("ngIf",i.estado!=="realizado"&&i.estado!=="cancelado"),s(),m("ngIf",i.estado==="pendiente"),s(),m("ngIf",i.estado==="pendiente"),s(),m("ngIf",i.estado==="confirmado"),s(),m("ngIf",i.comentario&&!i.mostrarresenia),s(),m("ngIf",i.mostrarresenia)}}function ee(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c().index,n=c(2);return u(n.eliminarDatoDinamico(e))}),l(1,"Eliminar"),o()}}function te(r,d){if(r&1){let i=_();a(0,"div")(1,"label",20),l(2,"Clave:"),o(),a(3,"input",21),x("ngModelChange",function(e){let n=p(i).$implicit;return f(n.clave,e)||(n.clave=e),u(e)}),o(),a(4,"label",20),l(5,"Valor:"),o(),a(6,"input",21),x("ngModelChange",function(e){let n=p(i).$implicit;return f(n.valor,e)||(n.valor=e),u(e)}),o(),S(7,ee,2,0,"button",5),o()}if(r&2){let i=d.$implicit,t=d.index,e=c(2);s(),v("for","clave-",t,""),s(2),v("id","clave-",t,""),v("name","clave-",t,""),C("ngModel",i.clave),s(),v("for","valor-",t,""),s(2),v("id","valor-",t,""),v("name","valor-",t,""),C("ngModel",i.valor),s(),m("ngIf",e.datosClinicos.dinamicos.length>1)}}function ie(r,d){if(r&1){let i=_();a(0,"button",7),g("click",function(){p(i);let e=c(2);return u(e.agregarDatoDinamico())}),l(1,"Agregar Dato Din\xE1mico"),o()}}function ne(r,d){if(r&1){let i=_();a(0,"div",8)(1,"h3"),l(2,"Datos de Historia Cl\xEDnica"),o(),a(3,"form",9),g("ngSubmit",function(){p(i);let e=c();return u(e.finalizarTurno())}),a(4,"label",10),l(5,"Altura:"),o(),a(6,"input",11),x("ngModelChange",function(e){p(i);let n=c();return f(n.datosClinicos.altura,e)||(n.datosClinicos.altura=e),u(e)}),o(),a(7,"label",12),l(8,"Peso:"),o(),a(9,"input",13),x("ngModelChange",function(e){p(i);let n=c();return f(n.datosClinicos.peso,e)||(n.datosClinicos.peso=e),u(e)}),o(),a(10,"label",14),l(11,"Temperatura:"),o(),a(12,"input",15),x("ngModelChange",function(e){p(i);let n=c();return f(n.datosClinicos.temperatura,e)||(n.datosClinicos.temperatura=e),u(e)}),o(),a(13,"label",16),l(14,"Presi\xF3n:"),o(),a(15,"input",17),x("ngModelChange",function(e){p(i);let n=c();return f(n.datosClinicos.presion,e)||(n.datosClinicos.presion=e),u(e)}),o(),S(16,te,8,15,"div",18)(17,ie,2,0,"button",5),a(18,"button",19),l(19,"Guardar Historia Cl\xEDnica y Finalizar Turno"),o()()()}if(r&2){let i=c();s(6),C("ngModel",i.datosClinicos.altura),s(3),C("ngModel",i.datosClinicos.peso),s(3),C("ngModel",i.datosClinicos.temperatura),s(3),C("ngModel",i.datosClinicos.presion),s(),m("ngForOf",i.datosClinicos.dinamicos),s(),m("ngIf",i.datosClinicos.dinamicos.length<3)}}var pe=(()=>{let d=class d{constructor(t,e,n){this.authService=t,this.turnoService=e,this.historiaClinicaService=n,this.turnos=[],this.turnosFiltrados=[],this.especialidades=[],this.pacientes=[],this.filtroEspecialidad="",this.filtroPaciente="",this.mostrarFormulario=!1,this.turnoSeleccionado=null,this.filtroGeneral="",this.datosClinicos={altura:"",peso:"",temperatura:"",presion:"",dinamicos:[{clave:"",valor:""}]}}ngOnInit(){return b(this,null,function*(){let t=yield this.authService.usuarioActual();this.turnoService.getTurnosByEspecialista(t.uid).subscribe(e=>{this.turnoService.cargarHistoriasClinicas(e).subscribe(n=>{this.turnos=n,this.turnosFiltrados=n,this.obtenerEspecialidadesYPacientes(n)})})})}obtenerEspecialidadesYPacientes(t){let e=new Set,n=new Set;t.forEach(h=>{e.add(h.especialidad),n.add({id:h.pacienteId,nombre:h.pacienteNombre})}),this.especialidades=Array.from(e),this.pacientes=Array.from(n)}aplicarFiltro(){this.turnosFiltrados=this.turnos.filter(t=>this.buscarEnTurno(t,this.filtroGeneral))}cancelarTurno(t,e){return b(this,null,function*(){t.estado!=="realizado"&&t.estado!=="cancelado"&&(t.estado="cancelado",t.comentario=e,yield this.turnoService.actualizarTurno(t))})}rechazarTurno(t,e){return b(this,null,function*(){t.estado==="pendiente"&&(t.estado="cancelado",t.comentario=e,yield this.turnoService.actualizarTurno(t))})}aceptarTurno(t){return b(this,null,function*(){t.estado==="pendiente"&&(t.estado="confirmado",yield this.turnoService.actualizarTurno(t))})}mostrarFormularioHistoriaClinica(t){this.turnoSeleccionado=t,this.mostrarFormulario=!0}agregarDatoDinamico(){this.datosClinicos.dinamicos.length<3&&this.datosClinicos.dinamicos.push({clave:"",valor:""})}eliminarDatoDinamico(t){this.datosClinicos.dinamicos.length>1&&this.datosClinicos.dinamicos.splice(t,1)}finalizarTurno(){return b(this,null,function*(){if(this.turnoSeleccionado){this.turnoSeleccionado.estado="realizado",yield this.turnoService.actualizarTurno(this.turnoSeleccionado);let t={id:"",turnoId:this.turnoSeleccionado.id,pacienteId:this.turnoSeleccionado.pacienteId,especialistaId:this.turnoSeleccionado.especialistaId,fecha:new Date,altura:this.datosClinicos.altura,peso:this.datosClinicos.peso,temperatura:this.datosClinicos.temperatura,presion:this.datosClinicos.presion,nombrePaciente:this.turnoSeleccionado.pacienteNombre,nombreEspecialista:this.turnoSeleccionado.especialistaNombre,datosDinamicos:this.datosClinicos.dinamicos};yield this.historiaClinicaService.agregarHistoriaClinica(t),this.mostrarFormulario=!1,this.turnoSeleccionado=null,this.datosClinicos={altura:"",peso:"",temperatura:"",presion:"",dinamicos:[{clave:"",valor:""}]}}})}verResenia(t){(t.estado==="realizado"||t.estado==="cancelado")&&(t.mostrarresenia=!t.mostrarresenia,t.mostrarresenia&&!t.comentario&&this.turnoService.obtenerComentario(t.id).subscribe(e=>{t.comentario=e||"No hay rese\xF1a"}))}buscarEnTurno(t,e){if(!e||(e=e.toLowerCase(),t.especialidad.toLowerCase().includes(e)||t.pacienteNombre.toLowerCase().includes(e)||t.estado.toLowerCase().includes(e)||t.fechaHora.toString().toLowerCase().includes(e)))return!0;if(t.historiaClinica){let{altura:n,peso:h,temperatura:T,presion:j,datosDinamicos:Y}=t.historiaClinica;if(n.toString().includes(e)||h.toString().includes(e)||T.toString().includes(e)||j.toLowerCase().includes(e)||Y.some(y=>y.clave.toLowerCase().includes(e)||y.valor.toLowerCase().includes(e)))return!0}return!1}};d.\u0275fac=function(e){return new(e||d)(E(z),E(G),E(q))},d.\u0275cmp=M({type:d,selectors:[["app-turnos-especialista"]],standalone:!0,features:[V],decls:4,vars:3,consts:[[1,"filtros"],["type","text","placeholder","Buscar...",3,"ngModelChange","input","ngModel"],["class","turno",4,"ngFor","ngForOf"],["class","formulario-historia-clinica",4,"ngIf"],[1,"turno"],[3,"click",4,"ngIf"],[4,"ngIf"],[3,"click"],[1,"formulario-historia-clinica"],[3,"ngSubmit"],["for","altura"],["id","altura","name","altura","required","",3,"ngModelChange","ngModel"],["for","peso"],["id","peso","name","peso","required","",3,"ngModelChange","ngModel"],["for","temperatura"],["id","temperatura","name","temperatura","required","",3,"ngModelChange","ngModel"],["for","presion"],["id","presion","name","presion","required","",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["type","submit"],[3,"for"],["required","",3,"ngModelChange","id","ngModel","name"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"input",1),x("ngModelChange",function(T){return f(n.filtroGeneral,T)||(n.filtroGeneral=T),T}),g("input",function(){return n.aplicarFiltro()}),o()(),S(2,$,16,13,"div",2)(3,ne,20,6,"div",3)),e&2&&(s(),C("ngModel",n.filtroGeneral),s(),m("ngForOf",n.turnosFiltrados),s(),m("ngIf",n.mostrarFormulario))},dependencies:[k,P,A,H,D,O,L,R,B,N,W],styles:["h2[_ngcontent-%COMP%]{color:#2c3e50;text-align:center;margin-bottom:20px}div[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px}input[type=text][_ngcontent-%COMP%]{width:calc(100% - 22px);padding:10px;margin-bottom:10px;border:1px solid #bdc3c7;border-radius:4px}.turno[_ngcontent-%COMP%]{background-color:#ecf0f1;border-left:5px solid #3498db;padding:15px;margin-bottom:20px;border-radius:4px}.turno[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#34495e}button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#2980b9}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:#0006}.modal-content[_ngcontent-%COMP%]{background-color:#fefefe;margin:auto;padding:20px;border-radius:4px;width:80%;max-width:500px}.close[_ngcontent-%COMP%]{color:#aaa;float:right;font-size:28px;font-weight:700}.close[_ngcontent-%COMP%]:hover, .close[_ngcontent-%COMP%]:focus{color:#000;text-decoration:none;cursor:pointer}"]});let r=d;return r})();export{pe as a};
